
# ุชุงุจุน `abs()` ุฏุฑ Prometheus

ุชุงุจุน `abs()` ฺฉ ุงุฒ ุชูุงุจุน ุฑุงุถ ุฏุฑ Prometheus ุงุณุช ฺฉู ุจุฑุง ูุญุงุณุจู **ููุฏุงุฑ ูุทูู** (Absolute Value) ฺฉ ูุชุฑฺฉ ุงุณุชูุงุฏู ูโุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุชุงุจุน `abs()`

ุชุงุจุน `abs()` ููุฏุงุฑ ูุทูู ฺฉ ุณุฑ ุฒูุงู ุง ฺฉ ุจุฑุฏุงุฑ ุฑุง ูุญุงุณุจู ูโฺฉูุฏุ ุนู:
- ุงฺฏุฑ ููุฏุงุฑ ูุซุจุช ุจุงุดุฏุ ุจุฏูู ุชุบุฑ ุจุงู ูโูุงูุฏ
- ุงฺฏุฑ ููุฏุงุฑ ููู ุจุงุดุฏุ ุนูุงูุช ุขู ุจู ูุซุจุช ุชุบุฑ ูโฺฉูุฏ

### ูุฑูุช ฺฉู:
```promql
abs(v instant-vector)
```

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ:

### ูุซุงู ฑ: ูุญุงุณุจู ููุฏุงุฑ ูุทูู ฺฉ ูุชุฑฺฉ
```promql
abs(temperature_celsius{instance="server01"})
```
ุงฺฏุฑ ููุฏุงุฑ `temperature_celsius` ุจุฑุงุจุฑ ุจุง `-15` ุจุงุดุฏุ ูุชุฌู `15` ุฎูุงูุฏ ุจูุฏ.

### ูุซุงู ฒ: ุงุณุชูุงุฏู ุจุง ุชูุงุจุน ุฏฺฏุฑ
```promql
abs(delta(cpu_temp_celsius[2h]))
```
ุงู ูพุฑุณโูุฌู ุชุบุฑุงุช ุฏูุง CPU ุฏุฑ 2 ุณุงุนุช ฺฏุฐุดุชู ุฑุง ูุญุงุณุจู ู ุณูพุณ ููุฏุงุฑ ูุทูู ุขู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

### ูุซุงู ณ: ุจุฑุง ูุชุฑฺฉโูุง ฺฉู ููฺฉู ุงุณุช ููู ุจุงุดูุฏ
```promql
abs(disk_free_bytes - disk_total_bytes)
```

## ููุงุฑุฏ ุงุณุชูุงุฏู ุฑุงุฌ:

ฑ. **ุญุฐู ุฌูุช ุฏุฑ ุชุบุฑุงุช**: ููุช ููุท ุงูุฏุงุฒู ุชุบุฑ ููู ุงุณุช ูู ุฌูุช ุขู
ฒ. **ูุญุงุณุจุงุช ุฎุทุง**: ููุช ูโุฎูุงูุฏ ุงุฎุชูุงู ุจู ููุงุฏุฑ ูุงูุน ุฑุง ุจุฏูู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุนูุงูุช ุงูุฏุงุฒู ุจฺฏุฑุฏ
ณ. **ูพุฑุฏุงุฒุด ูุชุฑฺฉโูุง ฺฉู ููฺฉู ุงุณุช ููุงุฏุฑ ููู ุชููุฏ ฺฉููุฏ**

## ูฺฉุงุช ููู:

- ุชุงุจุน `abs()` ููุท ุฑู instant vectorูุง ฺฉุงุฑ ูโฺฉูุฏ
- ุงู ุชุงุจุน ุจุฑฺุณุจโูุง ูุชุฑฺฉ ุฑุง ุญูุธ ูโฺฉูุฏ
- ุจุฑุง range vectorูุง ุจุงุฏ ุงุจุชุฏุง ุงุฒ ุชูุงุจุน ูุซู `delta()` ุง `rate()` ุงุณุชูุงุฏู ฺฉูุฏ

---


# ุชุงุจุน `absent()` ุฏุฑ Prometheus

ุชุงุจุน `absent()` ฺฉ ุชุงุจุน ููุฏ ุฏุฑ PromQL ุงุณุช ฺฉู ุจุฑุง ุชุดุฎุต ุนุฏู ูุฌูุฏ ุฏุงุฏู (missing metrics) ุงุณุชูุงุฏู ูโุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู:

ุชุงุจุน `absent()` ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ฺฉ ูุชุฑฺฉ ุฎุงุต ุง ูุฌููุนูโุง ุงุฒ ูุชุฑฺฉโูุง ูุฌูุฏ ุฏุงุฑูุฏ ุง ุฎุฑ. ุงฺฏุฑ ูุชุฑฺฉ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ููุฏุงุฑ ฑ ุจุฑูโฺฏุฑุฏุงูุฏ ู ุงฺฏุฑ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ูุชุฌู ุฎุงู (no data) ุจุฑูโฺฏุฑุฏุงูุฏ.

## ุณูุงุฑููุง ุงุณุชูุงุฏู:

ฑ. **ูุงูุชูุฑูฺฏ ูุฌูุฏ ูุชุฑฺฉโูุง ุญุงุช**:
   - ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุขุง ูุชุฑฺฉโูุง ููู ูุงููุฏ `up` ุง ูุชุฑฺฉโูุง ุณูุงุฑุด ุดูุง ูุฌูุฏ ุฏุงุฑูุฏ ุง ุฎุฑ.

ฒ. **ุชุดุฎุต ุญุฐู ุง ุบุฑูุนุงู ุดุฏู ุงฺฉุณูพูุฑุชุฑูุง**:
   - ููุช ฺฉ ุงฺฉุณูพูุฑุชุฑ ุงุฒ ฺฉุงุฑ ูโุงูุชุฏ ุง ุญุฐู ูโุดูุฏ.

ณ. **ุจุฑุฑุณ ูพฺฉุฑุจูุฏ ุงุดุชุจุงู**:
   - ููุช ูุชุฑฺฉโูุง ุจู ุฏูู ูพฺฉุฑุจูุฏ ูุงุฏุฑุณุช ุฌูุนโุขูุฑ ููโุดููุฏ.

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ:

### ูุซุงู ฑ: ุจุฑุฑุณ ูุฌูุฏ ูุชุฑฺฉ `up`
```promql
absent(up)
```
- ุงฺฏุฑ ูฺ ูููููโุง ุงุฒ `up` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุฎุฑูุฌ ฺฉ ุณุฑ ุฒูุงู ุจุง ููุฏุงุฑ ฑ ุฎูุงูุฏ ุจูุฏ.
- ุงฺฏุฑ `up` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ูุชุฌู ุฎุงู ุงุณุช.

### ูุซุงู ฒ: ุจุฑุฑุณ ูุฌูุฏ ูุชุฑฺฉ ุจุฑุง ฺฉ job ุฎุงุต
```promql
absent(up{job="node-exporter"})
```
- ุงู ูพุฑุณโูุฌู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุชุฑฺฉ `up` ุจุฑุง job ุจุง ูุงู `node-exporter` ูุฌูุฏ ุฏุงุฑุฏ ุง ุฎุฑ.

### ูุซุงู ณ: ุชุฑฺฉุจ ุจุง ุณุงุฑ ุชูุงุจุน
```promql
absent(sum by(job) (up))
```
- ุงู ูพุฑุณโูุฌู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ูุฑ jobุง ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุชุฑฺฉ `up` ูุฏุงุดุชู ุจุงุดุฏ.

## ูฺฉุงุช ููู:

ฑ. ุชุงุจุน `absent()` ููุท ุจุฑุง ูุชุฑฺฉโูุง instant vector ฺฉุงุฑ ูโฺฉูุฏ.
ฒ. ุงู ุชุงุจุน ุจุฑุง ุงุฌุงุฏ ุขูุงุฑูโูุง ุฒูุงู ฺฉู ูุชุฑฺฉโูุง ูุงูพุฏุฏ ูโุดููุฏ ุจุณุงุฑ ููุฏ ุงุณุช.
ณ. ูุนูููุงู ุฏุฑ ุณุณุชูโูุง ูุงูุชูุฑูฺฏ ุจุฑุง ุงุทููุงู ุงุฒ ุงูฺฉู ุชูุงู ุงุฌุฒุง ููุฑุฏ ุงูุชุธุงุฑ ุฏุฑ ุญุงู ฺฏุฒุงุฑุด ุฏุงุฏู ูุณุชูุฏ ุงุณุชูุงุฏู ูโุดูุฏ.

## ูุซุงู ุขูุงุฑู:
```promql
absent(up{job="node-exporter"}) == 1
```
ุงู ุนุจุงุฑุช ููุช ูุนุงู ูโุดูุฏ ฺฉู ุงฺฉุณูพูุฑุชุฑ node-exporter ูฺ ุฏุงุฏูโุง ุงุฑุณุงู ูฺฉุฑุฏู ุจุงุดุฏ.


-------

# ุชุงุจุน `absent_over_time()` ุฏุฑ Prometheus

 ุจุฑุง ุชุดุฎุต ุนุฏู ูุฌูุฏ ุฏุงุฏู (missing data) ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต ุงุณุชูุงุฏู ูโุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ฺฉ ูุชุฑฺฉ ุฎุงุต ุฏุฑ ุทูู ฺฉ ุจุงุฒู ุฒูุงู ฺฉุงููุงู ูุนุงู ุงุณุช ุง ุฎุฑ.

## ูุญูู ฺฉุงุฑ

- ุงฺฏุฑ ูุชุฑฺฉ ููุฑุฏ ูุธุฑ **ุฏุฑ ฺฉู ุจุงุฒู ุฒูุงู ูุดุฎุต ุดุฏู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ**ุ ููุฏุงุฑ 1 ุจุฑูโฺฏุฑุฏุงูุฏ
- ุงฺฏุฑ **ุญุฏุงูู ฺฉ ููููู ุงุฒ ูุชุฑฺฉ ุฏุฑ ุขู ุจุงุฒู ุฒูุงู ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ**ุ ูุชุฌู ุฎุงู (no data) ุจุฑูโฺฏุฑุฏุงูุฏ

## ูุฑูุช ฺฉู

```promql
absent_over_time(v range-vector)
```

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ

### ูุซุงู ฑ: ุจุฑุฑุณ ูุฌูุฏ ูุชุฑฺฉ `up` ุฏุฑ 5 ุฏููู ฺฏุฐุดุชู

```promql
absent_over_time(up[5m])
```

### ูุซุงู ฒ: ุจุฑุฑุณ ูุฌูุฏ ูุชุฑฺฉ ุจุฑุง ฺฉ ููููู ุฎุงุต

```promql
absent_over_time(up{instance="server01"}[1h])
```

### ูุซุงู ณ: ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุฏฺฏุฑ

```promql
absent_over_time(sum by(job) (up)[30m])
```

## ุชูุงูุช ุจุง `absent()`

ฑ. `absent()` ููุท ูุถุนุช ูุนู ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ (instant vector)
ฒ. `absent_over_time()` ูุถุนุช ุฑุง ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ุจุฑุฑุณ ูโฺฉูุฏ (range vector)

## ููุงุฑุฏ ุงุณุชูุงุฏู ูุนููู

ฑ. **ุชุดุฎุต ุงฺฉุณูพูุฑุชุฑูุง ุงุฒ ฺฉุงุฑ ุงูุชุงุฏู**: ููุช ฺฉ ุงฺฉุณูพูุฑุชุฑ ุจุฑุง ูุฏุช ุทููุงู ุฏุงุฏู ุงุฑุณุงู ูฺฉุฑุฏู ุจุงุดุฏ

ฒ. **ูุงูุชูุฑูฺฏ ุณูุงูุช ูุชุฑฺฉโูุง**: ุงุทููุงู ุงุฒ ุงูฺฉู ูุชุฑฺฉโูุง ุญุงุช ุจู ุทูุฑ ูุฏุงูู ฺฏุฒุงุฑุด ูโุดููุฏ

ณ. **ุชุดุฎุต ูุดฺฉูุงุช ุดุจฺฉู**: ููุช ุงุฑุชุจุงุท ุจุง ุงฺฉุณูพูุฑุชุฑูุง ูุทุน ุดุฏู ุจุงุดุฏ

## ูุซุงู ุจุฑุง ุงุฌุงุฏ ุขูุงุฑู

```promql
absent_over_time(up{job="node-exporter"}[15m]) == 1
```

ุงู ุขูุงุฑู ุฒูุงู ูุนุงู ูโุดูุฏ ฺฉู ูุชุฑฺฉ `up` ุจุฑุง job ูุฑุจูุท ุจู node-exporter ุจู ูุฏุช 15 ุฏููู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ.

## ูฺฉุงุช ููู

- ุงู ุชุงุจุน ุจุฑุง range vectorูุง ฺฉุงุฑ ูโฺฉูุฏ
- ุจุงุฒู ุฒูุงู ([5m], [1h] ู...) ุจุงุฏ ูุดุฎุต ุดูุฏ
- ูุนูููุงู ุฏุฑ ุณุณุชูโูุง ูุงูุชูุฑูฺฏ ุจุฑุง ุชุดุฎุต ูุดฺฉูุงุช ุทููุงู ูุฏุช ุงุณุชูุงุฏู ูโุดูุฏ
---

# ุชุงุจุน `changes()` ุฏุฑ Prometheus
 
  ุชุนุฏุงุฏ ุชุบุฑุงุช ููุฏุงุฑ ฺฉ ูุชุฑฺฉ ุฑุง ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต ูุญุงุณุจู ูฺฉูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ุชุนุฏุงุฏ ุฏูุนุงุช ฺฉู ููุฏุงุฑ ฺฉ ูุชุฑฺฉ ุฏุฑ ุจุงุฒู ุฒูุงู ุฏุงุฏู ุดุฏู ุชุบุฑ ฺฉุฑุฏู ุงุณุช ุฑุง ูโุดูุงุฑุฏ.

## ูุญูู ุนููฺฉุฑุฏ

- ุจุฑุง ูุฑ ุณุฑ ุฒูุงูุ ุชุนุฏุงุฏ ุชุบุฑุงุช ููุฏุงุฑ ุฑุง ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู ูโุดูุงุฑุฏ
- ูุฑ ุจุงุฑ ฺฉู ููุฏุงุฑ ูุชุฑฺฉ ูุณุจุช ุจู ููููู ูุจู ุชุบุฑ ฺฉูุฏุ ฺฉ ุนุฏุฏ ุจู ุดูุงุฑูุฏู ุงุถุงูู ูโุดูุฏ
- ุชุบุฑุงุช ุจู `NaN` (ุฏุงุฏู ูุฌูุฏ ูุฏุงุฑุฏ) ู ฺฉ ููุฏุงุฑ ูุนุชุจุฑ ูุฒ ุจู ุนููุงู ุชุบุฑ ูุญุณูุจ ูโุดูุฏ

## ูุฑูุช ฺฉู

```promql
changes(v range-vector)
```

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ

### ูุซุงู ฑ: ุดูุงุฑุด ุชุบุฑุงุช ฺฉ ูุชุฑฺฉ ุฏุฑ ต ุฏููู ฺฏุฐุดุชู

```promql
changes(process_resident_memory_bytes[5m])
```

### ูุซุงู ฒ: ุจุฑุฑุณ ุชุบุฑุงุช ูุถุนุช ฺฉ ุณุฑูุณ

```promql
changes(up{job="api-server"}[1h])
```

### ูุซุงู ณ: ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุฏฺฏุฑ

```promql
sum by(instance) (changes(process_cpu_seconds_total[5m]))
```

## ููุงุฑุฏ ุงุณุชูุงุฏู ูุนููู

ฑ. **ุชุดุฎุต ููุณุงูุงุช**: ุจุฑุง ุดูุงุณุง ูุชุฑฺฉโูุง ฺฉู ููุฏุงุฑุดุงู ุจู ุทูุฑ ุบุฑุนุงุฏ ุฏุฑ ุญุงู ุชุบุฑ ุงุณุช
ฒ. **ูุงูุชูุฑูฺฏ ูุถุนุช**: ุจุฑุง ุจุฑุฑุณ ุชุนุฏุงุฏ ุฏูุนุงุช ุชุบุฑ ูุถุนุช ฺฉ ุณุฑูุณ
ณ. **ุชุญูู ุฑูุชุงุฑ**: ุจุฑุง ูููุฏู ุงูฺฏููุง ุชุบุฑ ุฏุฑ ูุชุฑฺฉโูุง

## ูุซุงู ุจุฑุง ุงุฌุงุฏ ุขูุงุฑู

```promql
changes(up{job="mysql"}[15m]) > 3
```

ุงู ุขูุงุฑู ุฒูุงู ูุนุงู ูโุดูุฏ ฺฉู ุณุฑูุณ MySQL ุจุด ุงุฒ ณ ุจุงุฑ ุฏุฑ ฑต ุฏููู ุชุบุฑ ูุถุนุช ุฏุงุฏู ุจุงุดุฏ.

## ูฺฉุงุช ููู

- ุงู ุชุงุจุน ุจุฑุง range vectorูุง ฺฉุงุฑ ูโฺฉูุฏ
- ุชุบุฑุงุช ุจู `NaN` ู ฺฉ ููุฏุงุฑ ูุนุชุจุฑ ูุฒ ุดูุงุฑุด ูโุดูุฏ
- ุจุฑุง ูุชุฑฺฉโูุง counterุ ูุนูููุงู ุงุฒ `rate()` ุง `irate()` ููุงุณุจโุชุฑ ุงุณุช
- ููุฏุงุฑ ุจุงุฒฺฏุดุช ููุดู ฺฉ ุนุฏุฏ ุตุญุญ ุงุณุช

## ุชูุงูุช ุจุง `deriv()`

- `changes()` ููุท ุชุนุฏุงุฏ ุชุบุฑุงุช ุฑุง ูโุดูุงุฑุฏ
- `deriv()` ูุฑุฎ ุชุบุฑ ุฑุง ุฏุฑ ูุงุญุฏ ุฒูุงู ูุญุงุณุจู ูโฺฉูุฏ (ูุดุชู)


---------

# ุชุงุจุน `clamp()` ุฏุฑ Prometheus

ุฑุง ูุญุฏูุฏ ฺฉุฑุฏู ููุงุฏุฑ ฺฉ ูุชุฑฺฉ ุฏุฑ ฺฉ ุจุงุฒู ูุดุฎุต ุงุณุชูุงุฏู ูุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ููุงุฏุฑ ฺฉ ูุชุฑฺฉ ุฑุง ุจู ูุญุฏูุฏู ุชุนุฑู ุดุฏู ุดูุง ูุญุฏูุฏ ูฺฉูุฏ:
- ููุงุฏุฑ ฺฉูุชุฑ ุงุฒ ุญุฏุงูู ุฑุง ุจู ุญุฏุงูู ุชูุธู ูฺฉูุฏ
- ููุงุฏุฑ ุจุดุชุฑ ุงุฒ ุญุฏุงฺฉุซุฑ ุฑุง ุจู ุญุฏุงฺฉุซุฑ ุชูุธู ูฺฉูุฏ
- ููุงุฏุฑ ุฏุฑูู ูุญุฏูุฏู ุฑุง ุจุฏูู ุชุบุฑ ุจุงู ูฺฏุฐุงุฑุฏ

## ุงููุงุน ุชูุงุจุน clamp

Prometheus ุฏู ููุน ุชุงุจุน clamp ุงุฑุงุฆู ูุฏูุฏ:

ฑ. `clamp_min(v instant-vector, min scalar)`
   - ููุท ฺฉ ุญุฏุงูู ุชุนู ูฺฉูุฏ
   - ูุซุงู: `clamp_min(temperature, 10)`

ฒ. `clamp_max(v instant-vector, max scalar)`
   - ููุท ฺฉ ุญุฏุงฺฉุซุฑ ุชุนู ูฺฉูุฏ
   - ูุซุงู: `clamp_max(cpu_usage, 90)`

ณ. ุชุฑฺฉุจ ูุฑ ุฏู ุจุฑุง ุงุฌุงุฏ ูุญุฏูุฏู ฺฉุงูู

## ูุฑูุช ฺฉู

```promql
clamp(v instant-vector, min scalar, max scalar)
```

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ

### ูุซุงู ฑ: ูุญุฏูุฏ ฺฉุฑุฏู ุฏูุง ุจู 10 ุชุง 30 ุฏุฑุฌู

```promql
clamp(temperature_celsius, 10, 30)
```

### ูุซุงู ฒ: ุฌููฺฏุฑ ุงุฒ ููุงุฏุฑ ููู

```promql
clamp_min(memory_usage_bytes, 0)
```

### ูุซุงู ณ: ูุญุฏูุฏ ฺฉุฑุฏู ุฏุฑุตุฏ CPU

```promql
clamp(cpu_usage_percent, 0, 100)
```

## ููุงุฑุฏ ุงุณุชูุงุฏู ูุนููู

ฑ. **ูพุงฺฉุณุงุฒ ุฏุงุฏูโูุง**: ุญุฐู ููุงุฏุฑ ุบุฑููุทู ุง ูุงููฺฉู
ฒ. **ุชูู ูููุฏุงุฑูุง**: ูุญุฏูุฏ ฺฉุฑุฏู ููุงุฏุฑ ุจุฑุง ููุงุด ุจูุชุฑ
ณ. **ูุญุงุณุจุงุช ุงูู**: ุงุทููุงู ุงุฒ ุงูฺฉู ููุงุฏุฑ ุฏุฑ ูุญุฏูุฏู ูุนุชุจุฑ ุจุงู ููุงููุฏ

## ูฺฉุงุช ููู

- ุชุงุจุน `clamp()` ุจุฑฺุณุจโูุง ูุชุฑฺฉ ุฑุง ุญูุธ ูฺฉูุฏ
- ุจุฑุง range vectorูุง ุจุงุฏ ุงุจุชุฏุง ุงุฒ ุชูุงุจุน ูุซู `rate()` ุงุณุชูุงุฏู ฺฉูุฏ
- ููุงุฏุฑ NaN ุฑุง ุชุบุฑ ููุฏูุฏ
- ุญุฏุงูู ู ุญุฏุงฺฉุซุฑ ูุชูุงููุฏ ุงุนุฏุงุฏ ููู ุจุงุดูุฏ

## ูุซุงู ูพุดุฑูุชู

```promql
clamp(
  rate(http_requests_total[5m]),
  0,  # ุญุฏุงูู
  1000 # ุญุฏุงฺฉุซุฑ
)
```

ุงู ูุซุงู ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง HTTP ุฑุง ุจู 0 ุชุง 1000 ุฏุฑุฎูุงุณุช ุจุฑ ุซุงูู ูุญุฏูุฏ ูฺฉูุฏ.

-----

# ุชูุงุจุน `day_of_*` ุฏุฑ Prometheus

ุฏุฑ Prometheus ฺูุฏู ุชุงุจุน ูุฑุจูุท ุจู ุชุงุฑุฎ ู ุฒูุงู ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุจุฎุดโูุง ูุฎุชูู ุชุงุฑุฎ ุฑุง ุงุฒ ุชุงูโุงุณุชููพโูุง ุงุณุชุฎุฑุงุฌ ฺฉูุฏ. ุฏุฑ ุงูุฌุง ุจู ุชูุงุจุน ฺฉู ุจุง `day_of_` ุดุฑูุน ูโุดููุฏ ูโูพุฑุฏุงุฒู:

## ฑ. `day_of_month()`

**ฺฉุงุฑุจุฑุฏ**: ุงุณุชุฎุฑุงุฌ ุฑูุฒ ูุงู ุงุฒ ฺฉ ุชุงูโุงุณุชููพ (ุนุฏุฏ ุจู 1 ุชุง 31)

**ุณูุชฺฉุณ**:
```promql
day_of_month(v instant-vector)
```

**ูุซุงู**:
```promql
day_of_month(timestamp(up))
```
ุงู ูพุฑุณโูุฌู ุฑูุฒ ุฌุงุฑ ูุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ (ูุซูุงู 15 ุจุฑุง ูพุงูุฒุฏูู ูุงู).

## ฒ. `day_of_week()`

**ฺฉุงุฑุจุฑุฏ**: ุงุณุชุฎุฑุงุฌ ุฑูุฒ ููุชู (ฺฉุดูุจู=0 ุชุง ุดูุจู=6)

**ุณูุชฺฉุณ**:
```promql
day_of_week(v instant-vector)
```

**ูุซุงู**:
```promql
day_of_week(timestamp(process_start_time_seconds))
```
ููุฏุงุฑ 0 ุจุฑุง ฺฉุดูุจูุ 1 ุจุฑุง ุฏูุดูุจู ู ุงู ุขุฎุฑ.

## ณ. `day_of_year()`

**ฺฉุงุฑุจุฑุฏ**: ุงุณุชุฎุฑุงุฌ ุฑูุฒ ุณุงู (ุนุฏุฏ ุจู 1 ุชุง 365 ุง 366 ุฏุฑ ุณุงู ฺฉุจุณู)

**ุณูุชฺฉุณ**:
```promql
day_of_year(v instant-vector)
```

**ูุซุงู**:
```promql
day_of_year(timestamp(up))
```
ูุซูุงู ููุฏุงุฑ 1 ุจุฑุง ุงูู ูุฑูุฑุฏู ู 365 ุจุฑุง ุขุฎุฑ ุงุณููุฏ.

## ฺฉุงุฑุจุฑุฏูุง ุนูู:

ฑ. **ููุชุฑ ฺฉุฑุฏู ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ ุฑูุฒ**:
   ```promql
   up{job="api"} and day_of_week(timestamp(up)) < 5
   ```
   (ููุท ุฑูุฒูุง ฺฉุงุฑ ููุชู)

ฒ. **ุชุฌุฒู ู ุชุญูู ุงูฺฏููุง ููุชฺฏ**:
   ```promql
   avg by (day_of_week) (rate(http_requests_total[1d]))
   ```

ณ. **ฺฏุฒุงุฑุดโุฏู ูุงูุงูู**:
   ```promql
   sum by (day_of_month) (sales_events_total)
   ```

## ูฺฉุงุช ููู:

- ุชูุงู ุงู ุชูุงุจุน ุฑู instant vectorูุง ฺฉุงุฑ ูโฺฉููุฏ
- ูุฑูุฏ ุจุงุฏ ุชุงูโุงุณุชููพ ุจุงุดุฏ (ูุนูููุงู ุจุง ุชุงุจุน `timestamp()` ูโฺฏุฑู)
- ููุงุฏุฑ ุจุฑฺฏุดุช ููุดู ุงุนุฏุงุฏ ุตุญุญ ูุณุชูุฏ
- ุจุฑุง range vectorูุง ุจุงุฏ ุงุฒ ุชูุงุจุน aggregation ุงุณุชูุงุฏู ฺฉูุฏ

## ูุซุงู ุชุฑฺฉุจ:

```promql
# ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุขุฎุฑ ููุชู (ุดูุจู ู ฺฉุดูุจู)
sum(rate(http_requests_total[1h])) by (service)
  * on() group_left()
(day_of_week(timestamp(up)) >= 5)
```

ุงู ูพุฑุณโูุฌู ููุท ุฏุงุฏูโูุง ูุฑุจูุท ุจู ุฑูุฒูุง ุขุฎุฑ ููุชู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ.

-----------


# ุชุงุจุน `delta()` ุฏุฑ Prometheus

ุจุฑุง ูุญุงุณุจู ุชุบุฑุงุช ููุฏุงุฑ ฺฉ ูุชุฑฺฉ ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต ุงุณุชูุงุฏู ูโุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ุชูุงูุช ุจู ุงููู ู ุขุฎุฑู ููุฏุงุฑ ฺฉ ูุชุฑฺฉ ุฏุฑ ุจุงุฒู ุฒูุงู ุฏุงุฏู ุดุฏู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

```
delta = ููุฏุงุฑ ุขุฎุฑ - ููุฏุงุฑ ุงูู
```

## ูฺฺฏโูุง ฺฉูุฏ:

ฑ. **ูุฎุตูุต ูุชุฑฺฉโูุง ููุน Counter**: ุจุฑุง ูุชุฑฺฉโูุง ฺฉู ููุท ุงูุฒุงุด ูโุงุจูุฏ (ูุงููุฏ ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง) ููุงุณุจ ุงุณุช
ฒ. **ููุงุจูู ุจุง Reset**: ุงฺฏุฑ Counter ุฑุณุช ุดูุฏุ ูุญุงุณุจู ุฑุง ุจู ุฏุฑุณุช ุงูุฌุงู ูโุฏูุฏ
ณ. **ุจุงุฒู ุฒูุงู**: ุญุชูุงู ูุงุฒ ุจู ุชุนู ุจุงุฒู ุฒูุงู ุฏุงุฑุฏ (ูุซู [5m]ุ [1h])

## ูุฑูุช ฺฉู:

```promql
delta(v range-vector)
```

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ:

### ูุซุงู ฑ: ูุญุงุณุจู ุงูุฒุงุด ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู

```promql
delta(http_requests_total[5m])
```

### ูุซุงู ฒ: ูุญุงุณุจู ุงูุฒุงุด ุจุง ฺฏุฑููโุจูุฏ

```promql
delta(http_requests_total{job="api"}[1h])
```

### ูุซุงู ณ: ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุฏฺฏุฑ

```promql
sum by (instance) (delta(process_cpu_seconds_total[1m]))
```

## ุชูุงูุช ุจุง `increase()`:

- ุก`delta()` ููุฏุงุฑ ูุทูู ุชุบุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ (ููฺฉู ุงุณุช ููู ุจุงุดุฏ)
- ุก`increase()` ููุดู ููุฏุงุฑ ุบุฑููู ุจุฑูโฺฏุฑุฏุงูุฏ ู ุจุฑุง Counterูุง ููุงุณุจโุชุฑ ุงุณุช

## ูฺฉุงุช ููู:

ฑ. ููุท ุจุฑุง range vectorูุง ฺฉุงุฑ ูโฺฉูุฏ
ฒ. ุจุฑุง ูุชุฑฺฉโูุง Gauge (ฺฉู ูโุชูุงููุฏ ฺฉุงูุด ุงุจูุฏ) ูุฒ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ
ณ. ููฺฉู ุงุณุช ููุงุฏุฑ ููู ุจุฑฺฏุฑุฏุงูุฏ (ุฏุฑ ุตูุฑุช ฺฉุงูุด ููุฏุงุฑ ูุชุฑฺฉ)
ด. ุฏุฑ ุตูุฑุช ุฑุณุช ุดุฏู Counterุ ูุญุงุณุจุงุช ุฑุง ุชุตุญุญ ูโฺฉูุฏ

## ูุซุงู ูพุดุฑูุชู:

```promql
delta(
  node_network_receive_bytes_total{device="eth0"}[1h]
) / 1024 / 1024
```
(ูุญุงุณุจู ูฺฏุงุจุงุช ุฏุฑุงูุช ุดุฏู ุฏุฑ ฺฉ ุณุงุนุช)


-----

# ุชุงุจุน `deriv()` ุฏุฑ Prometheus

 ุจุฑุง ูุญุงุณุจู **ูุฑุฎ ุชุบุฑุงุช** ฺฉ ูุชุฑฺฉ ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ุงุณุชูุงุฏู ูุดูุฏ.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน **ูุดุชู** (ูุฑุฎ ุชุบุฑ) ฺฉ ูุชุฑฺฉ Gauge ุฑุง ุฏุฑ ุจุงุฒู ุฒูุงู ูุดุฎุต ูุญุงุณุจู ูฺฉูุฏ ู ูุดุงู ูุฏูุฏ ฺฉู ููุฏุงุฑ ูุชุฑฺฉ ุจุง ฺู ุณุฑุนุช ุฏุฑ ุญุงู ุชุบุฑ ุงุณุช.

## ูุฑูุช ฺฉู:
```promql
deriv(v range-vector)
```

## ูฺฺฏโูุง ฺฉูุฏ:
ฑ. ููุงุณุจ ุจุฑุง ูุชุฑฺฉโูุง ููุน **Gauge** (ููุงุฏุฑ ูุชุบุฑ)
ฒ. ูุญุงุณุจู **ูุฑุฎ ุชุบุฑ ุจุฑ ุซุงูู**
ณ. ุงุณุชูุงุฏู ุงุฒ ุฑฺฏุฑุณูู ุฎุท ุจุฑุง ูุญุงุณุจู ุฏููุชุฑ
ด. ูุงุฒ ุจู ุชุนู ุจุงุฒู ุฒูุงู (ูุซูุงู [5m], [1h])

## ูุซุงูโูุง ฺฉุงุฑุจุฑุฏ:

### ูุซุงู ฑ: ูุญุงุณุจู ูุฑุฎ ุชุบุฑ ุฏูุง CPU
```promql
deriv(node_cpu_temp_celsius[10m])
```
> ูุชุฌู: ูุฒุงู ุชุบุฑ ุฏูุง ุจุฑ ุญุณุจ ุฏุฑุฌู ุณุงูุชฺฏุฑุงุฏ ุจุฑ ุซุงูู

### ูุซุงู ฒ: ุฑููุฏ ุชุบุฑุงุช ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู
```promql
deriv(process_resident_memory_bytes[1h])
```

### ูุซุงู ณ: ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุฏฺฏุฑ
```promql
avg(deriv(disk_usage_percent[30m]))
```

## ุชูุงูุช ุจุง `delta()` ู `rate()`:
| ุชุงุจุน      | ููุงุณุจ ุจุฑุง    | ุฎุฑูุฌ                          | ุฑูุด ูุญุงุณุจู     |
| --------- | ------------- | ------------------------------ | -------------- |
| `deriv()` | Gauge         | ูุฑุฎ ุชุบุฑ (ููฺฉู ุงุณุช ููู ุจุงุดุฏ) | ุฑฺฏุฑุณูู ุฎุท    |
| `delta()` | Gauge/Counter | ุชุบุฑ ูุทูู                     | ุชูุงูุช ุณุงุฏู     |
| `rate()`  | Counter       | ูุฑุฎ ูุชูุณุท ุชุบุฑ                | ุจุฑ ุงุณุงุณ ุงูุฒุงุด |

## ูฺฉุงุช ููู:
ฑ. ุจุฑุง ูุชุฑฺฉโูุง Counter ุงุฒ `rate()` ุง `irate()` ุงุณุชูุงุฏู ฺฉูุฏ
ฒ. ููุงุฏุฑ ููู ูุดุงู ุฏููุฏู ฺฉุงูุด ูุชุฑฺฉ ุงุณุช
ณ. ุฏูุช ูุญุงุณุจู ุจู ุทูู ุจุงุฒู ุฒูุงู ุจุณุชฺฏ ุฏุงุฑุฏ
ด. ุจุฑุง ููุงุด ุฑููุฏูุง ุจููุฏูุฏุช ููุฏ ุงุณุช

## ูุซุงู ูพุดุฑูุชู:
```promql
# ูพุดโุจู ุฒูุงู ุฑุณุฏู ุจู ุญุฏ ูุฌุงุฒ ุญุงูุธู
predict_linear(
  deriv(process_resident_memory_bytes[1h])[10m:],
  3600
)
```

ุงู ุชุงุจุน ุจุฑุง ุชุญูู ุฑููุฏูุง ู ูพุดโุจู ูุดฺฉูุงุช ุงุญุชูุงู ุจุณุงุฑ ููุฏ ุงุณุช.


----------

### **Double Exponential Smoothing

ุฑูุด **Double Exponential Smoothing (ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู)** ุง ุจู ูุงุฑุณ **ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู**ุ ฺฉ ุงุฒ ุฑูุดโูุง ูพุดโุจู ุณุฑโูุง ุฒูุงู ุงุณุช ฺฉู ุนูุงูู ุจุฑ **ูุงูฺฏูโฺฏุฑ ู ูููุงุฑุณุงุฒ ุฏุงุฏูโูุง**ุ **ุฑููุฏ (Trend)** ุฏุงุฏู ุฑุง ูุฒ ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ.

---

### ๐น ูุฑูุฑ ุจุฑ ุงุฏู ุงุตู

ุฏุฑ **ูููุงุฑุณุงุฒ ููุง ุณุงุฏู (Simple Exponential Smoothing)** ูุฑุถ ูโุดูุฏ ฺฉู ุฏุงุฏูโูุง ุฑููุฏ ุฎุงุต ูุฏุงุฑูุฏ ู ููุท ููุณุงูุงุช ุชุตุงุฏู ุฏุงุฑูุฏ.
ุงูุง ุงฺฏุฑ ุฏุงุฏูโูุง ุฑููุฏ ุงูุฒุงุด ุง ฺฉุงูุด ุฏุงุดุชู ุจุงุดูุฏ (ูุซูุงู ูุฑูุด ูุงูุงูู ฺฉู ุฑู ุจู ุงูุฒุงุด ุงุณุช)ุ ูุฏู ุณุงุฏู ุฏฺฏุฑ ููุงุณุจ ูุณุช.
ุฏุฑ ุงู ุญุงูุช ุงุฒ **Double Exponential Smoothing** ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ูโุชูุงูุฏ **ุณุทุญ (Level)** ู **ุฑููุฏ (Trend)** ุฑุง ุฌุฏุงฺฏุงูู ูุฏู ฺฉูุฏ.

---

### ๐น ูุฑูููโูุง

ุงู ุฑูุด ุฏู ูุคููู ุฏุงุฑุฏ:

ฑ. **ุณุทุญ (Level):**
$$
   [
   L_t = \alpha Y_t + (1 - \alpha)(L_{t-1} + T_{t-1})
   ]$$
   ฺฉู ุฏุฑ ุขู:

โ   * ( Y_t ): ููุฏุงุฑ ูุดุงูุฏูโุดุฏู ุฏุฑ ุฒูุงู ( t )
   * โ( L_t ): ุณุทุญ (ูุงูฺฏู ูููุงุฑุดุฏู) ุฏุฑ ุฒูุงู ( t )
   * โ( T_{t-1} ): ุฑููุฏ ุจุฑุขูุฑุฏุดุฏู ุฏุฑ ุฒูุงู ูุจู
   โ* ( \alpha ): ุถุฑุจ ูููุงุฑุณุงุฒ ุจุฑุง ุณุทุญ (ุจู 0 ู 1)

ฒ. **ุฑููุฏ (Trend):**
  ฺฉู ุฏุฑ ุขู:
$$
   [
   T_t = \beta (L_t - L_{t-1}) + (1 - \beta) T_{t-1}
   ]
 
$$
   * โ( T_t ): ุฑููุฏ ุฏุฑ ุฒูุงู ( t )
   * โ( \beta ): ุถุฑุจ ูููุงุฑุณุงุฒ ุจุฑุง ุฑููุฏ (ุจู 0 ู 1)



ฒ. **ูพุดโุจู (Forecast):**

$$
   [
   \hat{Y}_{t+m} = L_t + mT_t
   ]
$$
   ฺฉู ุฏุฑ ุขู:
   

   * ( m ): ุชุนุฏุงุฏ ฺฏุงูโูุง ูพุดโุจู ุจู ุฌูู ุงุณุช (ูุซูุงู ูพุดโุจู ุจุฑุง ูุงู ุจุนุฏ ุนู ( m = 1 ))

---

### ๐น ุชูุณุฑ ุดููุฏ

โ* ( L_t ): ููุฏุงุฑ "ุณุทุญ" ูุนู ุฏุงุฏู (ูุซู ูุงูฺฏู ูููุงุฑุดุฏู)
โ* ( T_t ): ูุฑุฎ ุชุบุฑ (ุดุจ ุง ุฑููุฏ ุฑุดุฏ/ฺฉุงูุด)
* ุถุฑุงุจ ( \alpha ) ู ( \beta ): ฺฉูุชุฑู ูุฒุงู ูุงฺฉูุด ูุฏู ุจู ุชุบุฑุงุช ุฌุฏุฏ ุฏุงุฏูโูุง
  (ุงฺฏุฑ ูุฒุฏฺฉ 1 ุจุงุดูุฏุ ูุฏู ุจู ุชุบุฑุงุช ุฌุฏุฏ ุณุฑุนโุชุฑ ูุงฺฉูุด ูโุฏูุฏ)

---

### ๐น ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉูุฏ ุฏุงุฏูโูุง ูุฑูุด ูุงูุงูู ุจู ุตูุฑุช ุฒุฑ ุจุงุดูุฏ:

| ูุงู | ูุฑูุด (Y) |
| --- | -------- |
| 1   | 100      |
| 2   | 120      |
| 3   | 130      |
| 4   | 150      |

ูโุจูู ฺฉู ุฑููุฏ ุตุนูุฏ ุฏุงุฑุฏ โ ูพุณ Double Exponential Smoothing ููุงุณุจ ุงุณุช.

ูุฏู ุจุง ูุญุงุณุจู ุณุทุญ ู ุฑููุฏ ุฏุฑ ูุฑ ูุฑุญููุ ูุฑูุด ูุงูโูุง ุขูุฏู ุฑุง ูพุดโุจู ูโฺฉูุฏ (ูุซูุงู ูุงู 5 ู 6).

---

### ๐น ุงููุงุน ูุฏูโูุง

ุฏุฑ ูุงูุน Double Exponential Smoothing ููุน ุฎุงุต ุงุฒ ูุฏูโูุง **Holtโs Linear Trend** ุงุณุชุ ฺฉู ุจุนุฏูุง ุจุง ุงุถุงูู ฺฉุฑุฏู ูุคูููโ ูุตู (**Seasonality**) ุจู ูุฏู **Triple Exponential Smoothing (Holt-Winters)** ุชุจุฏู ุดุฏ.

---

### ๐น ุฏุฑ ูพุงุชูู (ูุซุงู ฺฉูุชุงู ุจุง statsmodels)

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

model = ExponentialSmoothing(data, trend='add').fit()
forecast = model.forecast(5)
print(forecast)
```

ุฏุฑ ุงูุฌุง:

โ* `trend='add'` ุนู ุฑููุฏ ุฎุท ุงูุฒุงุด.
โ* `forecast(5)` ุนู ูพุดโุจู ต ฺฏุงู ุขูุฏู.

---


# ุชุงุจุน `holt_winters()` (Double Exponential Smoothing) ุฏุฑ PromQL

 ุกPrometheus ุงุฒ ูุณุฎู 2.0 ุจู ุจุนุฏ ุชุงุจุน `holt_winters()` ุฑุง ุงุฑุงุฆู ฺฉุฑุฏู ฺฉู ูพุงุฏูโุณุงุฒ Double Exponential Smoothing (ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู) ุงุณุช.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ุจุฑุง **ูพุดโุจู ููุงุฏุฑ ุขูุฏู** ุจุฑ ุงุณุงุณ ุฑููุฏ ุชุงุฑุฎ ุฏุงุฏูโูุง ุงุณุชูุงุฏู ูโุดูุฏ ู ุชุฑฺฉุจ ุงุฒ:

ฑ. ูููุงุฑุณุงุฒ ุณุทุญ ุฏุงุฏู (Level)
ฒ. ูููุงุฑุณุงุฒ ุฑููุฏ (Trend)

## ูุฑูุช ฺฉู:

```promql
holt_winters(v range-vector, sf scalar, tf scalar)
```

- `sf`: ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ (smoothing factor) ุจุฑุง ุณุทุญ (0 < sf < 1)
- `tf`: ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุจุฑุง ุฑููุฏ (0 < tf < 1)

## ูุซุงู ฺฉุงุฑุจุฑุฏ:

```promql
holt_winters(
  node_memory_MemFree_bytes[1h],  # ูุชุฑฺฉ ู ุจุงุฒู ุฒูุงู
  0.3,  # ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุณุทุญ
  0.3   # ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุฑููุฏ
)
```



```promql
holt_winters(node_memory_MemFree_bytes[1h],0.3,0.3)
```
## ูพุงุฑุงูุชุฑูุง ููู:

ฑ. **ูุงฺฉุชูุฑูุง ูููุงุฑุณุงุฒ**:
   - ููุงุฏุฑ ูุฒุฏฺฉ ุจู 0: ูุฒู ุจุดุชุฑ ุจู ุฏุงุฏูโูุง ุชุงุฑุฎ
   - ููุงุฏุฑ ูุฒุฏฺฉ ุจู 1: ูุฒู ุจุดุชุฑ ุจู ุฏุงุฏูโูุง ุงุฎุฑ

ฒ. **ุจุงุฒู ุฒูุงู**:
   - ุจุงุฏ ุจู ุงูุฏุงุฒูโุง ุจุงุดุฏ ฺฉู ุงูฺฏููุง ูุตู ู ุฑููุฏ ุฑุง ูพูุดุด ุฏูุฏ

## ุชูุงูุช ุจุง `predict_linear()`:

| ูฺฺฏ | `holt_winters()` | `predict_linear()` |
|--------|------------------|--------------------|
| ุฑูุด | ูููุงุฑุณุงุฒ ุฏูฺฏุงูู | ุฑฺฏุฑุณูู ุฎุท ุณุงุฏู |
| ููุงุญุธุงุช ุฑููุฏ | ุฏุงุฑุฏ | ุฏุงุฑุฏ |
| ููุงุญุธุงุช ูุตู | ุฎุฑ | ุฎุฑ |
| ูพฺุฏฺฏ | ุจุดุชุฑ | ฺฉูุชุฑ |

## ูฺฉุงุช ููู:

ฑ. ููุท ุจุฑุง **Gauge metrics** ููุงุณุจ ุงุณุช
ฒ. ูุงุฒ ุจู ุชูุธู ุฏูู ูพุงุฑุงูุชุฑูุง ุฏุงุฑุฏ
ณ. ุจุฑุง ูพุดโุจูโูุง ฺฉูุชุงูโูุฏุช ุจูุชุฑ ุนูู ูโฺฉูุฏ
ด. ุฏุฑ ูุณุฎูโูุง ุฌุฏุฏ Prometheus ููฺฉู ุงุณุช ุชุบุฑ ฺฉุฑุฏู ุจุงุดุฏ

ูุซุงู ูพุดุฑูุชู ุจุฑุง ูุงูุชูุฑูฺฏ:

```promql
# ูพุดโุจู ุงุณุชูุงุฏู ุงุฒ CPU ุจุง ูููุงุฑุณุงุฒ ุฏูฺฏุงูู
holt_winters(
  instance:node_cpu_utilisation:rate5m[2h],
  0.5,
  0.2
) > 0.8
```

ุงู ฺฉูุฆุฑ ุฒูุงู ุขูุงุฑู ูโุฏูุฏ ฺฉู ูพุดโุจู ูโุดูุฏ ุงุณุชูุงุฏู ุงุฒ CPU ุงุฒ 80% ุนุจูุฑ ฺฉูุฏ.


ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช

 
---

## ๐งฉ ุชุนุฑู ุชุงุจุน histogram_fraction

```promql
histogram_fraction(ฯ, sum(rate(<histogram>_bucket[range])) by (labels))
```

ุง ุจู ุทูุฑ ฺฉู:

```promql
histogram_fraction(quantile, histogram_metric)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

`histogram_fraction()` ุจุฑุง ูุญุงุณุจู **ฺฉุณุฑ ุงุฒ ูููููโูุง histogram** ฺฉู **ฺฉูุชุฑ ุง ูุณุงู ฺฉ ููุฏุงุฑ ุฎุงุต** ูุณุชูุฏ ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูุดุฎุต ูโฺฉูุฏ ฺู ุณูู ุงุฒ ุฏุฑุฎูุงุณุชโูุง ุง ุฑูุฏุงุฏูุงุ ููุฏุงุฑุดุงู ฺฉูุชุฑ ุงุฒ ฺฉ ุญุฏ ูุนู ุงุณุช.

---

## ๐ง ููุงูู ฺฉูุฏ

1. Histogram ุฏุฑ Prometheus ูุนูููุงู ุดุงูู ฺูุฏ metric ุงุณุช:

| Metric    | ุชูุถุญ                               |
| --------- | ----------------------------------- |
| `_bucket` | ุชุนุฏุงุฏ ูููููโูุง โค ูุฑ ุญุฏ ุจุงูุง (le) |
| `_count`  | ุชุนุฏุงุฏ ฺฉู ูููููโูุง                   |
| `_sum`    | ุฌูุน ููุงุฏุฑ ูููููโูุง                 |

2. `histogram_fraction(ฯ, ...)` ฺฉุณุฑ ุงุฒ ูููููโูุง ฺฉู โค ููุฏุงุฑ ููุฑุฏ ูุธุฑ ูุณุชูุฏ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

* ฯ: ุนุฏุฏ ุจู 0 ู 1
* ฯ = 0.9 โ นฐูช ูููููโูุง

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ

ูุฑุถ ฺฉู metric ุฒุฑ ุฏุงุฑู:

```
http_request_duration_seconds_bucket
```

ู ูโุฎูุงูู ุจุจูู **นฐูช ุฏุฑุฎูุงุณุชโูุง ฺูุฏุฑ ุณุฑุน ูพุงุณุฎ ุฏุงุฏู ุดุฏูโุงูุฏ**:

```promql
histogram_quantile(0.9, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
```

๐น ุงู ูุซุงู ูุดุงุจู `histogram_fraction()` ุงุณุช.

* ุฏุฑ ูุงูุนุ `histogram_fraction()` ูุนูููุงู ุฏุฑ ูุญุงุณุจุงุช ุฏุงุฎู Prometheus ุจุฑุง ุจุฏุณุช ุขูุฑุฏู **percentile fractions** ุงุณุชูุงุฏู ูโุดูุฏ.

---

### ๐น ุชูุงูุช ุจุง `histogram_quantile()`

| ุชุงุจุน                   | ุฎุฑูุฌ                      | ฺฉุงุฑุจุฑุฏ                                             |
| ---------------------- | -------------------------- | -------------------------------------------------- |
| `histogram_fraction()` | ฺฉุณุฑ ูููููโูุง โค ููุฏุงุฑ ูุดุฎุต | ูุนูููุงู ุจุฑุง internal/low-level ูุญุงุณุจุงุช percentile |
| `histogram_quantile()` | ููุฏุงุฑ ูุชูุงุธุฑ ุจุง percentile | ูุญุงุณุจู quantile ูุซู P90ุ P99                       |

> ุจู ุนุจุงุฑุช:
>
> * `histogram_fraction()` ูโฺฏูุฏ: "ฺู ุฏุฑุตุฏ ุงุฒ ูููููโูุง โค ููุฏุงุฑ X ูุณุชูุฏ"
> * `histogram_quantile()` ูโฺฏูุฏ: "ููุฏุงุฑ Y ฺฉู ฯ ุฏุฑุตุฏ ูููููโูุง โค Y ูุณุชูุฏ"

---

## โ๏ธ ูฺฉุงุช ููู

* ุงู ุชุงุจุน **ูุณุชููุงู ุฑู histogram_bucket** ฺฉุงุฑ ูโฺฉูุฏ.
* ูุนูููุงู ุจุฑุง **ุชุญูู ุฏูู ุชูุฒุน ุฏุงุฏูโูุง** ุงุณุชูุงุฏู ูโุดูุฏ.
* ุฏุฑ ุจุดุชุฑ ุงุณุชูุงุฏูโูุง ูุนูููุ **ฺฉุงุฑุจุฑ ูุณุชูู ุงุฒ `histogram_fraction()` ุงุณุชูุงุฏู ููโฺฉูุฏ** ู ุงุฒ `histogram_quantile()` ุจูุฑู ูโุจุฑุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ                       | ุชูุถุญ                                                                            |
| --------------------------- | -------------------------------------------------------------------------------- |
| ุชุงุจุน                        | `histogram_fraction(ฯ, histogram_metric)`                                        |
| ูุฑูุฏ                       | histogram metric (_bucket)                                                       |
| ุฎุฑูุฌ                       | ฺฉุณุฑ ูููููโูุง โค ููุฏุงุฑ ูุดุฎุต                                                       |
| ฺฉุงุฑุจุฑุฏ                      | ูุญุงุณุจู ุฏุฑุตุฏ ูููููโูุง ุชุญุช ููุฏุงุฑ ุฎุงุตุ ุชุญูู percentile                             |
| ุชูุงูุช ุจุง histogram_quantile | histogram_fraction โ ุฏุฑุตุฏ ูููููโูุงุ histogram_quantile โ ููุฏุงุฑ ูุชูุงุธุฑ percentile |

---

ุงฺฏุฑ ุจุฎูุงูุ ูโุชูุงูู ฺฉ **ูุซุงู ุนูู ุจุง histogram HTTP request durations** ุจุฒูู ฺฉู ูู P90 ุฑุง ุจุง `histogram_quantile()` ู ูู ุฏุฑุตุฏ ูููููโูุง โค ฺฉ ููุฏุงุฑ ุฑุง ุจุง `histogram_fraction()` ูุดุงู ุฏูุฏุ ุชุง ูุฑูุดุงู ูุงุถุญ ุดูุฏ.

 ูชูชูชูชูชูชูชูชูชูชูชูช
-



--

##  ุชุงุจุน `histogram_quantile()`

ุชุงุจุน `histogram_quantile(ฯ, buckets)` ุจุฑุง ูุญุงุณุจูโ **ุตุฏฺฉ (quantile)** ฯ ุงุฒ ุฏุงุฏูโูุง ฺฉ **ูุณุชูฺฏุฑุงู (histogram)** ุงุณุชูุงุฏู ูโุดูุฏ.

ุจู ุฒุจุงู ุณุงุฏู:

> ุงู ุชุงุจุน ูโฺฏูุฏ "ฺูุฏ ุซุงูู ุทูู ฺฉุดุฏ ุชุง Xูช ุงุฒ ุฏุฑุฎูุงุณุชโูุง ูพุงุณุฎ ฺฏุฑูุชูุฏุ"

---

## ๐งฉ ุณุงุฎุชุงุฑ histogram ุฏุฑ Prometheus

ููุช ฺฉ ูุชุฑฺฉ ุงุฒ ููุน histogram ุจุณุงุฒุ Prometheus ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุณู ููุน ูุชุฑฺฉ ุชููุฏ ูโฺฉูุฏ:

| ูุชุฑฺฉ                     | ุชูุถุญ                                  |
| ------------------------- | -------------------------------------- |
| `<metric>_bucket{le="X"}` | ุชุนุฏุงุฏ ฺฉู ุฑุฎุฏุงุฏูุง ฺฉู ููุฏุงุฑุดุงู โค X ุงุณุช |
| `<metric>_sum`            | ูุฌููุน ุชูุงู ููุงุฏุฑ                      |
| `<metric>_count`          | ุชุนุฏุงุฏ ฺฉู ุฑุฎุฏุงุฏูุง                       |

ูุซูุงู ูุชุฑฺฉ ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑ:

```
http_request_duration_seconds
```

Prometheus ุฏุงุฏูโูุง ูุซู ุงู ุฐุฎุฑู ูโฺฉูุฏ:

| le   | ููุฏุงุฑ |
| ---- | ----- |
| 0.1  | 120   |
| 0.3  | 300   |
| 0.5  | 450   |
| 1.0  | 600   |
| +Inf | 700   |

ุนู:

* ุชุง ฐ.ฑ ุซุงูู: ฑฒฐ ุฏุฑุฎูุงุณุช
* ุชุง ฐ.ต ุซุงูู: ดตฐ ุฏุฑุฎูุงุณุช
* ุชุง ฑ ุซุงูู: ถฐฐ ุฏุฑุฎูุงุณุช
* ุฏุฑ ูุฌููุน: ทฐฐ ุฏุฑุฎูุงุณุช

---

## ๐งฎ ูุฑููู ููููู

ุชุงุจุน `histogram_quantile(ฯ, ...)` ุจู ุตูุฑุช ุชูุฑุจ ููุฏุงุฑ **q-th quantile** (ูุซู p90ุ p95 ุง p99) ุฑุง ุงุฒ ุงู bucketูุง ูุญุงุณุจู ูโฺฉูุฏ.

ุนู ุจุฑุง ฯ = 0.9 (ุตุฏฺฉ นฐโุงู):

> ุขู ููุฏุงุฑ ุงุฒ ุฒูุงู ูพุงุณุฎ ฺฉู นฐูช ุงุฒ ุฏุฑุฎูุงุณุชโูุง ฺฉูุชุฑ ุงุฒ ุขู ุจูุฏูโุงูุฏ.

---

## ๐ ูุญูู ุงุณุชูุงุฏู

ูุซุงู ุงุณุชุงูุฏุงุฑุฏ ุฏุฑ PromQL:

```promql
histogram_quantile(
  0.9,
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
)
```

ุชูุถุญ:

* `rate(...[5m])`: ูุฑุฎ ุงูุฒุงุด ูุฑ bucket ุฏุฑ ต ุฏููู ุงุฎุฑ
* `sum(... by (le))`: ูุฌููุน bucketูุง ุงุฒ ุชูุงู instanceูุง (ุงูุง bucket `le` ุฑุง ูฺฏู ูโุฏุงุฑุฏ)
* `histogram_quantile(0.9, โฆ)`: ูุญุงุณุจู ุตุฏฺฉ นฐุงู ุงุฒ ุงู ุชูุฒุน

---

## ๐ ูุซุงู ุนุฏุฏ

ูุฑุถ ฺฉู ุชูุฒุน bucketูุง latency ุจู ุดฺฉู ุฒุฑ ุงุณุช:

| Bucket (le) | Rate |
| ----------- | ---- |
| 0.1         | 50   |
| 0.3         | 200  |
| 0.5         | 400  |
| 1.0         | 500  |
| +Inf        | 550  |

ูโุฎูุงูู ฯ = 0.9 ุนู p90 ุฑุง ุญุณุงุจ ฺฉูู:

* ุฌูุน ฺฉู = 550
* นฐูช ุงุฒ ตตฐ = ดนต
* ุชุง bucket 0.5 ุฌูุน = ดฐฐ โ ูููุฒ ฺฉูุชุฑ ุงุฒ ดนต
* ุชุง bucket 1.0 ุฌูุน = ตฐฐ โ ุญุงูุง ุงุฒ ดนต ุนุจูุฑ ฺฉุฑุฏ
  ูพุณ p90 ุจู 0.5 ู 1.0 ุงุณุช.

ุจุง ุฏุฑููโุงุจ ุฎุท (interpolation):

```
p90 โ 0.5 + (1.0 - 0.5) * ((495 - 400) / (500 - 400))
    = 0.5 + 0.5 * 0.95
    = 0.975 seconds
```

ุนู p90 โ 0.975 ุซุงูู

---

## โ๏ธ ฺูุฏ ูฺฉุชู ููู

1. ุชุงุจุน `histogram_quantile()` ููุท ุจุง ูุชุฑฺฉโูุง ุงุฒ ููุน `_bucket` ฺฉุงุฑ ูโฺฉูุฏ.
   (ูู ุจุง `_sum` ุง `_count`)

2. ูุนูููุงู ุจุงุฏ ูุจู ุงุฒ ุขู ุงุฒ `rate()` ุงุณุชูุงุฏู ฺฉู ุชุง ูุฑุฎ ุชุบุฑ ุฑุง ุจฺฏุฑ:

   ```promql
   rate(http_request_duration_seconds_bucket[10m])
   ```

3. ู ูุนูููุงู ุจุง `sum()` ฺฏุฑููโุจูุฏ ูโุดูุฏ ุชุง ฺูุฏู ุณุฑูุฑ ุจุง ูู ุชุฑฺฉุจ ุดููุฏ:

   ```promql
   sum(rate(...)) by (le)
   ```

4. ุตุฏฺฉโูุง ุฑุงุฌ:

   * 0.5 โ p50 (ูุงูฺฏู)
   * 0.9 โ p90
   * 0.95 โ p95
   * 0.99 โ p99

---

## ๐ ุฎูุงุตู ุณุงุฏู

| ูพุงุฑุงูุชุฑ                   | ูุนู                                      |
| ------------------------- | ----------------------------------------- |
| `0.9`                     | ุฏุฑุตุฏ ููุฑุฏ ูุธุฑ (นฐูช)                       |
| `rate(..._bucket[10m])`   | ูุฑุฎ ุชุบุฑ bucketูุง ุฏุฑ ฑฐ ุฏููู ุงุฎุฑ       |
| `sum(... by (le))`        | ุฌูุน ฺฉู bucketูุง ุงุฒ ููู instanceูุง         |
| `histogram_quantile(...)` | ูุญุงุณุจูู p90 latency ุงุฒ ุฏุงุฏูโูุง histogram |

---

ูโุฎูุงู ุจุฑุงุช ฺฉ ูููุฏุงุฑ ุชุตูุฑ ุงุฒ ูุญููู ฺฉุงุฑ `histogram_quantile()` (ฺุทูุฑ ุจู bucketูุง ุฏุฑููโุงุจ ูโฺฉูุฏ) ุฑุณู ฺฉููุ
ุจุง ุงูู ุฎู ุฑุงุญุช ูโููู ฺุทูุฑ p90 ุงุฒ ุฏุงุฏูโูุง ุงุณุชุฎุฑุงุฌ ูโุดูุฏ.


------------


---

## โ๏ธ ุชุนุฑู ุชุงุจุน

```promql
idelta(v range-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `idelta()` ุงุฎุชูุงู ููุฏุงุฑ **ุขุฎุฑู ููููู (latest sample)** ู **ุงููู ููููู (earliest sample)** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ูุดุฎุตโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.
ุจู ุฒุจุงู ุณุงุฏู:

> ุชุบุฑ ููุฏุงุฑ ูุชุฑฺฉ ุจู ุดุฑูุน ู ูพุงุงู ฺฉ ุจุงุฒูโ ุฒูุงู ฺฉูุชุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

---

## ๐ฌ ูุญูู ฺฉุงุฑ

ูุฑุถ ฺฉู ุจุงุฒูโ `[5m]` ุฑุง ุฑู ฺฉ ูุชุฑฺฉ ูุฑุงุฑ ุฏู:

```promql
idelta(metric_name[5m])
```

ุงฺฏุฑ ุฏุฑ ุงู ต ุฏููู ููุฏุงุฑ ูุชุฑฺฉ ุงุฒ `100` ุจู `130` ุชุบุฑ ฺฉูุฏุ ุฎุฑูุฌ ูโุดูุฏ:

```
130 - 100 = 30
```

---

## ๐งฎ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ุฏุงุฑู:

| ุฒูุงู  | ููุฏุงุฑ ูุชุฑฺฉ |
| ----- | ----------- |
| 10:00 | 100         |
| 10:01 | 110         |
| 10:02 | 120         |
| 10:03 | 130         |

ู ุนุจุงุฑุช ุฒุฑ ุฑุง ุงุฌุฑุง ูโฺฉู:

```promql
idelta(metric_name[3m])
```

๐ค ูุชุฌู:

```
130 - 100 = 30
```

---

## ๐ง ุชูุงูุช `idelta()` ุจุง `delta()` ู `rate()`

| ุชุงุจุน       | ููุน ุฏุงุฏู ูุฑูุฏ | ุฎุฑูุฌ                         | ฺฉุงุฑุจุฑุฏ                                   |
| ---------- | -------------- | ----------------------------- | ---------------------------------------- |
| `idelta()` | range vector   | ุงุฎุชูุงู ูุญุธูโุง (raw)          | ุจุฑุง ูุชุฑฺฉโูุง *Gauge* ุง ุชุบุฑ ูุญุธูโุง  |
| `delta()`  | range vector   | ุงุฎุชูุงู ูุฑูุงูโุดุฏู ุจุฑ ุงุณุงุณ ุฒูุงู | ุจุฑุง ูุชุฑฺฉโูุง *Gauge* ุฏุฑ ุจุงุฒู ุทููุงูโุชุฑ |
| `rate()`   | range vector   | ูุฑุฎ ุชุบุฑ ุฏุฑ ูุงุญุฏ "ุฏุฑ ุซุงูู"  | ุจุฑุง *Counter* (ุชุฌูุน)                   |
| `irate()`  | range vector   | ูุฑุฎ ูุญุธูโุง ุจู ุฏู ููููู ุขุฎุฑ  | ุจุฑุง *Counter* ุฏุฑ ุจุงุฒู ฺฉูุชุงู             |

---

## ๐งฉ ูพุณ ุนู:

* `idelta()` โ ุงุฎุชูุงู ูุงูุน ุจู ุงููู ู ุขุฎุฑู ููููู (ุจุฏูู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุฒูุงู)
* `delta()` โ ุงุฎุชูุงู ุชูุณู ุจุฑ ูุฏุช ุฒูุงู ุจุงุฒู
* `rate()` โ ูุฎุตูุต ูุชุฑฺฉโูุง *Counter*
* `irate()` โ ูุฑุฎ ุชุบุฑ ุจู ุฏู ููุทู ุขุฎุฑ (ููุฑโุชุฑ)

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ

ูุฑุถ ฺฉู ฺฉ ูุชุฑฺฉ ุฏุงุฑ ุจู ูุงู:

```
temperature_celsius
```

ู ูโุฎูุงู ุจุฏุงู ุฏูุง ุณุณุชู ุฏุฑ ต ุฏูููโ ฺฏุฐุดุชู ฺูุฏุฑ ุชุบุฑ ฺฉุฑุฏู (ูุซูุงู ุงูุฒุงุด ุง ฺฉุงูุด ุณุฑุน ุฏูุง):

```promql
idelta(temperature_celsius[5m])
```

๐ค ูุชุฌู:
ุงฺฏุฑ ุงุฒ 42.0 ุจู 44.5 ุฑุณุฏู ุจุงุดุฏ โ ุฎุฑูุฌ = 2.5ยฐC

---

## โ๏ธ ูฺฉุชู ููู

`idelta()` ุจุฑุง **Gauge**ูุง (ูุซู ุฏูุงุ ุญุงูุธูุ ุจุงุฑ ุณุณุชู) ููุงุณุจ ุงุณุชุ
ุงูุง ุจุฑุง **Counter**ูุง (ูุซู ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง) **ุบูุท ุง ฺฏูุฑุงูโฺฉููุฏู** ุงุณุช.

ฺูู Counter ููุท ุงูุฒุงุด ูโุงุจุฏ (ู ููฺฉู ุงุณุช reset ุดูุฏ)ุ
ู ุฏุฑ ุงู ุญุงูุช ุจุงุฏ ุงุฒ `irate()` ุง `rate()` ุงุณุชูุงุฏู ฺฉู.

---

## ๐ ุฌูุนโุจูุฏ ุณุฑุน

| ูฺฺฏ           | ุชูุถุญ                                  |
| --------------- | -------------------------------------- |
| ุชุงุจุน            | `idelta(v range-vector)`               |
| ูุฑูุฏ           | range vector (ูุซูุงู `[5m]`)            |
| ุฎุฑูุฌ           | ุงุฎุชูุงู ุจู ุขุฎุฑู ู ุงููู ููููู ุฏุฑ ุจุงุฒู |
| ููุงุณุจ ุจุฑุง      | ูุชุฑฺฉโูุง Gauge                        |
| ููุงุณุจ ูุณุช ุจุฑุง | ูุชุฑฺฉโูุง Counter                      |
| ูุดุงุจู           | `delta()` ูู ุจุฏูู ุชูุณู ุจุฑ ุฒูุงู       |

---

### โณ๏ธ ูุซุงู ููุง ุจุฑุง ููู ุจูุชุฑ:

| ุฒูุงู  | metric | ฮ   | idelta        | delta                      |
| ----- | ------ | --- | ------------- | -------------------------- |
| 10:00 | 100    |     |               |                            |
| 10:05 | 150    | +50 | `idelta = 50` | `delta = 50 / 300 = 0.166` |

ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช

---

## โ๏ธ ุชุนุฑู ุชุงุจุน

```promql
increase(v range-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `increase()` ูุฒุงู **ุงูุฒุงุด ุชุฌูุน (total increase)** ฺฉ ูุชุฑฺฉ ุงุฒ ููุน **Counter** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ูุดุฎุตโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.

ุนู:

> ุงุฒ ุขุฎุฑู ููุฏุงุฑ ูููุง ุงููู ููุฏุงุฑ (ุจุง ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูุฑุฎ ูููููโุจุฑุฏุงุฑ ู reset ุงุญุชูุงู Counter).

---

## ๐งฉ ุฏุฑฺฉ ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฑู ุฏุงุฑ:

```
http_requests_total
```

ู ููุฏุงุฑูุงุด ุฏุฑ ุจุงุฒู ต ุฏูููโุง ุงูุทูุฑ ุจูุฏู:

| ุฒูุงู  | ููุฏุงุฑ |
| ----- | ----- |
| 10:00 | 100   |
| 10:01 | 150   |
| 10:02 | 220   |
| 10:03 | 260   |

ุงฺฏุฑ ุจููุณ:

```promql
increase(http_requests_total[5m])
```

๐ค ูุชุฌู = `100 - 260 = 160`

ุนู ุฏุฑ ต ุฏููู ฺฏุฐุดุชูุ **ฑถฐ ุฏุฑุฎูุงุณุช ุฌุฏุฏ** ุงูุฌุงู ุดุฏู.

---

## โ๏ธ ูฺฉุชู ููู: ูุฎุตูุต Counter ุงุณุช

`increase()` ููุท ุจุฑุง **Counter**ูุง ุทุฑุงุญ ุดุฏู (ูุชุฑฺฉโูุง ฺฉู ููุท ุฒุงุฏ ูโุดู).
ุจุฑุง ูุซุงู:

โ ุฏุฑุณุช ุจุฑุง:

* `http_requests_total`
* `packets_sent_total`
* `errors_total`

โ ุงุดุชุจุงู ุจุฑุง:

* `temperature_celsius`
* `cpu_usage`
* `memory_free`

ฺูู ุงููุง Gauge ูุณุชู (ฺฉู ู ุฒุงุฏ ูโุดู).

---

## ๐ง ูุญูู ูุญุงุณุจู ุฏูู

`increase()` ุฏุฑ ูุงูุน ุงุฒ `rate()` ุงุณุชูุงุฏู ูโฺฉูู:

```promql
increase(X[5m]) โ rate(X[5m]) * 300
```

(ุนุฏุฏ 300 ุนู ต ุฏููู = ณฐฐ ุซุงูู)

๐น ุชูุงูุช: `increase()` ููุฏุงุฑ ฺฉู ุงูุฒุงุด ุฏุฑ ุจุงุฒู ุฑุง ูโุฏูุฏ
๐น ุงูุง `rate()` ูุฑุฎ ุงูุฒุงุด ุฏุฑ ุซุงูู ุฑุง.

---

### ูุซุงู ุนุฏุฏ ุจุฑุง ููุงุณู

| ุชุงุจุน                                | ุฎุฑูุฌ   | ูุนู                                |
| ----------------------------------- | ------- | ----------------------------------- |
| `increase(http_requests_total[5m])` | `160`   | ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู ุงุฎุฑ |
| `rate(http_requests_total[5m])`     | `0.533` | ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู (โ160 รท 300s)      |

---

## ๐งฎ ุญุงูุช Reset (ุจุงุฒูุดุงู Counter)

ุงฺฏุฑ ููุฏุงุฑ Counter ุฑุณุช ุดูุฏ (ูุซูุงู ุณุฑูุฑ ุฑโุงุณุชุงุฑุช ุดูุฏ)ุ
โPrometheus ุงู ุฑุง ุชุดุฎุต ูโุฏูุฏ ู ูุญุงุณุจู ุฑุง ุงุตูุงุญ ูโฺฉูุฏ.

ูุซูุงู:

| ุฒูุงู  | ููุฏุงุฑ Counter |
| ----- | ------------- |
| 10:00 | 100           |
| 10:02 | 200           |
| 10:03 | 10 โ reset    |
| 10:04 | 60            |

ุฏุฑ ุงู ุญุงูุช:

```promql
increase(metric[5m])
```

ูุชุฌู = `(100 - 200) + (10 - 60) = 150`

Prometheus ุฎูุฏุด ุชุดุฎุต ูโุฏูุฏ ฺฉู ุจู 200 ู 10 ุฑุณุช ุงุชูุงู ุงูุชุงุฏู.

---

## ๐งฉ ูุซุงู ูุงูุน

ุงฺฏุฑ ุจุฎูุงู ุจุฏุงู ุฏุฑ ฑ ุณุงุนุช ฺฏุฐุดุชู ฺูุฏ ุฏุฑุฎูุงุณุช ูููู HTTP (`code="200"`) ุฏุงุดุชู:

```promql
increase(http_requests_total{code="200"}[1h])
```

๐ค ูุชุฌู: ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง ูููู ุฏุฑ ฑ ุณุงุนุช ุงุฎุฑ

---

## ๐ ูุซุงู ุชุฑฺฉุจ ุจุง `sum()`

ุงฺฏุฑ ฺูุฏ ุณุฑูุฑ ุง ูพุงุฏ ุฏุงุฑ ู ูโุฎูุงู ูุฌููุน ฺฉู ุงูุฒุงุด ุฑู ุญุณุงุจ ฺฉู:

```promql
sum(increase(http_requests_total[5m])) by (job)
```

๐ค ูุชุฌู: ูุฌููุน ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู ฺฏุฐุดุชู ุจุฑุง ูุฑ job

---

## โ ุฎูุงุตู

| ูฺฺฏ             | ุชูุถุญ                             |
| ----------------- | --------------------------------- |
| ุชุงุจุน              | `increase(v range-vector)`        |
| ูุฑูุฏ             | ูุชุฑฺฉ ุงุฒ ููุน Counter              |
| ุฎุฑูุฌ             | ููุฏุงุฑ ุงูุฒุงุด ุฏุฑ ุจุงุฒูโ ุฒูุงู      |
| ฺฉุงุฑุจุฑุฏ            | ุดูุงุฑุด ุฑุฎุฏุงุฏูุง ุฏุฑ ฺฉ ุจุงุฒู          |
| ุฑูุชุงุฑ ุจุง reset    | ุฎูุฏุด ุงุตูุงุญ ูโฺฉูุฏ                 |
| ุฑุงุจุทู ุจุง `rate()` | `increase() = rate() * ุฒูุงู_ุจุงุฒู` |

---

### ๐งพ ูุซุงู ููุง ุจุฑุง ุงุฏฺฏุฑ ุณุฑุน

| ูุชุฑฺฉ               | ุฒูุงู  | ููุฏุงุฑ | increase                  |
| ------------------- | ----- | ----- | ------------------------- |
| http_requests_total | 10:00 | 100   |                           |
| http_requests_total | 10:05 | 250   | `increase(...[5m]) = 150` |

---


ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช


## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
info(v instant-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `info()` ุจุฑุง **ุชููุฏ ฺฉ ูุณุฎูโ "informational" (ุงุทูุงุนุงุช)** ุงุฒ ฺฉ ูุชุฑฺฉ ุงุณุชูุงุฏู ูโุดูุฏ.
ุจู ุนุจุงุฑุช ุณุงุฏู:

> `info()` ูููโ ุจุฑฺุณุจโูุง (labels) ู ููุงุฏุฑ ูููููโูุง ุฑุง ุญูุธ ูโฺฉูุฏุ
> ูู ููุฏุงุฑ ุนุฏุฏ ูููโ ุขูโูุง ุฑุง ุจู `1` ุชุบุฑ ูโุฏูุฏ.

---

## ๐ ุนู ฺุ

ูุฑุถ ฺฉู ุฏุงุฑ:

```promql
up
```

๐ค ุฎุฑูุฌ:

| instance     | job  | value |
| ------------ | ---- | ----- |
| server1:9100 | node | 1     |
| server2:9100 | node | 0     |

ุงฺฏุฑ ุจููุณ:

```promql
info(up)
```

๐ค ุฎุฑูุฌ:

| instance     | job  | value |
| ------------ | ---- | ----- |
| server1:9100 | node | 1     |
| server2:9100 | node | 1     |

ุนู ูููโ ููุงุฏุฑ `1` ุดุฏู (ุตุฑูโูุธุฑ ุงุฒ ููุฏุงุฑ ุงุตู).

---

## ๐ง ูุฏู ูุงูุน ุงุณุชูุงุฏู ุงุฒ `info()`

ุชุงุจุน `info()` ุฏุฑ Prometheus 2.40 ุจู ุจุนุฏ ูุนุฑู ุดุฏ ุชุง ฺฉูฺฉ ฺฉูู:

* ุฏุงุฏูโูุง **ุงุทูุงุนุงุช / ูุชุงุฏุชุง** ุฑุง ุงุฒ ูุชุฑฺฉโูุง ุงุณุชุฎุฑุงุฌ ฺฉูุ
* ุง ุงุฒ **metricูุง gauge ุง counter** ููุท ุจุฑุง ูฺฏูโุฏุงุดุชู *labelูุง* ุงุณุชูุงุฏู ฺฉูุ ูู ููุฏุงุฑุดุงู.

---

## ๐ ฺฉุงุฑุจุฑุฏูุง ูุงูุน

### โ ฑ. ุดูุงุฑุด ุชุนุฏุงุฏ ุณุฑ ุฏุงุฏูโูุง

ูโุฎูุงู ุจุฏูู ฺูุฏ ุณุฑ ุฏุงุฏู ุจุฑุง ฺฉ ูุชุฑฺฉ ูุฌูุฏ ุฏุงุฑุฏ:

```promql
count(info(http_requests_total))
```

๐ค ูุซูุงู:

```
20
```

(ุนู ฒฐ ุณุฑ ูุฎุชูู ุงุฒ `http_requests_total` ููุฌูุฏ ุงุณุช.)

---

### โ ฒ. ุจุฑุฑุณ ูุณุช labelูุง ููุฌูุฏ

ุงฺฏุฑ ุจููุณ:

```promql
info(node_exporter_build_info)
```

ุฎุฑูุฌ ฺุฒ ูุซู ุงู ูโุดูุฏ:

| version | instance     | job  | value |
| ------- | ------------ | ---- | ----- |
| 1.7.0   | server1:9100 | node | 1     |
| 1.8.0   | server2:9100 | node | 1     |

๐น ุงูุฌุง ุงุฒ `node_exporter_build_info` ููุท ุงุทูุงุนุงุช ูุณุฎู ู ุจุฑฺุณุจโูุง ูฺฏู ุฏุงุดุชู ุดุฏู.

---

### โ ณ. ููุชุฑ ุฏุงุฏูโูุง ุจุฏูู ุฏุฑฺฏุฑ ุดุฏู ุจุง ููุฏุงุฑ

ฺฏุงู ูุชุฑฺฉโูุง ุฏุงุฑ ฺฉู ููุท label ููู ุงุณุชุ ูู ููุฏุงุฑ.
ูุซูุงู ูโุฎูุงู ููุฑุณุช ุชูุงู containerูุง ููุฌูุฏ ุฑุง ุจุจูุ ูุงุฑุบ ุงุฒ state:

```promql
info(container_last_seen)
```

---

## โ๏ธ ูฺฉุชู ูู

* ุชุงุจุน `info()` ููุฏุงุฑ ุนุฏุฏ ูุฑ sample ุฑุง ุจู 1 ุชุบุฑ ูโุฏูุฏ.
* ุชูุงู labelูุง ู timestampูุง ุฑุง ุญูุธ ูโฺฉูุฏ.
* ุงู ุชุงุจุน ููุท ุฑู **instant vector** ฺฉุงุฑ ูโฺฉูุฏ (ูู range vector).
* ููุฏุงุฑ ุฎุฑูุฌ ุจุฑุง **aggregation** ุง **counting** ููุงุณุจ ุงุณุชุ ูู ูุญุงุณุจุงุช ุฑุงุถ.

---

## ๐งพ ุฎูุงุตู ููุง

| ูฺฺฏ            | ุชูุถุญ                                           |
| ---------------- | ----------------------------------------------- |
| ุชุงุจุน             | `info(v instant-vector)`                        |
| ูุฑูุฏ            | ูุฑ ูุชุฑฺฉ ูุญุธูโุง                                |
| ุฎุฑูุฌ            | ููุงู ูุชุฑฺฉ ุจุง ููุฏุงุฑ ฑ ุจุฑุง ูููโ ูููููโูุง       |
| ูุฏู              | ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุชุ ุดูุงุฑุด ุง ููุฑุณุช labelูุง         |
| ููุงุณุจ ุจุฑุง       | metadata metrics ูุซู `*_info` ุง `*_build_info` |
| ูพุดุชุจุงู ุงุฒ ูุณุฎู | Prometheus 2.40+                                |

---

## ๐ก ูุซุงู ุชุฑฺฉุจ

```promql
count by (version) (info(node_exporter_build_info))
```

๐ค ูุชุฌู:

| version | count |
| ------- | ----- |
| 1.7.0   | 3     |
| 1.8.0   | 5     |

> ุนู ณ ููุฏ ุจุง ูุณุฎูโ 1.7.0 ู ต ููุฏ ุจุง ูุณุฎูโ 1.8.0 ฺฉุงุฑ ูโฺฉููุฏ.


ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช




---

## ๐งฉ ุชุนุฑู ุชุงุจุน irate

```promql
irate(v range-vector)
```

---

## ๐ฏ ูุฏู

ุชุงุจุน `irate()` (ูุฎูู **instant rate**)
ุจุฑุง ูุญุงุณุจูโ **ูุฑุฎ ูุญุธูโุง (ุชูุฑุจุงู ูุญุธูโุจูโูุญุธู)** ุชุบุฑุงุช ฺฉ **Counter** ุฏุฑ Prometheus ุงุณุชูุงุฏู ูโุดูุฏ.

ุจู ุฒุจุงู ุณุงุฏู:

> `irate()` ููุฏุงุฑ **ุณุฑุนุช ุชุบุฑ** ูุชุฑฺฉ ุฑุง ุฏุฑ **ุขุฎุฑู ุจุงุฒูโ ุฒูุงู** ุฏุงุฏูโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.
> ุนู ุงุฒ *ุขุฎุฑู ุฏู ููููู* ุฏุฑ ุจุงุฒู ุงุณุชูุงุฏู ูโฺฉูุฏ.

---

## โ๏ธ ูุญููโ ฺฉุงุฑฺฉุฑุฏ

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑ:

| ุฒูุงู  | ููุฏุงุฑ `http_requests_total` |
| ----- | --------------------------- |
| 12:00 | 100                         |
| 12:10 | 120                         |
| 12:20 | 180                         |

ุงฺฏุฑ ุจููุณ:

```promql
irate(http_requests_total[20m])
```

๐น Prometheus ููุท **ุขุฎุฑู ุฏู ููุทู** ุฑุง ูฺฏุงู ูโฺฉูุฏ:

* 12:10 โ 120
* 12:20 โ 180

ู ูุฑุฎ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

```
(180 - 120) / (12:20 - 12:10) = 60 / 600 = 0.1 req/sec
```

๐ค ุฎุฑูุฌ:

```
0.1
```

---

## ๐ ุชูุงูุช `irate()` ู `rate()`

| ูฺฺฏ                        | `rate()`                   | `irate()`                                       |
| ---------------------------- | -------------------------- | ----------------------------------------------- |
| ููุน ูุฑุฎ                      | **ูุงูฺฏู ูุฑุฎ** ุฏุฑ ฺฉู ุจุงุฒู | **ูุฑุฎ ูุญุธูโุง** ุงุฒ ุขุฎุฑู ุฏู ููููู               |
| ุญุณุงุณุช ุจู ุชุบุฑุงุช ูุงฺฏูุงู    | ฺฉูุชุฑ (smooth)              | ุฒุงุฏ (ุชุบุฑุงุช ุณุฑุน ุฑุง ูุดุงู ูโุฏูุฏ)              |
| ููุงุณุจ ุจุฑุง                   | ูููุฏุงุฑูุง ฺฉู ู Alertูุง    | ูุงูุชูุฑ ูุญุธูโุง (ูุซูุงู ุฏุงุดุจูุฑุฏ ุฒูุฏู ุฏุฑ Grafana) |
| ูููููโูุง ฺฉู ุงุณุชูุงุฏู ูโฺฉูุฏ | ุชูุงู ููุงุท ุจุงุฒู             | ููุท ุฏู ููููู ุขุฎุฑ                                |

---

### ๐น ูุซุงู ููุงุณูโุง

ูุฑุถ ฺฉู ุฏุฑ ต ุฏููู ุงุฎุฑุ `http_requests_total` ุงุฒ 100 โ 200 โ 400 โ 800 ุฑูุชู.

```promql
rate(http_requests_total[5m])
```

โ ููุฏุงุฑ ูุงูฺฏู ุฑุดุฏ ุฏุฑ ต ุฏููู ุงุฎุฑ ุฑุง ูโุฏูุฏ.
(ูุฑูโุชุฑ ู ูพุงุฏุงุฑุชุฑ ุงุณุช)

```promql
irate(http_requests_total[5m])
```

โ ููุท ุงุฒ ุฏู ููุทูโ ุขุฎุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ (ุณุฑุนโุชุฑ ู ููุณุงูโุชุฑ ุงุณุช).

---

## โ๏ธ ูฺฉุชู ููู

โ* `irate()` ููุท ุฑู **Counter metrics** (ูุซู `_total` ุง `_count`) ูุนู ุฏุงุฑุฏ.
* ุงฺฏุฑ ุฑู `Gauge` ุงุณุชูุงุฏู ุดูุฏ (ูุซู `temperature`)ุ ูุชุฌู ุงุดุชุจุงู ุงุณุช.
* ุงฺฏุฑ ุฏุงุฏูโูุง ุจุง ูุงุตูู ุฒุงุฏ ุฌูุน ุดููุฏ (ูุซูุงู ูุฑ 1 ุฏููู)ุ `irate()` ููฺฉู ุงุณุช **ูพุฑุช** ุดูุฏ ฺูู ููุท ุฏู ููุทู ุฏุงุฑุฏ.

---

## ๐ก ฺฉุงุฑุจุฑุฏูุง ูุงูุน

### โ ฑ. ูุฑุฎ ูุญุธูโุง ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ูุจโุณุฑูุฑ

```promql
irate(http_requests_total[1m])
```

> ูุดุงู ูโุฏูุฏ ุฏุฑ ููู ูุญุธูุ ฺูุฏ ุฏุฑุฎูุงุณุช ุจุฑ ุซุงูู ุฏุฑ ุญุงู ุงูุฌุงู ุงุณุช.

---

### โ ฒ. ูุฑุฎ ุฎุทุงูุง (Error rate)

```promql
irate(http_requests_total{status=~"5.."}[1m])
```

> ูุฑุฎ ูุญุธูโุง ุฎุทุงูุง 5xx ุฏุฑ ฑ ุฏููู ุงุฎุฑ.

---

### โ ณ. ูุฑุฎ ุงุฑุณุงู ุฏุงุฏู ุฏุฑ ุดุจฺฉู

```promql
irate(node_network_transmit_bytes_total[30s])
```

> ุณุฑุนุช ุงุฑุณุงู ุฏุงุฏู (ุจุงุช ุจุฑ ุซุงูู) ุฏุฑ ุขุฎุฑู ณฐ ุซุงูู.

---

## ๐งพ ุฎูุงุตู ููุง

| ูฺฺฏ             | ุชูุถุญ                                           |
| ----------------- | ----------------------------------------------- |
| ุชุงุจุน              | `irate(v range-vector)`                         |
| ูุฑูุฏ             | ูุชุฑฺฉ ุงุฒ ููุน Counter                            |
| ุฎุฑูุฌ             | ูุฑุฎ ูุญุธูโุง ุงูุฒุงุด ุฏุฑ ูุงุญุฏ ุฒูุงู                 |
| ุจุงุฒู ููุฑุฏ ุงุณุชูุงุฏู | ููุท ุฏู ูููููโ ุขุฎุฑ ุจุงุฒู                         |
| ุงุณุชูุงุฏู ูุนููู     | ูุงูุชูุฑ ุฒูุฏู (real-time)                        |
| ุชูุงูุช ุจุง rate()   | `rate` ูุฑูโุชุฑ ุงุณุชุ `irate` ุณุฑุนโุชุฑ ูุงฺฉูุด ูโุฏูุฏ |


ูชูชูชูชูชูชูชูชูชูชูชูชูชูช

---

## ๐งฉ ุชุนุฑู ุชุงุจุน label_join()

```promql
label_join(vector, dst_label, separator, src_label1, src_label2, ...)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `label_join()` ุจุฑุง **ุชุฑฺฉุจ ฺูุฏ label ุฏุฑ ฺฉ label ุฌุฏุฏ** ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูโุชูุงู ฺูุฏ ุจุฑฺุณุจ ูุชุฑฺฉ ุฑุง ุจุง ฺฉ ุฌุฏุงฺฉููุฏู (`separator`) ุจู ฺฉ label ุฌุฏุฏ ูุตู ฺฉุฑุฏ.

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ                       | ุชูุถุญ                                   |
| ----------------------------- | --------------------------------------- |
| `vector`                      | instant vector ุง range vector ููุฑุฏ ูุธุฑ |
| `dst_label`                   | ูุงู label ุฌุฏุฏ ฺฉู ูโุฎูุงู ุจุณุงุฒ       |
| `separator`                   | ุฑุดุชูโุง ฺฉู ุจู labelูุง ูุฑุงุฑ ูโฺฏุฑุฏ     |
| `src_label1, src_label2, ...` | labelูุง ฺฉู ูโุฎูุงู ุชุฑฺฉุจ ุดููุฏ        |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance | job | value |
| -------- | --- | ----- |
| 10.0.0.1 | web | 1     |
| 10.0.0.2 | web | 2     |

ูโุฎูุงูู ฺฉ label ุฌุฏุฏ ุจุณุงุฒู ฺฉู ุชุฑฺฉุจ `job` ู `instance` ุจุงุดุฏ:

```promql
label_join(up, "job_instance", "-", "job", "instance")
```

๐ค ุฎุฑูุฌ:

| instance | job | job_instance | value |
| -------- | --- | ------------ | ----- |
| 10.0.0.1 | web | web-10.0.0.1 | 1     |
| 10.0.0.2 | web | web-10.0.0.2 | 2     |

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ุณุงุฎุช label ุฌุฏุฏ ุจุฑุง grouping ุฏุฑ Grafana**

   * ูุซูุงู ุจุฎูุงู ุจุฑ ุงุณุงุณ ุชุฑฺฉุจ `namespace` ู `pod` ุฏุฑ ุฏุงุดุจูุฑุฏ ฺฏุฑููโุจูุฏ ฺฉู:

   ```promql
   label_join(container_cpu_usage_seconds_total, "ns_pod", "/", "namespace", "pod")
   ```

2. **ุขูุงุฏูโุณุงุฒ label ุจุฑุง vector matching**

   * ููุช ูโุฎูุงู ุฏู ูุชุฑฺฉ ุฑุง ุจุฑ ุงุณุงุณ label ุฌุฏุฏ match ฺฉูุ ูโุชูุงู ุจุง `label_join()` label ุฌุฏุฏ ุจุณุงุฒ ู ุณูพุณ `on()` ุง `group_left()` ุงุณุชูุงุฏู ฺฉู.

3. **ุณุงุฏฺฏ ุฏุฑ alerting**

   * ุจู ุฌุง ุงูฺฉู ฺูุฏ label ุฑุง ุฌุฏุงฺฏุงูู ุฏุฑ alert rule ุจุฑุฑุณ ฺฉูุ ููู ุฑุง ุจุง ฺฉ label ุชุฑฺฉุจ ูโฺฉู.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ ฺฉ ุงุฒ labelูุง ููุจุน ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ `dst_label` ุณุงุฎุชู ููโุดูุฏ.
* ููุฏุงุฑ `separator` ูโุชูุงูุฏ ูุฑ ุฑุดุชูโุง ุจุงุดุฏุ ุญุช ุฎุงู (`""`).
* `label_join()` ุชุบุฑ **ููุฏุงุฑ metric** ููโุฏูุฏุ ููุท labelูุง ุฑุง ุฏุณุชฺฉุงุฑ ูโฺฉูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ              | ุชูุถุญ                                                 |
| ------------------ | ----------------------------------------------------- |
| ุชุงุจุน               | `label_join(vector, dst_label, sep, src_label1, ...)` |
| ูุฑูุฏ              | instant ุง range vector                               |
| ุฎุฑูุฌ              | ููุงู vector ุจุง label ุฌุฏุฏ ุชุฑฺฉุจ                      |
| ฺฉุงุฑุจุฑุฏ             | ฺฏุฑููโุจูุฏุ alertingุ ุขูุงุฏูโุณุงุฒ label ุจุฑุง join       |
| ุชุบุฑ ููุฏุงุฑ metric | ูุฏุงุฑุฏุ ููุท labelูุง ุฑุง ุงุถุงูู ูโฺฉูุฏ                    |

---


ูชูชูชูชูชูชูชูชูชูชูชูชูชูช


---

## ๐งฉ ุชุนุฑู ุชุงุจุน label_replace

```promql
label_replace(vector, dst_label, replacement, src_label, regex)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `label_replace()` ุจุฑุง **ุณุงุฎุช ุง ุฌุงฺฏุฒู labelูุง ุจุฑ ุงุณุงุณ ุงูฺฏู regex** ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูโุชูุงู ููุฏุงุฑ ฺฉ label ุฑุง ุงุณุชุฎุฑุงุฌ ุง ุชุบุฑ ุฏุงุฏ ู ุฏุฑ ฺฉ label ุฌุฏุฏ ูุฑุงุฑ ุฏุงุฏ.

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ       | ุชูุถุญ                                                                                        |
| ------------- | -------------------------------------------------------------------------------------------- |
| `vector`      | instant vector ุง range vector ููุฑุฏ ูุธุฑ                                                      |
| `dst_label`   | ูุงู label ุฌุฏุฏ ุง ููุฌูุฏ ฺฉู ูโุฎูุงู ููุฏุงุฑ ุขู ุฑุง ุชุบุฑ ุฏู                                    |
| `replacement` | ููุฏุงุฑ ฺฉู ูโุฎูุงู ุจุง regex ุฌุงฺฏุฒู ุดูุฏ (ูโุชูุงูุฏ `$1` ู `$2` ุฏุงุดุชู ุจุงุดุฏ ุจุฑุง capture group) |
| `src_label`   | label ูุจุฏุง ฺฉู ููุฏุงุฑุด ุจุฑุง regex ุจุฑุฑุณ ูโุดูุฏ                                                 |
| `regex`       | ุงูฺฏู regex ุจุฑุง ุงุณุชุฎุฑุงุฌ ุจุฎุด ููุฑุฏ ูุธุฑ                                                        |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance    | job | value |
| ----------- | --- | ----- |
| web-01.prod | web | 1     |
| web-02.prod | web | 2     |

ูโุฎูุงูู ููุท ุดูุงุฑู ุณุฑูุฑ (01ุ 02) ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉูู ู ุฏุฑ label ุฌุฏุฏ `server_id` ูุฑุงุฑ ุฏูู:

```promql
label_replace(up, "server_id", "$1", "instance", "web-(\\d+)\\.prod")
```

๐ค ุฎุฑูุฌ:

| instance    | job | server_id | value |
| ----------- | --- | --------- | ----- |
| web-01.prod | web | 01        | 1     |
| web-02.prod | web | 02        | 2     |

> ุชูุถุญ:
>
> * `(\\d+)` โ ฺฉ ุง ฺูุฏ ุฑูู ุฑุง ุฏุฑ instance ูพุฏุง ูโฺฉูุฏ
> * `$1` โ ููุฏุงุฑ capture group ุงูู ุฑุง ุฏุฑ label ุฌุฏุฏ `server_id` ูุฑุงุฑ ูโุฏูุฏ

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ุงุณุชุฎุฑุงุฌ ุจุฎุด ุงุฒ label ุจุฑุง alert ุง grouping**

   * ูุซูุงู namespace ุง pod name ุฑุง ุงุฒ instance ุง container name ุฌุฏุง ูโฺฉูู.

2. **ุณุงุฎุช label ุฌุฏุฏ ุจุฑุง vector matching**

   * ููุช ูโุฎูุงู ุฏู ูุชุฑฺฉ ุฑุง ุจุฑ ุงุณุงุณ label ุฌุฏุฏ join ฺฉู.

3. **ุชุจุฏู ุง ูพุงฺฉโุณุงุฒ labelูุง**

   * ุญุฐู ูพุณููุฏุ ูพุดููุฏุ ุง ุจุฎุด ุงุถุงู ุฏุฑ labelูุง.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ regex match ูุดูุฏุ `dst_label` ุณุงุฎุชู ููโุดูุฏ.
* ูโุชูุงู ุงุฒ capture groups (`$1`, `$2`, ...) ุฏุฑ replacement ุงุณุชูุงุฏู ฺฉุฑุฏ.
* ุงู ุชุงุจุน ููุฏุงุฑ metric ุฑุง ุชุบุฑ ููโุฏูุฏุ ููุท labelูุง ุฑุง ุฏุณุชฺฉุงุฑ ูโฺฉูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ              | ุชูุถุญ                                                             |
| ------------------ | ----------------------------------------------------------------- |
| ุชุงุจุน               | `label_replace(vector, dst_label, replacement, src_label, regex)` |
| ูุฑูุฏ              | instant ุง range vector                                           |
| ุฎุฑูุฌ              | ููุงู vector ุจุง label ุฌุฏุฏ ุง ุงุตูุงุญโุดุฏู                            |
| ฺฉุงุฑุจุฑุฏ             | ุงุณุชุฎุฑุงุฌ ุง ุชุบุฑ label ุจุฑ ุงุณุงุณ regex                              |
| ุชุบุฑ ููุฏุงุฑ metric | ูุฏุงุฑุฏ                                                             |

---




ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช



---

## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
month(v instant-vector)
```

ุง ุงฺฏุฑ ุจุฏูู ุขุฑฺฏููุงู ุงุณุชูุงุฏู ุดูุฏ:

```promql
month()
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `month()` ููุฏุงุฑ **ูุงู ุฌุงุฑ (ุงุฒ 1 ุชุง 12)** ุฑุง ุงุฒ timestamp ูุฑ ููููู ุฏุงุฏู ุจุฑูโฺฏุฑุฏุงูุฏ.

> ุนู ุงฺฏุฑ timestamp ููููู ูุฑุจูุท ุจู ููุฑูุงู ุจุงุดุฏุ ุฎุฑูุฌ `7` ุฎูุงูุฏ ุจูุฏ (ูุงู ููุชู ุณุงู ููุงุฏ).

---

## ๐ง ฺฉุงุฑุจุฑุฏูุง

* ุชุญูู ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ **ูุงู ุณุงู**
* ุณุงุฎุช **report ูุงูุงูู** ุฏุฑ Prometheus ุง Grafana
* ุชุฑฺฉุจ ุจุง ุชูุงุจุน aggregate ุจุฑุง ฺฏุฑููโุจูุฏ ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ ูุงู

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

```promql
up
```

ุงฺฏุฑ ุจููุณ:

```promql
month(up)
```

* ูุฑ ููููู ููุฏุงุฑ ฑ ุชุง ฑฒ ุฎูุงูุฏ ุฏุงุดุชุ ุจุณุชู ุจู ุงูฺฉู ูุฑุจูุท ุจู ฺฉุฏุงู ูุงู ุจุงุดุฏ.

ูุซูุงู ุงฺฏุฑ ุงูุงู ููุฑูุงู (October / ูุงู 10 ููุงุฏ) ุจุงุดุฏ:

```
10
```

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ ุจุง aggregate

ูโุฎูุงู ูุงูฺฏู ูุชุฑฺฉ `http_requests_total` ุฑุง **ุจุฑุง ูุฑ ูุงู** ุจุจู:

```promql
avg(http_requests_total) by (month())
```

> ุงูุฌุง ูุงู ูุฑ ููููู ุฌุฏุง ุดุฏู ู ูุงูฺฏู ุจุฑุง ูุฑ ูุงู ูุญุงุณุจู ูโุดูุฏ.

---

## ๐น ุชูุงูุช ุจุง ุณุงุฑ ุชูุงุจุน ุฒูุงู

| ุชุงุจุน             | ุฎุฑูุฌ     | ูุญุฏูุฏู           |
| ---------------- | --------- | ---------------- |
| `hour()`         | ุณุงุนุช ุฑูุฒ  | 0โ23             |
| `day_of_month()` | ุฑูุฒ ูุงู   | 1โ31             |
| `day_of_week()`  | ุฑูุฒ ููุชู  | 0โ6 (0 = ฺฉุดูุจู) |
| `month()`        | ุดูุงุฑู ูุงู | 1โ12             |
| `year()`         | ุณุงู       | ูุซูุง 2025        |

---

## โ๏ธ ูฺฉุงุช ููู

* `month()` ุจุฑ ุงุณุงุณ **timestamp ูุฑ ููููู** ุนูู ูโฺฉูุฏุ ูู ุฒูุงู ูุนู ุณุณุชู.
* ูุนูููุงู ููุฑุงู ุจุง `by()` ุง aggregate ุงุณุชูุงุฏู ูโุดูุฏ ุชุง ฺฏุฒุงุฑุด ูุงูุงูู ุงุฌุงุฏ ุดูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ      | ุชูุถุญ                                   |
| ---------- | --------------------------------------- |
| ุชุงุจุน       | `month(v instant-vector)`               |
| ูุฑูุฏ      | vector (instant) ุง ุจุฏูู ูุฑูุฏ          |
| ุฎุฑูุฌ      | ุนุฏุฏ ูุงู (1โ12)                          |
| ฺฉุงุฑุจุฑุฏ     | ุชุญูู ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ ูุงูุ ฺฏุฒุงุฑุด ูุงูุงูู |
| ููููู ุณุงุฏู | `month(up)` โ 10                        |

---

ุงฺฏุฑ ุจุฎูุงูุ ูโุชูุงูู ฺฉ ูุซุงู ุนูู ุจุง **Grafana** ูุดุงู ุจุฏูู ฺฉู ฺุทูุฑ `month()` ุฑุง ุจุฑุง **heatmap ุง ฺฏุฒุงุฑุด ูุงูุงูู** ุงุณุชูุงุฏู ูโฺฉููุฏ ุชุง ุงูฺฏููุง ุชุฑุงูฺฉ ุง ุฏุฑุฎูุงุณุชโูุง ุฑุง ุจุฑ ุงุณุงุณ ูุงู ุจุจู.


ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช



---

## ๐งฉ ุชุนุฑู ุชุงุจุน predict_linear

```promql
predict_linear(range-vector, seconds)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

โ* `predict_linear()` ููุฏุงุฑ ุขูุฏู ฺฉ **metric** ุฑุง ูพุดโุจู ูโฺฉูุฏ.
* ูพุดโุจู ุจุฑ ุงุณุงุณ **ุฑููุฏ ุฎุท ุฏุงุฏูโูุง ฺฏุฐุดุชู** ุฏุฑ **ุจุงุฒูโ ุฒูุงู ูุดุฎุต ุดุฏู** ุงูุฌุงู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ุงฺฏุฑ ูุชุฑฺฉ ุดูุง ุจุง ููุงู ุฑููุฏ ุงุฏุงูู ูพุฏุง ฺฉูุฏุ ููุฏุงุฑ ุขู ุจุนุฏ ุงุฒ `seconds` ุซุงูู ุขูุฏู ฺูุฏุฑ ุฎูุงูุฏ ุจูุฏุ

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ        | ุชูุถุญ                                                                         |
| -------------- | ----------------------------------------------------------------------------- |
| `range-vector` | ุจุงุฒูโ ุฒูุงู ฺฉู ุฏุงุฏูโูุง ุจุฑุง ูุญุงุณุจูโ ุฑููุฏ ุฏุฑ ุขู ุจุฑุฑุณ ูโุดููุฏ (ูุซูุงู `[5m]`) |
| `seconds`      | ูุฏุช ุฒูุงู ูพุดโุจู ุจู ุซุงูู (ูุซูุงู `60` โ ฑ ุฏููู ุขูุฏู)                       |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู (ูุซูุงู ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง HTTP ุฏุฑ ูุฑ ุซุงูู):

```promql
http_requests_total
```

ูโุฎูุงูู ููุฏุงุฑ ูพุดโุจูโุดุฏู ุฏุฑ ฑ ุฏููู ุขูุฏู ุฑุง ุจุจููุ ุจุฑ ุงุณุงุณ ุฑููุฏ ต ุฏููู ุงุฎุฑ:

```promql
predict_linear(http_requests_total[5m], 60)
```

โ๐น Prometheus ุงุฒ **ุฑฺฏุฑุณูู ุฎุท** ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง ุฎุท ุฑููุฏ ฺฏุฐุดุชู ุฑุง ูพุฏุง ฺฉูุฏ ู ููุฏุงุฑ **60 ุซุงูู ุจุนุฏ** ุฑุง ูพุดโุจู ฺฉูุฏ.

---

## ๐งฎ ูุญูู ฺฉุงุฑฺฉุฑุฏ (ููููู)

1. ุฏุงุฏูโูุง ฺฏุฐุดุชู ุฏุฑ ุจุงุฒูโ `[5m]` ุฌูุนโุขูุฑ ูโุดููุฏ.
2. **ุฑฺฏุฑุณูู ุฎุท** ุฑู ุฏุงุฏูโูุง ุงุฌุฑุง ูโุดูุฏ ุชุง **ุดุจ ุฎุท ุฑููุฏ** (slope) ู ููุฏุงุฑ ุงููู (intercept) ูุญุงุณุจู ุดูุฏ.
3. ููุฏุงุฑ ูพุดโุจู ุดุฏู:

[
\text{predicted value} = \text{current value} + (\text{slope} \times \text{seconds})
]

> ุนู ุงฺฏุฑ ุฑููุฏ ูุนู ุงุฏุงูู ูพุฏุง ฺฉูุฏุ ููุฏุงุฑ ูุชุฑฺฉ ุจุนุฏ ุงุฒ `seconds` ุซุงูู ฺูุฏุฑ ุฎูุงูุฏ ุจูุฏ.

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

โ1. **Alerting ูพุดโุจูโุดุฏู**

   * ูโุชูุงู ูพุดโุจู ฺฉุฑุฏ ฺฉู ุขุง ูุชุฑฺฉ ุฏุฑ ุขูุฏู ุจู ุญุฏ ุจุญุฑุงู ูโุฑุณุฏ ุง ูู:

   ```promql
   predict_linear(node_memory_Active_bytes[10m], 300) > 0.9 * node_memory_MemTotal_bytes
   ```

   > ูพุดโุจู ูโฺฉูุฏ ฺฉู ุฏุฑ ต ุฏููู ุขูุฏูุ ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู ุจุด ุงุฒ นฐูช ุฎูุงูุฏ ุดุฏ ุง ูู.

2. **ูพุดโุจู ุชุฑุงูฺฉ**

   * ุจุฑุง HTTP requests ุง CPU usage ูโุชูุงู trend ุขูุฏู ุฑุง ูพุดโุจู ฺฉุฑุฏ ู alert ฺฏุฑูุช.

3. **ูููุฏุงุฑูุง ุขูุฏูโูฺฏุฑ ุฏุฑ Grafana**

   * ููุงุด ุฑููุฏ ูพุดโุจูโุดุฏู ุจุฑ ุงุณุงุณ ุฏุงุฏูโูุง ฺฏุฐุดุชู ุจุฑุง planning ุง ุธุฑูุชโุณูุฌ.

---

## โ๏ธ ูฺฉุงุช ููู

โ* `predict_linear()` ููุท ุฑู **ูุชุฑฺฉโูุง cumulative ุง gauge** ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.
* ูพุดโุจู ุฏูู ูุณุช ู ุตุฑูุงู **ุชุฎูู ุฎุท** ุงุณุชุ ุงฺฏุฑ ุฑูุชุงุฑ ูุชุฑฺฉ ูุงฺฏูุงู ุชุบุฑ ฺฉูุฏุ ูพุดโุจู ุงุดุชุจุงู ุฎูุงูุฏ ุจูุฏ.
* ุจุงุฒูโ `[range-vector]` ุจุงุฏ ุญุฏุงูู ุฏู ููููู ุฏุงุดุชู ุจุงุดุฏ ุชุง slope ูุงุจู ูุญุงุณุจู ุจุงุดุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ  | ุชูุถุญ                                                      |
| ------ | ---------------------------------------------------------- |
| ุชุงุจุน   | `predict_linear(range-vector, seconds)`                    |
| ูุฑูุฏ  | range vector ุงุฒ ุฏุงุฏูโูุง ฺฏุฐุดุชู                             |
| ุฎุฑูุฌ  | ููุฏุงุฑ ูพุดโุจูโุดุฏู ูุชุฑฺฉ ุจุนุฏ ุงุฒ `seconds` ุซุงูู            |
| ูุฏู    | ุชุฎูู ุขูุฏู ูุชุฑฺฉ ุจุฑ ุงุณุงุณ ุฑููุฏ ุฎุท ฺฏุฐุดุชู                   |
| ฺฉุงุฑุจุฑุฏ | Alerting ูพุดโุจูโุดุฏูุ ูููุฏุงุฑูุง ุขูุฏูโูฺฏุฑุ trend analysis |

---

ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช



