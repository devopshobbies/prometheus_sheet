
ุฏุฑ Prometheus ฺูุฏู ุชุงุจุน ุฏุงุฎู ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ูโุชูุงูุฏ ุงุฒ ุขููุง ุฏุฑ ุนุจุงุฑุงุช ูพุฑุณโูุฌู (PromQL) ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ุชูุงุจุน ุจู ุดูุง ุงูฺฉุงู ูโุฏููุฏ ูุญุงุณุจุงุช ูพฺุฏูโุชุฑ ุงูุฌุงู ุฏูุฏ ู ุฏุงุฏูโูุง ูุชุฑฺฉ ุฑุง ุจูุชุฑ ุชุญูู ฺฉูุฏ.
## ุฏุณุชูโุจูุฏ ุชูุงุจุน ุฏุฑ  Prometheus


ุจุนุถ ุชูุงุจุน ุขุฑฺฏููุงูโูุง ูพุดโูุฑุถ ุฏุงุฑูุฏุ ูุซูุงู `year(v=vector(time()) instant-vector)`. ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ฺฉ ุขุฑฺฏููุงู `v` ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ฺฉ ยซูฺฉุชูุฑ ูุญุธูโุงยป (instant-vector) ุงุณุช ู ุงฺฏุฑ ุงุฑุงุฆู ูุดูุฏุ ููุฏุงุฑ ูพุดโูุฑุถ ุขู ุนุจุงุฑุช `vector(time())` ุฎูุงูุฏ ุจูุฏ.

### `abs()`
โ`abs(v instant-vector)`: ูฺฉุชูุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุญุงู ุชูุงู ูููููโูุง float ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุงุณุช ฺฉู ุจู ูุฏุฑ ูุทููุดุงู ุชุจุฏู ุดุฏูโุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.


----

#### `absent()`



โ`absent(v instant-vector)`: ุงฺฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุฏุงุฑุง ุนูุตุฑ ุจุงุดุฏ (ูููููโูุง float ุง ูุณุชูฺฏุฑุงู)ุ ฺฉ ูฺฉุชูุฑ ุฎุงู ุจุฑูโฺฏุฑุฏุงูุฏ ู ุงฺฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ูฺ ุนูุตุฑ ูุฏุงุดุชู ุจุงุดุฏุ ฺฉ ูฺฉุชูุฑ ุชฺฉโุนูุตุฑ ุจุง ููุฏุงุฑ ฑ ุจุฑูโฺฏุฑุฏุงูุฏ.

ุงู ุชุงุจุน ุจุฑุง ูุดุฏุงุฑ ุฏุงุฏู ุฒูุงู ููุฏ ุงุณุช ฺฉู ูฺ ุณุฑ ุฒูุงู ุจุฑุง ุชุฑฺฉุจ ูุดุฎุต ุงุฒ ูุงู ูุชุฑฺฉ ู ูุจู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ.
```
absent(nonexistent{job="myjob"})
# => {job="myjob"}

absent(nonexistent{job="myjob",instance=~".*"})
# => {job="myjob"}

absent(sum(nonexistent{job="myjob"}))
# => {}
```
ุฏุฑ ุฏู ูุซุงู ุงููุ `absent()` ุณุน ูโฺฉูุฏ ููุดููุฏุงูู ูุจูโูุง ูฺฉุชูุฑ ุฎุฑูุฌ ุชฺฉโุนูุตุฑ ุฑุง ุงุฒ ูฺฉุชูุฑ ูุฑูุฏ ุงุณุชุฎุฑุงุฌ ฺฉูุฏ.

---

### `absent_over_time()`
โ`absent_over_time(v range-vector)`: ุงฺฏุฑ ยซูฺฉุชูุฑ ุจุงุฒูโุงยป (range-vector) ูุฑูุฏ ุฏุงุฑุง ุนูุตุฑ ุจุงุดุฏ (ูููููโูุง float ุง ูุณุชูฺฏุฑุงู)ุ ฺฉ ูฺฉุชูุฑ ุฎุงู ุจุฑูโฺฏุฑุฏุงูุฏ ู ุงฺฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ูุฑูุฏ ูฺ ุนูุตุฑ ูุฏุงุดุชู ุจุงุดุฏุ ฺฉ ูฺฉุชูุฑ ุชฺฉโุนูุตุฑ ุจุง ููุฏุงุฑ ฑ ุจุฑูโฺฏุฑุฏุงูุฏ.

ุงู ุชุงุจุน ุจุฑุง ูุดุฏุงุฑ ุฏุงุฏู ุฒูุงู ููุฏ ุงุณุช ฺฉู ูฺ ุณุฑ ุฒูุงู ุจุฑุง ุชุฑฺฉุจ ูุดุฎุต ุงุฒ ูุงู ูุชุฑฺฉ ู ูุจู ุจุฑุง ูุฏุช ุฒูุงู ูุนู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ.
```
absent_over_time(nonexistent{job="myjob"}[1h])
# => {job="myjob"}

absent_over_time(nonexistent{job="myjob",instance=~".*"}[1h])
# => {job="myjob"}

absent_over_time(sum(nonexistent{job="myjob"})[1h:])
# => {}
```
ุฏุฑ ุฏู ูุซุงู ุงููุ `absent_over_time()` ุณุน ูโฺฉูุฏ ููุดููุฏุงูู ูุจูโูุง ูฺฉุชูุฑ ุฎุฑูุฌ ุชฺฉโุนูุตุฑ ุฑุง ุงุฒ ูฺฉุชูุฑ ูุฑูุฏ ุงุณุชุฎุฑุงุฌ ฺฉูุฏ.

----

### `ceil()`
โ`ceil(v instant-vector)`: ูฺฉุชูุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุญุงู ุชูุงู ูููููโูุง float ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุงุณุช ฺฉู ุจู ูุฒุฏฺฉโุชุฑู ุนุฏุฏ ุตุญุญ ุจุฒุฑฺฏุชุฑ ุง ูุณุงู ููุฏุงุฑ ุงุตูโุดุงู ฺฏุฑุฏ ุดุฏูโุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.
```
ceil(+Inf) = +Inf
ceil(ยฑ0) = ยฑ0
ceil(1.49) = 2.0
ceil(1.78) = 2.0
```

### `changes()`
โ`changes(v range-vector)`: ุจุฑุง ูุฑ ุณุฑ ุฒูุงู ูุฑูุฏุ ุชุนุฏุงุฏ ุฏูุนุงุช ฺฉู ููุฏุงุฑ ุขู ุฏุฑ ุจุงุฒู ุฒูุงู ุงุฑุงุฆู ุดุฏู ุชุบุฑ ฺฉุฑุฏู ุงุณุช ุฑุง ุจู ุนููุงู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุจุฑูโฺฏุฑุฏุงูุฏ. ฺฉ ููููู float ู ุจู ุฏูุจุงู ุขู ฺฉ ููููู ูุณุชูฺฏุฑุงูุ ุง ุจุฑุนฺฉุณุ ุจู ุนููุงู ฺฉ ุชุบุฑ ูุญุณูุจ ูโุดูุฏ. ฺฉ ููููู ูุณุชูฺฏุฑุงู ุดูุงุฑูุฏู (counter) ู ุจู ุฏูุจุงู ุขู ฺฉ ููููู ูุณุชูฺฏุฑุงู ฺฏูุฌ (gauge) ุจุง ููุงุฏุฑ ุฏููุงู ฺฉุณุงู (ุจู ุฌุฒ ููุน)ุ ุง ุจุฑุนฺฉุณุ ุจู ุนููุงู ุชุบุฑ ูุญุณูุจ ููโุดูุฏ.

----


### `clamp()`
โ`clamp(v instant-vector, min scalar, max scalar)`: ููุงุฏุฑ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ุทูุฑ ูุญุฏูุฏ ูโฺฉูุฏ ฺฉู ุญุฏ ูพุงู `min` ู ุญุฏ ุจุงูุง `max` ุฏุงุดุชู ุจุงุดูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

----


ููุงุฑุฏ ุฎุงุต:
*   ุงฺฏุฑ `min > max` ุจุงุดุฏุ ฺฉ ูฺฉุชูุฑ ุฎุงู ุจุฑูโฺฏุฑุฏุงูุฏ.
*   ุงฺฏุฑ `min` ุง `max` ุจุฑุงุจุฑ `NaN` ุจุงุดุฏุ ูููููโูุง float ุจู `NaN` ูุญุฏูุฏ ูโุดููุฏ.

### `clamp_max()`
โ`clamp_max(v instant-vector, max scalar)`: ููุงุฏุฑ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ุทูุฑ ูุญุฏูุฏ ูโฺฉูุฏ ฺฉู ุญุฏ ุจุงูุง `max` ุฏุงุดุชู ุจุงุดูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `clamp_min()`
โ`clamp_min(v instant-vector, min scalar)`: ููุงุฏุฑ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ุทูุฑ ูุญุฏูุฏ ูโฺฉูุฏ ฺฉู ุญุฏ ูพุงู `min` ุฏุงุดุชู ุจุงุดูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

#### `day_of_month()`
โ`day_of_month(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุฑูุฒู ูุงู (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฑ ุชุง ณฑ ูุณุชูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

#### `day_of_week()`
โ`day_of_week(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุฑูุฒู ููุชู (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฐ ุชุง ถ ูุณุชูุฏุ ฺฉู ฐ ุจู ูุนูุง ฺฉุดูุจู ู ุงู ุขุฎุฑ ุงุณุช. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `day_of_year()`
โ`day_of_year(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุฑูุฒู ุณุงู (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจุฑุง ุณุงูโูุง ุบุฑฺฉุจุณู ุจู ฑ ุชุง ณถต ู ุจุฑุง ุณุงูโูุง ฺฉุจุณู ุจู ฑ ุชุง ณถถ ูุณุชูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `days_in_month()`
โ`days_in_month(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุชุนุฏุงุฏ ุฑูุฒูุง ูุงูู ูุฑ ฺฉ ุงุฒ ุขู timestamps (ุฏุฑ UTC) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฒธ ุชุง ณฑ ูุณุชูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `delta()`
โ`delta(v range-vector)`: ุชูุงูุช ุจู ููุฏุงุฑ ุงูู ู ุขุฎุฑ ูุฑ ุนูุตุฑ ุณุฑ ุฒูุงู ุฏุฑ ฺฉ ูฺฉุชูุฑ ุจุงุฒูโุง `v` ุฑุง ูุญุงุณุจู ฺฉุฑุฏู ู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุจุง ุฏูุชุงูุง ุฏุงุฏู ุดุฏู ู ูุจูโูุง ูุนุงุฏู ุจุฑูโฺฏุฑุฏุงูุฏ. ุฏูุชุง ุจุฑุง ูพูุดุด ฺฉุงูู ุจุงุฒู ุฒูุงู ูุดุฎุต ุดุฏู ุฏุฑ ุงูุชุฎุงุจฺฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุจุฑููุงุจ (extrapolate) ูโุดูุฏุ ุจูุงุจุฑุงู ุญุช ุงฺฏุฑ ููุงุฏุฑ ูููููโูุง ููฺฏ ุตุญุญ ุจุงุดูุฏุ ููฺฉู ุงุณุช ูุชุฌูโุง ุบุฑุตุญุญ ุจุฏุณุช ุขุฏ.

ูุซุงู ุฒุฑ ุชูุงูุช ุฏูุง CPU ุจู ุงฺฉููู ู ฒ ุณุงุนุช ูพุด ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```
delta(cpu_temp_celsius{host="zeus"}[2h])
```
โ`delta` ุจุฑ ุฑู ูููููโูุง ูุณุชูฺฏุฑุงู ุจุง ูุญุงุณุจู ฺฉ ูุณุชูฺฏุฑุงู ุฌุฏุฏ ุนูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุขู ูุฑ ุฌุฒุก (ูุฌููุน ู ุชุนุฏุงุฏ ูุดุงูุฏุงุชุ ุจุงฺฉุชโูุง) ุชูุงูุช ุจู ุฌุฒุก ูุฑุจูุทู ุฏุฑ ุงููู ู ุขุฎุฑู ูุณุชูฺฏุฑุงู ุจูู (native histogram) ุฏุฑ `v` ุงุณุช. ุจุง ุงู ุญุงูุ ูุฑ ุนูุตุฑ ุฏุฑ `v` ฺฉู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ุจุงุฒู ุฏุงุดุชู ุจุงุดุฏุ ุงุฒ ูฺฉุชูุฑ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ ุงุฏุฏุงุดุช (annotation) ุณุทุญ ูุดุฏุงุฑ (warn-level) ูุดุฎุต ูโุดูุฏ.

โ`delta` ููุท ุจุงุฏ ุจุง ฺฏูุฌโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ.

### `deriv()`
โ`deriv(v range-vector)`: ูุดุชู ุจุฑ ุญุณุจ ุซุงูู ูุฑ ุณุฑ ุฒูุงู float ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง `v` ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑฺฏุฑุณูู ุฎุท ุณุงุฏู ูุญุงุณุจู ูโฺฉูุฏ. ูฺฉุชูุฑ ุจุงุฒูโุง ุจุงุฏ ุญุฏุงูู ุฏู ููููู float ุจุฑุง ุงูุฌุงู ูุญุงุณุจู ุฏุงุดุชู ุจุงุดุฏ. ููฺฏุงู ฺฉู `+Inf` ุง `-Inf` ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุงูุช ุดูุฏุ ููุฏุงุฑ ุดุจ ู ุขูุณุช ูุญุงุณุจู ุดุฏู `NaN` ุฎูุงูุฏ ุจูุฏ.

โ`deriv` ููุท ุจุงุฏ ุจุง ฺฏูุฌโูุง ุงุณุชูุงุฏู ุดูุฏ ู ููุท ุจุฑุง ูููููโูุง float ฺฉุงุฑ ูโฺฉูุฏ. ุนูุงุตุฑ ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ฺฉู ููุท ุญุงู ูููููโูุง ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ุจู ุทูุฑ ฺฉุงูู ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ุจุฑุง ุนูุงุตุฑ ฺฉู ุญุงู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ููุท ุงุฒ ูููููโูุง float ุจู ุนููุงู ูุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ุจุง ฺฉ ุงุฏุฏุงุดุช ุณุทุญ ุงุทูุงุนุงุช (info-level) ูุดุฎุต ูโุดูุฏ.



### `double_exponential_smoothing()`

ุฑูุด **Double Exponential Smoothing (ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู)** ุง ุจู ูุงุฑุณ **ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู**ุ ฺฉ ุงุฒ ุฑูุดโูุง ูพุดโุจู ุณุฑโูุง ุฒูุงู ุงุณุช ฺฉู ุนูุงูู ุจุฑ **ูุงูฺฏูโฺฏุฑ ู ูููุงุฑุณุงุฒ ุฏุงุฏูโูุง**ุ **ุฑููุฏ (Trend)** ุฏุงุฏู ุฑุง ูุฒ ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ.

---

### ๐น ูุฑูุฑ ุจุฑ ุงุฏู ุงุตู

ุฏุฑ **ูููุงุฑุณุงุฒ ููุง ุณุงุฏู (Simple Exponential Smoothing)** ูุฑุถ ูโุดูุฏ ฺฉู ุฏุงุฏูโูุง ุฑููุฏ ุฎุงุต ูุฏุงุฑูุฏ ู ููุท ููุณุงูุงุช ุชุตุงุฏู ุฏุงุฑูุฏ.
ุงูุง ุงฺฏุฑ ุฏุงุฏูโูุง ุฑููุฏ ุงูุฒุงุด ุง ฺฉุงูุด ุฏุงุดุชู ุจุงุดูุฏ (ูุซูุงู ูุฑูุด ูุงูุงูู ฺฉู ุฑู ุจู ุงูุฒุงุด ุงุณุช)ุ ูุฏู ุณุงุฏู ุฏฺฏุฑ ููุงุณุจ ูุณุช.
ุฏุฑ ุงู ุญุงูุช ุงุฒ **Double Exponential Smoothing** ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ูโุชูุงูุฏ **ุณุทุญ (Level)** ู **ุฑููุฏ (Trend)** ุฑุง ุฌุฏุงฺฏุงูู ูุฏู ฺฉูุฏ.

---

### ๐น ูุฑูููโูุง

ุงู ุฑูุด ุฏู ูุคููู ุฏุงุฑุฏ:

ฑ. **ุณุทุญ (Level):**
$$
   [
   L_t = \alpha Y_t + (1 - \alpha)(L_{t-1} + T_{t-1})
   ]$$
   ฺฉู ุฏุฑ ุขู:

โ   * ( Y_t ): ููุฏุงุฑ ูุดุงูุฏูโุดุฏู ุฏุฑ ุฒูุงู ( t )
   * โ( L_t ): ุณุทุญ (ูุงูฺฏู ูููุงุฑุดุฏู) ุฏุฑ ุฒูุงู ( t )
   * โ( T_{t-1} ): ุฑููุฏ ุจุฑุขูุฑุฏุดุฏู ุฏุฑ ุฒูุงู ูุจู
   โ* ( \alpha ): ุถุฑุจ ูููุงุฑุณุงุฒ ุจุฑุง ุณุทุญ (ุจู 0 ู 1)

ฒ. **ุฑููุฏ (Trend):**
  ฺฉู ุฏุฑ ุขู:
$$
   [
   T_t = \beta (L_t - L_{t-1}) + (1 - \beta) T_{t-1}
   ]
 
$$
   * โ( T
   
   * โ( \beta ): ุถุฑุจ ูููุงุฑุณุงุฒ ุจุฑุง ุฑููุฏ (ุจู 0 ู 1)



ฒ. **ูพุดโุจู (Forecast):**

$$
   [
   \hat{Y}_{t+m} = L_t + mT_t
   ]
$$
   ฺฉู ุฏุฑ ุขู:
   

   * ( m ): ุชุนุฏุงุฏ ฺฏุงูโูุง ูพุดโุจู ุจู ุฌูู ุงุณุช (ูุซูุงู ูพุดโุจู ุจุฑุง ูุงู ุจุนุฏ ุนู ( m = 1 ))

---

### ๐น ุชูุณุฑ ุดููุฏ

โ* ( L_t ): ููุฏุงุฑ "ุณุทุญ" ูุนู ุฏุงุฏู (ูุซู ูุงูฺฏู ูููุงุฑุดุฏู)
โ* ( T_t ): ูุฑุฎ ุชุบุฑ (ุดุจ ุง ุฑููุฏ ุฑุดุฏ/ฺฉุงูุด)
* ุถุฑุงุจ ( \alpha ) ู ( \beta ): ฺฉูุชุฑู ูุฒุงู ูุงฺฉูุด ูุฏู ุจู ุชุบุฑุงุช ุฌุฏุฏ ุฏุงุฏูโูุง
  (ุงฺฏุฑ ูุฒุฏฺฉ 1 ุจุงุดูุฏุ ูุฏู ุจู ุชุบุฑุงุช ุฌุฏุฏ ุณุฑุนโุชุฑ ูุงฺฉูุด ูโุฏูุฏ)

---

### ๐น ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉูุฏ ุฏุงุฏูโูุง ูุฑูุด ูุงูุงูู ุจู ุตูุฑุช ุฒุฑ ุจุงุดูุฏ:

| ูุงู | ูุฑูุด (Y) |
| --- | -------- |
| 1   | 100      |
| 2   | 120      |
| 3   | 130      |
| 4   | 150      |

ูโุจูู ฺฉู ุฑููุฏ ุตุนูุฏ ุฏุงุฑุฏ โ ูพุณ Double Exponential Smoothing ููุงุณุจ ุงุณุช.

ูุฏู ุจุง ูุญุงุณุจู ุณุทุญ ู ุฑููุฏ ุฏุฑ ูุฑ ูุฑุญููุ ูุฑูุด ูุงูโูุง ุขูุฏู ุฑุง ูพุดโุจู ูโฺฉูุฏ (ูุซูุงู ูุงู 5 ู 6).

---

### ๐น ุงููุงุน ูุฏูโูุง

ุฏุฑ ูุงูุน Double Exponential Smoothing ููุน ุฎุงุต ุงุฒ ูุฏูโูุง **Holtโs Linear Trend** ุงุณุชุ ฺฉู ุจุนุฏูุง ุจุง ุงุถุงูู ฺฉุฑุฏู ูุคูููโ ูุตู (**Seasonality**) ุจู ูุฏู **Triple Exponential Smoothing (Holt-Winters)** ุชุจุฏู ุดุฏ.

---

### ๐น ุฏุฑ ูพุงุชูู (ูุซุงู ฺฉูุชุงู ุจุง statsmodels)

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

model = ExponentialSmoothing(data, trend='add').fit()
forecast = model.forecast(5)
print(forecast)
```

ุฏุฑ ุงูุฌุง:

โ* `trend='add'` ุนู ุฑููุฏ ุฎุท ุงูุฒุงุด.
โ* `forecast(5)` ุนู ูพุดโุจู ต ฺฏุงู ุขูุฏู.

---


# ุชุงุจุน `holt_winters()` (Double Exponential Smoothing) ุฏุฑ PromQL

 ุฏุฑ Prometheus ุงุฒ ูุณุฎู 2.0 ุจู ุจุนุฏ ุชุงุจุน `holt_winters()` ุฑุง ุงุฑุงุฆู ฺฉุฑุฏู ฺฉู ูพุงุฏูโุณุงุฒ Double Exponential Smoothing (ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู) ุงุณุช.

## ฺฉุงุฑุจุฑุฏ ุงุตู

ุงู ุชุงุจุน ุจุฑุง **ูพุดโุจู ููุงุฏุฑ ุขูุฏู** ุจุฑ ุงุณุงุณ ุฑููุฏ ุชุงุฑุฎ ุฏุงุฏูโูุง ุงุณุชูุงุฏู ูโุดูุฏ ู ุชุฑฺฉุจ ุงุฒ:

ฑ. ูููุงุฑุณุงุฒ ุณุทุญ ุฏุงุฏู (Level)
ฒ. ูููุงุฑุณุงุฒ ุฑููุฏ (Trend)

## ูุฑูุช ฺฉู:

```promql
holt_winters(v range-vector, sf scalar, tf scalar)
```

- `sf`: ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ (smoothing factor) ุจุฑุง ุณุทุญ (0 < sf < 1)
- `tf`: ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุจุฑุง ุฑููุฏ (0 < tf < 1)

## ูุซุงู ฺฉุงุฑุจุฑุฏ:

```promql
holt_winters(
  node_memory_MemFree_bytes[1h],  # ูุชุฑฺฉ ู ุจุงุฒู ุฒูุงู
  0.3,  # ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุณุทุญ
  0.3   # ูุงฺฉุชูุฑ ูููุงุฑุณุงุฒ ุฑููุฏ
)
```



```promql
holt_winters(node_memory_MemFree_bytes[1h],0.3,0.3)
```
## ูพุงุฑุงูุชุฑูุง ููู:

ฑ. **ูุงฺฉุชูุฑูุง ูููุงุฑุณุงุฒ**:
   - ููุงุฏุฑ ูุฒุฏฺฉ ุจู 0: ูุฒู ุจุดุชุฑ ุจู ุฏุงุฏูโูุง ุชุงุฑุฎ
   - ููุงุฏุฑ ูุฒุฏฺฉ ุจู 1: ูุฒู ุจุดุชุฑ ุจู ุฏุงุฏูโูุง ุงุฎุฑ

ฒ. **ุจุงุฒู ุฒูุงู**:
   - ุจุงุฏ ุจู ุงูุฏุงุฒูโุง ุจุงุดุฏ ฺฉู ุงูฺฏููุง ูุตู ู ุฑููุฏ ุฑุง ูพูุดุด ุฏูุฏ

## ุชูุงูุช ุจุง `predict_linear()`:

| ูฺฺฏ        | `holt_winters()` | `predict_linear()` |
| ------------ | ---------------- | ------------------ |
| ุฑูุด          | ูููุงุฑุณุงุฒ ุฏูฺฏุงูู | ุฑฺฏุฑุณูู ุฎุท ุณุงุฏู   |
| ููุงุญุธุงุช ุฑููุฏ | ุฏุงุฑุฏ             | ุฏุงุฑุฏ               |
| ููุงุญุธุงุช ูุตู | ุฎุฑ              | ุฎุฑ                |
| ูพฺุฏฺฏ      | ุจุดุชุฑ            | ฺฉูุชุฑ               |

## ูฺฉุงุช ููู:

ฑ. ููุท ุจุฑุง **Gauge metrics** ููุงุณุจ ุงุณุช
ฒ. ูุงุฒ ุจู ุชูุธู ุฏูู ูพุงุฑุงูุชุฑูุง ุฏุงุฑุฏ
ณ. ุจุฑุง ูพุดโุจูโูุง ฺฉูุชุงูโูุฏุช ุจูุชุฑ ุนูู ูโฺฉูุฏ
ด. ุฏุฑ ูุณุฎูโูุง ุฌุฏุฏ Prometheus ููฺฉู ุงุณุช ุชุบุฑ ฺฉุฑุฏู ุจุงุดุฏ

ูุซุงู ูพุดุฑูุชู ุจุฑุง ูุงูุชูุฑูฺฏ:

```promql
# ูพุดโุจู ุงุณุชูุงุฏู ุงุฒ CPU ุจุง ูููุงุฑุณุงุฒ ุฏูฺฏุงูู
holt_winters(
  instance:node_cpu_utilisation:rate5m[2h],
  0.5,
  0.2
) > 0.8
```

ุงู ฺฉูุฆุฑ ุฒูุงู ุขูุงุฑู ูโุฏูุฏ ฺฉู ูพุดโุจู ูโุดูุฏ ุงุณุชูุงุฏู ุงุฒ CPU ุงุฒ 80% ุนุจูุฑ ฺฉูุฏ.

---


ุงู ุชุงุจุน ุจุงุฏ ุงุฒ ุทุฑู ููฺฏ ูฺฺฏ `--enable-feature=promql-experimental-functions` ูุนุงู ุดูุฏ.

โ`double_exponential_smoothing(v range-vector, sf scalar, tf scalar)`: ฺฉ ููุฏุงุฑ ูููุงุฑ ุดุฏู ุจุฑุง ูุฑ ุณุฑ ุฒูุงู float ุฏุฑ ุจุงุฒู `v` ุชููุฏ ูโฺฉูุฏ. ูุฑฺู ุถุฑุจ smoothing ุง ูููุงุฑุณุงุฒ `sf` ฺฉูุชุฑ ุจุงุดุฏุ ุงููุช ุจุดุชุฑ ุจู ุฏุงุฏูโูุง ูุฏู ุฏุงุฏู ูโุดูุฏ. ูุฑฺู ุถุฑุจ ุฑููุฏ `tf` ุจุงูุงุชุฑ ุจุงุดุฏุ trendsูุง ุจุดุชุฑ ุฏุฑ ุฏุงุฏูโูุง ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ. ูุฑ ุฏู `sf` ู `tf` ุจุงุฏ ุจู ฐ ู ฑ ุจุงุดูุฏ. ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑุ ุจู ฺฉุชุงุจ ุฑุงูููุง ุขูุงุฑ ูููุฏุณ NIST ูุฑุงุฌุนู ฺฉูุฏ. ุฏุฑ Prometheus V2 ุงู ุชุงุจุน `holt_winters` ูุงูุฏู ูโุดุฏ. ุงู ุงูุฑ ุจุงุนุซ ุณุฑุฏุฑฺฏู ูโุดุฏ ุฒุฑุง ุฑูุด ูููุช-ููุชุฑุฒ ูุนูููุงู ุจู ูููุงุฑุณุงุฒ ููุง ุณูโฺฏุงูู ุงุดุงุฑู ุฏุงุฑุฏ. ูููุงุฑุณุงุฒ ููุง ุฏูฺฏุงูู ููุงูุทูุฑ ฺฉู ุฏุฑ ุงูุฌุง ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุชุ ุจู ุนููุงู "Holt Linear" ูุฒ ุดูุงุฎุชู ูโุดูุฏ.

โ`double_exponential_smoothing` ููุท ุจุงุฏ ุจุง ฺฏูุฌโูุง ุงุณุชูุงุฏู ุดูุฏ ู ููุท ุจุฑุง ูููููโูุง float ฺฉุงุฑ ูโฺฉูุฏ. ุนูุงุตุฑ ุฏุฑ range-vector ฺฉู ููุท ุญุงู ูููููโูุง ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ุจู ุทูุฑ ฺฉุงูู ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ุจุฑุง ุนูุงุตุฑ ฺฉู ุญุงู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ููุท ุงุฒ ูููููโูุง float ุจู ุนููุงู ูุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ุจุง ฺฉ info-level ูุดุฎุต ูโุดูุฏ.











### `exp()`
โ`exp(v instant-vector)`: ุชุงุจุน ููุง ุฑุง ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ูุญุงุณุจู ูโฺฉูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู  ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ููุงุฑุฏ ุฎุงุต ุนุจุงุฑุชูุฏ ุงุฒ:
```
Exp(+Inf) = +Inf
Exp(NaN) = NaN
```


### `floor()`
โ`floor(v instant-vector)`: ูฺฉุชูุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุญุงู ุชูุงู ูููููโูุง float ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุงุณุช ฺฉู ุจู ูุฒุฏฺฉโุชุฑู ุนุฏุฏ ุตุญุญ ฺฉูฺฺฉุชุฑ ุง ูุณุงู ููุฏุงุฑ ุงุตูโุดุงู ฺฏุฑุฏ ุดุฏูโุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.
```
floor(+Inf) = +Inf
floor(ยฑ0) = ยฑ0
floor(1.49) = 1.0
floor(1.78) = 1.0
```

### `histogram_avg()`

โ`histogram_avg(v instant-vector)`: ูุงูฺฏู ุญุณุงุจ ููุงุฏุฑ ูุดุงูุฏู ุดุฏู ุฐุฎุฑู ุดุฏู ุฏุฑ ูุฑ ููููู ูุณุชูฺฏุฑุงู ุฏุฑ `v` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง float ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒฺฏุดุช ุธุงูุฑ ููโุดููุฏ.

ุจุฑุง ูุญุงุณุจู ูุงูฺฏู ูุฏุช ุฒูุงู ุฏุฑุฎูุงุณุช ุฏุฑ ฺฉ ูพูุฌุฑู ต ุฏูููโุง ุงุฒ ฺฉ ูุณุชูฺฏุฑุงู ุจููุ ุงุฒ `histogram_avg` ุจู ุตูุฑุช ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:
```
histogram_avg(rate(http_request_duration_seconds[5m]))
```
ฺฉู ูุนุงุฏู ฺฉูุฆุฑ ุฒุฑ ุงุณุช:
```
  histogram_sum(rate(http_request_duration_seconds[5m]))
/
  histogram_count(rate(http_request_duration_seconds[5m]))
```

### `histogram_count()` ู `histogram_sum()`
โ`histogram_count(v instant-vector)`: ุชุนุฏุงุฏ ูุดุงูุฏุงุช ุฐุฎุฑู ุดุฏู ุฏุฑ ูุฑ ููููู ูุณุชูฺฏุฑุงู ุฏุฑ `v` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง float ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒฺฏุดุช ุธุงูุฑ ููโุดููุฏ.

ุจู ุทูุฑ ูุดุงุจูุ `histogram_sum(v instant-vector)` ูุฌููุน ูุดุงูุฏุงุช ุฐุฎุฑู ุดุฏู ุฏุฑ ูุฑ ููููู ูุณุชูฺฏุฑุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

ุจุฑุง ูุญุงุณุจู ูุฑุฎ ูุดุงูุฏุงุช (ุฏุฑ ุงู ููุฑุฏ ูุนุงุฏู "ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุซุงูู") ุงุฒ ฺฉ ุณุฑ ูููููโูุง ูุณุชูฺฏุฑุงูุ ุงุฒ `histogram_count` ุจู ุฑูุด ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:
```
histogram_count(rate(http_request_duration_seconds[10m]))
```





### histogram_fraction()

## ๐งฉ ุชุนุฑู ุชุงุจุน histogram_fraction

```promql
histogram_fraction(ฯ, sum(rate(<histogram>_bucket[range])) by (labels))
```

ุง ุจู ุทูุฑ ฺฉู:

```promql
histogram_fraction(quantile, histogram_metric)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุงู `histogram_fraction()` ุจุฑุง ูุญุงุณุจู **ฺฉุณุฑ ุงุฒ ูููููโูุง histogram** ฺฉู **ฺฉูุชุฑ ุง ูุณุงู ฺฉ ููุฏุงุฑ ุฎุงุต** ูุณุชูุฏ ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูุดุฎุต ูโฺฉูุฏ ฺู ุณูู ุงุฒ ุฏุฑุฎูุงุณุชโูุง ุง ุฑูุฏุงุฏูุงุ ููุฏุงุฑุดุงู ฺฉูุชุฑ ุงุฒ ฺฉ ุญุฏ ูุนู ุงุณุช.

---

## ๐ง ููุงูู ฺฉูุฏ

โ1. Histogram ุฏุฑ Prometheus ูุนูููุงู ุดุงูู ฺูุฏ metric ุงุณุช:

| Metric    | ุชูุถุญ                               |
| --------- | ----------------------------------- |
| `_bucket` | ุชุนุฏุงุฏ ูููููโูุง โค ูุฑ ุญุฏ ุจุงูุง (le) |
| `_count`  | ุชุนุฏุงุฏ ฺฉู ูููููโูุง                   |
| `_sum`    | ุฌูุน ููุงุฏุฑ ูููููโูุง                 |

โ2. `histogram_fraction(ฯ, ...)` ฺฉุณุฑ ุงุฒ ูููููโูุง ฺฉู โค ููุฏุงุฑ ููุฑุฏ ูุธุฑ ูุณุชูุฏ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

* ฯ: ุนุฏุฏ ุจู 0 ู 1
* ฯ = 0.9 โ นฐูช ูููููโูุง

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ

ูุฑุถ ฺฉู metric ุฒุฑ ุฏุงุฑู:

```
http_request_duration_seconds_bucket
```

ู ูโุฎูุงูู ุจุจูู **นฐูช ุฏุฑุฎูุงุณุชโูุง ฺูุฏุฑ ุณุฑุน ูพุงุณุฎ ุฏุงุฏู ุดุฏูโุงูุฏ**:

```promql
histogram_quantile(0.9, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
```

๐น ุงู ูุซุงู ูุดุงุจู `histogram_fraction()` ุงุณุช.

* ุฏุฑ ูุงูุนุ `histogram_fraction()` ูุนูููุงู ุฏุฑ ูุญุงุณุจุงุช ุฏุงุฎู Prometheus ุจุฑุง ุจุฏุณุช ุขูุฑุฏู **percentile fractions** ุงุณุชูุงุฏู ูโุดูุฏ.

---

### ๐น ุชูุงูุช ุจุง `histogram_quantile()`

| ุชุงุจุน                   | ุฎุฑูุฌ                      | ฺฉุงุฑุจุฑุฏ                                             |
| ---------------------- | -------------------------- | -------------------------------------------------- |
| `histogram_fraction()` | ฺฉุณุฑ ูููููโูุง โค ููุฏุงุฑ ูุดุฎุต | ูุนูููุงู ุจุฑุง internal/low-level ูุญุงุณุจุงุช percentile |
| `histogram_quantile()` | ููุฏุงุฑ ูุชูุงุธุฑ ุจุง percentile | ูุญุงุณุจู quantile ูุซู P90ุ P99                       |

> ุจู ุนุจุงุฑุช:
>
> * โ`histogram_fraction()` ูโฺฏูุฏ: "ฺู ุฏุฑุตุฏ ุงุฒ ูููููโูุง โค ููุฏุงุฑ X ูุณุชูุฏ"
> * โ`histogram_quantile()` ูโฺฏูุฏ: "ููุฏุงุฑ Y ฺฉู ฯ ุฏุฑุตุฏ ูููููโูุง โค Y ูุณุชูุฏ"

---

## โ๏ธ ูฺฉุงุช ููู

* ุงู ุชุงุจุน **ูุณุชููุงู ุฑู histogram_bucket** ฺฉุงุฑ ูโฺฉูุฏ.
* ูุนูููุงู ุจุฑุง **ุชุญูู ุฏูู ุชูุฒุน ุฏุงุฏูโูุง** ุงุณุชูุงุฏู ูโุดูุฏ.
* ุฏุฑ ุจุดุชุฑ ุงุณุชูุงุฏูโูุง ูุนูููุ **ฺฉุงุฑุจุฑ ูุณุชูู ุงุฒ `histogram_fraction()` ุงุณุชูุงุฏู ููโฺฉูุฏ** ู ุงุฒ `histogram_quantile()` ุจูุฑู ูโุจุฑุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ                       | ุชูุถุญ                                                                                |
| --------------------------- | ------------------------------------------------------------------------------------ |
| ุชุงุจุน                        | `histogram_fraction(ฯ, histogram_metric)`                                            |
| ูุฑูุฏ                       | histogram metric (_bucket)                                                           |
| ุฎุฑูุฌ                       | ฺฉุณุฑ ูููููโูุง โค ููุฏุงุฑ ูุดุฎุต                                                           |
| ฺฉุงุฑุจุฑุฏ                      | ูุญุงุณุจู ุฏุฑุตุฏ ูููููโูุง ุชุญุช ููุฏุงุฑ ุฎุงุตุ ุชุญูู percentile                                 |
| ุชูุงูุช ุจุง histogram_quantile | histogram_fraction โ ุฏุฑุตุฏ ูููููโูุงุ <br>histogram_quantile โ ููุฏุงุฑ ูุชูุงุธุฑ percentile |

---



โ`histogram_fraction(lower scalar, upper scalar, b instant-vector)`: ฺฉุณุฑ ุชุฎูู ูุดุงูุฏุงุช ุจู ููุงุฏุฑ ูพุงู ู ุจุงูุง ุงุฑุงุฆู ุดุฏู ุฑุง ุจุฑุง ูุฑ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุง ุจูู ููุฌูุฏ ุฏุฑ `b` ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง float ุฏุฑ `b` ุจู ุนููุงู ุชุนุฏุงุฏ ูุดุงูุฏุงุช ุฏุฑ ูุฑ ุจุงฺฉุช ุงุฒ ฺฉ ุง ฺูุฏ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏุ ุฏุฑ ุญุงู ฺฉู ูููููโูุง ูุณุชูฺฏุฑุงู ุจูู ุฏุฑ `b` ูุฑ ฺฉุฏุงู ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ุจู ุนููุงู ฺฉ ูุณุชูฺฏุฑุงู ูุฌุฒุง ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ. ุงู ุจู ููุงู ุฑูุด ุนูู ูโฺฉูุฏ ฺฉู ุจุฑุง `histogram_quantile()` ุนูู ูโฺฉูุฏ. (ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑ ุจู ุขูุฌุง ูุฑุงุฌุนู ฺฉูุฏ.)

ุงฺฏุฑ ููุงุฏุฑ ูพุงู ู ุจุงูุง ุงุฑุงุฆู ุดุฏู ุจุง ูุฑุฒูุง ุจุงฺฉุช ููุทุจู ูุจุงุดูุฏุ ฺฉุณุฑ ูุญุงุณุจู ุดุฏู ฺฉ ุชุฎูู ุงุณุช ฺฉู ุงุฒ ููุงู ุฑูุด ุฏุฑููโุงุจ `histogram_quantile()` ุงุณุชูุงุฏู ูโฺฉูุฏ. (ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑ ุจู ุขูุฌุง ูุฑุงุฌุนู ฺฉูุฏ.) ุจู ุฎุตูุต ุจุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉุ ุจู ุฑุงุญุช ูโุชูุงู ููุงุฏุฑ ูพุงู ุง ุจุงูุง ุฑุง ุงูุชุฎุงุจ ฺฉุฑุฏ ฺฉู ุจุณุงุฑ ุฏูุฑ ุงุฒ ูุฑ ูุฑุฒ ุจุงฺฉุช ุจุงุดูุฏ ู ููุฌุฑ ุจู ุญุงุดู ุฎุทุง ุฒุงุฏ ุดููุฏ. ุจู ุฌุง ุงุณุชูุงุฏู ุงุฒ `histogram_fraction()` ุจุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉุ ุงุบูุจ ุฑูฺฉุฑุฏ ููโุชุฑ ุงู ุงุณุช ฺฉู ููฺฏุงู ูุญุงุณุจู ฺฉุณุฑูุง ูุณุชููุงู ุฑู ุณุฑโูุง ุจุงฺฉุช ุนูู ฺฉูุฏ. ูุญุงุณุจู ุงูุชุงุฒ Apdex ุฑุง ุจู ุนููุงู ฺฉ ูุซุงู ูุนููู ุจุจูุฏ.

ุจู ุนููุงู ูุซุงูุ ุนุจุงุฑุช ุฒุฑ ฺฉุณุฑ ุฏุฑุฎูุงุณุชโูุง HTTP ุฏุฑ ุทูู ฺฉ ุณุงุนุช ฺฏุฐุดุชู ุฑุง ฺฉู ฒฐฐ ููโุซุงูู ุง ฺฉูุชุฑ ุทูู ฺฉุดุฏูโุงูุฏุ ูุญุงุณุจู ูโฺฉูุฏ:
```
histogram_fraction(0, 0.2, rate(http_request_duration_seconds[1h]))
```
ุฎุทุง ุชุฎูู ุจู resolution ูุณุชูฺฏุฑุงู ุจูู ุฒุฑุจูุง ู ุงูฺฉู ูุฑุฒูุง ุงุฑุงุฆู ุดุฏู ฺูุฏุฑ ุจุง ูุฑุฒูุง ุจุงฺฉุช ุฏุฑ ูุณุชูฺฏุฑุงู ููโุชุฑุงุฒ ูุณุชูุฏุ ุจุณุชฺฏ ุฏุงุฑุฏ.

โ`+Inf` ู `-Inf` ููุงุฏุฑ ูุฑุฒ ูุนุชุจุฑ ูุณุชูุฏ. ุจู ุนููุงู ูุซุงูุ ุงฺฏุฑ ูุณุชูฺฏุฑุงู ุฏุฑ ุนุจุงุฑุช ุจุงูุง ุดุงูู ูุดุงูุฏุงุช ููู ุจุงุดุฏ (ฺฉู ุจุฑุง ูุฏุช ุฒูุงู ุฏุฑุฎูุงุณุช ูุจุงุฏ ุงูุทูุฑ ุจุงุดุฏ)ุ ูุฑุฒ ูพุงู ููุงุณุจ ุจุฑุง ุดุงูู ฺฉุฑุฏู ุชูุงู ูุดุงูุฏุงุช ฺฉูุชุฑ ุง ูุณุงู ฐ.ฒุ `-Inf` ุฎูุงูุฏ ุจูุฏ ูู ฐ.

ุงูฺฉู ูุฑุฒูุง ุงุฑุงุฆู ุดุฏู ุดุงูู ุง ุบุฑุดุงูู (inclusive or exclusive) ุจุงุดูุฏุ ุชููุง ุฏุฑ ุตูุฑุช ูุฑุชุจุท ุงุณุช ฺฉู ูุฑุฒูุง ุงุฑุงุฆู ุดุฏู ุฏููุงู ุจุง ูุฑุฒูุง ุจุงฺฉุช ุฏุฑ ูุณุชูฺฏุฑุงู ุจูู ุฒุฑุจูุง ููโุชุฑุงุฒ ุจุงุดูุฏ. ุฏุฑ ุงู ุญุงูุชุ ุฑูุชุงุฑ ุจู ุชุนุฑู ุงุณฺฉูุง ูุณุชูฺฏุฑุงู ุจุณุชฺฏ ุฏุงุฑุฏ. (ุงุณฺฉูุงูุง ููุง ุงุณุชุงูุฏุงุฑุฏ ูุนููู ููฺฏ ุฏุงุฑุง ูุฑุฒูุง ุจุงูุง ุดุงูู ู ูุฑุฒูุง ูพุงู ุบุฑุดุงูู ุจุฑุง ููุงุฏุฑ ูุซุจุช ู ุจุฑุนฺฉุณ ุจุฑุง ููุงุฏุฑ ููู ูุณุชูุฏ.) ุจุฏูู ููโุชุฑุงุฒ ุฏูู ูุฑุฒูุงุ ุชุงุจุน ุงุฒ ุฏุฑููโุงุจ ุจุฑุง ุชุฎูู ฺฉุณุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ. ุจุง ุนุฏู ูุทุนุช ุญุงุตูุ ุงูฺฉู ูุฑุฒูุง ุดุงูู ุง ุบุฑุดุงูู ุจุงุดูุฏุ ุจโุฑุจุท ูโุดูุฏ.




















### histogram_quantile() 

##  ุชุงุจุน `histogram_quantile()`

ุชุงุจุน `histogram_quantile(ฯ, buckets)` ุจุฑุง ูุญุงุณุจูโ **ุตุฏฺฉ (quantile)** ฯ ุงุฒ ุฏุงุฏูโูุง ฺฉ **ูุณุชูฺฏุฑุงู (histogram)** ุงุณุชูุงุฏู ูโุดูุฏ.

ุจู ุฒุจุงู ุณุงุฏู:

> ุงู ุชุงุจุน ูโฺฏูุฏ "ฺูุฏ ุซุงูู ุทูู ฺฉุดุฏ ุชุง Xูช ุงุฒ ุฏุฑุฎูุงุณุชโูุง ูพุงุณุฎ ฺฏุฑูุชูุฏุ"

---

## ๐งฉ ุณุงุฎุชุงุฑ histogram ุฏุฑ Prometheus

ููุช ฺฉ ูุชุฑฺฉ ุงุฒ ููุน histogram ุจุณุงุฒุ Prometheus ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุณู ููุน ูุชุฑฺฉ ุชููุฏ ูโฺฉูุฏ:

| ูุชุฑฺฉ                     | ุชูุถุญ                                  |
| ------------------------- | -------------------------------------- |
| `<metric>_bucket{le="X"}` | ุชุนุฏุงุฏ ฺฉู ุฑุฎุฏุงุฏูุง ฺฉู ููุฏุงุฑุดุงู โค X ุงุณุช |
| `<metric>_sum`            | ูุฌููุน ุชูุงู ููุงุฏุฑ                      |
| `<metric>_count`          | ุชุนุฏุงุฏ ฺฉู ุฑุฎุฏุงุฏูุง                       |

ูุซูุงู ูุชุฑฺฉ ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑ:

```
http_request_duration_seconds
```

ุฏุฑ Prometheus ุฏุงุฏูโูุง ูุซู ุงู ุฐุฎุฑู ูโฺฉูุฏ:

| le   | ููุฏุงุฑ |
| ---- | ----- |
| 0.1  | 120   |
| 0.3  | 300   |
| 0.5  | 450   |
| 1.0  | 600   |
| +Inf | 700   |

ุนู:

* ุชุง ฐ.ฑ ุซุงูู: ฑฒฐ ุฏุฑุฎูุงุณุช
* ุชุง ฐ.ต ุซุงูู: ดตฐ ุฏุฑุฎูุงุณุช
* ุชุง ฑ ุซุงูู: ถฐฐ ุฏุฑุฎูุงุณุช
* ุฏุฑ ูุฌููุน: ทฐฐ ุฏุฑุฎูุงุณุช

---

## ๐งฎ ูุฑููู ููููู

ุชุงุจุน `histogram_quantile(ฯ, ...)` ุจู ุตูุฑุช ุชูุฑุจ ููุฏุงุฑ **q-th quantile** (ูุซู p90ุ p95 ุง p99) ุฑุง ุงุฒ ุงู bucketูุง ูุญุงุณุจู ูโฺฉูุฏ.

ุนู ุจุฑุง ฯ = 0.9 (ุตุฏฺฉ นฐโุงู):

> ุขู ููุฏุงุฑ ุงุฒ ุฒูุงู ูพุงุณุฎ ฺฉู นฐูช ุงุฒ ุฏุฑุฎูุงุณุชโูุง ฺฉูุชุฑ ุงุฒ ุขู ุจูุฏูโุงูุฏ.

---

## ๐ ูุญูู ุงุณุชูุงุฏู

ูุซุงู ุงุณุชุงูุฏุงุฑุฏ ุฏุฑ PromQL:

```promql
histogram_quantile(
  0.9,
  sum(rate(http_request_duration_seconds_bucket[5m])) by (le)
)
```

ุชูุถุญ:

โ* `rate(...[5m])`: ูุฑุฎ ุงูุฒุงุด ูุฑ bucket ุฏุฑ ต ุฏููู ุงุฎุฑ
โ* `sum(... by (le))`: ูุฌููุน bucketูุง ุงุฒ ุชูุงู instanceูุง (ุงูุง bucket `le` ุฑุง ูฺฏู ูโุฏุงุฑุฏ)
โ* `histogram_quantile(0.9, โฆ)`: ูุญุงุณุจู ุตุฏฺฉ นฐุงู ุงุฒ ุงู ุชูุฒุน

---

## ๐ ูุซุงู ุนุฏุฏ

ูุฑุถ ฺฉู ุชูุฒุน bucketูุง latency ุจู ุดฺฉู ุฒุฑ ุงุณุช:

| Bucket (le) | Rate |
| ----------- | ---- |
| 0.1         | 50   |
| 0.3         | 200  |
| 0.5         | 400  |
| 1.0         | 500  |
| +Inf        | 550  |

ูโุฎูุงูู ฯ = 0.9 ุนู p90 ุฑุง ุญุณุงุจ ฺฉูู:

* ุฌูุน ฺฉู = 550
* นฐูช ุงุฒ ตตฐ = ดนต
* ุชุง bucket 0.5 ุฌูุน = ดฐฐ โ ูููุฒ ฺฉูุชุฑ ุงุฒ ดนต
* ุชุง bucket 1.0 ุฌูุน = ตฐฐ โ ุญุงูุง ุงุฒ ดนต ุนุจูุฑ ฺฉุฑุฏ
  ูพุณ p90 ุจู 0.5 ู 1.0 ุงุณุช.

ุจุง ุฏุฑููโุงุจ ุฎุท (interpolation):

```
p90 โ 0.5 + (1.0 - 0.5) * ((495 - 400) / (500 - 400))
    = 0.5 + 0.5 * 0.95
    = 0.975 seconds
```

ุนู p90 โ 0.975 ุซุงูู

---

## โ๏ธ ฺูุฏ ูฺฉุชู ููู

1. ุชุงุจุน `histogram_quantile()` ููุท ุจุง ูุชุฑฺฉโูุง ุงุฒ ููุน `_bucket` ฺฉุงุฑ ูโฺฉูุฏ.
   (ูู ุจุง `_sum` ุง `_count`)

2. ูุนูููุงู ุจุงุฏ ูุจู ุงุฒ ุขู ุงุฒ `rate()` ุงุณุชูุงุฏู ฺฉู ุชุง ูุฑุฎ ุชุบุฑ ุฑุง ุจฺฏุฑ:

   ```promql
   rate(http_request_duration_seconds_bucket[10m])
   ```

3. ู ูุนูููุงู ุจุง `sum()` ฺฏุฑููโุจูุฏ ูโุดูุฏ ุชุง ฺูุฏู ุณุฑูุฑ ุจุง ูู ุชุฑฺฉุจ ุดููุฏ:

   ```promql
   sum(rate(...)) by (le)
   ```

4. ุตุฏฺฉโูุง ุฑุงุฌ:

   * 0.5 โ p50 (ูุงูฺฏู)
   * 0.9 โ p90
   * 0.95 โ p95
   * 0.99 โ p99

---

## ๐ ุฎูุงุตู ุณุงุฏู

| ูพุงุฑุงูุชุฑ                   | ูุนู                                      |
| ------------------------- | ----------------------------------------- |
| `0.9`                     | ุฏุฑุตุฏ ููุฑุฏ ูุธุฑ (นฐูช)                       |
| `rate(..._bucket[10m])`   | ูุฑุฎ ุชุบุฑ bucketูุง ุฏุฑ ฑฐ ุฏููู ุงุฎุฑ       |
| `sum(... by (le))`        | ุฌูุน ฺฉู bucketูุง ุงุฒ ููู instanceูุง         |
| `histogram_quantile(...)` | ูุญุงุณุจูู p90 latency ุงุฒ ุฏุงุฏูโูุง histogram |

---

![image](../../../src/qinterpolation.png)




โ`histogram_quantile(ฯ scalar, b instant-vector)`: ฺูุฏฺฉู ฯ-ุงู (ฯ ุจู ฐ ู ฑ) ุฑุง ุงุฒ ฺฉ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุง ฺฉ ูุณุชูฺฏุฑุงู ุจูู ูุญุงุณุจู ูโฺฉูุฏ. (ุจุฑุง ุชูุถุญ ุฏูู ฺูุฏฺฉโูุง ฯ-ุงู ู ุงุณุชูุงุฏู ุงุฒ ููุน ูุชุฑฺฉ ูุณุชูฺฏุฑุงู (ฺฉูุงุณฺฉ) ุจู ุทูุฑ ฺฉูุ ุจู ุจุฎุด [histograms and summarie](https://prometheus.io/docs/practices/histograms/) ูุฑุงุฌุนู ฺฉูุฏ.)

ูููููโูุง float ุฏุฑ `b` ุจู ุนููุงู ุชุนุฏุงุฏ ูุดุงูุฏุงุช ุฏุฑ ูุฑ ุจุงฺฉุช ุงุฒ ฺฉ ุง ฺูุฏ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ. ูุฑ ููููู float ุจุงุฏ ุฏุงุฑุง ฺฉ ูุจู `le` ุจุงุดุฏ ฺฉู ููุฏุงุฑ ูุจูุ ฺฉุฑุงู ุจุงูุง ุดุงููู ุจุงฺฉุช ุฑุง ูุดุงู ูโุฏูุฏ. (ูููููโูุง float ุจุฏูู ฺูู ูุจู ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.) ุณุงุฑ ูุจูโูุง ู ูุงู ูุชุฑฺฉ ุจุฑุง ุดูุงุณุง ุจุงฺฉุชโูุง ูุชุนูู ุจู ูุฑ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุงุณุชูุงุฏู ูโุดููุฏ. ููุน ูุชุฑฺฉ ูุณุชูฺฏุฑุงู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุณุฑโูุง ุฒูุงู ุจุง ูพุณููุฏ `_bucket` ู ูุจูโูุง ููุงุณุจ ุฑุง ุงุฑุงุฆู ูโุฏูุฏ.

ูููููโูุง ูุณุชูฺฏุฑุงู (ุจูู) ุฏุฑ `b` ูุฑ ฺฉุฏุงู ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ุจู ุนููุงู ฺฉ ูุณุชูฺฏุฑุงู ูุฌุฒุง ุจุฑุง ูุญุงุณุจู ฺูุฏฺฉ ุงุฒ ุขู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ.

ุชุง ุฒูุงู ฺฉู ุชุฏุงุฎู ูุงู ุงุฌุงุฏ ูุดูุฏุ `b` ููฺฉู ุงุณุช ุญุงู ุชุฑฺฉุจ ุงุฒ ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉ ู ุจูู ุจุงุดุฏ.

==ุงุฒ ุชุงุจุน `rate()` ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ูพูุฌุฑู ุฒูุงู ุจุฑุง ูุญุงุณุจู ฺูุฏฺฉ ุงุณุชูุงุฏู ฺฉูุฏ.==

ูุซุงู: ฺฉ ูุชุฑฺฉ ูุณุชูฺฏุฑุงู `http_request_duration_seconds` ูุงูุฏู ูโุดูุฏ (ู ุจูุงุจุฑุงู ูุงู ูุชุฑฺฉ ุจุฑุง ุจุงฺฉุชโูุง ฺฉ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ `http_request_duration_seconds_bucket` ุงุณุช). ุจุฑุง ูุญุงุณุจู ุตุฏฺฉ นฐุงู ูุฏุช ุฒูุงู ุฏุฑุฎูุงุณุช ุฏุฑ ฑฐ ุฏููู ฺฏุฐุดุชูุ ุฏุฑ ุตูุฑุช ฺฉู `http_request_duration_seconds` ฺฉ ูุณุชูฺฏุฑุงู ฺฉูุงุณฺฉ ุจุงุดุฏุ ุงุฒ ุนุจุงุฑุช ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:
```
histogram_quantile(0.9, rate(http_request_duration_seconds_bucket[10m]))
```
ุจุฑุง ฺฉ ูุณุชูฺฏุฑุงู ุจููุ ุจู ุฌุง ุขู ุงุฒ ุนุจุงุฑุช ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:
```
histogram_quantile(0.9, rate(http_request_duration_seconds[10m]))
```


ฺูุฏฺฉ ุจุฑุง ูุฑ ุชุฑฺฉุจ ูุจู ุฏุฑ `http_request_duration_seconds` ูุญุงุณุจู ูโุดูุฏ. ุจุฑุง ุชุฌูุน (aggregate)ุ ุงุฒ ุชุฌูุนโฺฉููุฏู `sum()` ุฏุฑ ุงุทุฑุงู ุชุงุจุน `rate()` ุงุณุชูุงุฏู ฺฉูุฏ. ุงุฒ ุขูุฌุง ฺฉู ูุจู `le` ุจุฑุง `histogram_quantile()` ุฌูุช ูุฏุฑุช ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉ ููุฑุฏ ูุงุฒ ุงุณุชุ ุจุงุฏ ุฏุฑ ุนุจุงุฑุช `by` ฺฏูุฌุงูุฏู ุดูุฏ. ุนุจุงุฑุช ุฒุฑ ุตุฏฺฉ นฐุงู ุฑุง ุจุฑ ุงุณุงุณ `job` ุจุฑุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉ ุชุฌูุน ูโฺฉูุฏ:
```
histogram_quantile(0.9, sum by (job, le) (rate(http_request_duration_seconds_bucket[10m])))
```
ููฺฏุงู ุชุฌูุน ูุณุชูฺฏุฑุงูโูุง ุจููุ ุนุจุงุฑุช ุณุงุฏูโุชุฑ ูโุดูุฏ:
```
histogram_quantile(0.9, sum by (job) (rate(http_request_duration_seconds[10m])))
```
ุจุฑุง ุชุฌูุน ุชูุงู ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉุ ููุท ูุจู `le` ุฑุง ูุดุฎุต ฺฉูุฏ:
```
histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket[10m])))
```
ุจุง ูุณุชูฺฏุฑุงูโูุง ุจููุ ุชุฌูุน ููู ฺุฒ ุทุจู ูุนููู ุจุฏูู ูฺ ุนุจุงุฑุช `by` ฺฉุงุฑ ูโฺฉูุฏ:
```
histogram_quantile(0.9, sum(rate(http_request_duration_seconds[10m])))
```

ุงู ุนุจุงุฑุช ูุนูููุงู ุจุฑุง ูุญุงุณุจู **p90 latency** (ุนู ุตุฏฺฉ นฐโุงู ูุฏุช ุฒูุงู ูพุงุณุฎ HTTP) ุงุณุชูุงุฏู ูโุดูุฏ.  
ุจู ุฒุจุงู ุณุงุฏู:

> ุนู ุฏุฑ นฐูช ุฏุฑุฎูุงุณุชโูุงุ ุฒูุงู ูพุงุณุฎ ฺฉูุชุฑ ุงุฒ ุงู ููุฏุงุฑ ุงุณุช.

==ุฏุฑ ุญุงูุช (ุฑุงุฌ) ฺฉู ููุฏุงุฑ ฺูุฏฺฉ ุจุง ูุฑุฒ ุจุงฺฉุช ููุทุจู ูุจุงุดุฏุ ุชุงุจุน `histogram_quantile()` ููุฏุงุฑ ฺูุฏฺฉ ุฑุง ุฏุฑูู ุจุงฺฉุช ฺฉู ููุฏุงุฑ ฺูุฏฺฉ ุฏุฑ ุขู ูุฑุงุฑ ูโฺฏุฑุฏุ ุฏุฑููโุงุจ ูโฺฉูุฏ.== ุจุฑุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉุ ุจุฑุง ูุณุชูฺฏุฑุงูโูุง ุจูู ุจุง ูุฑุฒูุง ุจุงฺฉุช ุณูุงุฑุดุ ู ุจุฑุง ุจุงฺฉุช ุตูุฑู ุณุงุฑ ูุณุชูฺฏุฑุงูโูุง ุจููุ ุชูุฒุน ฺฉููุงุฎุช ูุดุงูุฏุงุช ุฏุฑูู ุจุงฺฉุช ุฑุง ูุฑุถ ูโฺฉูุฏ (ฺฉู ุจู ุขู ุฏุฑููโุงุจ ุฎุท ูุฒ ฺฏูุชู ูโุดูุฏ). ุจุฑุง ุจุงฺฉุชโูุง ุบุฑ ุตูุฑู ูุณุชูฺฏุฑุงูโูุง ุจูู ุจุง ุงุณฺฉูุง ุจุงฺฉุชโุจูุฏ ููุง ุงุณุชุงูุฏุงุฑุฏุ ุฏุฑููโุงุจ ุจุง ุงู ูุฑุถ ุงูุฌุงู ูโุดูุฏ ฺฉู ูููููโูุง ุฏุฑูู ุจุงฺฉุช ุจู ฺฏูููโุง ุชูุฒุน ุดุฏูโุงูุฏ ฺฉู ุจุงฺฉุชโูุง ุฑุง ุฏุฑ ฺฉ ูุณุชูฺฏุฑุงู ูุฑุถ ุจุง ูุถูุญ ุจุงูุงุชุฑ ุจู ุทูุฑ ฺฉููุงุฎุช ูพุฑ ูโฺฉููุฏ. (ุงู ูุฒ ุฏุฑููโุงุจ ููุง ูุงูุฏู ูโุดูุฏ. ุจุฑุง ุฌุฒุฆุงุช ุจุดุชุฑ ุจู ูุดุฎุตุงุช ูุณุชูฺฏุฑุงู ุจูู ูุฑุงุฌุนู ฺฉูุฏ.)

==ุงฺฏุฑ `b` ุตูุฑ ูุดุงูุฏู ุฏุงุดุชู ุจุงุดุฏุ `NaN` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ. ุจุฑุง `ฯ < 0`ุ `-Inf` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ. ุจุฑุง `ฯ > 1`ุ `+Inf` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ. ุจุฑุง `ฯ = NaN`ุ `NaN` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.==

ููุงุฑุฏ ุฎุงุต ุจุฑุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉ:
*   ุงฺฏุฑ `b` ฺฉูุชุฑ ุงุฒ ุฏู ุจุงฺฉุช ุฏุงุดุชู ุจุงุดุฏุ `NaN` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.
*   ุจุงูุงุชุฑู ุจุงฺฉุช ุจุงุฏ ุฏุงุฑุง ฺฉุฑุงู ุจุงูุง `+Inf` ุจุงุดุฏ. (ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ `NaN` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.)
*   ุงฺฏุฑ ฺฉ ฺูุฏฺฉ ุฏุฑ ุจุงูุงุชุฑู ุจุงฺฉุช ูุฑุงุฑ ุฏุงุดุชู ุจุงุดุฏุ ฺฉุฑุงู ุจุงูุง ุฏููู ุจุงฺฉุชู ุจุงูุงุชุฑ ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.
*   ==ุญุฏ ูพุงู ูพุงูโุชุฑู ุจุงฺฉุชุ ุฏุฑ ุตูุฑุช ฺฉู ฺฉุฑุงู ุจุงูุง ุขู ุจุงฺฉุช ุจุฒุฑฺฏุชุฑ ุงุฒ ฐ ุจุงุดุฏุ ฐ ูุฑุถ ูโุดูุฏ. ุฏุฑ ุงู ุญุงูุชุ ุฏุฑููโุงุจ ุฎุท ูุนููู ุฏุฑูู ุขู ุจุงฺฉุช ุงุนูุงู ูโุดูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ฺฉุฑุงู ุจุงูุง ูพุงูโุชุฑู ุจุงฺฉุช ุจุฑุง ฺูุฏฺฉโูุง ฺฉู ุฏุฑ ูพุงูโุชุฑู ุจุงฺฉุช ูุฑุงุฑ ุฏุงุฑูุฏุ ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.==

ููุงุฑุฏ ุฎุงุต ุจุฑุง ูุณุชูฺฏุฑุงูโูุง ุจูู (ูุฑุจูุท ุจู ุฏุฑููโุงุจ ุฏูู ฺฉู ุฏุฑ ุจุงฺฉุช ุตูุฑ ุงุชูุงู ูโุงูุชุฏ):
*   ฺฉ ุจุงฺฉุช ุตูุฑ ุจุง ุนุฑุถ ูุญุฏูุฏุ ุฏุฑ ุตูุฑุช ฺฉู ูุณุชูฺฏุฑุงู ูุดุงูุฏุงุช ุฏุฑ ุจุงฺฉุชโูุง ูุซุจุช ุฏุงุดุชู ุจุงุดุฏ ุงูุง ูฺ ูุดุงูุฏูโุง ุฏุฑ ุจุงฺฉุชโูุง ููู ูุฏุงุดุชู ุจุงุดุฏุ ูุฑุถ ูโุดูุฏ ูฺ ูุดุงูุฏู ููู ูุฏุงุฑุฏ.
*   ฺฉ ุจุงฺฉุช ุตูุฑ ุจุง ุนุฑุถ ูุญุฏูุฏุ ุฏุฑ ุตูุฑุช ฺฉู ูุณุชูฺฏุฑุงู ูุดุงูุฏุงุช ุฏุฑ ุจุงฺฉุชโูุง ููู ุฏุงุดุชู ุจุงุดุฏ ุงูุง ูฺ ูุดุงูุฏูโุง ุฏุฑ ุจุงฺฉุชโูุง ูุซุจุช ูุฏุงุดุชู ุจุงุดุฏุ ูุฑุถ ูโุดูุฏ ูฺ ูุดุงูุฏู ูุซุจุช ูุฏุงุฑุฏ.

==ูโุชูุงูุฏ ุงุฒ `histogram_quantile(0, v instant-vector)` ุจุฑุง ุจุฏุณุช ุขูุฑุฏู ููุฏุงุฑ ุญุฏุงูู ุชุฎูู ุฐุฎุฑู ุดุฏู ุฏุฑ ฺฉ ูุณุชูฺฏุฑุงู ุงุณุชูุงุฏู ฺฉูุฏ.==

==ูโุชูุงูุฏ ุงุฒ `histogram_quantile(1, v instant-vector)` ุจุฑุง ุจุฏุณุช ุขูุฑุฏู ููุฏุงุฑ ุญุฏุงฺฉุซุฑ ุชุฎูู ุฐุฎุฑู ุดุฏู ุฏุฑ ฺฉ ูุณุชูฺฏุฑุงู ุงุณุชูุงุฏู ฺฉูุฏ.==

ุจุงฺฉุชโูุง ูุณุชูฺฏุฑุงูโูุง ฺฉูุงุณฺฉ ุชุฌูุน ูุณุชูุฏ. ุจูุงุจุฑุงูุ ููุงุฑุฏ ุฒุฑ ููุดู ุจุงุฏ ุตุงุฏู ุจุงุดูุฏ:
*   ุชุนุฏุงุฏ ุฏุฑ ุจุงฺฉุชโูุง ุจู ุทูุฑ ฺฉููุงุฎุช ุตุนูุฏ ุงุณุช (ุงฺฉุฏุงู ุบุฑ ูุฒูู).
*   ==ููุฏุงู ูุดุงูุฏุงุช ุจู ุญุฏูุฏ ุจุงูุง ุฏู ุจุงฺฉุช ูุชูุงู ููุฌุฑ ุจู ุชุนุฏุงุฏ ูุณุงู ุฏุฑ ุขู ุฏู ุจุงฺฉุช ูโุดูุฏ.==

ุจุง ุงู ุญุงูุ ูุณุงุฆู ูุฑุจูุท ุจู ุฏูุช ููุฒ ุดูุงูุฑ (ูุงููุฏ ุงุฎุชูุงูุงุช ุฌุฒุฆ ูุงุด ุงุฒ ูุญุงุณุจู ุจุงฺฉุชโูุง ุจุง `sum(rate(...))`) ุง ุฏุงุฏูโูุง ูุงูุนุชุจุฑ ููฺฉู ุงุณุช ุงู ูุฑุถุงุช ุฑุง ููุถ ฺฉููุฏ. ุฏุฑ ุงู ุญุงูุชุ `histogram_quantile` ูุงุฏุฑ ุจู ุจุงุฒฺฏุฑุฏุงูุฏู ูุชุงุฌ ูุนูโุฏุงุฑ ูุฎูุงูุฏ ุจูุฏ. ุจุฑุง ฺฉุงูุด ุงู ูุดฺฉูุ ==`histogram_quantile` ูุฑุถ ูโฺฉูุฏ ฺฉู ุชูุงูุชโูุง ูุณุจ ุจุณุงุฑ ฺฉูฺฺฉ ุจู ุจุงฺฉุชโูุง ูุชูุงู ุจู ุฏูู ุฎุทุงูุง ุฏูุช ููุฒ ุดูุงูุฑ ุฑุฎ ูโุฏููุฏ ู ุขููุง ุฑุง ูุงุฏุฏู ูโฺฏุฑุฏ. (ุขุณุชุงูู ูุงุฏุฏู ฺฏุฑูุชู ุชูุงูุช ุจู ุฏู ุจุงฺฉุชุ ฺฉ ุชุฑูููู (1e-12) ุงุฒ ูุฌููุน ูุฑ ุฏู ุจุงฺฉุช ุงุณุช.)== ุนูุงูู ุจุฑ ุงูุ ุงฺฏุฑ ุญุช ูพุณ ุงุฒ ุงู ุชูุธูุ ุชุนุฏุงุฏ ุจุงฺฉุชโูุง ุบุฑฺฉููุงุฎุช ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ุขููุง ุจู ููุฏุงุฑ ุจุงฺฉุชโูุง ูุจู ุงูุฒุงุด ูโุงุจูุฏ ุชุง ฺฉููุงุฎุช ุงุนูุงู ุดูุฏ. ููุฑุฏ ุฏูู ุดุงูุฏ ุจุฑ ูุฌูุฏ ูุดฺฉู ูุงูุน ุฏุฑ ุฏุงุฏูโูุง ูุฑูุฏ ุงุณุช ู ==ุจูุงุจุฑุงู ุจุง ฺฉ info-level ุจุง ูุชู `input to histogram_quantile needed to be fixed`== ูุดุฎุต ูโุดูุฏ. ุงฺฏุฑ ุจุง ุงู ุงุฏุฏุงุดุช ููุงุฌู ุดุฏุฏุ ุจุงุฏ ููุจุน ุฏุงุฏูโูุง ูุงูุนุชุจุฑ ุฑุง ูพุฏุง ู ุญุฐู ฺฉูุฏ.















### `histogram_stddev()` ู `histogram_stdvar()`
โ`histogram_stddev(v instant-vector)`: ุงูุญุฑุงู ูุนุงุฑ ุชุฎูู ูุดุงูุฏุงุช ุฑุง ุจุฑุง ูุฑ ููููู ูุณุชูฺฏุฑุงู ุฏุฑ `v` ุจุฑูโฺฏุฑุฏุงูุฏ. ุจุฑุง ุงู ุชุฎููุ ูุฑุถ ูโุดูุฏ ุชูุงู ูุดุงูุฏุงุช ุฏุฑ ฺฉ ุจุงฺฉุช ููุฏุงุฑ ูุงูฺฏู ูุฑุฒูุง ุจุงฺฉุช ุฑุง ุฏุงุฑูุฏ. ุจุฑุง ุจุงฺฉุช ุตูุฑ ู ุจุฑุง ุจุงฺฉุชโูุง ุจุง ูุฑุฒูุง ุณูุงุฑุดุ ุงุฒ ูุงูฺฏู ุญุณุงุจ ุงุณุชูุงุฏู ูโุดูุฏ. ุจุฑุง ุจุงฺฉุชโูุง ููุง ูุนูููุ ุงุฒ ูุงูฺฏู ููุฏุณ ุงุณุชูุงุฏู ูโุดูุฏ. ูููููโูุง float ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒฺฏุดุช ุธุงูุฑ ููโุดููุฏ.

ุจู ุทูุฑ ูุดุงุจูุ `histogram_stdvar(v instant-vector)` ูุงุฑุงูุณ ุชุฎูู ูุดุงูุฏุงุช ุฑุง ุจุฑุง ูุฑ ููููู ูุณุชูฺฏุฑุงู ุฏุฑ `v` ุจุฑูโฺฏุฑุฏุงูุฏ.

### `hour()` 
โ`hour(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุณุงุนุชู ุฑูุฒ (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฐ ุชุง ฒณ ูุณุชูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.




#### `idelta()`  
โ`idelta(v range-vector)`: ุชูุงูุช ุจู ุฏู ููููู ุขุฎุฑ ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง `v` ุฑุง ูุญุงุณุจู ฺฉุฑุฏู ู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุจุง ุฏูุชุงูุง ุฏุงุฏู ุดุฏู ู ูุจูโูุง ูุนุงุฏู ุจุฑูโฺฏุฑุฏุงูุฏ. ูุฑ ุฏู ููููู ุจุงุฏ ุง ููููู float ุจุงุดูุฏ ุง ููููู ูุณุชูฺฏุฑุงู. ุนูุงุตุฑ ุฏุฑ `v` ฺฉู ฺฉ ุงุฒ ุฏู ููููู ุขุฎุฑ ุขููุง ููููู float ู ุฏฺฏุฑ ููููู ูุณุชูฺฏุฑุงู ุจุงุดุฏุ ุงุฒ ูฺฉุชูุฑ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ warn-level ูุดุฎุต ูโุดููุฏ.

โ`idelta` ููุท ุจุงุฏ ุจุง ฺฏูุฌโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ.


## โ๏ธ ุชุนุฑู ุชุงุจุน

```promql
idelta(v range-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `idelta()` ุงุฎุชูุงู ููุฏุงุฑ **ุขุฎุฑู ููููู (latest sample)** ู **ุงููู ููููู (earliest sample)** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ูุดุฎุตโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.
ุจู ุฒุจุงู ุณุงุฏู:

> ุชุบุฑ ููุฏุงุฑ ูุชุฑฺฉ ุจู ุดุฑูุน ู ูพุงุงู ฺฉ ุจุงุฒูโ ุฒูุงู ฺฉูุชุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

---

## ๐ฌ ูุญูู ฺฉุงุฑ

ูุฑุถ ฺฉู ุจุงุฒูโ `[5m]` ุฑุง ุฑู ฺฉ ูุชุฑฺฉ ูุฑุงุฑ ุฏู:

```promql
idelta(metric_name[5m])
```

ุงฺฏุฑ ุฏุฑ ุงู ต ุฏููู ููุฏุงุฑ ูุชุฑฺฉ ุงุฒ `100` ุจู `130` ุชุบุฑ ฺฉูุฏุ ุฎุฑูุฌ ูโุดูุฏ:

```
130 - 120 = 10
```

---

## ๐งฎ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ุฏุงุฑู:

| ุฒูุงู  | ููุฏุงุฑ ูุชุฑฺฉ |
| ----- | ----------- |
| 10:00 | 100         |
| 10:01 | 110         |
| 10:02 | 120         |
| 10:03 | 130         |

ู ุนุจุงุฑุช ุฒุฑ ุฑุง ุงุฌุฑุง ูโฺฉู:

```promql
idelta(metric_name[3m])
```

๐ค ูุชุฌู:

```
130 - 120 = 10
```

---

## ๐ง ุชูุงูุช `idelta()` ุจุง `delta()` ู `rate()`

| ุชุงุจุน       | ููุน ุฏุงุฏู ูุฑูุฏ | ุฎุฑูุฌ                         | ฺฉุงุฑุจุฑุฏ                                   |
| ---------- | -------------- | ----------------------------- | ---------------------------------------- |
| `idelta()` | range vector   | ุงุฎุชูุงู ูุญุธูโุง (raw)          | ุจุฑุง ูุชุฑฺฉโูุง *Gauge* ุง ุชุบุฑ ูุญุธูโุง  |
| `delta()`  | range vector   | ุงุฎุชูุงู ูุฑูุงูโุดุฏู ุจุฑ ุงุณุงุณ ุฒูุงู | ุจุฑุง ูุชุฑฺฉโูุง *Gauge* ุฏุฑ ุจุงุฒู ุทููุงูโุชุฑ |
| `rate()`   | range vector   | ูุฑุฎ ุชุบุฑ ุฏุฑ ูุงุญุฏ "ุฏุฑ ุซุงูู"  | ุจุฑุง *Counter* (ุชุฌูุน)                   |
| `irate()`  | range vector   | ูุฑุฎ ูุญุธูโุง ุจู ุฏู ููููู ุขุฎุฑ  | ุจุฑุง *Counter* ุฏุฑ ุจุงุฒู ฺฉูุชุงู             |

---

## ๐งฉ ูพุณ ุนู:

* `idelta()` โ ุงุฎุชูุงู ูุงูุน ุจู ุงููู ู ุขุฎุฑู ููููู (ุจุฏูู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุฒูุงู)
* `delta()` โ ุงุฎุชูุงู ุชูุณู ุจุฑ ูุฏุช ุฒูุงู ุจุงุฒู
* `rate()` โ ูุฎุตูุต ูุชุฑฺฉโูุง *Counter*
* `irate()` โ ูุฑุฎ ุชุบุฑ ุจู ุฏู ููุทู ุขุฎุฑ (ููุฑโุชุฑ)

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ

ูุฑุถ ฺฉู ฺฉ ูุชุฑฺฉ ุฏุงุฑ ุจู ูุงู:

```
temperature_celsius
```

ู ูโุฎูุงู ุจุฏุงู ุฏูุง ุณุณุชู ุฏุฑ ต ุฏูููโ ฺฏุฐุดุชู ฺูุฏุฑ ุชุบุฑ ฺฉุฑุฏู (ูุซูุงู ุงูุฒุงุด ุง ฺฉุงูุด ุณุฑุน ุฏูุง):

```promql
idelta(temperature_celsius[5m])
```

๐ค ูุชุฌู:
ุงฺฏุฑ ุงุฒ 42.0 ุจู 44.5 ุฑุณุฏู ุจุงุดุฏ โ ุฎุฑูุฌ = 2.5ยฐC

---

## โ๏ธ ูฺฉุชู ููู

`idelta()` ุจุฑุง **Gauge**ูุง (ูุซู ุฏูุงุ ุญุงูุธูุ ุจุงุฑ ุณุณุชู) ููุงุณุจ ุงุณุชุ
ุงูุง ุจุฑุง **Counter**ูุง (ูุซู ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง) **ุบูุท ุง ฺฏูุฑุงูโฺฉููุฏู** ุงุณุช.

ฺูู Counter ููุท ุงูุฒุงุด ูโุงุจุฏ (ู ููฺฉู ุงุณุช reset ุดูุฏ)ุ
ู ุฏุฑ ุงู ุญุงูุช ุจุงุฏ ุงุฒ `irate()` ุง `rate()` ุงุณุชูุงุฏู ฺฉู.

---

## ๐ ุฌูุนโุจูุฏ ุณุฑุน

| ูฺฺฏ           | ุชูุถุญ                                  |
| --------------- | -------------------------------------- |
| ุชุงุจุน            | `idelta(v range-vector)`               |
| ูุฑูุฏ           | range vector (ูุซูุงู `[5m]`)            |
| ุฎุฑูุฌ           | ุงุฎุชูุงู ุจู ุขุฎุฑู ู ุงููู ููููู ุฏุฑ ุจุงุฒู |
| ููุงุณุจ ุจุฑุง      | ูุชุฑฺฉโูุง Gauge                        |
| ููุงุณุจ ูุณุช ุจุฑุง | ูุชุฑฺฉโูุง Counter                      |
| ูุดุงุจู           | `delta()` ูู ุจุฏูู ุชูุณู ุจุฑ ุฒูุงู       |

---

### โณ๏ธ ูุซุงู ููุง ุจุฑุง ููู ุจูุชุฑ:

| ุฒูุงู  | metric | ฮ   | idelta        | delta                      |
| ----- | ------ | --- | ------------- | -------------------------- |
| 10:00 | 100    |     |               |                            |
| 10:05 | 150    | +50 | `idelta = 50` | `delta = 50 / 300 = 0.166` |













### `increase() `   ++
โ`increase(v range-vector)`: ุงูุฒุงุด ุฏุฑ ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุฑุง ูุญุงุณุจู ูโฺฉูุฏ. ููููโูุง ุฏุฑ ฺฉููุงุฎุช (ูุงููุฏ ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง ุจู ุฏูู ุฑโุงุณุชุงุฑุช ุดุฏู ูุฏูโูุง) ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุธู ูโุดููุฏ. ุงูุฒุงุด ุจุฑุง ูพูุดุด ฺฉุงูู ุจุงุฒู ุฒูุงู ูุดุฎุต ุดุฏู ุฏุฑ ุงูุชุฎุงุจฺฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุจุฑููุงุจ ูโุดูุฏุ ุจูุงุจุฑุงู ุญุช ุงฺฏุฑ ฺฉ ุดูุงุฑูุฏู ููุท ุจุง ุงูุฒุงุดโูุง ุตุญุญ ุงูุฒุงุด ุงุจุฏุ ููฺฉู ุงุณุช ูุชุฌูโุง ุบุฑุตุญุญ ุจุฏุณุช ุขุฏ.

ูุซุงู ุฒุฑ ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง HTTP ุฑุง ฺฉู ุฏุฑ ต ุฏููู ฺฏุฐุดุชู ุงูุฏุงุฒูโฺฏุฑ ุดุฏูโุงูุฏุ ุจู ุงุฒุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```
increase(http_requests_total{job="api-server"}[5m])
```
โ`increase` ุจุฑ ุฑู ูููููโูุง ูุณุชูฺฏุฑุงู ุจุง ูุญุงุณุจู ฺฉ ูุณุชูฺฏุฑุงู ุฌุฏุฏ ุนูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุขู ูุฑ ุฌุฒุก (ูุฌููุน ู ุชุนุฏุงุฏ ูุดุงูุฏุงุชุ ุจุงฺฉุชโูุง) ุงูุฒุงุด ุจู ุฌุฒุก ูุฑุจูุทู ุฏุฑ ุงููู ู ุขุฎุฑู ูุณุชูฺฏุฑุงู ุจูู ุฏุฑ `v` ุงุณุช. ุจุง ุงู ุญุงูุ ูุฑ ุนูุตุฑ ุฏุฑ `v` ฺฉู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ุจุงุฒู ุฏุงุดุชู ุจุงุดุฏุ ุงุฒ ูฺฉุชูุฑ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ ุงุฏุฏุงุดุช ุณุทุญ ูุดุฏุงุฑ (warn-level) ูุดุฎุต ูโุดูุฏ.

โ`increase` ููุท ุจุงุฏ ุจุง ุดูุงุฑูุฏูโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ. ุงู ฺฉ syntactic sugar ุจุฑุง `rate(v)` ุถุฑุจุฏุฑ ุชุนุฏุงุฏ ุซุงููโูุง ุฏุฑ ูพูุฌุฑู ุฒูุงู ูุดุฎุต ุดุฏู ุงุณุช ู ุจุงุฏ ุฏุฑ ุฏุฑุฌู ุงูู ุจุฑุง ุฎูุงูุง ุงูุณุงู ุงุณุชูุงุฏู ุดูุฏ. ุงุฒ `rate` ุฏุฑ ููุงูู ุถุจุท (recording rules) ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ุงูุฒุงุดโูุง ุจู ุทูุฑ ูุฏุงูู ุจุฑ ุงุณุงุณ ุซุงูู ุฑุฏุงุจ ุดููุฏ.

## โ๏ธ ุชุนุฑู ุชุงุจุน

```promql
increase(v range-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `increase()` ูุฒุงู **ุงูุฒุงุด ุชุฌูุน (total increase)** ฺฉ ูุชุฑฺฉ ุงุฒ ููุน **Counter** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ูุดุฎุตโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.

ุนู:

> ุงุฒ ุขุฎุฑู ููุฏุงุฑ ูููุง ุงููู ููุฏุงุฑ (ุจุง ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูุฑุฎ ูููููโุจุฑุฏุงุฑ ู reset ุงุญุชูุงู Counter).

---

## ๐งฉ ุฏุฑฺฉ ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฑู ุฏุงุฑ:

```
http_requests_total
```

ู ููุฏุงุฑูุงุด ุฏุฑ ุจุงุฒู ต ุฏูููโุง ุงูุทูุฑ ุจูุฏู:

| ุฒูุงู  | ููุฏุงุฑ |
| ----- | ----- |
| 10:00 | 100   |
| 10:01 | 150   |
| 10:02 | 220   |
| 10:03 | 260   |

ุงฺฏุฑ ุจููุณ:

```promql
increase(http_requests_total[5m])
```

๐ค ูุชุฌู = `100 - 260 = 160`

ุนู ุฏุฑ ต ุฏููู ฺฏุฐุดุชูุ **ฑถฐ ุฏุฑุฎูุงุณุช ุฌุฏุฏ** ุงูุฌุงู ุดุฏู.

---

## โ๏ธ ูฺฉุชู ููู: ูุฎุตูุต Counter ุงุณุช

ุงู `increase()` ููุท ุจุฑุง **Counter**ูุง ุทุฑุงุญ ุดุฏู (ูุชุฑฺฉโูุง ฺฉู ููุท ุฒุงุฏ ูโุดู).
ุจุฑุง ูุซุงู:

โ ุฏุฑุณุช ุจุฑุง:

* `http_requests_total`
* `packets_sent_total`
* `errors_total`

โ ุงุดุชุจุงู ุจุฑุง:

* `temperature_celsius`
* `cpu_usage`
* `memory_free`

ฺูู ุงููุง Gauge ูุณุชู (ฺฉู ู ุฒุงุฏ ูโุดู).

---

## ๐ง ูุญูู ูุญุงุณุจู ุฏูู

`increase()` ุฏุฑ ูุงูุน ุงุฒ `rate()` ุงุณุชูุงุฏู ูโฺฉูู:

```promql
increase(X[5m]) โ rate(X[5m]) * 300
```

(ุนุฏุฏ 300 ุนู ต ุฏููู = ณฐฐ ุซุงูู)

๐น ุชูุงูุช: `increase()` ููุฏุงุฑ ฺฉู ุงูุฒุงุด ุฏุฑ ุจุงุฒู ุฑุง ูโุฏูุฏ
๐น ุงูุง `rate()` ูุฑุฎ ุงูุฒุงุด ุฏุฑ ุซุงูู ุฑุง.

---

### ูุซุงู ุนุฏุฏ ุจุฑุง ููุงุณู

| ุชุงุจุน                                | ุฎุฑูุฌ   | ูุนู                                |
| ----------------------------------- | ------- | ----------------------------------- |
| `increase(http_requests_total[5m])` | `160`   | ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู ุงุฎุฑ |
| `rate(http_requests_total[5m])`     | `0.533` | ุฏุฑุฎูุงุณุช ุฏุฑ ุซุงูู (โ160 รท 300s)      |

---

## ๐งฎ ุญุงูุช Reset (ุจุงุฒูุดุงู Counter)

ุงฺฏุฑ ููุฏุงุฑ Counter ุฑุณุช ุดูุฏ (ูุซูุงู ุณุฑูุฑ ุฑโุงุณุชุงุฑุช ุดูุฏ)ุ
โPrometheus ุงู ุฑุง ุชุดุฎุต ูโุฏูุฏ ู ูุญุงุณุจู ุฑุง ุงุตูุงุญ ูโฺฉูุฏ.

ูุซูุงู:

| ุฒูุงู  | ููุฏุงุฑ Counter |
| ----- | ------------- |
| 10:00 | 100           |
| 10:02 | 200           |
| 10:03 | 10 โ reset    |
| 10:04 | 60            |

ุฏุฑ ุงู ุญุงูุช:

```promql
increase(metric[5m])
```

ูุชุฌู = `(100 - 200) + (10 - 60) = 150`

ูพุณ Prometheus ุฎูุฏุด ุชุดุฎุต ูโุฏูุฏ ฺฉู ุจู 200 ู 10 ุฑุณุช ุงุชูุงู ุงูุชุงุฏู.

---

## ๐งฉ ูุซุงู ูุงูุน

ุงฺฏุฑ ุจุฎูุงู ุจุฏุงู ุฏุฑ ฑ ุณุงุนุช ฺฏุฐุดุชู ฺูุฏ ุฏุฑุฎูุงุณุช ูููู HTTP (`code="200"`) ุฏุงุดุชู:

```promql
increase(http_requests_total{code="200"}[1h])
```

๐ค ูุชุฌู: ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง ูููู ุฏุฑ ฑ ุณุงุนุช ุงุฎุฑ

---

## ๐ ูุซุงู ุชุฑฺฉุจ ุจุง `sum()`

ุงฺฏุฑ ฺูุฏ ุณุฑูุฑ ุง ูพุงุฏ ุฏุงุฑ ู ูโุฎูุงู ูุฌููุน ฺฉู ุงูุฒุงุด ุฑู ุญุณุงุจ ฺฉู:

```promql
sum(increase(http_requests_total[5m])) by (job)
```

๐ค ูุชุฌู: ูุฌููุน ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู ฺฏุฐุดุชู ุจุฑุง ูุฑ job

---

## โ ุฎูุงุตู

| ูฺฺฏ             | ุชูุถุญ                             |
| ----------------- | --------------------------------- |
| ุชุงุจุน              | `increase(v range-vector)`        |
| ูุฑูุฏ             | ูุชุฑฺฉ ุงุฒ ููุน Counter              |
| ุฎุฑูุฌ             | ููุฏุงุฑ ุงูุฒุงุด ุฏุฑ ุจุงุฒูโ ุฒูุงู      |
| ฺฉุงุฑุจุฑุฏ            | ุดูุงุฑุด ุฑุฎุฏุงุฏูุง ุฏุฑ ฺฉ ุจุงุฒู          |
| ุฑูุชุงุฑ ุจุง reset    | ุฎูุฏุด ุงุตูุงุญ ูโฺฉูุฏ                 |
| ุฑุงุจุทู ุจุง `rate()` | `increase() = rate() * ุฒูุงู_ุจุงุฒู` |

---

### ๐งพ ูุซุงู ููุง ุจุฑุง ุงุฏฺฏุฑ ุณุฑุน

| ูุชุฑฺฉ               | ุฒูุงู  | ููุฏุงุฑ | increase                  |
| ------------------- | ----- | ----- | ------------------------- |
| http_requests_total | 10:00 | 100   |                           |
| http_requests_total | 10:05 | 250   | `increase(...[5m]) = 150` |




















### `info()`  ++
ุชุงุจุน `info` ฺฉ ุขุฒูุงุด ุจุฑุง ุจูุจูุฏ ุชุฌุฑุจู ฺฉุงุฑุจุฑ (UX) ุฏุฑ ููุฑุฏ ฺฏูุฌุงูุฏู ูุจูโูุง ุงุฒ ูุชุฑฺฉโูุง `info` ุงุณุช. ุฑูุชุงุฑ ุงู ุชุงุจุน ููฺฉู ุงุณุช ุฏุฑ ูุณุฎูโูุง ุขูุฏู Prometheus ุชุบุฑ ฺฉูุฏุ ุงุฒ ุฌููู ุญุฐู ุขู ุงุฒ PromQL. ุชุงุจุน `info` ุจุงุฏ ุงุฒ ุทุฑู ููฺฏ ูฺฺฏ `--enable-feature=promql-experimental-functions` ูุนุงู ุดูุฏ.

โ`info(v instant-vector, [data-label-selector instant-vector])`: ุจุฑุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ `v`ุ ุชูุงู ุณุฑโูุง `info` ุจุง ูุจูโูุง ุดูุงุณุง ููุทุจู ุฑุง ูพุฏุง ูโฺฉูุฏ (ุฏุฑ ุงุฏุงูู ุจุดุชุฑ ุฏุฑ ุงู ููุฑุฏ ุชูุถุญ ุฏุงุฏู ุฎูุงูุฏ ุดุฏ)ุ ู ุงุฌุชูุงุน ูุจูโูุง ุฏุงุฏูโุง (ุนู ุบุฑ ุดูุงุณุง) ุขููุง ุฑุง ุจู ุณุฑ ุฒูุงู ุงุถุงูู ูโฺฉูุฏ. ุขุฑฺฏููุงู ุฏูู `data-label-selector` ุงุฎุชุงุฑ ุงุณุช. ุงู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ูุงูุน ูุณุชุ ุงูุง ุงุฒ ุฒุฑูุฌููุนูโุง ุงุฒ ูุญู ุขู ุงุณุชูุงุฏู ูโฺฉูุฏ. ุจุงุฏ ุจุง ุขฺฉููุงุฏ ุดุฑูุน ู ุชูุงู ุดูุฏ (`{ ... }`) ู ููุท ูโุชูุงูุฏ ุดุงูู ุชุทุจูโุฏููุฏูโูุง ูุจู ุจุงุดุฏ. ุชุทุจูโุฏููุฏูโูุง ูุจู ุจุฑุง ูุญุฏูุฏ ฺฉุฑุฏู ุงูฺฉู ฺฉุฏุงู ุณุฑโูุง `info` ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดููุฏ ู ฺฉุฏุงู ูุจูโูุง ุฏุงุฏู ุจู `v` ุงุถุงูู ุดููุฏุ ุงุณุชูุงุฏู ูโุดููุฏ.

ูุจูโูุง ุดูุงุณุง (identifying labels) ฺฉ ุณุฑ `info` ุฒุฑูุฌููุนูโุง ุงุฒ ูุจูโูุง ูุณุชูุฏ ฺฉู ุจู ุทูุฑ ููุญุตุฑุจูโูุฑุฏ ุณุฑ `info` ุฑุง ูุดุฎุต ูโฺฉููุฏ. ูุจูโูุง ุจุงููุงูุฏู ูุจูโูุง ุฏุงุฏู (data labels) (ููฺูู ุบุฑ ุดูุงุณุง ูุงูุฏู ูโุดููุฏ) ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ. (ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ููููู ููุช ุณุฑ ุฒูุงู ุฏุฑ Prometheus ููุดู ุดุงูู ุชูุงู ูุจูโูุง ูโุดูุฏ. ุจู ุฎุงุทุฑ ุชุงุจุน `info`ุ ูุง ููุช ุณุฑ `info` ุฑุง ยซููุทูุงูยป ุจู ุฑูุด ูุชูุงูุช ุงุฒ ุฏุฏฺฏุงู ูุฑุณูู Prometheus ุชุนุฑู ูโฺฉูู.) ูุจูโูุง ุดูุงุณุง ฺฉ ุณุฑ `info` ุจุฑุง ูพูุณุชู (join) ุขู ุจู ุณุฑโูุง ูุนููู (ุบุฑ `info`) ุงุณุชูุงุฏู ูโุดููุฏุ ุนู ุขู ุณุฑโูุง ฺฉู ูุจูโูุง ูุดุงุจู ูุจูโูุง ุดูุงุณุง ุณุฑ `info` ุฑุง ุฏุงุฑูุฏ. ูุจูโูุง ุฏุงุฏูุ ฺฉู ุขููุง ูุณุชูุฏ ฺฉู ุชูุณุท ุชุงุจุน `info` ุจู ุณุฑโูุง ูุนููู ุงุถุงูู ูโุดููุฏุ ุจู ุทูุฑ ููุซุฑ ุฌูุชโูุง ฺฉูุฏ-ููุฏุงุฑ ูุฑุงุฏุงุฏู (metadata) ุฑุง ุฑูุฒฺฏุฐุงุฑ ูโฺฉููุฏ. (ุงู ุจุฏุงู ูุนูุงุณุช ฺฉู ุชุบุฑ ุฏุฑ ูุจูโูุง ุฏุงุฏู ุฏุฑ ุฏุฏฺฏุงู ูุฑุณูู Prometheus ุจู ูุนูุง ูพุงุงู ฺฉ ุณุฑ `info` ู ุขุบุงุฒ ฺฉ ุณุฑ `info` ุฌุฏุฏ ุงุณุชุ ุฏุฑ ุญุงู ฺฉู ุฏุฏฺฏุงู ยซููุทูยป ุชุงุจุน `info` ุงู ุงุณุช ฺฉู ููุงู ุณุฑ `info` ุจู ูุฌูุฏ ุฎูุฏ ุงุฏุงูู ูโุฏูุฏุ ููุท ุจุง ยซุฏุงุฏูโูุงยป ูุชูุงูุช.)

ุฑูฺฉุฑุฏ ูุฑุณูู ุงูุฒูุฏู ูุจูโูุง ุฏุงุฏู ฺฏุงู ุงููุงุช ยซฺฉูุฆุฑ ูพููุฏยป (join query) ูุงูุฏู ูโุดูุฏุ ููุงูุทูุฑ ฺฉู ุฏุฑ ูุซุงู ุฒุฑ ูุดุงู ุฏุงุฏู ุดุฏู ุงุณุช:
```
  rate(http_server_request_duration_seconds_count[2m])
* on (job, instance) group_left (k8s_cluster_name)
  target_info
```
ูุณุชู ฺฉูุฆุฑ ุนุจุงุฑุช `rate(http_server_request_duration_seconds_count[2m])` ุงุณุช. ุงูุง ุจุฑุง ุงูุฒูุฏู ูุจูโูุง ุฏุงุฏู ุงุฒ ฺฉ ูุชุฑฺฉ `info`ุ ฺฉุงุฑุจุฑ ุจุงุฏ ุงุฒ ูุญู ูพฺุฏู (ู ูู ฺูุฏุงู ูุงุถุญ) ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ุงูฺฉู ุงุฒ ฺฉุฏุงู ูุชุฑฺฉ `info` ุงุณุชูุงุฏู ฺฉูุฏ (`target_info`)ุ ูุจูโูุง ุดูุงุณุง ฺู ูุณุชูุฏ (`on (job, instance)`)ุ ู ฺฉุฏุงู ูุจูโูุง ุฏุงุฏู ุงุถุงูู ุดููุฏ (`group_left (k8s_cluster_name)`) ุงุณุชูุงุฏู ฺฉูุฏ.

---

## ๐ ฺฉู ฺฉูุฆุฑ

```promql
rate(http_server_request_duration_seconds_count[2m])
* on (job, instance) group_left (k8s_cluster_name)
target_info
```

---

## ๐งฉ ูุฑุญูู ฑ: ุจุฎุด `rate(http_server_request_duration_seconds_count[2m])`

### ๐ ููููู

ุชุงุจุน `rate()` ูุฑุฎ ุงูุฒุงุด ฺฉ **counter** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ุฏุงุฏูโุดุฏู ุญุณุงุจ ูโฺฉูุฏ.

ุฏุฑ ุงูุฌุง:

* `http_server_request_duration_seconds_count` โ ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง HTTP (Counter)
* `[2m]` โ ุฏุฑ ุจุงุฒูโ ุฏู ุฏูููโ ุงุฎุฑ
* `rate(...)` โ ูุงูฺฏู ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุซุงููุ ุท ุงู ุฏู ุฏููู

๐ค ุฎุฑูุฌ:
ฺฉ **instant vector** ฺฉู ฺุฒ ุดุจู ุฒุฑ ุงุณุช:

| job | instance      | value (req/s) |
| --- | ------------- | ------------- |
| web | 10.0.0.1:8080 | 0.5           |
| web | 10.0.0.2:8080 | 0.8           |

---

## ๐งฉ ูุฑุญูู ฒ: `target_info`

ูุชุฑฺฉ `target_info` ฺฉ ุงุฒ **ูุชุฑฺฉโูุง ุฎูุฏ Prometheus** ุงุณุช ฺฉู ุงุทูุงุนุงุช ุฌุงูุจ (metadata) ุฏุฑุจุงุฑูโ ูุฑ target ุฏุงุฑุฏ.

ูุซูุงู:

| job | instance      | k8s_cluster_name | value |
| --- | ------------- | ---------------- | ----- |
| web | 10.0.0.1:8080 | cluster-a        | 1     |
| web | 10.0.0.2:8080 | cluster-b        | 1     |

๐ข ููุฏุงุฑุด ููุดู `1` ุงุณุช (ุจู ฺฉูฺฉ `info()` ุณุงุฎุชู ูโุดูุฏ).
ูุฏูุด ููุท ุงุถุงูู ฺฉุฑุฏู ุงุทูุงุนุงุช label ุงุณุช โ ูู ุนุฏุฏ ูุงูุน.

---

## ๐งฉ ูุฑุญูู ณ: ุนููฺฏุฑ `* on (job, instance) group_left (k8s_cluster_name)`

ุงู ุจุฎุด ุฎู ูููู ๐

### ๐น `on (job, instance)`

ูโฺฏูุฏ join ุฑุง **ููุท ุจุฑ ุงุณุงุณ ุจุฑฺุณุจโูุง `job` ู `instance`** ุงูุฌุงู ุจุฏู.
ุนู ุฑุฏูโูุง ฺฉู ุงู ุฏู ุจุฑฺุณุจ ุจุฑุงุจุฑ ุฏุงุฑูุฏุ ุจุง ูู match ูโุดููุฏ.

### ๐น `group_left (k8s_cluster_name)`

ฺูู `target_info` ููฺฉู ุงุณุช **labelูุง ุงุถุงู (ูุซู `k8s_cluster_name`)** ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุชุฑฺฉ ุงูู ูุฏุงุฑุฏุ
ูุง ุงุฒ `group_left()` ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุจุชูุงูู ุขู label ุฑุง ุจู ูุชุฑฺฉ ุงุตู **ุงุถุงูู ฺฉูู**.

๐ธ ุฎูุงุตู:
ูโุฎูุงูู ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง (`rate`) ุฑุง ุจฺฏุฑู ู ุงุฒ ูุชุฑฺฉ `target_info`ุ ูุงู ฺฉูุงุณุชุฑ ุฑุง ุจูุด ุงุถุงูู ฺฉูู.

---

## ๐ง ูุฑุญูู ด: ุถุฑุจ (`*`)

ุฏุฑ PromQLุ ููุช ุฏู ูุชุฑฺฉ ุฑุง ุจุง `*` ุถุฑุจ ูโฺฉูุ ุงฺฏุฑ labelูุงุดุงู match ุดููุฏุ
ููุงุฏุฑุดุงู ุฏุฑ ูู ุถุฑุจ ูโุดูุฏ.

ูู ฺูู ููุฏุงุฑ `target_info` ููุดู `1` ุงุณุชุ ุญุงุตู ุถุฑุจ **ุชุบุฑ ุฏุฑ ููุฏุงุฑ ููโุฏูุฏ** โ
ุงูุง ุจุงุนุซ ูโุดูุฏ labelูุง ุงุถุงู (`k8s_cluster_name`) ุจู ุฎุฑูุฌ ุงุถุงูู ุดููุฏ โ

---

## ๐ค ูุชุฌู ููุง

| job | instance      | k8s_cluster_name | value (req/s) |
| --- | ------------- | ---------------- | ------------- |
| web | 10.0.0.1:8080 | cluster-a        | 0.5           |
| web | 10.0.0.2:8080 | cluster-b        | 0.8           |

---

## ๐งพ ุฎูุงุตู ููุง

| ุจุฎุด                                                    | ุชูุถุญ                                                   |
| ------------------------------------------------------ | ------------------------------------------------------- |
| `rate(http_server_request_duration_seconds_count[2m])` | ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง HTTP ุฏุฑ ฒ ุฏููู ุงุฎุฑ                    |
| `target_info`                                          | ูุชุฑฺฉ ุงุทูุงุนุงุช ุจุง labelูุง ุงุถุงู ูุซู `k8s_cluster_name` |
| `on (job, instance)`                                   | join ุจุฑ ุงุณุงุณ ุงู ุฏู label                               |
| `group_left (k8s_cluster_name)`                        | ุงุถุงููโฺฉุฑุฏู label ุฌุฏุฏ ุงุฒ ุณูุช ุฑุงุณุช                       |
| ุถุฑุจ `*`                                                | ููุฏุงุฑ ุญูุธ ูโุดูุฏ ูู label ุฌุฏุฏ ุงุถุงูู ูโฺฏุฑุฏุฏ           |

---

## ๐ก ฺฉุงุฑุจุฑุฏ ูุงูุน

ุงู ุงูฺฏู ุจุณุงุฑ ุฑุงุฌ ุงุณุช ุฏุฑ ูุญุทโูุง **Kubernetes**:

ููุช Prometheus ุฏุงุฏูโูุง ุฑุง ุงุฒ exporterูุง ุฌูุน ูโฺฉูุฏุ
ูโุฎูุงู ุจู ูุฑ ูุชุฑฺฉ ุงุทูุงุนุงุช ูุซู:

* ูุงู ฺฉูุงุณุชุฑ (`k8s_cluster_name`)
* namespace
* region


----


ุงู ฺฉูุฆุฑ ูู ุชููุง ูพุฑูุทูุจ ู ููุดุชู ุขู ุฏุดูุงุฑ ุงุณุชุ ุจูฺฉู ููฺฉู ุงุณุช ุจุง ยซุจุญุฑุงู ููุชยป ูุฒ ููุงุฌู ุดูุฏ: ุงฺฏุฑ ูุฑ ฺฉ ุงุฒ ูุจูโูุง ุฏุงุฏู `target_info` ุชุบุฑ ฺฉูุฏุ Prometheus ุขู ุฑุง ุจู ุนููุงู ุชุบุฑ ุณุฑ ูโุจูุฏ (ููุงูุทูุฑ ฺฉู ุฏุฑ ุจุงูุง ุงุดุงุฑู ุดุฏุ Prometheus ูฺ ููููู ุจูู ุงุฒ ูุจูโูุง ุบุฑ ุดูุงุณุง ูุฏุงุฑุฏ). ุงฺฏุฑ ุณุฑ `target_info` ูุฏู ุจู ุฏุฑุณุช ุจู ุนููุงู ููุณูุฎ (stale) ุนูุงูุชโฺฏุฐุงุฑ ูุดูุฏ (ฺฉู ูโุชูุงูุฏ ุจุง ุจุฑุฎ ูุณุฑูุง ุฏุฑุงูุช ุฏุงุฏู ุงุชูุงู ุจูุชุฏ)ุ ฺฉูุฆุฑ ุจุงูุง ุชุง ต ุฏููู (ุฏูุชุง ุจุงุฒุจู ุง lookback delta) ุจุง ุดฺฉุณุช ููุงุฌู ุฎูุงูุฏ ุดุฏ ุฒุฑุง ุจุง ูุฑ ุฏู ูุณุฎู ูุฏู ู ุฌุฏุฏ `target_info` ฺฉ ุชุทุงุจู ูุชูุงูุถ ูพุฏุง ูโฺฉูุฏ.

ุชุงุจุน `info` ูู ุชููุง ุงู ุชุถุงุฏ ุฑุง ุจู ููุน ุณุฑ ุฌุฏุฏุชุฑ ุญู ูโฺฉูุฏุ ุจูฺฉู ูุญู ุฑุง ูุฒ ุณุงุฏู ูโฺฉูุฏ ุฒุฑุง ุงุฒ ุณุฑโูุง `info` ููุฌูุฏ ู ุงูฺฉู ูุจูโูุง ุดูุงุณุง ุขููุง ฺุณุชุ ุงุทูุงุน ุฏุงุฑุฏ. ฺฉูุฆุฑ ูุซุงู ุจุง ุชุงุจุน `info` ุจู ุงู ุตูุฑุช ุงุณุช:
```
info(
  rate(http_server_request_duration_seconds_count[2m]),
  {k8s_cluster_name=~".+"}
)
```
ุญุงูุช ุฑุงุฌ ุงูุฒูุฏู ุชูุงู ูุจูโูุง ุฏุงุฏู ุฑุง ูโุชูุงู ุจุง ุญุฐู ฺฉุงูู ุขุฑฺฏููุงู ุฏูู ุชุงุจุน `info` ุจู ุฏุณุช ุขูุฑุฏุ ฺฉู ูุซุงู ุฑุง ุญุช ุณุงุฏูโุชุฑ ูโฺฉูุฏ:
```
info(rate(http_server_request_duration_seconds_count[2m]))
```
ุฏุฑ ุญุงู ฺฉู `info` ูุนูููุงู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุงู ุณุฑโูุง `info` ููุทุจู ุฑุง ูพุฏุง ูโฺฉูุฏุ ูโุชูุงู ุขููุง ุฑุง ุจุง ุงุฑุงุฆู ฺฉ ุชุทุจูโุฏููุฏู ูุจู `__name__` ูุญุฏูุฏ ฺฉุฑุฏุ ุจู ุนููุงู ูุซุงู `{__name__="target_info"}`.

#### ูุญุฏูุฏุชโูุง
ุฏุฑ ุชฺฉุฑุงุฑ ูุนูุ `info` ุจู ุทูุฑ ูพุดโูุฑุถ ููุท ุณุฑโูุง `info` ุจุง ูุงู `target_info` ุฑุง ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ. ููฺูู ูุฑุถ ูโฺฉูุฏ ฺฉู ูุจูโูุง ุดูุงุณุง ุณุฑ `info`ุ `instance` ู `job` ูุณุชูุฏ. ุจุง ุงู ุญุงูุ `info` ุงุฒ ูุงูโูุง ุฏฺฏุฑ ุณุฑ `info` ุงุฒ ุทุฑู ุชุทุจูโุฏููุฏูโูุง ูุจู `__name__` ูพุดุชุจุงู ูโฺฉูุฏ. ุจู ุนููุงู ูุซุงูุ ูโุชูุงู ุจู ุตุฑุงุญุช ฺฏูุช ฺฉู ูู `target_info` ู ูู `build_info` ุฑุง ุจู ุตูุฑุช ุฒุฑ ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ: `{__name__=~"(target|build)_info"}`. ุจุง ุงู ุญุงูุ ูุจูโูุง ุดูุงุณุง ููุดู ุจุงุฏ `instance` ู `job` ุจุงุดูุฏ.

ุงู ูุญุฏูุฏุชโูุง ุชุง ุญุฏ ูุฏู ุชุงุจุน `info` ุฑุง ุชุถุนู ูโฺฉููุฏ. ุฏุฑ ูุฑุญูู ูุนูุ ุงู ฺฉ ุขุฒูุงุด ุจุฑุง ูพ ุจุฑุฏู ุจู ูุฒุงู ููุฏ ุจูุฏู ุงู ุฑูฺฉุฑุฏ ุฏุฑ ุนูู ุงุณุช. ูุณุฎู ููุง ุชุงุจุน `info` ุฏุฑ ูุงูุน ุชูุงู ุณุฑโูุง `info` ููุทุจู ุฑุง ุจุง ูุจูโูุง ุดูุงุณุง ููุงุณุจ ุขููุง ุฏุฑ ูุธุฑ ุฎูุงูุฏ ฺฏุฑูุช.





## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
info(v instant-vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `info()` ุจุฑุง **ุชููุฏ ฺฉ ูุณุฎูโ "informational" (ุงุทูุงุนุงุช)** ุงุฒ ฺฉ ูุชุฑฺฉ ุงุณุชูุงุฏู ูโุดูุฏ.
ุจู ุนุจุงุฑุช ุณุงุฏู:

> `info()` ูููโ ุจุฑฺุณุจโูุง (labels) ู ููุงุฏุฑ ูููููโูุง ุฑุง ุญูุธ ูโฺฉูุฏุ
> ูู ููุฏุงุฑ ุนุฏุฏ ูููโ ุขูโูุง ุฑุง ุจู `1` ุชุบุฑ ูโุฏูุฏ.

---

## ๐ ุนู ฺุ

ูุฑุถ ฺฉู ุฏุงุฑ:

```promql
up
```

๐ค ุฎุฑูุฌ:

| instance     | job  | value |
| ------------ | ---- | ----- |
| server1:9100 | node | 1     |
| server2:9100 | node | 0     |

ุงฺฏุฑ ุจููุณ:

```promql
info(up)
```

๐ค ุฎุฑูุฌ:

| instance     | job  | value |
| ------------ | ---- | ----- |
| server1:9100 | node | 1     |
| server2:9100 | node | 1     |

ุนู ูููโ ููุงุฏุฑ `1` ุดุฏู (ุตุฑูโูุธุฑ ุงุฒ ููุฏุงุฑ ุงุตู).

---

## ๐ง ูุฏู ูุงูุน ุงุณุชูุงุฏู ุงุฒ `info()`

ุชุงุจุน `info()` ุฏุฑ Prometheus 2.40 ุจู ุจุนุฏ ูุนุฑู ุดุฏ ุชุง ฺฉูฺฉ ฺฉูู:

* ุฏุงุฏูโูุง **ุงุทูุงุนุงุช / ูุชุงุฏุชุง** ุฑุง ุงุฒ ูุชุฑฺฉโูุง ุงุณุชุฎุฑุงุฌ ฺฉูุ
* ุง ุงุฒ **metricูุง gauge ุง counter** ููุท ุจุฑุง ูฺฏูโุฏุงุดุชู *labelูุง* ุงุณุชูุงุฏู ฺฉูุ ูู ููุฏุงุฑุดุงู.

---

## ๐ ฺฉุงุฑุจุฑุฏูุง ูุงูุน

### โ ฑ. ุดูุงุฑุด ุชุนุฏุงุฏ ุณุฑ ุฏุงุฏูโูุง

ูโุฎูุงู ุจุฏูู ฺูุฏ ุณุฑ ุฏุงุฏู ุจุฑุง ฺฉ ูุชุฑฺฉ ูุฌูุฏ ุฏุงุฑุฏ:

```promql
count(info(http_requests_total))
```

๐ค ูุซูุงู:

```
20
```

(ุนู ฒฐ ุณุฑ ูุฎุชูู ุงุฒ `http_requests_total` ููุฌูุฏ ุงุณุช.)

---

### โ ฒ. ุจุฑุฑุณ ูุณุช labelูุง ููุฌูุฏ

ุงฺฏุฑ ุจููุณ:

```promql
info(node_exporter_build_info)
```

ุฎุฑูุฌ ฺุฒ ูุซู ุงู ูโุดูุฏ:

| version | instance     | job  | value |
| ------- | ------------ | ---- | ----- |
| 1.7.0   | server1:9100 | node | 1     |
| 1.8.0   | server2:9100 | node | 1     |

๐น ุงูุฌุง ุงุฒ `node_exporter_build_info` ููุท ุงุทูุงุนุงุช ูุณุฎู ู ุจุฑฺุณุจโูุง ูฺฏู ุฏุงุดุชู ุดุฏู.

---

### โ ณ. ููุชุฑ ุฏุงุฏูโูุง ุจุฏูู ุฏุฑฺฏุฑ ุดุฏู ุจุง ููุฏุงุฑ

ฺฏุงู ูุชุฑฺฉโูุง ุฏุงุฑ ฺฉู ููุท label ููู ุงุณุชุ ูู ููุฏุงุฑ.
ูุซูุงู ูโุฎูุงู ููุฑุณุช ุชูุงู containerูุง ููุฌูุฏ ุฑุง ุจุจูุ ูุงุฑุบ ุงุฒ state:

```promql
info(container_last_seen)
```

---

## โ๏ธ ูฺฉุชู ูู

* ุชุงุจุน `info()` ููุฏุงุฑ ุนุฏุฏ ูุฑ sample ุฑุง ุจู 1 ุชุบุฑ ูโุฏูุฏ.
* ุชูุงู labelูุง ู timestampูุง ุฑุง ุญูุธ ูโฺฉูุฏ.
* ุงู ุชุงุจุน ููุท ุฑู **instant vector** ฺฉุงุฑ ูโฺฉูุฏ (ูู range vector).
* ููุฏุงุฑ ุฎุฑูุฌ ุจุฑุง **aggregation** ุง **counting** ููุงุณุจ ุงุณุชุ ูู ูุญุงุณุจุงุช ุฑุงุถ.

---

## ๐งพ ุฎูุงุตู ููุง

| ูฺฺฏ            | ุชูุถุญ                                           |
| ---------------- | ----------------------------------------------- |
| ุชุงุจุน             | `info(v instant-vector)`                        |
| ูุฑูุฏ            | ูุฑ ูุชุฑฺฉ ูุญุธูโุง                                |
| ุฎุฑูุฌ            | ููุงู ูุชุฑฺฉ ุจุง ููุฏุงุฑ ฑ ุจุฑุง ูููโ ูููููโูุง       |
| ูุฏู              | ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุชุ ุดูุงุฑุด ุง ููุฑุณุช labelูุง         |
| ููุงุณุจ ุจุฑุง       | metadata metrics ูุซู `*_info` ุง `*_build_info` |
| ูพุดุชุจุงู ุงุฒ ูุณุฎู | Prometheus 2.40+                                |

---

## ๐ก ูุซุงู ุชุฑฺฉุจ

```promql
count by (version) (info(node_exporter_build_info))
```

๐ค ูุชุฌู:

| version | count |
| ------- | ----- |
| 1.7.0   | 3     |
| 1.8.0   | 5     |

> ุนู ณ ููุฏ ุจุง ูุณุฎูโ 1.7.0 ู ต ููุฏ ุจุง ูุณุฎูโ 1.8.0 ฺฉุงุฑ ูโฺฉููุฏ.











### `irate()`
โ`irate(v range-vector)`: ูุฑุฎ ูุญุธูโุง ุงูุฒุงุด ุจุฑ ุญุณุจ ุซุงูู ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุฑุง ูุญุงุณุจู ูโฺฉูุฏ. ุงู ุจุฑ ุงุณุงุณ ุฏู ููุทู ุฏุงุฏู ุขุฎุฑ ุงุณุช. ููููโูุง ุฏุฑ ฺฉููุงุฎุช (ูุงููุฏ ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง ุจู ุฏูู ุฑโุงุณุชุงุฑุช ุดุฏู ูุฏูโูุง) ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุธู ูโุดููุฏ. ูุฑ ุฏู ููููู ุจุงุฏ ุง ููููู float ุจุงุดูุฏ ุง ููููู ูุณุชูฺฏุฑุงู. ุนูุงุตุฑ ุฏุฑ `v` ฺฉู ฺฉ ุงุฒ ุฏู ููููู ุขุฎุฑ ุขููุง ููููู float ู ุฏฺฏุฑ ููููู ูุณุชูฺฏุฑุงู ุจุงุดุฏุ ุงุฒ ูฺฉุชูุฑ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ ุงุฏุฏุงุดุช ุณุทุญ ูุดุฏุงุฑ (warn-level) ูุดุฎุต ูโุดููุฏ.

โ`irate` ููุท ุจุงุฏ ุจุง ุดูุงุฑูุฏูโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ.

ูุซุงู ุฒุฑ ูุฑุฎ ุจุฑ ุญุณุจ ุซุงูู ุฏุฑุฎูุงุณุชโูุง HTTP ุฑุง ุจุง ูฺฏุงู ุจู ต ุฏููู ูุจู ุจุฑุง ุฏู ููุทู ุฏุงุฏู ุงุฎุฑุ ุจู ุงุฒุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```
irate(http_requests_total{job="api-server"}[5m])
```
โ`irate` ููุท ุจุงุฏ ููฺฏุงู ุฑุณู ูููุฏุงุฑ ุดูุงุฑูุฏูโูุง ูุฑุงุฑ ู ุณุฑุนโุงูุชุบุฑ ุงุณุชูุงุฏู ุดูุฏ. ุงุฒ `rate` ุจุฑุง ูุดุฏุงุฑูุง ู ุดูุงุฑูุฏูโูุง ฺฉูุฏ ุชุบุฑ ุงุณุชูุงุฏู ฺฉูุฏุ ุฒุฑุง ุชุบุฑุงุช ูุฎุชุตุฑ ุฏุฑ ูุฑุฎ ูโุชูุงูุฏ ุนุจุงุฑุช `FOR` ุฑุง ุฑุณุช ฺฉูุฏ ู ูููุฏุงุฑูุง ฺฉู ฺฉุงููุงู ุงุฒ ุฌูุดโูุง ูุงุฏุฑ ุชุดฺฉู ุดุฏูโุงูุฏุ ุฎูุงูุฏูุดุงู ุฏุดูุงุฑ ุงุณุช.

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ููฺฏุงู ุชุฑฺฉุจ `irate()` ุจุง ฺฉ ุนููฺฏุฑ ุชุฌูุน (ูุซูุงู `sum()`) ุง ุชุงุจุน ฺฉู ุฏุฑ ุทูู ุฒูุงู ุชุฌูุน ูโฺฉูุฏ (ูุฑ ุชุงุจุน ฺฉู ุจู `_over_time` ุฎุชู ูโุดูุฏ)ุ ููุดู ุงุจุชุฏุง `irate()` ุฑุง ุจฺฏุฑุฏุ ุณูพุณ ุชุฌูุน ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุช `irate()` ููโุชูุงูุฏ ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง ุฑุง ููฺฏุงู ุฑโุงุณุชุงุฑุช ุดุฏู ูุฏู ุดูุง ุชุดุฎุต ุฏูุฏ.


## ๐งฉ ุชุนุฑู ุชุงุจุน irate

```promql
irate(v range-vector)
```

---

## ๐ฏ ูุฏู

ุชุงุจุน `irate()` (ูุฎูู **instant rate**)
ุจุฑุง ูุญุงุณุจูโ **ูุฑุฎ ูุญุธูโุง (ุชูุฑุจุงู ูุญุธูโุจูโูุญุธู)** ุชุบุฑุงุช ฺฉ **Counter** ุฏุฑ Prometheus ุงุณุชูุงุฏู ูโุดูุฏ.

ุจู ุฒุจุงู ุณุงุฏู:

>ฺฉ `irate()` ููุฏุงุฑ **ุณุฑุนุช ุชุบุฑ** ูุชุฑฺฉ ุฑุง ุฏุฑ **ุขุฎุฑู ุจุงุฒูโ ุฒูุงู** ุฏุงุฏูโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.
> ุนู ุงุฒ *ุขุฎุฑู ุฏู ููููู* ุฏุฑ ุจุงุฒู ุงุณุชูุงุฏู ูโฺฉูุฏ.

---

## โ๏ธ ูุญููโ ฺฉุงุฑฺฉุฑุฏ

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑ:

| ุฒูุงู  | ููุฏุงุฑ `http_requests_total` |
| ----- | --------------------------- |
| 12:00 | 100                         |
| 12:10 | 120                         |
| 12:20 | 180                         |

ุงฺฏุฑ ุจููุณ:

```promql
irate(http_requests_total[20m])
```

๐น Prometheus ููุท **ุขุฎุฑู ุฏู ููุทู** ุฑุง ูฺฏุงู ูโฺฉูุฏ:

* 12:10 โ 120
* 12:20 โ 180

ู ูุฑุฎ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

```
(180 - 120) / (12:20 - 12:10) = 60 / 600 = 0.1 req/sec
```

๐ค ุฎุฑูุฌ:

```
0.1
```

---

## ๐ ุชูุงูุช `irate()` ู `rate()`

| ูฺฺฏ                        | `rate()`                   | `irate()`                                       |
| ---------------------------- | -------------------------- | ----------------------------------------------- |
| ููุน ูุฑุฎ                      | **ูุงูฺฏู ูุฑุฎ** ุฏุฑ ฺฉู ุจุงุฒู | **ูุฑุฎ ูุญุธูโุง** ุงุฒ ุขุฎุฑู ุฏู ููููู               |
| ุญุณุงุณุช ุจู ุชุบุฑุงุช ูุงฺฏูุงู    | ฺฉูุชุฑ (smooth)              | ุฒุงุฏ (ุชุบุฑุงุช ุณุฑุน ุฑุง ูุดุงู ูโุฏูุฏ)              |
| ููุงุณุจ ุจุฑุง                   | ูููุฏุงุฑูุง ฺฉู ู Alertูุง    | ูุงูุชูุฑ ูุญุธูโุง (ูุซูุงู ุฏุงุดุจูุฑุฏ ุฒูุฏู ุฏุฑ Grafana) |
| ูููููโูุง ฺฉู ุงุณุชูุงุฏู ูโฺฉูุฏ | ุชูุงู ููุงุท ุจุงุฒู             | ููุท ุฏู ููููู ุขุฎุฑ                                |

---

### ๐น ูุซุงู ููุงุณูโุง

ูุฑุถ ฺฉู ุฏุฑ ต ุฏููู ุงุฎุฑุ `http_requests_total` ุงุฒ 100 โ 200 โ 400 โ 800 ุฑูุชู.

```promql
rate(http_requests_total[5m])
```

โ ููุฏุงุฑ ูุงูฺฏู ุฑุดุฏ ุฏุฑ ต ุฏููู ุงุฎุฑ ุฑุง ูโุฏูุฏ.
(ูุฑูโุชุฑ ู ูพุงุฏุงุฑุชุฑ ุงุณุช)

```promql
irate(http_requests_total[5m])
```

โ ููุท ุงุฒ ุฏู ููุทูโ ุขุฎุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ (ุณุฑุนโุชุฑ ู ููุณุงูโุชุฑ ุงุณุช).

---

## โ๏ธ ูฺฉุชู ููู

โ* `irate()` ููุท ุฑู **Counter metrics** (ูุซู `_total` ุง `_count`) ูุนู ุฏุงุฑุฏ.
* ุงฺฏุฑ ุฑู `Gauge` ุงุณุชูุงุฏู ุดูุฏ (ูุซู `temperature`)ุ ูุชุฌู ุงุดุชุจุงู ุงุณุช.
* ุงฺฏุฑ ุฏุงุฏูโูุง ุจุง ูุงุตูู ุฒุงุฏ ุฌูุน ุดููุฏ (ูุซูุงู ูุฑ 1 ุฏููู)ุ `irate()` ููฺฉู ุงุณุช **ูพุฑุช** ุดูุฏ ฺูู ููุท ุฏู ููุทู ุฏุงุฑุฏ.

---

## ๐ก ฺฉุงุฑุจุฑุฏูุง ูุงูุน

### โ ฑ. ูุฑุฎ ูุญุธูโุง ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ูุจโุณุฑูุฑ

```promql
irate(http_requests_total[1m])
```

> ูุดุงู ูโุฏูุฏ ุฏุฑ ููู ูุญุธูุ ฺูุฏ ุฏุฑุฎูุงุณุช ุจุฑ ุซุงูู ุฏุฑ ุญุงู ุงูุฌุงู ุงุณุช.

---

### โ ฒ. ูุฑุฎ ุฎุทุงูุง (Error rate)

```promql
irate(http_requests_total{status=~"5.."}[1m])
```

> ูุฑุฎ ูุญุธูโุง ุฎุทุงูุง 5xx ุฏุฑ ฑ ุฏููู ุงุฎุฑ.

---

### โ ณ. ูุฑุฎ ุงุฑุณุงู ุฏุงุฏู ุฏุฑ ุดุจฺฉู

```promql
irate(node_network_transmit_bytes_total[30s])
```

> ุณุฑุนุช ุงุฑุณุงู ุฏุงุฏู (ุจุงุช ุจุฑ ุซุงูู) ุฏุฑ ุขุฎุฑู ณฐ ุซุงูู.

---

## ๐งพ ุฎูุงุตู ููุง

| ูฺฺฏ             | ุชูุถุญ                                           |
| ----------------- | ----------------------------------------------- |
| ุชุงุจุน              | `irate(v range-vector)`                         |
| ูุฑูุฏ             | ูุชุฑฺฉ ุงุฒ ููุน Counter                            |
| ุฎุฑูุฌ             | ูุฑุฎ ูุญุธูโุง ุงูุฒุงุด ุฏุฑ ูุงุญุฏ ุฒูุงู                 |
| ุจุงุฒู ููุฑุฏ ุงุณุชูุงุฏู | ููุท ุฏู ูููููโ ุขุฎุฑ ุจุงุฒู                         |
| ุงุณุชูุงุฏู ูุนููู     | ูุงูุชูุฑ ุฒูุฏู (real-time)                        |
| ุชูุงูุช ุจุง rate()   | `rate` ูุฑูโุชุฑ ุงุณุชุ `irate` ุณุฑุนโุชุฑ ูุงฺฉูุด ูโุฏูุฏ |













### `label_join()`
โ`label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)`: ุจุฑุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ `v`ุ ุชูุงู ููุงุฏุฑ ุชูุงู `src_labels` ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ `separator` ุจู ูู ูโูพููุฏุฏ ู ุณุฑ ุฒูุงู ุฑุง ุจุง ูุจู `dst_label` ุญุงู ููุฏุงุฑ ูพูุณุชู ุจุฑูโฺฏุฑุฏุงูุฏ. ูุฑ ุชุนุฏุงุฏ `src_labels` ูโุชูุงูุฏ ุฏุฑ ุงู ุชุงุจุน ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.

โ`label_join` ุจุฑ ุฑู ูููููโูุง float ู ูุณุชูฺฏุฑุงู ุจู ฺฉ ุดฺฉู ุนูู ูโฺฉูุฏ.

ุงู ูุซุงู ฺฉ ูฺฉุชูุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ูุฑ ุณุฑ ุฒูุงู ุขู ุฏุงุฑุง ฺฉ ูุจู `foo` ุจุง ููุฏุงุฑ `a,b,c` ุงุณุช ฺฉู ุจู ุขู ุงุถุงูู ุดุฏู ุงุณุช:
```
label_join(up{job="api-server",src1="a",src2="b",src3="c"}, "foo", ",", "src1", "src2", "src3")
```


---

## ๐งฉ ุชุนุฑู ุชุงุจุน label_join()

```promql
label_join(vector, dst_label, separator, src_label1, src_label2, ...)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `label_join()` ุจุฑุง **ุชุฑฺฉุจ ฺูุฏ label ุฏุฑ ฺฉ label ุฌุฏุฏ** ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูโุชูุงู ฺูุฏ ุจุฑฺุณุจ ูุชุฑฺฉ ุฑุง ุจุง ฺฉ ุฌุฏุงฺฉููุฏู (`separator`) ุจู ฺฉ label ุฌุฏุฏ ูุตู ฺฉุฑุฏ.

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ                       | ุชูุถุญ                                   |
| ----------------------------- | --------------------------------------- |
| `vector`                      | instant vector ุง range vector ููุฑุฏ ูุธุฑ |
| `dst_label`                   | ูุงู label ุฌุฏุฏ ฺฉู ูโุฎูุงู ุจุณุงุฒ       |
| `separator`                   | ุฑุดุชูโุง ฺฉู ุจู labelูุง ูุฑุงุฑ ูโฺฏุฑุฏ     |
| `src_label1, src_label2, ...` | labelูุง ฺฉู ูโุฎูุงู ุชุฑฺฉุจ ุดููุฏ        |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance | job | value |
| -------- | --- | ----- |
| 10.0.0.1 | web | 1     |
| 10.0.0.2 | web | 2     |

ูโุฎูุงูู ฺฉ label ุฌุฏุฏ ุจุณุงุฒู ฺฉู ุชุฑฺฉุจ `job` ู `instance` ุจุงุดุฏ:

```promql
label_join(up, "job_instance", "-", "job", "instance")
```

๐ค ุฎุฑูุฌ:

| instance | job | job_instance | value |
| -------- | --- | ------------ | ----- |
| 10.0.0.1 | web | web-10.0.0.1 | 1     |
| 10.0.0.2 | web | web-10.0.0.2 | 2     |

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ุณุงุฎุช label ุฌุฏุฏ ุจุฑุง grouping ุฏุฑ Grafana**

   * ูุซูุงู ุจุฎูุงู ุจุฑ ุงุณุงุณ ุชุฑฺฉุจ `namespace` ู `pod` ุฏุฑ ุฏุงุดุจูุฑุฏ ฺฏุฑููโุจูุฏ ฺฉู:

   ```promql
   label_join(container_cpu_usage_seconds_total, "ns_pod", "/", "namespace", "pod")
   ```

2. **ุขูุงุฏูโุณุงุฒ label ุจุฑุง vector matching**

   * ููุช ูโุฎูุงู ุฏู ูุชุฑฺฉ ุฑุง ุจุฑ ุงุณุงุณ label ุฌุฏุฏ match ฺฉูุ ูโุชูุงู ุจุง `label_join()` label ุฌุฏุฏ ุจุณุงุฒ ู ุณูพุณ `on()` ุง `group_left()` ุงุณุชูุงุฏู ฺฉู.

3. **ุณุงุฏฺฏ ุฏุฑ alerting**

   * ุจู ุฌุง ุงูฺฉู ฺูุฏ label ุฑุง ุฌุฏุงฺฏุงูู ุฏุฑ alert rule ุจุฑุฑุณ ฺฉูุ ููู ุฑุง ุจุง ฺฉ label ุชุฑฺฉุจ ูโฺฉู.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ ฺฉ ุงุฒ labelูุง ููุจุน ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ `dst_label` ุณุงุฎุชู ููโุดูุฏ.
* ููุฏุงุฑ `separator` ูโุชูุงูุฏ ูุฑ ุฑุดุชูโุง ุจุงุดุฏุ ุญุช ุฎุงู (`""`).
* ฺฉ`label_join()` ุชุบุฑ **ููุฏุงุฑ metric** ููโุฏูุฏุ ููุท labelูุง ุฑุง ุฏุณุชฺฉุงุฑ ูโฺฉูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ              | ุชูุถุญ                                                 |
| ------------------ | ----------------------------------------------------- |
| ุชุงุจุน               | `label_join(vector, dst_label, sep, src_label1, ...)` |
| ูุฑูุฏ              | instant ุง range vector                               |
| ุฎุฑูุฌ              | ููุงู vector ุจุง label ุฌุฏุฏ ุชุฑฺฉุจ                      |
| ฺฉุงุฑุจุฑุฏ             | ฺฏุฑููโุจูุฏุ alertingุ ุขูุงุฏูโุณุงุฒ label ุจุฑุง join       |
| ุชุบุฑ ููุฏุงุฑ metric | ูุฏุงุฑุฏุ ููุท labelูุง ุฑุง ุงุถุงูู ูโฺฉูุฏ                    |

---












### `label_replace()`
โ`label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`: ุจุฑุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ `v`ุ ุนุจุงุฑุช ููุธู `regex` ุฑุง ุจุง ููุฏุงุฑ ูุจู `src_label` ูุทุงุจูุช ูโุฏูุฏ. ุงฺฏุฑ ูุทุงุจูุช ุฏุงุดุชู ุจุงุดุฏุ ููุฏุงุฑ ูุจู `dst_label` ุฏุฑ ุณุฑ ุฒูุงู ุจุงุฒฺฏุดุชุ ุจุณุท `replacement` ุจู ููุฑุงู ูุจูโูุง ุงุตู ุฏุฑ ูุฑูุฏ ุฎูุงูุฏ ุจูุฏ. ุจู ฺฏุฑููโูุง ฺฉูพฺุฑ ุดุฏู ุฏุฑ ุนุจุงุฑุช ููุธู ูโุชูุงู ุจุง `$1`ุ `$2` ู ุบุฑู ุงุฑุฌุงุน ุฏุงุฏ. ุจู ฺฏุฑููโูุง ฺฉูพฺุฑ ุดุฏู ูุงูโฺฏุฐุงุฑ ุดุฏู ุฏุฑ ุนุจุงุฑุช ููุธู ูโุชูุงู ุจุง `$name` (ฺฉู `name` ูุงู ฺฏุฑูู ฺฉูพฺุฑ ุดุฏู ุงุณุช) ุงุฑุฌุงุน ุฏุงุฏ. ุงฺฏุฑ ุนุจุงุฑุช ููุธู ูุทุงุจูุช ูุฏุงุดุชู ุจุงุดุฏุ ุณุฑ ุฒูุงู ุจุฏูู ุชุบุฑ ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ.

โ`label_replace` ุจุฑ ุฑู ูููููโูุง float ู ูุณุชูฺฏุฑุงู ุจู ฺฉ ุดฺฉู ุนูู ูโฺฉูุฏ.

ุงู ูุซุงู ุณุฑโูุง ุฒูุงู ุจุง ููุงุฏุฑ `a:c` ุฏุฑ ูุจู `service` ู `a` ุฏุฑ ูุจู `foo` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```
label_replace(up{job="api-server",service="a:c"}, "foo", "$1", "service", "(.*):.*")
```
ุงู ูุซุงู ุฏูู ููุงู ุชุฃุซุฑ ูุซุงู ุงูู ุฑุง ุฏุงุฑุฏ ู ุงุณุชูุงุฏู ุงุฒ ฺฏุฑููโูุง ฺฉูพฺุฑ ุดุฏู ูุงูโฺฏุฐุงุฑ ุดุฏู ุฑุง ูุดุงู ูโุฏูุฏ:
```
label_replace(up{job="api-server",service="a:c"}, "foo", "$name", "service", "(?P<name>.*):(?P<version>.*)")
```




---

## ๐งฉ ุชุนุฑู ุชุงุจุน label_replace

```promql
label_replace(vector, dst_label, replacement, src_label, regex)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `label_replace()` ุจุฑุง **ุณุงุฎุช ุง ุฌุงฺฏุฒู labelูุง ุจุฑ ุงุณุงุณ ุงูฺฏู regex** ุงุณุชูุงุฏู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ูโุชูุงู ููุฏุงุฑ ฺฉ label ุฑุง ุงุณุชุฎุฑุงุฌ ุง ุชุบุฑ ุฏุงุฏ ู ุฏุฑ ฺฉ label ุฌุฏุฏ ูุฑุงุฑ ุฏุงุฏ.

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ       | ุชูุถุญ                                                                                        |
| ------------- | -------------------------------------------------------------------------------------------- |
| `vector`      | instant vector ุง range vector ููุฑุฏ ูุธุฑ                                                      |
| `dst_label`   | ูุงู label ุฌุฏุฏ ุง ููุฌูุฏ ฺฉู ูโุฎูุงู ููุฏุงุฑ ุขู ุฑุง ุชุบุฑ ุฏู                                    |
| `replacement` | ููุฏุงุฑ ฺฉู ูโุฎูุงู ุจุง regex ุฌุงฺฏุฒู ุดูุฏ (ูโุชูุงูุฏ `$1` ู `$2` ุฏุงุดุชู ุจุงุดุฏ ุจุฑุง capture group) |
| `src_label`   | label ูุจุฏุง ฺฉู ููุฏุงุฑุด ุจุฑุง regex ุจุฑุฑุณ ูโุดูุฏ                                                 |
| `regex`       | ุงูฺฏู regex ุจุฑุง ุงุณุชุฎุฑุงุฌ ุจุฎุด ููุฑุฏ ูุธุฑ                                                        |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance    | job | value |
| ----------- | --- | ----- |
| web-01.prod | web | 1     |
| web-02.prod | web | 2     |

ูโุฎูุงูู ููุท ุดูุงุฑู ุณุฑูุฑ (01ุ 02) ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉูู ู ุฏุฑ label ุฌุฏุฏ `server_id` ูุฑุงุฑ ุฏูู:

```promql
label_replace(up, "server_id", "$1", "instance", "web-(\\d+)\\.prod")
```

๐ค ุฎุฑูุฌ:

| instance    | job | server_id | value |
| ----------- | --- | --------- | ----- |
| web-01.prod | web | 01        | 1     |
| web-02.prod | web | 02        | 2     |

> ุชูุถุญ:
>
>โ * `(\\d+)` โ ฺฉ ุง ฺูุฏ ุฑูู ุฑุง ุฏุฑ instance ูพุฏุง ูโฺฉูุฏ
> * `$1` โ ููุฏุงุฑ capture group ุงูู ุฑุง ุฏุฑ label ุฌุฏุฏ `server_id` ูุฑุงุฑ ูโุฏูุฏ

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ุงุณุชุฎุฑุงุฌ ุจุฎุด ุงุฒ label ุจุฑุง alert ุง grouping**

   * ูุซูุงู namespace ุง pod name ุฑุง ุงุฒ instance ุง container name ุฌุฏุง ูโฺฉูู.

2. **ุณุงุฎุช label ุฌุฏุฏ ุจุฑุง vector matching**

   * ููุช ูโุฎูุงู ุฏู ูุชุฑฺฉ ุฑุง ุจุฑ ุงุณุงุณ label ุฌุฏุฏ join ฺฉู.

3. **ุชุจุฏู ุง ูพุงฺฉโุณุงุฒ labelูุง**

   * ุญุฐู ูพุณููุฏุ ูพุดููุฏุ ุง ุจุฎุด ุงุถุงู ุฏุฑ labelูุง.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ regex match ูุดูุฏุ `dst_label` ุณุงุฎุชู ููโุดูุฏ.
* ูโุชูุงู ุงุฒ capture groups (`$1`, `$2`, ...) ุฏุฑ replacement ุงุณุชูุงุฏู ฺฉุฑุฏ.
* ุงู ุชุงุจุน ููุฏุงุฑ metric ุฑุง ุชุบุฑ ููโุฏูุฏุ ููุท labelูุง ุฑุง ุฏุณุชฺฉุงุฑ ูโฺฉูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ              | ุชูุถุญ                                                             |
| ------------------ | ----------------------------------------------------------------- |
| ุชุงุจุน               | `label_replace(vector, dst_label, replacement, src_label, regex)` |
| ูุฑูุฏ              | instant ุง range vector                                           |
| ุฎุฑูุฌ              | ููุงู vector ุจุง label ุฌุฏุฏ ุง ุงุตูุงุญโุดุฏู                            |
| ฺฉุงุฑุจุฑุฏ             | ุงุณุชุฎุฑุงุฌ ุง ุชุบุฑ label ุจุฑ ุงุณุงุณ regex                              |
| ุชุบุฑ ููุฏุงุฑ metric | ูุฏุงุฑุฏ                                                             |

---

















### `ln()`
โ`ln(v instant-vector)`: ูฺฏุงุฑุชู ุทุจุน ุฑุง ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ูุญุงุณุจู ูโฺฉูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ููุงุฑุฏ ุฎุงุต ุนุจุงุฑุชูุฏ ุงุฒ:
```
ln(+Inf) = +Inf
ln(0) = -Inf
ln(x < 0) = NaN
ln(NaN) = NaN
```
### `log2()`
โ`log2(v instant-vector)`: ูฺฏุงุฑุชู ุฏูุฏู ุฑุง ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ูุญุงุณุจู ูโฺฉูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ููุงุฑุฏ ุฎุงุต ูุนุงุฏู ููุงุฑุฏ ููุฌูุฏ ุฏุฑ `ln` ูุณุชูุฏ.

### `log10()`
โ`log10(v instant-vector)`: ูฺฏุงุฑุชู ุงุนุดุงุฑ ุฑุง ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ูุญุงุณุจู ูโฺฉูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ููุงุฑุฏ ุฎุงุต ูุนุงุฏู ููุงุฑุฏ ููุฌูุฏ ุฏุฑ `ln` ูุณุชูุฏ.

### `minute()`
โ`minute(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ุฏููู ุงุฒ ุณุงุนุช (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฐ ุชุง ตน ูุณุชูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.



### `month()` ++
โ`month(v=vector(time()) instant-vector)`: ูููููโูุง float ุฏุฑ `v` ุฑุง ุจู ุนููุงู timestamps (ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC) ุชูุณุฑ ฺฉุฑุฏู ู ูุงูู ุณุงู (ุฏุฑ UTC) ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุขู timestamps ุจุฑูโฺฏุฑุฏุงูุฏ. ููุงุฏุฑ ุจุงุฒฺฏุดุช ุจู ฑ ุชุง ฑฒ ูุณุชูุฏุ ฺฉู ฑ ุจู ูุนูุง ฺุงููู ู ุงู ุขุฎุฑ ุงุณุช. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.



---

## ๐งฉ ุชุนุฑู ุชุงุจุน month

```promql
month(v instant-vector)
```

ุง ุงฺฏุฑ ุจุฏูู ุขุฑฺฏููุงู ุงุณุชูุงุฏู ุดูุฏ:

```promql
month()
```

---

## ๐ฏ ูุฏู ุชุงุจุน

ุชุงุจุน `month()` ููุฏุงุฑ **ูุงู ุฌุงุฑ (ุงุฒ 1 ุชุง 12)** ุฑุง ุงุฒ timestamp ูุฑ ููููู ุฏุงุฏู ุจุฑูโฺฏุฑุฏุงูุฏ.

> ุนู ุงฺฏุฑ timestamp ููููู ูุฑุจูุท ุจู ููุฑูุงู ุจุงุดุฏุ ุฎุฑูุฌ `7` ุฎูุงูุฏ ุจูุฏ (ูุงู ููุชู ุณุงู ููุงุฏ).

---

## ๐ง ฺฉุงุฑุจุฑุฏูุง

* ุชุญูู ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ **ูุงู ุณุงู**
* ุณุงุฎุช **report ูุงูุงูู** ุฏุฑ Prometheus ุง Grafana
* ุชุฑฺฉุจ ุจุง ุชูุงุจุน aggregate ุจุฑุง ฺฏุฑููโุจูุฏ ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ ูุงู

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

```promql
up
```

ุงฺฏุฑ ุจููุณ:

```promql
month(up)
```

* ูุฑ ููููู ููุฏุงุฑ ฑ ุชุง ฑฒ ุฎูุงูุฏ ุฏุงุดุชุ ุจุณุชู ุจู ุงูฺฉู ูุฑุจูุท ุจู ฺฉุฏุงู ูุงู ุจุงุดุฏ.

ูุซูุงู ุงฺฏุฑ ุงูุงู ููุฑูุงู (October / ูุงู 10 ููุงุฏ) ุจุงุดุฏ:

```
10
```

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ ุจุง aggregate

ูโุฎูุงู ูุงูฺฏู ูุชุฑฺฉ `http_requests_total` ุฑุง **ุจุฑุง ูุฑ ูุงู** ุจุจู:

```promql
avg(http_requests_total) by (month())
```

> ุงูุฌุง ูุงู ูุฑ ููููู ุฌุฏุง ุดุฏู ู ูุงูฺฏู ุจุฑุง ูุฑ ูุงู ูุญุงุณุจู ูโุดูุฏ.

---

## ๐น ุชูุงูุช ุจุง ุณุงุฑ ุชูุงุจุน ุฒูุงู

| ุชุงุจุน             | ุฎุฑูุฌ     | ูุญุฏูุฏู           |
| ---------------- | --------- | ---------------- |
| `hour()`         | ุณุงุนุช ุฑูุฒ  | 0โ23             |
| `day_of_month()` | ุฑูุฒ ูุงู   | 1โ31             |
| `day_of_week()`  | ุฑูุฒ ููุชู  | 0โ6 (0 = ฺฉุดูุจู) |
| `month()`        | ุดูุงุฑู ูุงู | 1โ12             |
| `year()`         | ุณุงู       | ูุซูุง 2025        |

---

## โ๏ธ ูฺฉุงุช ููู

* `month()` ุจุฑ ุงุณุงุณ **timestamp ูุฑ ููููู** ุนูู ูโฺฉูุฏุ ูู ุฒูุงู ูุนู ุณุณุชู.
* ูุนูููุงู ููุฑุงู ุจุง `by()` ุง aggregate ุงุณุชูุงุฏู ูโุดูุฏ ุชุง ฺฏุฒุงุฑุด ูุงูุงูู ุงุฌุงุฏ ุดูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ      | ุชูุถุญ                                   |
| ---------- | --------------------------------------- |
| ุชุงุจุน       | `month(v instant-vector)`               |
| ูุฑูุฏ      | vector (instant) ุง ุจุฏูู ูุฑูุฏ          |
| ุฎุฑูุฌ      | ุนุฏุฏ ูุงู (1โ12)                          |
| ฺฉุงุฑุจุฑุฏ     | ุชุญูู ุฏุงุฏูโูุง ุจุฑ ุงุณุงุณ ูุงูุ ฺฏุฒุงุฑุด ูุงูุงูู |
| ููููู ุณุงุฏู | `month(up)` โ 10                        |

---













### `predict_linear()` ++
โ`predict_linear(v range-vector, t scalar)`: ููุฏุงุฑ ุณุฑ ุฒูุงู ุฑุง `t` ุซุงูู ุงุฒ ุงฺฉูููุ ุจุฑ ุงุณุงุณ ูฺฉุชูุฑ ุจุงุฒูโุง `v`ุ ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑฺฏุฑุณูู ุฎุท ุณุงุฏู ูพุดโุจู ูโฺฉูุฏ. ูฺฉุชูุฑ ุจุงุฒูโุง ุจุงุฏ ุญุฏุงูู ุฏู ููููู float ุจุฑุง ุงูุฌุงู ูุญุงุณุจู ุฏุงุดุชู ุจุงุดุฏ. ููฺฏุงู ฺฉู `+Inf` ุง `-Inf` ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุงูุช ุดูุฏุ ููุฏุงุฑ ูพุดโุจู ุดุฏู `NaN` ุฎูุงูุฏ ุจูุฏ.

โ`predict_linear` ููุท ุจุงุฏ ุจุง ฺฏูุฌโูุง ุงุณุชูุงุฏู ุดูุฏ ู ููุท ุจุฑุง ูููููโูุง float ฺฉุงุฑ ูโฺฉูุฏ. ุนูุงุตุฑ ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ฺฉู ููุท ุญุงู ูููููโูุง ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ุจู ุทูุฑ ฺฉุงูู ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ. ุจุฑุง ุนูุงุตุฑ ฺฉู ุญุงู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ููุท ุงุฒ ูููููโูุง float ุจู ุนููุงู ูุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ุจุง ฺฉ ุงุฏุฏุงุดุช info-level ูุดุฎุต ูโุดูุฏ.




---

## ๐งฉ ุชุนุฑู ุชุงุจุน predict_linear

```promql
predict_linear(range-vector, seconds)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

โ* `predict_linear()` ููุฏุงุฑ ุขูุฏู ฺฉ **metric** ุฑุง ูพุดโุจู ูโฺฉูุฏ.
* ูพุดโุจู ุจุฑ ุงุณุงุณ **ุฑููุฏ ุฎุท ุฏุงุฏูโูุง ฺฏุฐุดุชู** ุฏุฑ **ุจุงุฒูโ ุฒูุงู ูุดุฎุต ุดุฏู** ุงูุฌุงู ูโุดูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ุงฺฏุฑ ูุชุฑฺฉ ุดูุง ุจุง ููุงู ุฑููุฏ ุงุฏุงูู ูพุฏุง ฺฉูุฏุ ููุฏุงุฑ ุขู ุจุนุฏ ุงุฒ `seconds` ุซุงูู ุขูุฏู ฺูุฏุฑ ุฎูุงูุฏ ุจูุฏุ

---

## โ๏ธ ูพุงุฑุงูุชุฑูุง

| ูพุงุฑุงูุชุฑ        | ุชูุถุญ                                                                         |
| -------------- | ----------------------------------------------------------------------------- |
| `range-vector` | ุจุงุฒูโ ุฒูุงู ฺฉู ุฏุงุฏูโูุง ุจุฑุง ูุญุงุณุจูโ ุฑููุฏ ุฏุฑ ุขู ุจุฑุฑุณ ูโุดููุฏ (ูุซูุงู `[5m]`) |
| `seconds`      | ูุฏุช ุฒูุงู ูพุดโุจู ุจู ุซุงูู (ูุซูุงู `60` โ ฑ ุฏููู ุขูุฏู)                       |

---

## ๐ง ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู (ูุซูุงู ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง HTTP ุฏุฑ ูุฑ ุซุงูู):

```promql
http_requests_total
```

ูโุฎูุงูู ููุฏุงุฑ ูพุดโุจูโุดุฏู ุฏุฑ ฑ ุฏููู ุขูุฏู ุฑุง ุจุจููุ ุจุฑ ุงุณุงุณ ุฑููุฏ ต ุฏููู ุงุฎุฑ:

```promql
predict_linear(http_requests_total[5m], 60)
```

โ๐น Prometheus ุงุฒ **ุฑฺฏุฑุณูู ุฎุท** ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง ุฎุท ุฑููุฏ ฺฏุฐุดุชู ุฑุง ูพุฏุง ฺฉูุฏ ู ููุฏุงุฑ **60 ุซุงูู ุจุนุฏ** ุฑุง ูพุดโุจู ฺฉูุฏ.

---

## ๐งฎ ูุญูู ฺฉุงุฑฺฉุฑุฏ (ููููู)

1. ุฏุงุฏูโูุง ฺฏุฐุดุชู ุฏุฑ ุจุงุฒูโ `[5m]` ุฌูุนโุขูุฑ ูโุดููุฏ.
2. **ุฑฺฏุฑุณูู ุฎุท** ุฑู ุฏุงุฏูโูุง ุงุฌุฑุง ูโุดูุฏ ุชุง **ุดุจ ุฎุท ุฑููุฏ** (slope) ู ููุฏุงุฑ ุงููู (intercept) ูุญุงุณุจู ุดูุฏ.
3. ููุฏุงุฑ ูพุดโุจู ุดุฏู:

$[$
$\text{predicted value} = \text{current value} + (\text{slope} \times \text{seconds})$
$]$

> ุนู ุงฺฏุฑ ุฑููุฏ ูุนู ุงุฏุงูู ูพุฏุง ฺฉูุฏุ ููุฏุงุฑ ูุชุฑฺฉ ุจุนุฏ ุงุฒ `seconds` ุซุงูู ฺูุฏุฑ ุฎูุงูุฏ ุจูุฏ.

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

โ1. **Alerting ูพุดโุจูโุดุฏู**

   * ูโุชูุงู ูพุดโุจู ฺฉุฑุฏ ฺฉู ุขุง ูุชุฑฺฉ ุฏุฑ ุขูุฏู ุจู ุญุฏ ุจุญุฑุงู ูโุฑุณุฏ ุง ูู:

   ```promql
   predict_linear(node_memory_Active_bytes[10m], 300) > 0.9 * node_memory_MemTotal_bytes
   ```

   > ูพุดโุจู ูโฺฉูุฏ ฺฉู ุฏุฑ ต ุฏููู ุขูุฏูุ ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู ุจุด ุงุฒ นฐูช ุฎูุงูุฏ ุดุฏ ุง ูู.

2. **ูพุดโุจู ุชุฑุงูฺฉ**

   * ุจุฑุง HTTP requests ุง CPU usage ูโุชูุงู trend ุขูุฏู ุฑุง ูพุดโุจู ฺฉุฑุฏ ู alert ฺฏุฑูุช.

3. **ูููุฏุงุฑูุง ุขูุฏูโูฺฏุฑ ุฏุฑ Grafana**

   * ููุงุด ุฑููุฏ ูพุดโุจูโุดุฏู ุจุฑ ุงุณุงุณ ุฏุงุฏูโูุง ฺฏุฐุดุชู ุจุฑุง planning ุง ุธุฑูุชโุณูุฌ.

---

## โ๏ธ ูฺฉุงุช ููู

โ* `predict_linear()` ููุท ุฑู **ูุชุฑฺฉโูุง cumulative ุง gauge** ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.
* ูพุดโุจู ุฏูู ูุณุช ู ุตุฑูุงู **ุชุฎูู ุฎุท** ุงุณุชุ ุงฺฏุฑ ุฑูุชุงุฑ ูุชุฑฺฉ ูุงฺฏูุงู ุชุบุฑ ฺฉูุฏุ ูพุดโุจู ุงุดุชุจุงู ุฎูุงูุฏ ุจูุฏ.
* ุจุงุฒูโ `[range-vector]` ุจุงุฏ ุญุฏุงูู ุฏู ููููู ุฏุงุดุชู ุจุงุดุฏ ุชุง slope ูุงุจู ูุญุงุณุจู ุจุงุดุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ  | ุชูุถุญ                                                      |
| ------ | ---------------------------------------------------------- |
| ุชุงุจุน   | `predict_linear(range-vector, seconds)`                    |
| ูุฑูุฏ  | range vector ุงุฒ ุฏุงุฏูโูุง ฺฏุฐุดุชู                             |
| ุฎุฑูุฌ  | ููุฏุงุฑ ูพุดโุจูโุดุฏู ูุชุฑฺฉ ุจุนุฏ ุงุฒ `seconds` ุซุงูู            |
| ูุฏู    | ุชุฎูู ุขูุฏู ูุชุฑฺฉ ุจุฑ ุงุณุงุณ ุฑููุฏ ุฎุท ฺฏุฐุดุชู                   |
| ฺฉุงุฑุจุฑุฏ | Alerting ูพุดโุจูโุดุฏูุ ูููุฏุงุฑูุง ุขูุฏูโูฺฏุฑุ trend analysis |

---

ูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูชูช














### `rate()`
โ`rate(v range-vector)`: ูุงูฺฏู ูุฑุฎ ุงูุฒุงุด ุจุฑ ุญุณุจ ุซุงูู ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุฑุง ูุญุงุณุจู ูโฺฉูุฏ. ููููโูุง ุฏุฑ ฺฉููุงุฎุช (ูุงููุฏ ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง ุจู ุฏูู ุฑโุงุณุชุงุฑุช ุดุฏู ูุฏูโูุง) ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุธู ูโุดููุฏ. ููฺููุ ูุญุงุณุจู ุจู ุงูุชูุง ุจุงุฒู ุฒูุงู ุจุฑููุงุจ ูโุดูุฏุ ฺฉู ุงูฺฉุงู ุงุฒ ุฏุณุช ุฑูุชู ูููููโุจุฑุฏุงุฑโูุง (scrapes) ุง ุนุฏู ุชุทุงุจู ฺฉุงูู ฺุฑุฎูโูุง ูููููโุจุฑุฏุงุฑ ุจุง ุฏูุฑู ุฒูุงู ุจุงุฒู ุฑุง ูุฑุงูู ูโฺฉูุฏ.

ูุซุงู ุฒุฑ ูุงูฺฏู ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง HTTP ุจุฑ ุญุณุจ ุซุงูู ุฑุง ุฏุฑ ต ุฏููู ฺฏุฐุดุชูุ ุจู ุงุฒุง ูุฑ ุณุฑ ุฒูุงู ุฏุฑ ูฺฉุชูุฑ ุจุงุฒูโุง ุจุฑูโฺฏุฑุฏุงูุฏ:
```
rate(http_requests_total{job="api-server"}[5m])
```
โ`rate` ุจุฑ ุฑู ูุณุชูฺฏุฑุงูโูุง ุจูู ุจุง ูุญุงุณุจู ฺฉ ูุณุชูฺฏุฑุงู ุฌุฏุฏ ุนูู ูโฺฉูุฏ ฺฉู ุฏุฑ ุขู ูุฑ ุฌุฒุก (ูุฌููุน ู ุชุนุฏุงุฏ ูุดุงูุฏุงุชุ ุจุงฺฉุชโูุง) ูุฑุฎ ุงูุฒุงุด ุจู ุฌุฒุก ูุฑุจูุทู ุฏุฑ ุงููู ู ุขุฎุฑู ูุณุชูฺฏุฑุงู ุจูู ุฏุฑ `v` ุงุณุช. ุจุง ุงู ุญุงูุ ูุฑ ุนูุตุฑ ุฏุฑ `v` ฺฉู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูููููโูุง ูุณุชูฺฏุฑุงู ุจูู ุฏุฑ ุจุงุฒู ุฏุงุดุชู ุจุงุดุฏุ ุงุฒ ูฺฉุชูุฑ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ ุงุฏุฏุงุดุช   warn-level ูุดุฎุต ูโุดูุฏ.

โ`rate` ููุท ุจุงุฏ ุจุง ุดูุงุฑูุฏูโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ. ุจุฑุง ูุดุฏุงุฑ ุฏุงุฏู ู ุจุฑุง ุฑุณู ูููุฏุงุฑ ุดูุงุฑูุฏูโูุง ฺฉูุฏ ุชุบุฑ ุจูุชุฑู ฺฏุฒูู ุงุณุช.

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ููฺฏุงู ุชุฑฺฉุจ `rate()` ุจุง ฺฉ ุนููฺฏุฑ ุชุฌูุน (ูุซูุงู `sum()`) ุง ุชุงุจุน ฺฉู ุฏุฑ ุทูู ุฒูุงู ุชุฌูุน ูโฺฉูุฏ (ูุฑ ุชุงุจุน ฺฉู ุจู `_over_time` ุฎุชู ูโุดูุฏ)ุ ููุดู ุงุจุชุฏุง `rate()` ุฑุง ุจฺฏุฑุฏุ ุณูพุณ ุชุฌูุน ฺฉูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุช `rate()` ููโุชูุงูุฏ ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง ุฑุง ููฺฏุงู ุฑโุงุณุชุงุฑุช ุดุฏู ูุฏู ุดูุง ุชุดุฎุต ุฏูุฏ.




ุชุงุจุน `rate()` ุฏุฑ PromQL ฺฉ ุงุฒ **ูููโุชุฑู ู ูพุฑฺฉุงุฑุจุฑุฏุชุฑู ุชูุงุจุน** ุฏุฑ ูุงูุชูุฑูฺฏ ุจุง Prometheus ุงุณุช.
ุงู ุชุงุจุน ุจุฑุง **ูุญุงุณุจูโ ุณุฑุนุช ุงูุฒุงุด ุฏุงุฏูโูุง ุงุฒ ููุน Counter** ุงุณุชูุงุฏู ูโุดูุฏ โ ุนู ูุดุงู ูโุฏูุฏ ฺฉู ฺฉ ุดูุงุฑูุฏู ุฏุฑ ูุฑ ุซุงููุ ุจูโุทูุฑ ูุชูุณุท ฺูุฏุฑ ุฑุดุฏ ฺฉุฑุฏู ุงุณุช.

---

## ๐น ุชุนุฑู ฺฉู

```promql
rate(counter_metric_name[range])
```

ุชุงุจุน `rate()` ูุฑุฎ **ุงูุฒุงุด ูุงูฺฏู ุฏุฑ ุซุงูู** ุฑุง ุฏุฑ ุจุงุฒูโ ุฒูุงู ุฏุงุฏูโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ.
ุฏุงุฏู ุจุงุฏ ุงุฒ ููุน **Counter** ุจุงุดุฏ โ ุนู ููุฏุงุฑ ฺฉู ููุท ุฒุงุฏ ูโุดูุฏ (ูุซู ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุงุ ุชุนุฏุงุฏ ุฎุทุงูุงุ ุจุงุชโูุง ุงุฑุณุงูโุดุฏู ู...).

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุจู ูุงู:

```
http_requests_total
```

ุฏุงุฑู ฺฉู ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง HTTP ุฑุง ูุดุงู ูโุฏูุฏ.

ุงฺฏุฑ ุจููุณู:

```promql
rate(http_requests_total[5m])
```

ุนู:

> ุฏุฑ ูุฑ ุซุงููุ ูุงูฺฏู ฺูุฏ ุฏุฑุฎูุงุณุช ุฏุฑ ต ุฏูููโ ฺฏุฐุดุชู ุซุจุช ุดุฏู ุงุณุช.

ูุซูุงู ุงฺฏุฑ ุฏุฑ ต ุฏููู ุงุฎุฑุ ุดูุงุฑูุฏู ุงุฒ 1000 ุจู 1600 ุฑุณุฏู ุจุงุดุฏ:

$[$
$\text{rate} = \frac{1600 - 1000}{5 \times 60} = 2 \text{ requests/sec}$
$]$

---

## ๐งฎ ูุฑููู ููููู

ุชุงุจุน `rate()` ุงุณุงุณุงู **ุดุจ ุฎุท ุฑฺฏุฑุณูู ุฎุท** (linear regression) ุฑุง ุจู ููุงุท ุฏุงุฏู ุฏุฑ ุจุงุฒูโ ุฒูุงู ุชุนูโุดุฏู ูุญุงุณุจู ูโฺฉูุฏ:

[
$\text{rate} = \frac{\Delta y}{\Delta t}$
$]$

ฺฉู ุฏุฑ ุขู:

* ( y ) = ููุฏุงุฑ Counter
* ( t ) = ุฒูุงู (ุซุงูู)

---

## โ๏ธ ุฑูุชุงุฑ ุฏุฑ Counterูุง Resetโุดุฏู

ุงฺฏุฑ Counter ุฑุณุช ุดูุฏ (ูุซูุงู ุณุฑูุณ ุฑโุงุณุชุงุฑุช ุดูุฏ ู ููุฏุงุฑ ุงุฒ 1000 ุฏูุจุงุฑู ุจู 0 ุจุฑฺฏุฑุฏุฏ)ุ Prometheus ุงู ุฑุง ุชุดุฎุต ูโุฏูุฏ ู ููุฏุงุฑ ููู ุฑุง **ูุงุฏุฏู ฺฏุฑูุชู** ู ุงุฏุงููโ ูุญุงุณุจู ุฑุง ุงุฒ 0 ุฏุฑ ูุธุฑ ูโฺฏุฑุฏ.

ูุซูุงู:

```
ูุจู: 1000
ุจุนุฏ: 20
```

Prometheus ูโูููุฏ ฺฉู ุดูุงุฑูุฏู ุฑุณุช ุดุฏู ู ููุฏุงุฑ ูุงูุน ุงูุฒุงุด 20 ุงุณุชุ ูู ููู 980.

---

## ๐ ฺฉุงุฑุจุฑุฏูุง ูุชุฏุงูู

| ูุฏู                   | ูุซุงู PromQL                                   |
| --------------------- | --------------------------------------------- |
| ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง HTTP  | `rate(http_requests_total[5m])`               |
| ูุฑุฎ ุฎุทุงูุง HTTP       | `rate(http_requests_total{status="500"}[5m])` |
| ูพููุง ุจุงูุฏ ูุฑูุฏ ุดุจฺฉู | `rate(node_network_receive_bytes_total[1m])`  |
| ุชุนุฏุงุฏ ูุงฺฏโูุง ุฏุฑ ุซุงูู | `rate(app_logs_total[1m])`                    |

---

## ๐ง ุชูุงูุช ุจุง ุชูุงุจุน ูุดุงุจู

| ุชุงุจุน         | ุชูุถุญ                                                      |
| ------------ | ---------------------------------------------------------- |
| `irate()`    | ูุฑุฎ ูุญุธูโุง ุจู ุฏู ูููููโ ุขุฎุฑ (ุชุบุฑ ุณุฑุนโุชุฑุ ููุฒ ุจุดุชุฑ) |
| `increase()` | ฺฉู ุงูุฒุงุด ุฏุฑ ุจุงุฒู (ูู ูุฑุฎ ุจุฑ ุซุงูู)                        |
| `rate()`     | ูุงูฺฏู ุงูุฒุงุด ุจุฑ ุซุงูู ุฏุฑ ุจุงุฒู                            |

ูุซูุงู:

```promql
increase(http_requests_total[5m])
```

โ ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ต ุฏููู
ุฏุฑ ุญุงูโฺฉู:

```promql
rate(http_requests_total[5m])
```

โ ูุฑุฎ ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุซุงูู

---

## ๐ ุฎูุงุตู

| ูฺฺฏ          | ุชูุถุญ                    |
| -------------- | ------------------------ |
| ููุน ุฏุงุฏู ูุฑูุฏ | Counter                  |
| ุฎุฑูุฌ          | Gauge (ูุฑุฎ ุจุฑ ุซุงูู)     |
| ฺฉุงุฑุจุฑุฏ         | ูุงูฺฏู ุณุฑุนุช ุฑุดุฏ ุฏุฑ ุจุงุฒู |
| ุฑูุชุงุฑ ุจุง Reset | ุชุดุฎุต ุฎูุฏฺฉุงุฑ ู ุงุตูุงุญ     |
| ูุงุญุฏ           | ุจุฑ ุญุณุจ ยซุจุฑ ุซุงููยป        |

---

### `resets()`
โ`resets(v range-vector)`: ุจุฑุง ูุฑ ุณุฑ ุฒูุงู ูุฑูุฏุ ุชุนุฏุงุฏ ุฑุณุชโูุง ุดูุงุฑูุฏู ุฏุฑ ุจุงุฒู ุฒูุงู ุงุฑุงุฆู ุดุฏู ุฑุง ุจู ุนููุงู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุจุฑูโฺฏุฑุฏุงูุฏ. ูุฑฺฏููู ฺฉุงูุด ุฏุฑ ููุฏุงุฑ ุจู ุฏู ููููู float ูุชูุงู ุจู ุนููุงู ุฑุณุช ุดูุงุฑูุฏู ุชูุณุฑ ูโุดูุฏ. ุฑุณุช ุฏุฑ ฺฉ ูุณุชูฺฏุฑุงู ุจูู ุจู ุฑูุด ูพฺุฏูโุชุฑ ุชุดุฎุต ุฏุงุฏู ูโุดูุฏ: ูุฑฺฏููู ฺฉุงูุด ุฏุฑ ูุฑ ุจุงฺฉุชุ ุงุฒ ุฌููู ุจุงฺฉุช ุตูุฑุ ุง ุฏุฑ ุชุนุฏุงุฏ ูุดุงูุฏุงุชุ ฺฉ ุฑุณุช ุดูุงุฑูุฏู ูุญุณูุจ ูโุดูุฏุ ุงูุง ููฺูู ูุงูพุฏุฏ ุดุฏู ูุฑ ุจุงฺฉุช ูุจูุงู ูพุฑ ุดุฏูุ ฺฉุงูุด ุนุฑุถ ุจุงฺฉุช ุตูุฑุ ุง ูุฑฺฏููู ุชุบุฑ ุงุณฺฉูุง ฺฉู ฺฉุงูุด ูุถูุญ ุณุงุฒฺฏุงุฑ ูุจุงุดุฏ ูุฒ ุฑุณุช ูุญุณูุจ ูโุดูุฏ.

โ`resets` ููุท ุจุงุฏ ุจุง ุดูุงุฑูุฏูโูุง (ูู ุจุฑุง float ู ูู ุจุฑุง ูุณุชูฺฏุฑุงู) ุงุณุชูุงุฏู ุดูุฏ.โ

ฺฉ ููููู float ู ุจู ุฏูุจุงู ุขู ฺฉ ููููู ูุณุชูฺฏุฑุงูุ ุง ุจุฑุนฺฉุณุ ุจู ุนููุงู ุฑุณุช ูุญุณูุจ ูโุดูุฏ. ฺฉ ููููู ูุณุชูฺฏุฑุงู ุดูุงุฑูุฏู ู ุจู ุฏูุจุงู ุขู ฺฉ ููููู ูุณุชูฺฏุฑุงู ฺฏูุฌุ ุง ุจุฑุนฺฉุณุ ูุฒ ุจู ุนููุงู ุฑุณุช ูุญุณูุจ ูโุดูุฏ (ุงูุง ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `resets` ูุจุงุฏ ุฏุฑ ูููู ุงูู ุฑู ฺฏูุฌโูุง ุงุณุชูุงุฏู ุดูุฏุ ุจู ุจุงูุง ูุฑุงุฌุนู ฺฉูุฏ).



---

## ๐น ุชุนุฑู ุชุงุจุน

```promql
resets(counter_metric_name[range])
```

ุชุงุจุน `resets()` ุชุนุฏุงุฏ ุฏูุนุงุช ุฑุง ฺฉู ููุฏุงุฑ ฺฉ **Counter** ุฏุฑ ุจุงุฒูโ ุฒูุงู ุฏุงุฏูโุดุฏู ุฑุณุช (ุตูุฑ) ุดุฏู ุงุณุชุ ุจุฑูโฺฏุฑุฏุงูุฏ.

---

## ๐ง ฺฉุงุฑุจุฑุฏ ู ูุฏู

ุฏุฑ Prometheusุ ูุชุฑฺฉโูุง ุงุฒ ููุน **Counter** ููุดู ุจุงุฏ ููุท **ุงูุฒุงุด ูพุฏุง ฺฉููุฏ**.
ุงูุง ุงฺฏุฑ ุณุฑูุณ ุฑโุงุณุชุงุฑุช ุดูุฏุ ุง ุดูุงุฑูุฏู ุจู ูุฑ ุฏูู ุงุฒ ูู ุดุฑูุน ุดูุฏุ ููุฏุงุฑ ุขู ุจู ุนุฏุฏ ฺฉูฺฺฉุชุฑ (ูุนูููุงู ุตูุฑ) ุจุฑูโฺฏุฑุฏุฏ.
ุชุงุจุน `resets()` ุจุฑุง **ุชุดุฎุต ุงู ุฑุณุชโูุง** ุทุฑุงุญ ุดุฏู ุงุณุช.

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

```
http_requests_total
```

ู ุฏุฑ ุทูู ฑฐ ุฏููู ุงุฎุฑ ููุฏุงุฑุด ุงูโุทูุฑ ุชุบุฑ ฺฉุฑุฏู:

```
0 โ 100 โ 200 โ 0 โ 50 โ 0 โ 120
```

ุฏุฑ ุงูุฌุง ุดูุงุฑูุฏู ุฏูุจุงุฑ ุฑุณุช ุดุฏู (ุฏู ุจุงุฑ ุงุฒ ููุฏุงุฑ ุจุงูุง ุจู ฐ ุจุฑฺฏุดุชู).

ุงฺฏุฑ ุจููุณู:

```promql
resets(http_requests_total[10m])
```

๐ ุฎุฑูุฌ ุจุฑุงุจุฑ ุจุง:

```
2
```

---

## โ๏ธ ูฺฉุงุช ุฑูุชุงุฑ

* โ`resets()` ููุท ุฏุฑ **Counter** ูุนู ุฏุงุฑุฏ (ฺูู Gauge ูโุชูุงูุฏ ุจุงูุง ู ูพุงู ุจุฑูุฏ).
* ุงฺฏุฑ ูุชุฑฺฉ ุงุตูุงู ุฑุณุช ูุดุฏู ุจุงุดุฏุ ุฎุฑูุฌ `0` ุงุณุช.
* โPrometheus ููุฏุงุฑ ุฑุง ุจุง ุจุฑุฑุณ ููุงุท ููู ุฏุฑ ุงุฎุชูุงูโูุง ุชุดุฎุต ูโุฏูุฏ:
  ุนู ูุฑ ุจุงุฑ ฺฉู ููุฏุงุฑ ูุชุฑฺฉ ฺฉูุชุฑ ุงุฒ ููุฏุงุฑ ูุจู ุดูุฏุ ฺฉ "ุฑุณุช" ุญุณุงุจ ูโุดูุฏ.

---

## ๐ ูุซุงู ูุงูุน ุฏุฑ ูุงูุชูุฑูฺฏ

๐น ุจุฑุง ูููุฏู ุงูฺฉู ุณุฑูุณ ฺูุฏ ุจุงุฑ ุฑโุงุณุชุงุฑุช ุดุฏู:

```promql
resets(process_start_time_seconds[1h])
```

๐น ุจุฑุง ุดูุงุฑุด ุชุนุฏุงุฏ ุฑุณุช ุฏุฑ ุดูุงุฑูุฏูโ ุฏุฑุฎูุงุณุชโูุง:

```promql
resets(http_requests_total[30m])
```

๐น ุจุฑุง ููุงุณู ุจู ุณุฑูุฑูุง:

```promql
resets(http_requests_total[10m]) > 0
```

โ ุงฺฏุฑ ุฎุฑูุฌ > 0 ุจุงุดุฏุ ุนู ุขู ุณุฑูุฑ ุฏุฑ ฑฐ ุฏูููโ ุงุฎุฑ ุฑุณุช ุดุฏู ุงุณุช.

---

## ๐งฎ ุชุฑฺฉุจ ุจุง labelูุง

ูโุชูุงู ูุซูุงู ุฑุณุชโูุง ูุฑ instance ุฑุง ุจุจู:

```promql
resets(http_requests_total[10m]) by (instance)
```

---

## ๐ ุฎูุงุตู

| ูฺฺฏ          | ุชูุถุญ                                      |
| -------------- | ------------------------------------------ |
| ููุน ุฏุงุฏู ูุฑูุฏ | Counter                                    |
| ุฎุฑูุฌ          | ุนุฏุฏ (ุชุนุฏุงุฏ ุฏูุนุงุช ุฑุณุช)                     |
| ูุนู           | ฺูุฏ ุจุงุฑ ููุฏุงุฑ ุงุฒ ุฒุงุฏ ุจู ฺฉู ุชุบุฑ ฺฉุฑุฏู ุงุณุช |
| ฺฉุงุฑุจุฑุฏ         | ุชุดุฎุต ุฑโุงุณุชุงุฑุช ุง ุฑุณุช ุดุฏู ุดูุงุฑูุฏูโูุง     |
| ููุฏุงุฑ ูุนููู    | ุนุฏุฏ ุตุญุญ โฅ 0                               |

---




### `round()`
โ`round(v instant-vector, to_nearest=1 scalar)`: ููุงุฏุฑ ููููู ุชูุงู ุนูุงุตุฑ ุฏุฑ `v` ุฑุง ุจู ูุฒุฏฺฉโุชุฑู ุนุฏุฏ ุตุญุญ ฺฏุฑุฏ ูโฺฉูุฏ. ุฏุฑ ููุงุฑุฏ ูุณุงู (ties)ุ ุจู ุณูุช ุจุงูุง ฺฏุฑุฏ ูโุดูุฏ. ุขุฑฺฏููุงู ุงุฎุชุงุฑ `to_nearest` ุงูฺฉุงู ูุดุฎุต ฺฉุฑุฏู ูุฒุฏฺฉโุชุฑู ูุถุฑุจ ุฑุง ฺฉู ููุงุฏุฑ ููููู ุจุงุฏ ุจู ุขู ฺฏุฑุฏ ุดููุฏุ ูุฑุงูู ูโฺฉูุฏ. ุงู ูุถุฑุจ ููฺูู ูโุชูุงูุฏ ฺฉ ฺฉุณุฑ ุจุงุดุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `scalar()`
โ`scalar(v instant-vector)`: ุจุง ูุฑุถ ฺฉ ูฺฉุชูุฑ ูุฑูุฏ ฺฉู ููุท ฺฉ ุนูุตุฑ ุจุง ููููู float ุฏุงุฑุฏุ ููุฏุงุฑ ููููู ุขู ููููู float ุฑุง ุจู ุนููุงู ฺฉ ุงุณฺฉุงูุฑ ุจุฑูโฺฏุฑุฏุงูุฏ. ุงฺฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุฏููุงู ฺฉ ุนูุตุฑ ุจุง ููููู float ูุฏุงุดุชู ุจุงุดุฏุ `scalar` ููุฏุงุฑ `NaN` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.


```promql
scalar(vector)
```

---

## ๐ฏ ูุฏู ุชุงุจุน

*  ุงู `scalar()` ููุฏุงุฑ ฺฉ **instant vector** ฺฉู ููุท **ฺฉ ููููู ุฏุงุฑุฏ** ุฑุง ุจู ฺฉ ุนุฏุฏ ุณุงุฏู ุชุจุฏู ูโฺฉูุฏ.
* ุฎุฑูุฌ ููุดู ฺฉ **scalar (ุนุฏุฏ ูุงูุน)** ุงุณุชุ ูู vector ุจุง labelูุง.

> ุจู ุฒุจุงู ุณุงุฏู: ููุช ูโุฎูุงู ููุฏุงุฑ ุนุฏุฏ ูุชุฑฺฉ ุฑุง ุฎุงุฑุฌ ุงุฒ ูุญุท labelูุง ุงุณุชูุงุฏู ฺฉูุ ุงุฒ `scalar()` ุงุณุชูุงุฏู ูโุดูุฏ.

---

## ๐ง ูฺฉุงุช ููู

1. **ููุท ุจุฑุง ฺฉ ููููู ูุนุชุจุฑ**

   * ุงฺฏุฑ vector ุจุด ุงุฒ ฺฉ ููููู ุฏุงุดุชู ุจุงุดุฏ โ **ุฎุทุง ูโุฏูุฏ**.
   * ุงฺฏุฑ vector ุฎุงู ุจุงุดุฏ โ **ุฎุทุง ุง NaN** ุจุงุฒ ูโฺฏุฑุฏุงูุฏ.

2. **ุชุจุฏู ุจู ุนุฏุฏ ุจุฏูู label**

   * ููู labelูุง ุงุฒ ุจู ูโุฑููุฏ ู ููุท ููุฏุงุฑ ุนุฏุฏ ุจุงู ูโูุงูุฏ.

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ `up` ุฏุงุฑู ู ููุท ฺฉ ููููู ุฏุฑ ูุธุฑ ูโฺฏุฑู:

```promql
up{instance="10.0.0.1:9100"}
```

* ุฎุฑูุฌ:

```
{instance="10.0.0.1:9100", job="node"} โ 1
```

ุญุงูุง ุงฺฏุฑ ุจุฎูุงูู ููุท ููุฏุงุฑ ุนุฏุฏ ุฑุง ุจฺฏุฑู:

```promql
scalar(up{instance="10.0.0.1:9100"})
```

๐ค ุฎุฑูุฌ:

```
1
```

> ููู labelูุง ุญุฐู ุดุฏูุฏุ ููุท ุนุฏุฏ ุจุงู ูโูุงูุฏ.

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ุงุณุชูุงุฏู ุฏุฑ ูุญุงุณุจุงุช ุฎุงุฑุฌ ุง alert expressions**

   * ููุช ูโุฎูุงู ุนุฏุฏ ุฑุง ุฏุฑ ฺฉ expression ุณุงุฏู ุง ุฏุฑ ุชุฑฺฉุจ ุจุง math ุงุณุชูุงุฏู ฺฉู:

   ```promql
   scalar(up{job="node"}) * 100
   ```

2. **ุงุฑุณุงู ููุฏุงุฑ ุจู ุณุณุชูโูุง ุฏฺฏุฑ**

   * ุจุนุถ exporterูุง ุง ุงุจุฒุงุฑูุง ููุท ุนุฏุฏ ุณุงุฏู ูโุฎูุงููุฏุ ูู vector ุจุง label.

3. **ููุงุณู ุจุง ุนุฏุฏ ุซุงุจุช**

   * ูุซุงู:

   ```promql
   scalar(node_memory_MemAvailable_bytes{instance="10.0.0.1"}) < 1073741824
   ```

   > ุขุง ุญุงูุธู ุขุฒุงุฏ ฺฉูุชุฑ ุงุฒ ฑ ฺฏฺฏุงุจุงุช ุงุณุชุ

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ vector ุจุด ุงุฒ ฺฉ ููููู ุฏุงุดุชู ุจุงุดุฏ โ **error**
* ุงฺฏุฑ vector ุฎุงู ุจุงุดุฏ โ **error ุง NaN**
* ูุนูููุง ุจุง aggregate ุง filter ุงุณุชูุงุฏู ูโุดูุฏ ุชุง ููุท ฺฉ ููููู ุจุงู ุจูุงูุฏ:

  ```promql
  scalar(max(up{job="node"}))
  ```

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ    | ุชูุถุญ                                                 |
| -------- | ----------------------------------------------------- |
| ุชุงุจุน     | `scalar(vector)`                                      |
| ูุฑูุฏ    | instant vector ุจุง **ฺฉ ููููู**                        |
| ุฎุฑูุฌ    | ุนุฏุฏ ุณุงุฏู (scalar)                                     |
| ฺฉุงุฑุจุฑุฏ   | ุงุณุชุฎุฑุงุฌ ููุฏุงุฑ ุนุฏุฏุ ุงุณุชูุงุฏู ุฏุฑ ูุญุงุณุจุงุช ุฑุงุถ ุง alert |
| ูฺฉุชู ููู | ุจุด ุงุฒ ฺฉ ููููู โ ุฎุทุง                                 |








### `sgn()`
โ`sgn(v instant-vector)`: ูฺฉุชูุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุชูุงู ููุงุฏุฑ ููููู float ุขู ุจู ุนูุงูุชุดุงู ุชุจุฏู ุดุฏูโุงูุฏุ ุจู ุงู ุตูุฑุช ุชุนุฑู ูโุดูุฏ: ฑ ุงฺฏุฑ v ูุซุจุช ุจุงุดุฏุ -ฑ ุงฺฏุฑ v ููู ุจุงุดุฏ ู ฐ ุงฺฏุฑ v ูุณุงู ุตูุฑ ุจุงุดุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.


ุญุชูุงู! ๐
ุชุงุจุน **`sgn()`** ุฏุฑ **PromQL** ฺฉ ุงุฒ ุชูุงุจุน ุณุงุฏู ูู ฺฉุงุฑุจุฑุฏ ุงุณุช ฺฉู ุจุฑุง **ุชุจุฏู ููุฏุงุฑ ุนุฏุฏ ฺฉ ูุชุฑฺฉ ุจู ุนูุงูุช ุขู** ุงุณุชูุงุฏู ูโุดูุฏ.
ุจุงุฏ ูุฑุญููโุจูโูุฑุญูู ุจุฑุฑุณ ฺฉูู:

---

## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
sgn(vector)
```

---

## ๐ฏ ูุฏู

* โ`sgn()` ููุฏุงุฑ ูุฑ ููููู ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ ู **ุนูุงูุช ุนุฏุฏ ุฑุง ุจุงุฒูโฺฏุฑุฏุงูุฏ**:

| ููุฏุงุฑ ููููู | ุฎุฑูุฌ `sgn()` |
| ----------- | ------------- |
| > 0         | 1             |
| = 0         | 0             |
| < 0         | -1            |

> ุจู ุฒุจุงู ุณุงุฏู: ุฎุฑูุฌ ููุดู ฺฉ ุงุฒ ุงุนุฏุงุฏ `-1`, `0`, ุง `1` ุงุณุช.

---

## ๐ง ูฺฉุงุช ููู

* ุงู ุชุงุจุน ุฑู **instant vector** ุง **range vector** ูุงุจู ุงุณุชูุงุฏู ุงุณุช.
* โ**Labelูุง ุญูุธ ูโุดููุฏ**ุ ููุท ููุฏุงุฑ ุนุฏุฏ ุชุบุฑ ูโฺฉูุฏ.
* ูุนูููุง ุจุฑุง **ุชุดุฎุต ุฌูุช ุชุบุฑ ุง ูุถุนุช ูุซุจุช/ููู** ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance | value |
| -------- | ----- |
| a        | 5     |
| b        | -3    |
| c        | 0     |

ุงฺฏุฑ ุจููุณู:

```promql
sgn(my_metric)
```

๐ค ุฎุฑูุฌ:

| instance | value |
| -------- | ----- |
| a        | 1     |
| b        | -1    |
| c        | 0     |

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ููุชุฑ ุฏุงุฏูโูุง ุจุง ุนููุงุช ุถุฑุจ ุง ุฌูุน**

   * ูุซูุง ุจุฎูุงู ููู ููุงุฏุฑ ููู ุฑุง ุจู `-1` ู ูุซุจุชโูุง ุจู `1` ุชุจุฏู ฺฉู ุชุง ุฏุฑ alert ุง ูุญุงุณุจุงุช ุจุนุฏ ุงุณุชูุงุฏู ุดูุฏ.

2. **ุชุดุฎุต ุฌูุช ุชุบุฑ ูุชุฑฺฉ**

   * ุงฺฏุฑ ูุฑุฎ ุชุบุฑ (`rate` ุง `delta`) ุฏุงุดุชู ุจุงุดูุ ูโุชูุงูู ุฌูุช ุงูุฒุงุด ุง ฺฉุงูุด ุฑุง ุจุง `sgn()` ุจูููู:

```promql
sgn(rate(cpu_usage_total[1m]))
```

> ุฎุฑูุฌ: 1 โ ุงูุฒุงุดุ -1 โ ฺฉุงูุดุ 0 โ ุจุฏูู ุชุบุฑ

3. **ูุญุงุณุจุงุช ุดุฑุท**

   * ูโุชูุงู ุงุฒ ุขู ุฏุฑ ุชุฑฺฉุจ ุจุง ุถุฑุจ ุง ุฌูุน ุจุฑุง ูุฒูโุฏู ุจู ููุงุฏุฑ ุงุณุชูุงุฏู ฺฉุฑุฏ.

---

## โ๏ธ ูฺฉุงุช ููู

* ุฎุฑูุฌ ููุท `-1`, `0`, `1` ุงุณุช.
*  ุงู Labelูุง ุญุฐู ููโุดููุฏ.
* ฺฉุงุฑุจุฑุฏ ุงุตู ุจุฑุง **ุชุดุฎุต ุฌูุช ุชุบุฑ ุง ูุถุนุช ูุซุจุช/ููู** ุงุณุช.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ     | ุชูุถุญ                                               |
| --------- | --------------------------------------------------- |
| ุชุงุจุน      | `sgn(vector)`                                       |
| ูุฑูุฏ     | instant ุง range vector                             |
| ุฎุฑูุฌ     | -1ุ 0 ุง 1                                          |
| ฺฉุงุฑุจุฑุฏ    | ุชุดุฎุต ุฌูุช ุชุบุฑุ ููุชุฑ ุง ูุฒูโุฏู ุจุฑ ุงุณุงุณ ุนูุงูุช ุนุฏุฏ |
| ุญูุธ label | ุจูู                                                 |

---


















### `sort()`
โ`sort(v โinstant-vector)`: ุนูุงุตุฑ ูฺฉุชูุฑ ุฑุง ุจุฑ ุงุณุงุณ ููุงุฏุฑ ููููู float ุขููุงุ ุจู ุชุฑุชุจ ุตุนูุฏ ูุฑุชุจ ฺฉุฑุฏู ู ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `sort` ููุท ุจุฑ ูุชุงุฌ ฺฉูุฆุฑโูุง ูุญุธูโุง ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏุ ุฒุฑุง ูุชุงุฌ ฺฉูุฆุฑ ุจุงุฒูโุง ููุดู ุชุฑุชุจ ุฎุฑูุฌ ุซุงุจุช ุฏุงุฑูุฏ.




ุชุงุจุน **`sort()`** ุฏุฑ **PromQL** ฺฉ ุงุฒ ุชูุงุจุน ูพุฑฺฉุงุฑุจุฑุฏ ุจุฑุง **ูุฑุชุจโุณุงุฒ ูุชุงุฌ** ุจุฑ ุงุณุงุณ ููุฏุงุฑ metric ุงุณุช.
ุจุงุฏ ูุฏูโุจูโูุฏู ุจุฑุฑุณ ฺฉูู:

---

## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
sort(vector)
```

---

## ๐ฏ ูุฏู

* โ`sort()` **ุชูุงู ูููููโูุง ฺฉ vector ุฑุง ุจุฑ ุงุณุงุณ ููุฏุงุฑ ุนุฏุฏโุดุงู ุจู ุชุฑุชุจ ุตุนูุฏ ูุฑุชุจ ูโฺฉูุฏ**.
* โLabelูุง ุญูุธ ูโุดููุฏุ ููุท ุชุฑุชุจ ุฑุฏูโูุง ุชุบุฑ ูโฺฉูุฏ.

> ุจู ุฒุจุงู ุณุงุฏู: ุฎุฑูุฌ ููุงู vector ุงุณุช ุงูุง ุงุฒ ฺฉูุชุฑู ููุฏุงุฑ ุจู ุจุดุชุฑู ููุฏุงุฑ ูุฑุชุจ ุดุฏู.

---

## ๐ง ูฺฉุงุช ููู

* ููุท **instant vector** ุง **range vector** ูุฑูุฏ ูโฺฏุฑุฏ.
* โ**Labelูุง ุญูุธ ูโุดููุฏ**.
* ุจุฑุง ูุฑุชุจโุณุงุฒ ูุฒููุ ุจุงุฏ ุงุฒ ุชุฑฺฉุจ `sort_desc()` ุงุณุชูุงุฏู ฺฉุฑุฏ.

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance | value |
| -------- | ----- |
| a        | 5     |
| b        | 3     |
| c        | 8     |

ุงฺฏุฑ ุจููุณู:

```promql
sort(my_metric)
```

๐ค ุฎุฑูุฌ:

| instance | value |
| -------- | ----- |
| b        | 3     |
| a        | 5     |
| c        | 8     |

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ููุงุด ูุชุงุฌ ูุฑุชุจ ุฏุฑ Grafana**

   * ูุซูุง ูโุฎูุงู ูุณุช nodeูุง ุฑุง ุจุฑ ุงุณุงุณ ฺฉูุชุฑู ุง ุจุดุชุฑู CPU usage ูุฑุชุจ ฺฉู.

```promql
sort(node_cpu_seconds_total)
```

2. **ุงุณุชูุงุฏู ูุจู ุงุฒ ฺฏุฑูุชู top/bottom**

   * ฺฏุงู ูโุฎูุงูู `topk()` ุง `bottomk()` ุจฺฏุฑูุ ูุฑุชุจโุณุงุฒ ูุจู ุง ุจุนุฏ ฺฉูฺฉ ูโฺฉูุฏ.

```promql
bottomk(5, sort(node_memory_Active_bytes))
```

3. **ฺฏุฒุงุฑุดโฺฏุฑ**

   * ููุช ูโุฎูุงู ููุงุจุน ุง ุฏุฑุฎูุงุณุชโูุง ุฑุง ุจุฑ ุงุณุงุณ ฺฉูุชุฑู ููุฏุงุฑ ูพุฏุง ฺฉู.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงฺฏุฑ ุชุนุฏุงุฏ ูููููโูุง ุฒุงุฏ ุจุงุดุฏุ ูุฑุชุจโุณุงุฒ ููฺฉู ุงุณุช ฺฉู ูุฒููโุจุฑ ุดูุฏ.
* ุจุฑุง ูุฑุชุจโุณุงุฒ ูุฒููุ ุงุฒ `sort_desc()` ุงุณุชูุงุฏู ฺฉูุฏ.

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ     | ุชูุถุญ                                                 |
| --------- | ----------------------------------------------------- |
| ุชุงุจุน      | `sort(vector)`                                        |
| ูุฑูุฏ     | instant ุง range vector                               |
| ุฎุฑูุฌ     | ููุงู vector ุจุง ุชุฑุชุจ ุตุนูุฏ ุจุฑ ุงุณุงุณ ููุฏุงุฑ              |
| ฺฉุงุฑุจุฑุฏ    | ูุฑุชุจโุณุงุฒ metricูุง ุจุฑุง ฺฏุฒุงุฑุดุ alert ุง visualization |
| ุญูุธ label | ุจูู                                                   |

---
















### `sort_desc()`
ูุงููุฏ `sort`ุ ุงูุง ุจู ุชุฑุชุจ ูุฒูู ูุฑุชุจ ูโฺฉูุฏ.

### `sort_by_label()`
ุงู ุชุงุจุน ุจุงุฏ ุงุฒ ุทุฑู ููฺฏ ูฺฺฏ `--enable-feature=promql-experimental-functions` ูุนุงู ุดูุฏ.

โ`sort_by_label(v instant-vector, label string, ...)`: ุนูุงุตุฑ ูฺฉุชูุฑ ุฑุง ุจุฑ ุงุณุงุณ ููุงุฏุฑ ูุจูโูุง ุฏุงุฏู ุดุฏู ุจู ุชุฑุชุจ ุตุนูุฏ ูุฑุชุจ ฺฉุฑุฏู ู ุจุฑูโฺฏุฑุฏุงูุฏ. ุฏุฑ ุตูุฑุช ฺฉู ุงู ููุงุฏุฑ ูุจู ูุณุงู ุจุงุดูุฏุ ุนูุงุตุฑ ุจุฑ ุงุณุงุณ ูุฌููุนู ฺฉุงูู ูุจูโูุงุดุงู ูุฑุชุจ ูโุดููุฏ. `sort_by_label` ุจุฑ ุฑู ูููููโูุง float ู ูุณุชูฺฏุฑุงู ุจู ฺฉ ุดฺฉู ุนูู ูโฺฉูุฏ.

ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `sort_by_label` ููุท ุจุฑ ูุชุงุฌ ฺฉูุฆุฑโูุง ูุญุธูโุง ุชุฃุซุฑ ูโฺฏุฐุงุฑุฏุ ุฒุฑุง ูุชุงุฌ ฺฉูุฆุฑ ุจุงุฒูโุง ููุดู ุชุฑุชุจ ุฎุฑูุฌ ุซุงุจุช ุฏุงุฑูุฏ.

โ`sort_by_label` ุงุฒ ุชุฑุชุจ ูุฑุชุจโุณุงุฒ ุทุจุน (natural sort order) ุงุณุชูุงุฏู ูโฺฉูุฏ.



---

```promql
sort_by_label(vector, label_name)
```

* `vector` โ instant vector ุง range vector ูุฑูุฏ
* `label_name` โ ูุงู label ฺฉู ูโุฎูุงูู ุจุฑ ุงุณุงุณ ุขู ูุฑุชุจโุณุงุฒ ุงูุฌุงู ุดูุฏ

---

## ๐ฏ ูุฏู

* ูุฑุชุจโุณุงุฒ ูููููโูุง **ุจุฑ ุงุณุงุณ ููุฏุงุฑ ฺฉ label ูุดุฎุต**
* ูู ููุฏุงุฑ ุนุฏุฏ metric
* ุชุฑุชุจ ุตุนูุฏ lexicographical (ุญุฑูู) ุงุณุช
*  ุงู Labelูุง ุฏฺฏุฑ ู ููุฏุงุฑ metric ุญูุธ ูโุดููุฏ

> ุจู ุฒุจุงู ุณุงุฏู: ูโุฎูุงูู ุฎุฑูุฌ ุจุฑ ุงุณุงุณ ูุงูุ namespace ุง ูุฑ label ุฏฺฏุฑ ูุฑุชุจ ุดูุฏุ ูู ุนุฏุฏ metric.

---

## ๐ง ูฺฉุงุช ููู

* ููุท ุจุฑุง **instant vector** ุง **range vector** ุงุณุชูุงุฏู ูโุดูุฏ
* ุฎุฑูุฌ ููุงู vector ุงุณุช ูู ุชุฑุชุจ ุฑุฏูโูุง ุชุบุฑ ูโฺฉูุฏ
* ุงฺฏุฑ label ูุดุฎุต ุดุฏู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ โ ูููููโูุง ุฏุฑ ุงุจุชุฏุง ูุณุช ูุฑุงุฑ ูโฺฏุฑูุฏ

---

## ๐ ูุซุงู ุณุงุฏู

ูุฑุถ ฺฉู ูุชุฑฺฉ ุฒุฑ ุฏุงุฑู:

| instance | job | value |
| -------- | --- | ----- |
| b        | web | 5     |
| a        | web | 3     |
| c        | web | 8     |

ูโุฎูุงูู ูููููโูุง ุฑุง ุจุฑ ุงุณุงุณ label `instance` ูุฑุชุจ ฺฉูู:

```promql
sort_by_label(my_metric, "instance")
```

๐ค ุฎุฑูุฌ:

| instance | job | value |
| -------- | --- | ----- |
| a        | web | 3     |
| b        | web | 5     |
| c        | web | 8     |

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. **ูุฑุชุจโุณุงุฒ ุฏุฑ Grafana**

   * ููุช ูโุฎูุงู ูููููโูุง ุฑุง ุจุฑ ุงุณุงุณ ูุงู hostุ pod ุง namespace ููุงุด ุฏู.

```promql
sort_by_label(node_cpu_seconds_total, "instance")
```

2. **ุชุฑุชุจ ููุทู ุจุฑุง aggregation ุง comparison**

   * ูุจู ุงุฒ ุงุณุชูุงุฏู ุงุฒ `topk()` ุง `bottomk()`ุ ูุฑุชุจโุณุงุฒ ุจุฑ ุงุณุงุณ label ฺฉูฺฉ ูโฺฉูุฏ ุชุง ูุชุงุฌ ูุงุจูโูพุดโุจู ุจุงุดูุฏ.

3. **ุณุงุฏูโุณุงุฒ ฺฏุฒุงุฑุดโูุง**

   * ูุฑุชุจโุณุงุฒ ุจุฑ ุงุณุงุณ ูุงู ุณุฑูุณุ ุงูพูฺฉุดู ุง ฺฉูุงุณุชุฑ ุจุฑุง ููุงุด ุฏุฑ ุฌุฏูู ุง ุฏุงุดุจูุฑุฏ.

---

## โ๏ธ ูฺฉุงุช ููู

* ุงู ุชุงุจุน **ููุฏุงุฑ metric ุฑุง ุชุบุฑ ููโุฏูุฏ**ุ ููุท ุชุฑุชุจ ูููููโูุง ุฑุง ุชุบุฑ ูโุฏูุฏ
* ูุฑุชุจโุณุงุฒ lexicographic ุงุณุชุ ูู numeric
* ุงฺฏุฑ label ููุฌูุฏ ูุจุงุดุฏ โ ูููููโูุง ุงุจุชุฏุง ูโุขูุฏ

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ              | ุชูุถุญ                                                       |
| ------------------ | ----------------------------------------------------------- |
| ุชุงุจุน               | `sort_by_label(vector, label_name)`                         |
| ูุฑูุฏ              | instant ุง range vector                                     |
| ุฎุฑูุฌ              | ููุงู vector ุจุง ุชุฑุชุจ ุตุนูุฏ ุจุฑ ุงุณุงุณ label ูุดุฎุต               |
| ฺฉุงุฑุจุฑุฏ             | ูุฑุชุจโุณุงุฒ ุจุฑ ุงุณุงุณ ูุงูุ namespaceุ instance ุง ูุฑ label ุฏฺฏุฑ |
| ุชุบุฑ ููุฏุงุฑ metric | ูุฏุงุฑุฏ                                                       |

---











### `sort_by_label_desc()`
ุงู ุชุงุจุน ุจุงุฏ ุงุฒ ุทุฑู ููฺฏ ูฺฺฏ `--enable-feature=promql-experimental-functions` ูุนุงู ุดูุฏ.

ูุงููุฏ `sort_by_label`ุ ุงูุง ุจู ุชุฑุชุจ ูุฒูู ูุฑุชุจ ูโฺฉูุฏ.

### `sqrt()`
โ`sqrt(v instant-vector)`: ุฑุดู ุฏูู ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ุจโุตุฏุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `time()`
โ`time()`: ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงู ุชุงุจุน ุฏุฑ ูุงูุน ุฒูุงู ูุนู ุฑุง ุจุฑููโฺฏุฑุฏุงูุฏุ ุจูฺฉู ุฒูุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ุนุจุงุฑุช ุจุงุฏ ุฏุฑ ุขู ุงุฑุฒุงุจ ุดูุฏ.

### `timestamp()`
โ`timestamp(v instant-vector)`: ูููุฑ ุฒูุงู ูุฑ ฺฉ ุงุฒ ูููููโูุง ูฺฉุชูุฑ ุฏุงุฏู ุดุฏู ุฑุง ุจู ุนููุงู ุชุนุฏุงุฏ ุซุงููโูุง ุงุฒ ุงูู ฺุงููู ฑนทฐ UTC ุจุฑูโฺฏุฑุฏุงูุฏ. ุงู ุชุงุจุน ุจุฑ ุฑู ูููููโูุง float ู ูุณุชูฺฏุฑุงู ุจู ฺฉ ุดฺฉู ุนูู ูโฺฉูุฏ.







ุฏู ุชุงุจุน **`time()`** ู **`timestamp()`** ุฏุฑ PromQL ุจุง ุฒูุงู ูููููโูุง ุณุฑูฺฉุงุฑ ุฏุงุฑูุฏ ูู ฺฉุงุฑุจุฑุฏ ู ุฎุฑูุฌ ูุชูุงูุช ุฏุงุฑูุฏ. ุจุงุฏ ุฏูู ุจุฑุฑุณ ฺฉูู:

---

## 1๏ธโฃ ุชุงุจุน `time()`

### ๐งฉ ุชุนุฑู

```promql
time()
```

### ๐ฏ ูุฏู

* ููุฏุงุฑ **ุฒูุงู ูุนู Prometheus server** ุฑุง ุจุฑ ุญุณุจ **ุซุงูู ุงุฒ Epoch (Unix timestamp)** ุจุฑูโฺฏุฑุฏุงูุฏ.
* ุฎุฑูุฌ **instant vector** ุจุง ฺฉ ููููู ุฏุงุฑุฏ ู **label ูุฏุงุฑุฏ**.

---

### ๐ ูุซุงู

```promql
time()
```

* ุฎุฑูุฌ:

```
1697625600
```

> ุงู ุนุฏุฏ ููุงุงูฺฏุฑ ุชุนุฏุงุฏ ุซุงูู ุงุฒ 1 ฺุงููู 1970 ุชุง ุญุงูุง ุงุณุช.

---

### โก ฺฉุงุฑุจุฑุฏูุง

1. ุชุฑฺฉุจ ุจุง ูุญุงุณุจุงุช ุจุฑุง **ุชุนู ูุฑุฎ ุง ุงุฎุชูุงู ุฒูุงู**:

```promql
time() - node_boot_time_seconds
```

> ูโุชูุงูุฏ ูุดุงู ุฏูุฏ ฺฉู ุณุฑูุฑ ฺูุฏ ุซุงูู ุงุฒ ุจูุช ุดุฏูุด ฺฏุฐุดุชู ุงุณุช.

2. **ูุญุงุณุจู ุณู metricูุง**:

```promql
(time() - timestamp(up)) / 60
```

> ฺูุฏ ุฏููู ุงุฒ ุขุฎุฑู scrape ฺฏุฐุดุชู ุงุณุช.

---

## 2๏ธโฃ ุชุงุจุน `timestamp()`

### ๐งฉ ุชุนุฑู

```promql
timestamp(v instant-vector)
```

### ๐ฏ ูุฏู

* **ุฒูุงู ููููู ูุฑ metric ุฏุฑ Prometheus** ุฑุง ุจุฑ ุญุณุจ ุซุงูู ุงุฒ Epoch ุจุฑูโฺฏุฑุฏุงูุฏ.
* ุฎุฑูุฌ **instant vector** ุจุง ููุงู labelูุง ุงุณุชุ ููุท ููุฏุงุฑ ุนุฏุฏ ุจุฑุงุจุฑ timestamp ููููู ูโุดูุฏ.

---

### ๐ ูุซุงู

ูุฑุถ ฺฉู metric `up` ุฏุงุฑู:

| instance | value |
| -------- | ----- |
| a        | 1     |
| b        | 1     |

```promql
timestamp(up)
```

* ุฎุฑูุฌ ููฺฉู ุงุณุช ูุซู ุฒุฑ ุจุงุดุฏ:

| instance | value      |
| -------- | ---------- |
| a        | 1697625590 |
| b        | 1697625590 |

> ููุฏุงุฑ ูุดุงูโุฏููุฏู **ุฒูุงู scrape ูุชุฑฺฉ** ุงุณุช.

---

### โก ฺฉุงุฑุจุฑุฏูุง

1. **ูุญุงุณุจู ุนูุฑ metric**

```promql
time() - timestamp(up)
```

> ูุดุงู ูโุฏูุฏ ฺฉู ฺูุฏ ุซุงูู ุงุฒ ุขุฎุฑู scrape ฺฏุฐุดุชู ุงุณุช.

2. **ุงุณุชูุงุฏู ุฏุฑ alerting**

* ูโุชูุงู ุชุดุฎุต ุฏุงุฏ ฺฉู metric ุฎู ูุฏู ุดุฏู ู alert ูุนุงู ฺฉุฑุฏ.

---

## ๐งพ ุชูุงูุช ฺฉูุฏ `time()` ู `timestamp()`

| ูฺฺฏ   | `time()`                             | `timestamp(v)`                           |
| ------- | ------------------------------------ | ---------------------------------------- |
| ูุฑูุฏ   | ูุฏุงุฑุฏ                                | ฺฉ instant vector                        |
| ุฎุฑูุฌ   | ุฒูุงู ูุนู Prometheus                 | ุฒูุงู ููููู metric ูุฑูุฏ                  |
| labelูุง | ูุฏุงุฑุฏ                                | โlabelูุง metric ุญูุธ ูโุดููุฏ             |
| ฺฉุงุฑุจุฑุฏ  | ูุญุงุณุจู ุฒูุงู ูุนู ุง ุงุฎุชูุงู ุจุง metric | โโโูุญุงุณุจู ุนูุฑ metric ุง ุจุฑุฑุณ โfreshness |

---













### `vector()`
โ`vector(s scalar)`: ุงุณฺฉุงูุฑ `s` ุฑุง ุจู ฺฉ ููููู float ุชุจุฏู ฺฉุฑุฏู ู ุขู ุฑุง ุจู ุนููุงู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุชฺฉโุนูุตุฑ ุจุฏูู ูุจู ุจุฑูโฺฏุฑุฏุงูุฏ.



ุชุงุจุน **`vector()`** ุฏุฑ PromQL ฺฉ ุงุฒ ุชูุงุจุน ูพุงูโุง ู ุจุณุงุฑ ุณุงุฏู ูู ฺฉุงุฑุจุฑุฏ ุงุณุช.
ุจุงุฏ ูุฏูโุจูโูุฏู ุจุฑุฑุณ ฺฉูู:

---

## ๐งฉ ุชุนุฑู ุชุงุจุน

```promql
vector(scalar)
```

---

## ๐ฏ ูุฏู

* ุชุงุจุน `vector()` ููุฏุงุฑ **ฺฉ scalar ุง ุนุฏุฏ ุซุงุจุช** ุฑุง ุจู **instant vector** ุชุจุฏู ูโฺฉูุฏ.
* ุฎุฑูุฌ ฺฉ **instant vector ุจุง ฺฉ ููููู** ุงุณุช ู **label ูุฏุงุฑุฏ**.

> ุจู ุฒุจุงู ุณุงุฏู: ููุช ูโุฎูุงู ฺฉ ุนุฏุฏ ุซุงุจุช ุฑุง ุฏุฑ PromQL ุจู ุดฺฉู ฺฉ vector ุงุณุชูุงุฏู ฺฉูุ ุงุฒ `vector()` ุงุณุชูุงุฏู ูโุดูุฏ.

---

## ๐ง ูฺฉุงุช ููู

* ูุฑูุฏ: **ุนุฏุฏ ุซุงุจุช ุง scalar**
* ุฎุฑูุฌ: instant vector ุจุง ููุฏุงุฑ ููุงู ุนุฏุฏ
* Labelูุง ูุฌูุฏ ูุฏุงุฑูุฏ (ุงูุง ูโุชูุงู ุจุนุฏุงู ุจุง `label_replace()` ุง `label_join()` ุงุถุงูู ฺฉุฑุฏ)
* ฺฉุงุฑุจุฑุฏ ุงุตู: ุชุฑฺฉุจ ุจุง metricูุง ุง ุงุณุชูุงุฏู ุฏุฑ ูุญุงุณุจุงุช ุฑุงุถ

---

## ๐ ูุซุงู ุณุงุฏู

```promql
vector(10)
```

๐ค ุฎุฑูุฌ:

| value |
| ----- |
| 10    |

> ุนู ููุงู ุนุฏุฏ ฑฐุ ูู ุจู ุดฺฉู instant vector ุงุณุช.

---

### ๐น ูุซุงู ุชุฑฺฉุจ ุจุง metric

ูุฑุถ ฺฉู metric `up` ุฏุงุฑู ู ูโุฎูุงูู ุฏุฑุตุฏ uptime ุฑุง ูุญุงุณุจู ฺฉูู:

```promql
up / vector(1)
```

* ุงูุฌุง `vector(1)` ุนุฏุฏ ฑ ุฑุง ุจู instant vector ุชุจุฏู ูโฺฉูุฏ ุชุง ูุญุงุณุจู ุฑุงุถ ุจุง `up` ุงูฺฉุงูโูพุฐุฑ ุจุงุดุฏ.

---

### ๐น ูุซุงู ุฏุฑ alerting

ูโุฎูุงูู alert ุจุณุงุฒู ฺฉู CPU usage ุงุฒ ทฐูช ุจุดุชุฑ ุดูุฏ:

```promql
node_cpu_usage_seconds_total / vector(1) > 0.7
```

* `vector(1)` ฺฉูฺฉ ูโฺฉูุฏ ฺฉู ููุงุณู ุนุฏุฏ ุจุง metric ุงูุฌุงู ุดูุฏ.

---

## โก ฺฉุงุฑุจุฑุฏูุง ุนูู

1. ุชุจุฏู scalar ุจู vector ุจุฑุง ูุญุงุณุจุงุช
2. ุงุณุชูุงุฏู ุฏุฑ alert ุง expression ฺฉู ูุงุฒ ุจู vector ุฏุงุฑุฏ
3. ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุฑุงุถ ุง rate ู aggregation

---

## ๐งพ ุฎูุงุตู

| ูฺฺฏ   | ุชูุถุญ                                                    |
| ------- | -------------------------------------------------------- |
| ุชุงุจุน    | `vector(scalar)`                                         |
| ูุฑูุฏ   | ุนุฏุฏ ุซุงุจุช ุง scalar                                       |
| ุฎุฑูุฌ   | instant vector ุจุง ููุงู ููุฏุงุฑ                             |
| ฺฉุงุฑุจุฑุฏ  | ุงุณุชูุงุฏู ุนุฏุฏ ุซุงุจุช ุฏุฑ ูุญุงุณุจุงุชุ ุชุฑฺฉุจ ุจุง metric ุง alerting |
| labelูุง | ูุฏุงุฑุฏ ูู ูโุชูุงู ุจุนุฏุงู ุงุถุงูู ฺฉุฑุฏ                        |

---










### `year()`
โ`year(v=vector(time()) instant-vector)`: ุณุงู ุฑุง ุจุฑุง ูุฑ ฺฉ ุงุฒ ุฒูุงูโูุง ุฏุงุฏู ุดุฏู ุฏุฑ UTC ุจุฑูโฺฏุฑุฏุงูุฏ. ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ  ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ.

### `<aggregation>_over_time()`
ุชูุงุจุน ุฒุฑ ุงูฺฉุงู ุชุฌูุน ูุฑ ุณุฑ ุงุฒ ฺฉ ูฺฉุชูุฑ ุจุงุฒูโุง ุฏุงุฏู ุดุฏู ุฏุฑ ุทูู ุฒูุงู ุฑุง ูุฑุงูู ฺฉุฑุฏู ู ฺฉ ูฺฉุชูุฑ ูุญุธูโุง ุจุง ูุชุงุฌ ุชุฌูุน ุจู ุงุฒุง ูุฑ ุณุฑ ุจุฑูโฺฏุฑุฏุงููุฏ:

* โ  `avg_over_time(range-vector)`: ููุฏุงุฑ ูุงูฺฏู ุชูุงู ูููููโูุง float ุง ูุณุชูฺฏุฑุงู ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู (ุฌุฒุฆุงุช ุฒุฑ ุฑุง ุจุจูุฏ).
* โ  `min_over_time(range-vector)`: ุญุฏุงูู ููุฏุงุฑ ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
* โ  `max_over_time(range-vector)`: ุญุฏุงฺฉุซุฑ ููุฏุงุฑ ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
* โ  `sum_over_time(range-vector)`: ูุฌููุน ุชูุงู ูููููโูุง float ุง ูุณุชูฺฏุฑุงู ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู (ุฌุฒุฆุงุช ุฒุฑ ุฑุง ุจุจูุฏ).
* โ  `count_over_time(range-vector)`: ุชุนุฏุงุฏ ุชูุงู ูููููโูุง ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
* โ  `quantile_over_time(scalar, range-vector)`: ฺูุฏฺฉู ฯ-ุงู (ฯ ุจู ฐ ู ฑ) ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
* โ  `stddev_over_time(range-vector)`: ุงูุญุฑุงู ูุนุงุฑ ุฌุงูุนู ุขูุงุฑ ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
* โ  `stdvar_over_time(range-vector)`: ูุงุฑุงูุณ ุฌุงูุนู ุขูุงุฑ ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
*โ   `last_over_time(range-vector)`: ุฌุฏุฏุชุฑู ููููู ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.
*โ   `present_over_time(range-vector)`: ููุฏุงุฑ ฑ ุจุฑุง ูุฑ ุณุฑ ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.

ุงฺฏุฑ ููฺฏ ูฺฺฏ `--enable-feature=promql-experimental-functions` ุชูุธู ุดุฏู ุจุงุดุฏุ ุชูุงุจุน ุงุถุงู ุฒุฑ ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ:
* โ  `mad_over_time(range-vector)`: ุงูุญุฑุงู ูุทูู ูุงูู ุชูุงู ูููููโูุง float ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู.

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชูุงู ููุงุฏุฑ ุฏุฑ ุจุงุฒู ูุดุฎุต ุดุฏู ูุฒู ฺฉุณุงู ุฏุฑ ุชุฌูุน ุฏุงุฑูุฏุ ุญุช ุงฺฏุฑ ููุงุฏุฑ ุจู ุทูุฑ ูุณุงู ุฏุฑ ุทูู ุจุงุฒู ุชูุฒุน ูุดุฏู ุจุงุดูุฏ.

ุงู ุชูุงุจุน ุจุฑ ุฑู ูุณุชูฺฏุฑุงูโูุง ุจู ุฑูุด ุฒุฑ ุนูู ูโฺฉููุฏ:
* โ  `count_over_time`ุ `last_over_time`ุ ู `present_over_time()` ุจุฑ ุฑู ูููููโูุง float ู ูุณุชูฺฏุฑุงู ุจู ฺฉ ุดฺฉู ุนูู ูโฺฉููุฏ.
* โ  `avg_over_time()` ู `sum_over_time()` ุจุฑ ุฑู ูููููโูุง ูุณุชูฺฏุฑุงู ุจู ุฑูุด ุนูู ูโฺฉููุฏ ฺฉู ุจุง ุนููฺฏุฑูุง ุชุฌูุน ูุฑุจูุทู ูุทุงุจูุช ุฏุงุฑุฏ. ุงฺฏุฑ ฺฉ ุณุฑ ุญุงู ุชุฑฺฉุจ ุงุฒ ูููููโูุง float ู ูููููโูุง ูุณุชูฺฏุฑุงู ุฏุฑ ุจุงุฒู ุจุงุดุฏุ ูุชุฌู ูุฑุจูุทู ุจู ุทูุฑ ฺฉุงูู ุงุฒ ูฺฉุชูุฑ ุฎุฑูุฌ ุญุฐู ูโุดูุฏ. ฺูู ุญุฐู ุจุง ฺฉ ุงุฏุฏุงุดุช ุณุทุญ ูุดุฏุงุฑ (warn-level) ูุดุฎุต ูโุดูุฏ.
*   ุชูุงู ุชูุงุจุน ุฏฺฏุฑ ูููููโูุง ูุณุชูฺฏุฑุงู ุฑุง ุจู ุฑูุด ุฒุฑ ูุงุฏุฏู ูโฺฏุฑูุฏ: ุจุงุฒูโูุง ูุฑูุฏ ฺฉู ููุท ุญุงู ูููููโูุง ูุณุชูฺฏุฑุงู ูุณุชูุฏุ ุจโุตุฏุง ุงุฒ ุฎุฑูุฌ ุญุฐู ูโุดููุฏ. ุจุฑุง ุจุงุฒูโูุง ุจุง ุชุฑฺฉุจ ุงุฒ ูููููโูุง ูุณุชูฺฏุฑุงู ู floatุ ููุท ูููููโูุง float ูพุฑุฏุงุฒุด ูโุดููุฏ ู ุญุฐู ูููููโูุง ูุณุชูฺฏุฑุงู ุจุง ฺฉ ุงุฏุฏุงุดุช ุณุทุญ ุงุทูุงุนุงุช (info-level) ูุดุฎุต ูโุดูุฏ.

### ุชูุงุจุน ูุซูุซุงุช
ุชูุงุจุน ูุซูุซุงุช ุจุฑ ุญุณุจ ุฑุงุฏุงู ฺฉุงุฑ ูโฺฉููุฏ. ุขููุง ูููููโูุง ูุณุชูฺฏุฑุงู ุฑุง ุฏุฑ ูฺฉุชูุฑ ูุฑูุฏ ูุงุฏุฏู ูโฺฏุฑูุฏ.

* โ  `acos(v instant-vector)`: ุขุฑฺฉโฺฉุณููุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `acosh(v instant-vector)`: ฺฉุณููุณ ููพุฑุจููฺฉ ูุนฺฉูุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
*โ   `asin(v instant-vector)`: ุขุฑฺฉโุณููุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `asinh(v instant-vector)`: ุณููุณ ููพุฑุจููฺฉ ูุนฺฉูุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
*โ   `atan(v instant-vector)`: ุขุฑฺฉโุชุงูฺุงูุช ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `atanh(v instant-vector)`: ุชุงูฺุงูุช ููพุฑุจููฺฉ ูุนฺฉูุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `cos(v instant-vector)`: ฺฉุณููุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `cosh(v instant-vector)`: ฺฉุณููุณ ููพุฑุจููฺฉ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `sin(v instant-vector)`: ุณููุณ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `sinh(v instant-vector)`: ุณููุณ ููพุฑุจููฺฉ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `tan(v instant-vector)`: ุชุงูฺุงูุช ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).
* โ  `tanh(v instant-vector)`: ุชุงูฺุงูุช ููพุฑุจููฺฉ ุชูุงู ูููููโูุง float ุฏุฑ `v` ุฑุง ูุญุงุณุจู ูโฺฉูุฏ (ููุงุฑุฏ ุฎุงุต).

ููุงุฑุฏ ุฒุฑ ุจุฑุง ุชุจุฏู ุจู ุฏุฑุฌู ู ุฑุงุฏุงู ููุฏ ูุณุชูุฏ:
* โ  `deg(v instant-vector)`: ุฑุงุฏุงู ุฑุง ุจู ุฏุฑุฌู ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ุชุจุฏู ูโฺฉูุฏ.
* โ  `pi()`: ุนุฏุฏ ูพ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
* โ  `rad(v instant-vector)`: ุฏุฑุฌู ุฑุง ุจู ุฑุงุฏุงู ุจุฑุง ุชูุงู ูููููโูุง float ุฏุฑ `v` ุชุจุฏู ูโฺฉูุฏ.