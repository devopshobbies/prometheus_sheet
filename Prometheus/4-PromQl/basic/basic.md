


โ`PromQL` ุฒุจุงู `Query Language` ูุฑุจูุท ุจู `Prometheus` ุงุณุช. ุจุง ุงูฺฉู ุจู QL ุฎุชู ูโุดูุฏุ ูุชูุฌู ุฎูุงูุฏ ุดุฏ ฺฉู ุฒุจุงู ุดุจู `SQL` ูุณุชุ ุฒุฑุง ุฒุจุงูโูุง `SQL` ูุนูููุงู ูุฏุฑุช ุจุงู ฺฉุงู ุจุฑุง ุงูุฌุงู ูุญุงุณุจุงุช ฺฉู ุฑู `time series` (ุณุฑโูุง ุฒูุงู) ุงูุฌุงู ูโุฏูุฏ ุฑุง ูุฏุงุฑูุฏ. `Labels` (ุจุฑฺุณุจโูุง) ุจุฎุด ฺฉูุฏ `PromQL` ูุณุชูุฏ ู ูโุชูุงูุฏ ุงุฒ ุขูโูุง ูู ุชููุง ุจุฑุง ุงูุฌุงู `aggregations` (ุชุฌูุนโูุง) ุฏูุฎูุงูุ ุจูฺฉู ุจุฑุง ูพููุฏ ุฏุงุฏู `metrics` ูุฎุชูู ุจู ฺฉุฏฺฏุฑ ุฌูุช ุงูุฌุงู `arithmetic operations` (ุนููุงุช ุญุณุงุจ) ุฑู ุขูโูุง ุงุณุชูุงุฏู ฺฉูุฏ. ุทู ฺฏุณุชุฑุฏูโุง ุงุฒ ุชูุงุจุน ุงุฒ `prediction` (ูพุดโุจู) ฺฏุฑูุชู ุชุง ุชูุงุจุน `date` (ุชุงุฑุฎ) ู `math functions` (ุฑุงุถ) ุฏุฑ ุฏุณุชุฑุณ ุดูุง ูุณุชูุฏ.

ุงู ุฏุฑุณ ุจู ุดูุง ุฑุง ุจุง ููุงูู ูพุงู `PromQL`ุ ุดุงูู `aggregation` (ุชุฌูุน)ุ `basic types` (ุงููุงุน ูพุงู) ู `HTTP API` ุขุดูุง ูโฺฉูุฏ.

โ`Prometheus` ฺฉ ุฒุจุงู `query` ุชุงุจุน ุจู ูุงู `PromQL` (`Prometheus Query Language`) ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ุจู ฺฉุงุฑุจุฑ ุงุฌุงุฒู ูโุฏูุฏ ุฏุงุฏูโูุง `time series` ุฑุง ุฏุฑ ุฒูุงู ูุงูุน ุงูุชุฎุงุจ ู `aggregate` ฺฉูุฏ.

ููุช ฺฉ ุฏุฑุฎูุงุณุช `query` ุจู `Prometheus` ุงุฑุณุงู ูโฺฉูุฏุ ูโุชูุงูุฏ ฺฉ `instant query` ุจุงุดุฏ ฺฉู ุฏุฑ ฺฉ ููุทู ุฒูุงู ุงุฑุฒุงุจ ูโุดูุฏุ ุง ฺฉ `range query` ุฏุฑ ฺฏุงูโูุง ุจุง ูุงุตูู ูุณุงู ุจู ุฒูุงู ุดุฑูุน ู ูพุงุงู. `PromQL` ุฏููุงู ุจู ููู ุดฺฉู ุฏุฑ ูุฑ ุฏู ุญุงูุช ฺฉุงุฑ ูโฺฉูุฏุ `range query` ูุงููุฏ ฺฉ `instant query` ุงุณุช ฺฉู ฺูุฏู ุจุงุฑ ุฏุฑ `timestamp`ูุง ูุฎุชูู ุงุฌุฑุง ูโุดูุฏ.

ุฏุฑ `UI` `Prometheus`ุ ุชุจ `"Table"` ุจุฑุง `instant queries` ู ุชุจ `"Graph"` ุจุฑุง `range queries` ุงุณุช.

ุจุฑูุงููโูุง ุฏฺฏุฑ ูโุชูุงููุฏ ูุชุฌู ฺฉ `expression` `PromQL` ุฑุง ุงุฒ ุทุฑู `HTTP API` ุฏุฑุงูุช ฺฉููุฏ.

**ูุซุงูโูุง**
ุงู ุณูุฏ ฺฉ ูุฑุฌุน ูพุงู ุฒุจุงู `Prometheus` ุงุณุช. ุจุฑุง ุงุฏฺฏุฑุ ููฺฉู ุงุณุช ุดุฑูุน ุจุง ฺูุฏ ูุซุงู ุขุณุงูโุชุฑ ุจุงุดุฏ.

**ุงููุงุน ุฏุงุฏู ุฒุจุงู `Expression`**
ุฏุฑ ุฒุจุงู `expression` `Prometheus`ุ ฺฉ `expression` ุง `sub-expression` ูโุชูุงูุฏ ุจู ฺฉ ุงุฒ ฺูุงุฑ ููุน ุงุฑุฒุงุจ ุดูุฏ:

*   โ`Instant vector` - ูุฌููุนูโุง ุงุฒ `time series` ุญุงู ฺฉ `sample` ุจุฑุง ูุฑ `time series`ุ ฺฉู ููฺฏ `timestamp` ฺฉุณุงู ุฏุงุฑูุฏ.
*   โ`Range vector` - ูุฌููุนูโุง ุงุฒ `time series` ุญุงู ูุญุฏูุฏูโุง ุงุฒ ููุงุท ุฏุงุฏู ุฏุฑ ุทูู ุฒูุงู ุจุฑุง ูุฑ `time series`.
*   โ`Scalar` - ฺฉ ููุฏุงุฑ ุนุฏุฏ ุณุงุฏู `floating point`.
*   โ`String` - ฺฉ ููุฏุงุฑ `string` ุณุงุฏูุ ุฏุฑ ุญุงู ุญุงุถุฑ ุงุณุชูุงุฏู ููโุดูุฏ.



## Instant Vector

ฺฉ `instant vector selector` ฺฉ `instant vector` ุงุฒ ุฌุฏุฏุชุฑู `samples` ูุจู ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ (`query evaluation time`) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏุ ุนู ูุณุช ุงุฒ ุตูุฑ ุง ฺูุฏ `time series`. ูุฑ ฺฉ ุงุฒ ุงู `time series`ูุง ฺฉ `sample` ุฎูุงููุฏ ุฏุงุดุช ู ฺฉ `sample` ูู ููุฏุงุฑ ู ูู `timestamp` ุฑุง ุฏุฑ ุจุฑ ูโฺฏุฑุฏ. ุฏุฑ ุญุงู ฺฉู `instant vector` ุจุงุฒฺฏุดุช ุชูุณุท ฺฉ `instant vector selector` ุฏุงุฑุง `timestamp` ุฏุงุฏู ุงุตู ุงุณุชุ ูุฑ `instant vector` ุจุงุฒฺฏุดุช ุชูุณุท ุนููุงุช ุง ุชูุงุจุน ุฏฺฏุฑุ `timestamp` ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุฑุง ุจุฑุง ุชูุงู ููุงุฏุฑ ุฎูุฏ ุฎูุงูุฏ ุฏุงุดุช.

ููฺฏุงู ฺฉู ุงุณุชูุงุฏู ูุนู ุญุงูุธู ุฑุง ุฏุฑุฎูุงุณุช ูโฺฉูุฏุ ููโุฎูุงูุฏ `samples` ุงุฒ ฺฉ `instance` ฺฉู ุฑูุฒูุง ูพุด ุฎุงููุด ุดุฏู ุงุณุชุ ุดุงูู ุดูุฏุ ููููู ฺฉู ุจู ุนููุงู `staleness` (ฺฉููฺฏ) ุดูุงุฎุชู ูโุดูุฏ. ุฏุฑ Prometheus 1.x ุงู ฺฉุงุฑ ุจุง ุจุฑฺฏุฑุฏุงูุฏู `time series`ูุง ุงูุฌุงู ูโุดุฏ ฺฉู `sample` ุขูโูุง ุญุฏุงฺฉุซุฑ ต ุฏููู ูุจู ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุจูุฏ. ุงู ุชุง ุญุฏ ุฒุงุฏ ฺฉุงุฑ ูโฺฉุฑุฏ ุงูุง ูุนุงุจ ูุงููุฏ ุดูุงุฑุด ูุถุงุนู ุฏุงุดุช ุงฺฏุฑ ฺฉ `instance` ุจุง `label` `instance` ุฌุฏุฏ ุฏุฑ ุขู ูพูุฌุฑู ต ุฏูููโุง ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ูโุดุฏ.

โPrometheus 2.x ุฑูฺฉุฑุฏ ูพฺุฏูโุชุฑ ุฏุงุฑุฏ. ุงฺฏุฑ ฺฉ `time series` ุงุฒ ฺฉ `scrape` ุจู `scrape` ุจุนุฏ ูุงูพุฏุฏ ุดูุฏุ ุง ุงฺฏุฑ ฺฉ `target` ุฏฺฏุฑ ุงุฒ `service discovery` ุจุงุฒฺฏุฑุฏุงูุฏู ูุดูุฏุ ููุน ุฎุงุต ุงุฒ `sample` ุจู ูุงู `stale marker`ยนโฐ (ูุดุงูฺฏุฑ ฺฉููู) ุจู `time series` ุงุถุงูู ูโุดูุฏ. ููฺฏุงู ุงุฑุฒุงุจ ฺฉ `instant vector selector`ุ ุงุจุชุฏุง ุชูุงู `time series`ูุง ฺฉู ุชูุงู `matchers` ุฑุง ุจุฑุขูุฑุฏู ูโฺฉููุฏ ูพุฏุง ูโุดููุฏ ู ุฌุฏุฏุชุฑู `sample` ุฏุฑ ต ุฏููู ูุจู ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ููฺูุงู ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ. ุงฺฏุฑ `sample` ฺฉ `sample` ูุนููู ุจุงุดุฏุ ุฏุฑ `instant vector` ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏุ ุงูุง ุงฺฏุฑ ฺฉ `stale marker` ุจุงุดุฏุ ุขู `time series` ุฏุฑ ุขู `instant vector` ฺฏูุฌุงูุฏู ูุฎูุงูุฏ ุดุฏ. ูุชุฌู ููู ุงููุง ุงู ุงุณุช ฺฉู ููุช ุงุฒ `instant vector selector` ุงุณุชูุงุฏู ูโฺฉูุฏุ `time series`ูุง ฺฉู `stale` (ฺฉููู) ุดุฏูโุงูุฏุ ุจุงุฒฺฏุฑุฏุงูุฏู ููโุดููุฏ.

ุงฺฏุฑ `exporter` ุง ุฏุงุฑุฏ ฺฉู `timestamps` ุฑุง ููุงุด ูโุฏูุฏุ ููุงูุทูุฑ ฺฉู ุฏุฑ "Timestamps" ุฏุฑ ูุจู ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุชุ `stale markers` ู ููุทู `staleness` Prometheus 2.x ุงุนูุงู ูุฎูุงูุฏ ุดุฏ. `time series`ูุง ุชุญุช ุชุฃุซุฑ ุจู ุฌุง ุขู ุจุง ููุทู ูุฏูโุชุฑ ฺฉู ต ุฏููู ุจู ุนูุจ ูฺฏุงู ูโฺฉูุฏุ ฺฉุงุฑ ุฎูุงููุฏ ฺฉุฑุฏ.


```json
curl 'http://localhost:9090/api/v1/query' \
  --data 'query=http_requests_total{code="200"}' \
  --data time=1608481001
{
  "metric": {"__name__": "http_requests_total", "code": "200"},
  "value": [1608481001, "881"]
}
```

![[instantVec2.png]]



![[instantVector.png]]





### Range Vector

ููุน ุฏูู `selector` ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุจูุงู ุฏุฏูโุงุฏ ู `range vector selector` ูุงูุฏู ูโุดูุฏ. ุจุฑุฎูุงู `instant vector selector` ฺฉู ฺฉ `sample` ุจุฑุง ูุฑ `time series` ุจุฑูโฺฏุฑุฏุงูุฏุ ฺฉ `range vector selector` ูโุชูุงูุฏ ฺูุฏู `sample` ุจุฑุง ูุฑ `time series` ุจุฑฺฏุฑุฏุงูุฏ.ยนยน `Range vectors` ููุดู ุจุง ุชุงุจุน `rate` ุงุณุชูุงุฏู ูโุดููุฏุ ุจู ุนููุงู ูุซุงู:

`rate(process_cpu_seconds_total[1m])`

โ`[1m]` `instant vector selector` ุฑุง ุจู `range vector selector` ุชุจุฏู ูโฺฉูุฏ ู ุจู `PromQL` ุฏุณุชูุฑ ูโุฏูุฏ ุชุง ุจุฑุง ุชูุงู `time series`ูุง ูุทุงุจู ุจุง `selector`ุ ุชูุงู `samples` ูุฑุจูุท ุจู ุฏููู ููุชู ุจู ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุฑุง ุจุฑฺฏุฑุฏุงูุฏ. ุงฺฏุฑ ููุท `process_cpu_seconds_total[1m]` ุฑุง ุฏุฑ ุชุจ `Console` ูุฑูุฑฺฏุฑ `expression` ุงุฌุฑุง ฺฉูุฏุ ฺุฒ ุดุจู ุดฺฉู ุฒุฑ ุฎูุงูุฏ ุฏุฏ.

![[pic13.png]]

ุฏุฑ ุงู ููุฑุฏุ ูุฑ `time series` ุงุชูุงูุงู ุดุด `sample` ุฏุฑ ุฏููู ฺฏุฐุดุชู ุฏุงุฑุฏ. ูุชูุฌู ุฎูุงูุฏ ุดุฏ ฺฉู ุฏุฑ ุญุงู ฺฉู `samples` ุจุฑุง ูุฑ `time series` ุงุชูุงูุงู ุฏููุงู ฑฐ ุซุงูู ุงุฒ ูู ูุงุตูู ุฏุงุฑูุฏ ูุทุงุจู ุจุง ูุงุตูู `scrape` ฺฉู ูพฺฉุฑุจูุฏ ฺฉุฑุฏูโุงุฏุ `timestamps` ุฏู `time series` ุจุง ฺฉุฏฺฏุฑ ููโุชุฑุงุฒ ูุณุชูุฏ. ฺฉ `time series` ฺฉ `sample` ุจุง `timestamp` 1517925155.087 ุฏุงุฑุฏ ู ุฏฺฏุฑ 1517925156.245.



ุงู ุจู ุงู ุฏูู ุงุณุช ฺฉู `range vectors` `timestamps` ูุงูุน `samples` ุฑุง ุญูุธ ูโฺฉููุฏ ู `scrapes` ุจุฑุง `targets` ูุฎุชูู ุจู ููุธูุฑ ุชูุฒุน ุจุงุฑ ุจู ุทูุฑ ูุณุงูโุชุฑุ ุชูุฒุน ูโุดููุฏ. ุฏุฑ ุญุงู ฺฉู ูโุชูุงูุฏ ูุฑฺฉุงูุณ `scrapes` ู ุงุฑุฒุงุจ ููุงูู ุฑุง ฺฉูุชุฑู ฺฉูุฏุ ููโุชูุงูุฏ `phase` ุง `alignment` (ุชุฑุงุฒุจูุฏ) ุขูโูุง ุฑุง ฺฉูุชุฑู ฺฉูุฏ. ุงฺฏุฑ ูุงุตูู `scrape` ฑฐ ุซุงููโุง ู ุตุฏูุง `target` ุฏุงุฑุฏุ ุชูุงู ุขู `target`ูุง ุฏุฑ ููุงุท ูุฎุชูู ุฏุฑ ฺฉ ูพูุฌุฑู ฑฐ ุซุงููโุง ูุนู `scrape` ุฎูุงููุฏ ุดุฏ. ุจู ุนุจุงุฑุช ุฏฺฏุฑุ `time series`ูุง ุดูุง ููฺฏ ุณูโูุง ฺฉู ูุชูุงูุช ุฏุงุฑูุฏ. ุงู ุจู ุทูุฑ ฺฉู ุฏุฑ ุนูู ุจุฑุง ุดูุง ุงููุช ูุฎูุงูุฏ ุฏุงุดุชุ ุงูุง ูโุชูุงูุฏ ููุฌุฑ ุจู `artifacts` (ูุตููุนุงุช) ุดูุฏ ุฒุฑุง ุงุณุงุณุงู ุณุณุชูโูุง ูุงูุชูุฑูฺฏ ูุจุชู ุจุฑ `metrics` ูุงููุฏ `Prometheus` ุชุฎููโูุง (ุจุณุงุฑ ุฎูุจ) ุจู ุฌุง ูพุงุณุฎโูุง ุฏูู ุชููุฏ ูโฺฉููุฏ.

ุดูุง ุจู ูุฏุฑุช ุจู ุทูุฑ ูุณุชูู ุจู `range vectors` ูฺฏุงู ุฎูุงูุฏ ฺฉุฑุฏ. ุงู ููุท ุฒูุงู ูพุด ูโุขุฏ ฺฉู ุจุฑุง `debugging` ูุงุฒ ุจู ุฏุฏู `samples` ุฎุงู ุฏุงุฑุฏ. ุชูุฑุจุงู ููุดู ุงุฒ `range vector` ุจุง ุชุงุจุน ูุงููุฏ `rate` ุง `avg_over_time` ุงุณุชูุงุฏู ุฎูุงูุฏ ฺฉุฑุฏ ฺฉู `range vector` ุฑุง ุจู ุนููุงู ุขุฑฺฏููุงู ูโฺฏุฑุฏ. `Staleness` ู `stale markers` ุชุฃุซุฑ ุจุฑ `range vectors` ูุฏุงุฑูุฏุ ุดูุง ุชูุงู `samples` ูุนููู ุฑุง ุฏุฑ ฺฉ ุจุงุฒู ูุนู ุฏุฑุงูุช ุฎูุงูุฏ ฺฉุฑุฏ. ูุฑ `stale marker` ุฏฺฏุฑ ูุฒ ฺฉู ุฏุฑ ุขู ุจุงุฒู ุจุงุดุฏุ ุชูุณุท `range vector selector` ุจุงุฒฺฏุฑุฏุงูุฏู ููโุดูุฏ.

![[ReangeVec.png]]


![[RangeVector2.png]]



```json
curl 'http://localhost:9090/api/v1/query' \
  --data 'query=http_requests_total{code="200"}[30s]' \
  --data time=1608481001
{
  "metric": {"__name__": "http_requests_total", "code": "200"},
  "values": [
    [1608480978, "863"],
    [1608480986, "874"],
    [1608480094, "881"]
  ]
}
```

ุจุณุชู ุจู ููุฑุฏ ุงุณุชูุงุฏู (ูุซูุงู ููฺฏุงู ุชุฑุณู `graph` ุฏุฑ ููุงุจู ููุงุด ุฎุฑูุฌ ฺฉ `expression`)ุ ููุท ุจุฑุฎ ุงุฒ ุงู ุงููุงุน ุจู ุนููุงู ูุชุฌู ฺฉ `expression` ูุดุฎุต ุดุฏู ุชูุณุท ฺฉุงุฑุจุฑ ูุฌุงุฒ ูุณุชูุฏ. ุจุฑุง `instant queries`ุ ูุฑ ฺฉ ุงุฒ ุงููุงุน ุฏุงุฏู ุจุงูุง ุจู ุนููุงู ุฑุดู `expression` ูุฌุงุฒ ุงุณุช. `Range queries` ููุท ุงุฒ `expression`ูุง ููุน `scalar` ู `instant-vector` ูพุดุชุจุงู ูโฺฉููุฏ.

**ุงุฏุฏุงุดุชโูุง ุฏุฑุจุงุฑู `native histograms` ุชุฌุฑุจ:**

*   ูุนุงู ฺฉุฑุฏู `Ingesting` `native histograms` ุจุงุฏ ุงุฒ ุทุฑู ฺฉ `feature flag` ุงูุฌุงู ุดูุฏ.
*   ููฺฏุงู ฺฉู `native histograms` ุฏุฑ `TSDB` `ingest` ุดุฏูุฏ (ู ุญุช ูพุณ ุงุฒ ุบุฑูุนุงู ฺฉุฑุฏู ุฏูุจุงุฑู `feature flag`)ุ ูู `instant vectors` ู ูู `range vectors` ููฺฉู ุงุณุช ุงฺฉููู ุญุงู `sample`ูุง ุจุงุดูุฏ ฺฉู ุงุนุฏุงุฏ ุณุงุฏู `floating point` (`float samples`) ูุณุชูุฏุ ุจูฺฉู `histograms` ฺฉุงูู (`histogram samples`) ูุณุชูุฏ. ฺฉ `vector` ููฺฉู ุงุณุช ุชุฑฺฉุจ ุงุฒ `float samples` ู `histogram samples` ุฑุง ุดุงูู ุดูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงุตุทูุงุญ ยซ`histogram sample`ยป ุฏุฑ ูุณุชูุฏุงุช `PromQL` ููุดู ุจู ฺฉ `native histogram` ุงุดุงุฑู ุฏุงุฑุฏ. `Classic histograms` ุจู ุชุนุฏุงุฏ `series` ุงุฒ `float samples` ุชูุณู ูโุดููุฏ. ุงุฒ ุฏุฏฺฏุงู `PromQL`ุ ฺุฒ ุจู ูุงู ยซ`classic histogram samples`ยป ูุฌูุฏ ูุฏุงุฑุฏ.
*   ูุงููุฏ `float samples`ุ `histogram samples` ูโุชูุงููุฏ `counters` ุง `gauges` ุจุงุดูุฏ ฺฉู ุจู ุชุฑุชุจ `counter histograms` ุง `gauge histograms` ูุฒ ูุงูุฏู ูโุดููุฏ.
*  โ `Native histograms` ูโุชูุงููุฏ `bucket layout`ูุง ูุฎุชูู ุฏุงุดุชู ุจุงุดูุฏุ ุงูุง ุจู ุทูุฑ ฺฉู ุจุฑุง ุงุนูุงู ุนููุงุช `binary` ู `aggregation` ุฑู ุขููุงุ ูุงุจู ุชุจุฏู ุจู ูุณุฎูโูุง ุณุงุฒฺฏุงุฑ ูุณุชูุฏ. ุงู ุจุฑุง ููู `bucketing schemas` ุตุงุฏู ูุณุช. ุงฺฏุฑ `histograms` ูุงุณุงุฒฺฏุงุฑ ุฏุฑ ฺฉ ุนููุงุช ููุงุฌู ุดููุฏุ ุนูุตุฑ `vector` ุฎุฑูุฌ ูุฑุจูุทู ุงุฒ ูุชุฌู ุญุฐู ุดุฏู ู ุจุง ฺฉ `annotation` ุณุทุญ ูุดุฏุงุฑ (warn-level) ุนูุงูุชโฺฏุฐุงุฑ ูโุดูุฏ. ุฌุฒุฆุงุช ุจุดุชุฑ ุฑุง ูโุชูุงู ุฏุฑ `native histogram specification` ุงูุช.

ุนุจุงุฑุช **Native Histograms** ฺฉ ุงุฒ ูุงุจูุชโูุง ุฌุฏุฏ ุฏุฑ **Prometheus** ุงุณุช ฺฉู ุจุฑุง ุจูุจูุฏ ุนููฺฉุฑุฏ ู ุฏูุช ุฏุฑ ุฐุฎุฑูโุณุงุฒ ู ูพุฑุฏุงุฒุด **ุชูุฒุน ููุงุฏุฑ (distribution of values)** ุจู ฺฉุงุฑ ูโุฑูุฏ.



---

## ๐ฆ Native Histograms ุฏุฑ Prometheus ฺุณุชุ

โ**Native Histograms** ููุน ุฌุฏุฏ ุงุฒ ุฏุงุฏูโูุง ุฏุฑ Prometheus ูุณุชูุฏ ฺฉู ุจุฑุง ุฐุฎุฑูโุณุงุฒ ุชูุฒุน ููุงุฏุฑ ุจูโุตูุฑุช **ูุดุฑุฏู ู ุฏููโุชุฑ** ุทุฑุงุญ ุดุฏูโุงูุฏุ ุจูโูฺู ุจุฑุง ุฏุงุฏูโูุง ูุซู latencyุ duration ุง ุงูุฏุงุฒูโูุง.

ุขูโูุง ุฌุงฺฏุฒู ุง ูฺฉูู ุจุฑุง **classic histograms** (`*_bucket` metrics) ูุณุชูุฏ.

---

## ๐ ุชูุงูุช ุจุง Classic Histograms

### ๐ฏ Classic Histogram (ูุฏู):

* ุงุฒ ูุชุฑฺฉโูุง ูุซู `http_request_duration_seconds_bucket{le="0.5"}` ุงุณุชูุงุฏู ูโฺฉูุฏ.
* ุจุฑุง ูุฑ bucket ฺฉ ูุชุฑฺฉ ุฌุฏุง ุฏุงุฑุฏ.
* ุฏูุช ูพุงูโุชุฑ ู ุญุฌู ุฐุฎุฑูโุณุงุฒ ุจุดุชุฑ.
* ูุญุงุณุจุงุช ุฑู ุขูโูุง ูพฺุฏูโุชุฑ ู ูพุฑูุฒููโุชุฑ ุงุณุช.

### โก Native Histogram:

* ุจู ุตูุฑุช **ฺฉ ูุชุฑฺฉ ูุงุญุฏ** ุฐุฎุฑู ูโุดูุฏ (ูู ฺูุฏ `*_bucket` ุฌุฏุง).
* ุฏูุช ุจุงูุง ุฏุฑ ูุญุฏูุฏู ูุณุน.
* ฺฉุงุฑุขูุฏุชุฑ ุฏุฑ ูุตุฑู ุญุงูุธู ู ูุถุง ุฐุฎุฑูโุณุงุฒ.
* ุงุฒ ูุญุงุธ ุนููฺฉุฑุฏ ุจุฑุง query ุจุณุงุฑ ุณุฑุนโุชุฑ ุงุณุช.

---

## ๐ฌ ฺุทูุฑ ฺฉุงุฑ ูโฺฉูุฏุ

* ุงุฒ **logarithmic bucketing** ุงุณุชูุงุฏู ูโฺฉูุฏุ ุนู ููุงุตู ุจู bucketูุง ุจุณุชู ุจู ููุฏุงุฑ ุชุบุฑ ูโฺฉููุฏ.
* ุจู ุทูุฑ **ูุดุฑุฏูโุดุฏู** ู **ุจุงูุฑ** ุฐุฎุฑู ูโุดูุฏ.
* โPrometheus ุงุฒ ูุณุฎู **v2.40** ุจู ุจุนุฏ ุงุฒ ุขู ูพุดุชุจุงู ูโฺฉูุฏ.

---

## ๐ ููููู ูุชุฑฺฉ:

ุจู ุฌุง ุฏุงุดุชู ฺูุฏ ูุชุฑฺฉ ูุซู:

```
http_request_duration_seconds_bucket{le="0.1"}
http_request_duration_seconds_bucket{le="0.5"}
...
```

ุฏุฑ Native Histogram ูููโ ุงูโูุง ุฏุฑ ฺฉ **ูุชุฑฺฉ compact** ุฐุฎุฑู ูโุดูุฏ ูุซู:

```
http_request_duration_seconds
```

ู ููุน ุขู ุจู ุตูุฑุช `histogram` ุฏุฑ ูุชุงุฏุชุง ุชุนุฑู ูโุดูุฏ.

---

## โ ูุฒุงุง:

| ูฺฺฏ                           | ุชูุถุญ                                                |
| ------------------------------- | ---------------------------------------------------- |
| ๐ฏ ุฏูุช ุจุงูุง                     | ุญุช ุฏุฑ ุจุงุฒูโูุง ุจุณุงุฑ ฺฉูฺฺฉ ุง ุจุฒุฑฺฏ                   |
| ๐ฆ ูุตุฑู ูุถุง ฺฉูุชุฑ               | ฺูู ูุดุฑุฏู ุงุณุช                                        |
| ๐ ฺฉุงุฑุง ุจุงูุง ุฏุฑ Query         | ูุฎุตูุตุงู ุฏุฑ queryูุง ุทููุงู ูุฏุช ุง aggregate          |
| ๐ ููุงุณุจ ุจุฑุง long-term storage | ุจุง TSDBูุง ูุซู Thanos ู Cortex ูู ุณุงุฒฺฏุงุฑุชุฑ ุฎูุงูุฏ ุดุฏ |

---

## ๐ง ูุนุงูโุณุงุฒ:

ุจุฑุง ูุนุงูโุณุงุฒ Native Histograms ุฏุฑ ฺฉ exporter (ูุซูุงู Go client):

```go
prometheus.NewHistogram(prometheus.HistogramOpts{
    Name:                   "http_request_duration_seconds",
    NativeHistogramBucketFactor: 1.1, // ูุนุงูโุณุงุฒ native histogram
})
```

> ุงู ูุงุจูุช ูุนูุงู **opt-in** ุงุณุชุ ุนู ุจุงุฏ ุจูโุตูุฑุช ุฏุณุช ูุนุงู ุดูุฏ.

---




**`Literals`**

ุฏุฑ **PromQL** (ุฒุจุงู ฺฉูุฆุฑโููุณ Prometheus)ุ **String Literals** ุจู ุฑุดุชูโูุง ุงุทูุงู ูโุดูุฏ ฺฉู ุจุฑุง ููุชุฑ ฺฉุฑุฏูุ ููุงุณูุ ุง ููุฏุงุฑุฏู ุจู **label**โูุง ู ุจุฑุฎ ุชูุงุจุน ุงุณุชูุงุฏู ูโุดููุฏ.

---

## ๐ค ุชุนุฑู String Literal ุฏุฑ Prometheus:

โ**String Literal** ุฏุฑ Prometheus ุนู **ฺฉ ููุฏุงุฑ ูุชู ูุญุตูุฑ ุฏุฑ ฺฉูุชุดู (`" "` ุง `' '`)** ฺฉู ุฏุฑ ฺฉูุฆุฑโูุง ุงุณุชูุงุฏู ูโุดูุฏ โ ูุนูููุงู ุจุฑุง **ููุฏุงุฑ ุจุฑฺุณุจโูุง (labels)** ุง ูุฑูุฏ ุจุฑุฎ ุชูุงุจุน.

---

## ๐ ูุซุงูโูุง ุฑุงุฌ:

### 1. **ุฏุฑ ููุชุฑ ฺฉุฑุฏู Labelูุง**

```promql
http_requests_total{job="api-server"}
```

ุฏุฑ ุงูุฌุง `"api-server"` ฺฉ **string literal** ุงุณุช ฺฉู ุจุฑุง ููุชุฑ ฺฉุฑุฏู ููุฏุงุฑ ุจุฑฺุณุจ `job` ุงุณุชูุงุฏู ูโุดูุฏ.

---

### 2. **ุจุง regular expressions (regex)**

```promql
http_requests_total{instance=~"web-[0-9]+"}
```

ุฏุฑ ุงูุฌุง `"web-[0-9]+"` ฺฉ string literal ุจุฑุง ฺฉ **ุนุจุงุฑุช ููุธู (regex)** ุงุณุช.

---

### 3. **ุฏุฑ ุชูุงุจุน ูุซู `label_replace()`**

```promql
label_replace(up, "new_label", "$1", "job", "(.*)")
```

ุฏุฑ ุงู ุชุงุจุนุ `"new_label"`, `"$1"`, `"job"` ู `"(.*)"` ููฺฏ string literal ูุณุชูุฏ.

---

## โ ูฺฉุงุช ููู:

| ูฺฺฏ                                         | ุชูุถุญ                                      |
| --------------------------------------------- | ------------------------------------------ |
| ูุญุตูุฑ ุฏุฑ `" "` ุง `' '`                       | ูุนูููุงู ุงุฒ `" "` ุงุณุชูุงุฏู ูโุดูุฏ            |
| ุงุบูุจ ุฏุฑ ููุชุฑ label ุงุณุชูุงุฏู ูโุดูุฏ            | ุจู ุดฺฉู `label="value"` ุง `label=~"regex"` |
| ุงุณุชูุงุฏู ุฏุฑ ุชูุงุจุน ุฎุงุต                          | ูุซู `label_replace`, `label_join`, ู ...   |
| ููุท ููุน **String** ุฏุฑ labelูุง ูพุดุชุจุงู ูโุดูุฏ | ุนู labelูุง ููุท ุฑุดุชู ูุณุชูุฏ                |

---

## โ ุบูุท ุฑุงุฌ:

```promql
up{job=api-server}   โ ุงุดุชุจุงู: ููุฏุงุฑ ุจุงุฏ ุฏุฑ ฺฉูุชุดู ุจุงุดุฏ
```

โ ุฏุฑุณุช:

```promql
up{job="api-server"}
```

---



**`String literals`**
`โString literals` ุจุง `single quotes`ุ `double quotes` ุง `backticks` ูุดุฎุต ูโุดููุฏ.

โ`PromQL` ุงุฒ ููุงู `escaping rules` ุฒุจุงู `Go` ูพุฑู ูโฺฉูุฏ. ุจุฑุง `string literals` ุฏุฑ `single` ุง `double quotes`ุ ฺฉ `backslash` ฺฉ `escape sequence` ุฑุง ุขุบุงุฒ ูโฺฉูุฏุ ฺฉู ููฺฉู ุงุณุช ุจุง `a`, `b`, `f`, `n`, `r`, `t`, `v` ุง `\` ุฏูุจุงู ุดูุฏ. ฺฉุงุฑุงฺฉุชุฑูุง ุฎุงุต ุฑุง ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ููุงุฏฺฏุฐุงุฑ `octal` (`\nnn`) ุง `hexadecimal` (`\xnn`, `\unnnn` ู `\Unnnnnnnn`) ุงุฑุงุฆู ุฏุงุฏ.

ุจุฑุนฺฉุณุ ฺฉุงุฑุงฺฉุชุฑูุง `escape` ุฏุฑ `string literals` ูุดุฎุต ุดุฏู ุจุง `backticks` ุชุฌุฒู ููโุดููุฏ. ููู ุงุณุช ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุจุฑุฎูุงู `Go`ุ `Prometheus` `newlines` ุฏุงุฎู `backticks` ุฑุง ุญุฐู ููโฺฉูุฏ.

ูุซุงู:

```
"this is a string"
'these are unescaped: \n \\ \t'
`these are not unescaped: \n ' " \t`
```

**`Float literals` ู `time durations`**
ููุงุฏุฑ `Scalar` `float` ุฑุง ูโุชูุงู ุจู ุตูุฑุช ุงุนุฏุงุฏ `integer` ุง `floating-point` `literal` ุฏุฑ ูุงูุจ ุฒุฑ ููุดุช (ูุถุง ุฎุงู ููุท ุจุฑุง ุฎูุงูุง ุจูุชุฑ ฺฏูุฌุงูุฏู ุดุฏู ุงุณุช):

```
[-+]?(
      [0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?
    | 0[xX][0-9a-fA-F]+
    | [nN][aA][nN]
    | [iI][nN][fF]
)
```

ูุซุงูโูุง:

```
23
-2.43
3.4e-9
0x8f
-Inf
NaN
```

ุนูุงูู ุจุฑ ุงูุ `underscores` (_) ุฑุง ูโุชูุงู ุจู ุงุฑูุงู `decimal` ุง `hexadecimal` ุจุฑุง ุจูุจูุฏ ุฎูุงูุง ุงุณุชูุงุฏู ฺฉุฑุฏ.

ูุซุงูโูุง:

```
1_000_000
.123_456_789
0x_53_AB_F3_82
```

โ`Float literals` ููฺูู ุจุฑุง ูุดุฎุต ฺฉุฑุฏู `durations` ุจุฑ ุญุณุจ ุซุงูู ุงุณุชูุงุฏู ูโุดููุฏ. ุจุฑุง ุฑุงุญุชุ ุงุนุฏุงุฏ `integer` `decimal` ููฺฉู ุงุณุช ุจุง `time units` ุฒุฑ ุชุฑฺฉุจ ุดููุฏ:

* โ  `ms` โ milliseconds
* โ  `s` โ seconds โ 1s ุจุฑุงุจุฑ ุงุณุช ุจุง 1000ms
* โ  `m` โ minutes โ 1m ุจุฑุงุจุฑ ุงุณุช ุจุง 60s (ูุงุฏุฏู ฺฏุฑูุชู leap seconds)
* โ  `h` โ hours โ 1h ุจุฑุงุจุฑ ุงุณุช ุจุง 60m
* โ  `d` โ days โ 1d ุจุฑุงุจุฑ ุงุณุช ุจุง 24h (ูุงุฏุฏู ฺฏุฑูุชู daylight saving time)
* โ  `w` โ weeks โ 1w ุจุฑุงุจุฑ ุงุณุช ุจุง 7d
* โ  `y` โ years โ 1y ุจุฑุงุจุฑ ุงุณุช ุจุง 365d (ูุงุฏุฏู ฺฏุฑูุชู leap days)

ุงูุฒูุฏู ูพุณููุฏ ฺฉ ุงุฒ ูุงุญุฏูุง ุจุงูุง ุจู ฺฉ ุนุฏุฏ `integer` `decimal`ุ ููุงุด ูุชูุงูุช ุงุฒ ูุนุงุฏู ุชุนุฏุงุฏ ุซุงูู ุจู ุนููุงู ฺฉ `float literal` ุฎุงู ุงุณุช.

ูุซุงูโูุง:

```
1s # ูุนุงุฏู 1.
2m # ูุนุงุฏู 120.
1ms # ูุนุงุฏู 0.001.
-2h # ูุนุงุฏู -7200.
```

ูุซุงูโูุง ุฒุฑ ฺฉุงุฑ ููโฺฉููุฏ:

```
0xABm # ุนุฏู ุงูฺฉุงู ูพุณููุฏฺฏุฐุงุฑ ุงุนุฏุงุฏ hexadecimal.
1.5h # Time units ุฑุง ููโุชูุงู ุจุง ฺฉ floating point ุชุฑฺฉุจ ฺฉุฑุฏ.
+Infd # ุนุฏู ุงูฺฉุงู ูพุณููุฏฺฏุฐุงุฑ ยฑInf ุง NaN.
```

ฺูุฏู ูุงุญุฏ ุฑุง ูโุชูุงู ุจุง `concatenation` ุงุนุฏุงุฏ ุตุญุญ ูพุณููุฏุฏุงุฑ ุชุฑฺฉุจ ฺฉุฑุฏ. ูุงุญุฏูุง ุจุงุฏ ุงุฒ ุทููุงูโุชุฑู ุจู ฺฉูุชุงูโุชุฑู ูุฑุชุจ ุดููุฏ. ฺฉ ูุงุญุฏ ุฏุงุฏู ุดุฏู ููุท ุจุงุฏ ฺฉ ุจุงุฑ ุฏุฑ ูุฑ `float literal` ุธุงูุฑ ุดูุฏ.

ูุซุงูโูุง:

```
1h30m # ูุนุงุฏู 5400s ู ุจูุงุจุฑุงู 5400.
12h34m56s # ูุนุงุฏู 45296s ู ุจูุงุจุฑุงู 45296.
54s321ms # ูุนุงุฏู 54.321.
```

**`Time series selectors`**
ุงููุง ุจููฺฉโูุง ุณุงุฒูุฏู ุงุตู ูุณุชูุฏ ฺฉู ุจู `PromQL` ุฏุณุชูุฑ ูโุฏููุฏ ฺู ุฏุงุฏูโูุง ุฑุง `fetch` ฺฉูุฏ.

### **`Instant vector selectors`**

ุฏุฑ Prometheus ู ุฒุจุงู ฺฉูุฆุฑ PromQLุ ููููู **Instant Vector Selector** ุจู ฺฉูุฆุฑโูุง ุงุดุงุฑู ุฏุงุฑุฏ ฺฉู **ุณุฑโูุง ุฒูุงู (time series) ุฑุง ุฏุฑ ฺฉ ูุญุธู ูุดุฎุต** ุงูุชุฎุงุจ ูโฺฉููุฏ โ ูุนูููโุชุฑู ู ูพุฑฺฉุงุฑุจุฑุฏุชุฑู ููุน ฺฉูุฆุฑ ุฏุฑ PromQL ุงุณุช.

---

## ๐ข ุชุนุฑู ุณุงุฏู:

**Instant Vector Selector** ุนู:
๐น ยซุงูุชุฎุงุจ ฺฉ ุง ฺูุฏ ุณุฑ ุฒูุงู ุฏุฑ ฺฉ ููุทู ุฒูุงู ุฎุงุต (ูุนูููุงู "ุงูุงู")ยป

---

## โ ูฺฺฏโูุง:

| ูฺฺฏ                     | ุชูุถุญ                                                                      |
| ------------------------- | -------------------------------------------------------------------------- |
| ููุท ฺฉ ููุฏุงุฑ ุฏุฑ ุฒูุงู ูุดุฎุต | ุงุฒ ูุฑ ุณุฑ ุฒูุงูุ ููุฏุงุฑ ูุฑุจูุท ุจู "ุงูุงู" (ุง ฺฉ ุฒูุงู ุฎุงุต) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ     |
| ุจุฏูู ุจุงุฒู ุฒูุงู `[ ]`     | ุงฺฏุฑ ุจุงุฒู ูุซู `[5m]` ูุฏุงุดุชู ุจุงุดูุ ุนู Instant Vector ูุณุช                   |
| ูพุงูโ ุงฺฉุซุฑ ฺฉูุฆุฑโูุง      | ููุงุดโูุง ฺฏุฑุงูุ alertูุง ู ุจุณุงุฑ ุงุฒ ูุญุงุณุจุงุช ุงุฒ Instant Vector ุดุฑูุน ูโุดููุฏ |

---

## ๐ ูุซุงูโูุง:

### 1. ุณุงุฏูโุชุฑู ุญุงูุช:

```promql
up
```

ุงู ฺฉูุฆุฑ ููู ุณุฑโูุง ุฒูุงู ุจุง ูุงู `up` ุฑุง ุฏุฑ ููู ูุญุธู (now) ุงูุชุฎุงุจ ูโฺฉูุฏ.

---

### 2. ุจุง Label Selector:

```promql
node_cpu_seconds_total{mode="idle", instance="server01:9100"}
```

ุงู ฺฉ Instant Vector Selector ุงุณุช ฺฉู ููุท ุณุฑโูุง ุจุง ุงู ุจุฑฺุณุจโูุง ุฑุง ุฏุฑ ูุญุธู ุฌุงุฑ ุงูุชุฎุงุจ ูโฺฉูุฏ.

---

### 3. ุจุง Offset (ุฌุงุจูโุฌุง ุฒูุงู):

```promql
http_requests_total offset 1h
```

ููุฏุงุฑ ูุชุฑฺฉ ุฑุง ุฏุฑ **ุฏููุงู 1 ุณุงุนุช ูุจู** ุจุฑูโฺฏุฑุฏุงูุฏ โ ููฺูุงู ฺฉ Instant Vector ุงุณุชุ ูู ูู ุจุฑุง "ุงูุงู".

---

### 4. ุงุดุชุจุงู ุฑุงุฌ โ Range Vector ูุณุช:

```promql
rate(http_requests_total[5m])   โ ุงู ฺฉ Range Vector ุงุณุชุ ูู Instant
```

---

## ๐ง ุงุฏุขูุฑ:

**ุงฺฏุฑ ฺฉูุฆุฑ ูฺ `[ ]` ูุฏุงุดุชู ุจุงุดุฏ ู ูุชุฑฺฉ ุฑุง ุฏุฑ ูุญุธูโุง ูุดุฎุต (ุงูุงู ุง ุจุง offset) ุจุฎูุงูุฏุ ุขู ุฑุง ฺฉ Instant Vector Selector ูโูุงูู.**


โ`Instant vector selectors` ุงูฺฉุงู ุงูุชุฎุงุจ ูุฌููุนูโุง ุงุฒ `time series` ู ฺฉ ููุฏุงุฑ `sample` ุจุฑุง ูุฑ ฺฉุฏุงู ุฏุฑ ฺฉ `timestamp` ูุนู (ููุทู ุฒูุงู) ุฑุง ูุฑุงูู ูโฺฉููุฏ. ุฏุฑ ุณุงุฏูโุชุฑู ุดฺฉูุ ููุท ฺฉ `metric name` ูุดุฎุต ูโุดูุฏุ ฺฉู ููุฌุฑ ุจู ฺฉ `instant vector` ุญุงู ุนูุงุตุฑ ุจุฑุง ุชูุงู `time series`ูุง ูโุดูุฏ ฺฉู ุงู `metric name` ุฑุง ุฏุงุฑูุฏ.

ููุฏุงุฑ ุจุงุฒฺฏุดุชุ ููุฏุงุฑ ุฌุฏุฏุชุฑู `sample` ุฏุฑ ุง ูุจู ุงุฒ `timestamp` ุงุฑุฒุงุจ `query` (ุฏุฑ ููุฑุฏ `instant query`) ุง ฺฏุงู ูุนู ุฏุฑูู `query` (ุฏุฑ ููุฑุฏ `range query`) ุฎูุงูุฏ ุจูุฏ. `@ modifier` ุงุฌุงุฒู ูโุฏูุฏ `timestamp` ฺฉู ุงูุชุฎุงุจ ูุณุจุช ุจู ุขู ุงูุฌุงู ูโุดูุฏ ุฑุง ุจุงุฒููุณ ฺฉูุฏ. `Time series`ูุง ุชููุง ุฏุฑ ุตูุฑุช ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดููุฏ ฺฉู ุฌุฏุฏุชุฑู `sample` ุขููุง ฺฉูุชุฑ ุงุฒ ุฏูุฑู `lookback period` ูพุด ุจุงุดุฏ.

ุงู ูุซุงู ุชูุงู `time series`ูุง ุฑุง ฺฉู `metric name` `http_requests_total` ุฏุงุฑูุฏ ุงูุชุฎุงุจ ูโฺฉูุฏ ู ุฌุฏุฏุชุฑู `sample` ุฑุง ุจุฑุง ูุฑ ฺฉุฏุงู ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```promql
http_requests_total
```

ุงูฺฉุงู ููุชุฑ ฺฉุฑุฏู ุจุดุชุฑ ุงู `time series`ูุง ุจุง ุงูุฒูุฏู ูุณุช ุงุฒ `label matchers` ุฌุฏุง ุดุฏู ุจุง ฺฉุงูุง ุฏุฑ `curly braces ({})` ูุฌูุฏ ุฏุงุฑุฏ.

ุงู ูุซุงู ููุท ุขู `time series`ูุง ุฑุง ุจุง `metric name` `http_requests_total` ุงูุชุฎุงุจ ูโฺฉูุฏ ฺฉู ููฺูู `label` `job` ุขููุง ุฑู `prometheus` ู `label` `group` ุขููุง ุฑู `canary` ุชูุธู ุดุฏู ุจุงุดุฏ:

```promql
http_requests_total{job="prometheus",group="canary"}
```

ููฺูู ุงูฺฉุงู ุชุทุจู ููู ฺฉ `label value`ุ ุง ุชุทุจู `label values` ุจุง `regular expressions` ูุฌูุฏ ุฏุงุฑุฏ. `label matching operators` ุฒุฑ ูุฌูุฏ ุฏุงุฑูุฏ:

*   `=`: ุงูุชุฎุงุจ `labels` ฺฉู ุฏููุงู ุจุฑุงุจุฑ ุจุง `string` ุงุฑุงุฆู ุดุฏู ูุณุชูุฏ.
*   `!=`: ุงูุชุฎุงุจ `labels` ฺฉู ุจุฑุงุจุฑ ุจุง `string` ุงุฑุงุฆู ุดุฏู ูุณุชูุฏ.
*   `=~`: ุงูุชุฎุงุจ `labels` ฺฉู ุจุง `regex` ุจุง `string` ุงุฑุงุฆู ุดุฏู ูุทุงุจูุช ุฏุงุฑูุฏ.
*   `!~`: ุงูุชุฎุงุจ `labels` ฺฉู ุจุง `regex` ุจุง `string` ุงุฑุงุฆู ุดุฏู ูุทุงุจูุช ูุฏุงุฑูุฏ.

ุชุทุงุจูโูุง `Regex` ฺฉุงููุงู `anchored` ูุณุชูุฏ. ุชุทุงุจู `"env=~"foo` ุจู ุนููุงู `"$env=~"^foo` ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ.

ุจู ุนููุงู ูุซุงูุ ุงู ููุฑุฏ ุชูุงู `time series`ูุง `http_requests_total` ุฑุง ุจุฑุง ูุญุทโูุง `staging`ุ `testing` ู `development` ู `HTTP methods` ุบุฑ ุงุฒ `GET` ุงูุชุฎุงุจ ูโฺฉูุฏ.

```promql
http_requests_total{environment=~"staging|testing|development",method!="GET"}
```

โ`Label matchers` ฺฉู ุจุง `label values` ุฎุงู ูุทุงุจูุช ุฏุงุฑูุฏุ ููฺูู ุชูุงู `time series`ูุง ุฑุง ุงูุชุฎุงุจ ูโฺฉููุฏ ฺฉู `label` ูุดุฎุต ุดุฏู ุฑุง ุงุตูุงู ูุฏุงุฑูุฏ. ุงูฺฉุงู ุฏุงุดุชู ฺูุฏู `matcher` ุจุฑุง ฺฉ `label name` ูุฌูุฏ ุฏุงุฑุฏ.

ุจู ุนููุงู ูุซุงูุ ุจุง ุชูุฌู ุจู `dataset`:

```
http_requests_total
http_requests_total{replica="rep-a"}
http_requests_total{replica="rep-b"}
http_requests_total{environment="development"}
```

`query` `http_requests_total{environment=""}` 
ูุทุงุจูุช ุฏุงุฏู ู ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```
http_requests_total
http_requests_total{replica="rep-a"}
http_requests_total{replica="rep-b"}
```

ู ูุณุชุซู ูโฺฉูุฏ:

```
http_requests_total{environment="development"}
```

ูโุชูุงู ุงุฒ ฺูุฏู `matcher` ุจุฑุง ฺฉ `label name` ุงุณุชูุงุฏู ฺฉุฑุฏุ ููู ุขููุง ุจุงุฏ ุจุฑูุฑุงุฑ ุจุงุดูุฏ ุชุง ูุชุฌูโุง ุจุงุฒฺฏุฑุฏุงูุฏู ุดูุฏ.

`query`:

```promql
http_requests_total{replica!="rep-a",replica=~"rep.*"}
```

ุณูพุณ ูุทุงุจูุช ูโุฏูุฏ:

```
http_requests_total{replica="rep-b"}
```

โ`Vector selectors` ุจุงุฏ ุง ฺฉ ูุงู ูุดุฎุต ฺฉููุฏ ุง ุญุฏุงูู ฺฉ `label matcher` ฺฉู ุจุง `string` ุฎุงู ูุทุงุจูุช ูุฏุงุดุชู ุจุงุดุฏ. `expression` ุฒุฑ ุบุฑูุงููู ุงุณุช:

```promql
{job=~".*"} # Bad!
```

ุฏุฑ ููุงุจูุ ุงู `expression`ูุง ูุนุชุจุฑ ูุณุชูุฏ ุฒุฑุง ูุฑ ุฏู ุฏุงุฑุง ฺฉ `selector` ูุณุชูุฏ ฺฉู ุจุง `label values` ุฎุงู ูุทุงุจูุช ูุฏุงุฑุฏ.

```promql
{job=~".+"}              # Good!
{job=~".*",method="get"} # Good!
```

โ`Label matchers` ุฑุง ูโุชูุงู ุจุง ุชุทุจู ุจุง `label` ุฏุงุฎู `__name__` ุจู `metric names` ูุฒ ุงุนูุงู ฺฉุฑุฏ. ุจู ุนููุงู ูุซุงูุ `expression` `http_requests_total` ูุนุงุฏู `{__name__="http_requests_total"}` ุงุณุช. `Matchers` ุบุฑ ุงุฒ `=` (`!=`, `=~`, `!~`) ูุฒ ููฺฉู ุงุณุช ุงุณุชูุงุฏู ุดููุฏ. `expression` ุฒุฑ ุชูุงู `metrics` ุฑุง ฺฉู ูุงูุดุงู ุจุง `job:` ุดุฑูุน ูโุดูุฏ ุงูุชุฎุงุจ ูโฺฉูุฏ:

```promql
{__name__=~"job:.*"}
```

โ`Metric name` ูุจุงุฏ ฺฉ ุงุฒ `keywords` `bool`, `on`, `ignoring`, `group_left` ู `group_right` ุจุงุดุฏ. `expression` ุฒุฑ ุบุฑูุงููู ุงุณุช:

```promql
on{} # Bad!
```

ฺฉ ุฑุงู ุญู ุจุฑุง ุงู ูุญุฏูุฏุช ุงุณุชูุงุฏู ุงุฒ `label` `__name__` ุงุณุช:

```promql
{__name__="on"} # Good!
```


ุฏุฑ Prometheus ู ุฒุจุงู **PromQL**ุ ุนุจุงุฑุช **Range Vector Selector** ุจุฑุง ุงูุชุฎุงุจ **ูุฌููุนูโุง ุงุฒ ุฏุงุฏูโูุง ุณุฑ ุฒูุงู ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต** ุจู ฺฉุงุฑ ูโุฑูุฏ.

---

## ๐ฆ ุชุนุฑู ุณุงุฏู:

**Range Vector Selector** ุนู:

> ุงูุชุฎุงุจ ุณุฑ ุฒูุงู ุจูโููุฑุงู ุชูุงู ููุฏุงุฑูุง (ูููููโูุง) ุขู ุฏุฑ ฺฉ **ุจุงุฒู ุฒูุงู ูุดุฎุต**ุ ูุซูุงู ุฏุฑ 5 ุฏููู ุง 1 ุณุงุนุช ฺฏุฐุดุชู.

---

## ๐ ุณุงุฎุชุงุฑ ฺฉู:

```
<metric_name>[<duration>]
```

ูุซุงู:

```promql
http_requests_total[5m]
```

ุนู: ุชูุงู ูููููโูุง (samples) ุณุฑ ุฒูุงู `http_requests_total` ุฑุง ุฏุฑ **ต ุฏูููโ ฺฏุฐุดุชู** ุงูุชุฎุงุจ ฺฉู.

---

## โ ูฺฺฏโูุง Range Vector:

| ูฺฺฏ                                  | ุชูุถุญ                                                 |
| -------------------------------------- | ----------------------------------------------------- |
| ุดุงูู ฺูุฏู ููุทู ุฏุงุฏู                   | ุจุฑุฎูุงู Instant Vector ฺฉู ููุท ฑ ููุฏุงุฑ ุฏุฑ ุฒูุงู ุฎุงุต ุฏุงุฑุฏ |
| ุจุงุฒู ุฒูุงู ุตุฑุญ ุฏุงุฑุฏ                   | ูุซูุงู `[1m]`, `[5m]`, `[1h]`, `[30s]`                 |
| ููุท ุจุง ุจุนุถ ุชูุงุจุน ฺฉุงุฑ ูโฺฉูุฏ           | ูุซู `rate()`, `avg_over_time()`, `max_over_time()`    |
| ูพุงูโ ูุญุงุณุจูู ูุฑุฎุ ูุงูฺฏูุ ุฏุฑุตุฏ ู... | ฺูู ุจุฑุง ุชุญูู ุฑููุฏ ุฏุงุฏูโูุง ุงุณุชูุงุฏู ูโุดูุฏ            |

---

## ๐ ูุซุงูโูุง ุฑุงุฌ:

### 1. ููุท ุงูุชุฎุงุจ ุจุงุฒู:

```promql
node_cpu_seconds_total[2m]
```

ุชูุงู ุฏุงุฏูโูุง ุงู ูุชุฑฺฉ ุฏุฑ ฒ ุฏููู ฺฏุฐุดุชู โ ุฎุฑูุฌ ฺฉ **Range Vector** ุงุณุช.

---

### 2. ุงุณุชูุงุฏู ุฏุฑ ุชุงุจุน `rate()`:

```promql
rate(http_requests_total[1m])
```

ูุงูฺฏู ูุฑุฎ ุฑุดุฏ ุงู ูุชุฑฺฉ ุฏุฑ ฑ ุฏููู ฺฏุฐุดุชู ุฑุง ุญุณุงุจ ูโฺฉูุฏ.

---

### 3. ุงุณุชูุงุฏู ุฏุฑ ุชุงุจุน `avg_over_time()`:

```promql
avg_over_time(node_load1[15m])
```

ูุงูฺฏู ุจุงุฑ ุณุณุชู ุฏุฑ ฑต ุฏููู ฺฏุฐุดุชู.

---

## โ๏ธ ุชูุงูุช ุจุง Instant Vector:

| ูฺฺฏ  | Instant Vector       | Range Vector               |
| ------ | -------------------- | -------------------------- |
| ุฒูุงู   | ููุท ฺฉ ูุญุธู          | ฺฉ ุจุงุฒู ุฒูุงู              |
| ููุฏุงุฑ  | ููุท ุขุฎุฑู ููููู      | ฺูุฏู ููููู                |
| ููุงุฏ   | ุจุฏูู `[ ]`           | ุจุง `[duration]`            |
| ฺฉุงุฑุจุฑุฏ | ูุดุงูุฏู ูุถุนุช ูุญุธูโุง | ุชุญูู ุขูุงุฑ ุฑู ุฒูุงู ฺฏุฐุดุชู |

---

## ๐ง ูฺฉุชู:

๐น ุงฺฏุฑ ุฏุฑ PromQL ุฏุฏ ูุชุฑฺฉ ุฏุฑ ฺฉูุงุฑ `[5m]` ุง `[30s]` ุขูุฏูุ ุจุฏูู ูฺ ุชุงุจุนุ ุงูู **Range Vector Selector** ุงุณุช.
๐น ุงูุง ุจุฑุง ุงูฺฉู ูุนูโุฏุงุฑ ุจุดู (ูุซูุงู rate ูุญุงุณุจู ุดู)ุ ูุนูููุงู ุจุงุฏ ุจุง ุชูุงุจุน ุงุณุชูุงุฏู ุจุดู.

---




**`Range Vector Selectors`**
โ`Range vector literals` ูุงููุฏ `instant vector literals` ฺฉุงุฑ ูโฺฉููุฏุ ุจุง ุงู ุชูุงูุช ฺฉู ูุญุฏูุฏูโุง ุงุฒ `samples` ุฑุง ุงุฒ ูุญุธู ูุนู ุจู ุนูุจ ุงูุชุฎุงุจ ูโฺฉููุฏ. ุงุฒ ูุธุฑ ูุญูุ ฺฉ `float literal` ุฏุฑ `square brackets ([])` ุฏุฑ ุงูุชูุง ฺฉ `vector selector` ุงุถุงูู ูโุดูุฏ ุชุง ูุดุฎุต ฺฉูุฏ ููุงุฏุฑ ุจุฑุง ฺูุฏ ุซุงูู ูุจู ุฏุฑ ุฒูุงู ุจุงุฏ ุจุฑุง ูุฑ ุนูุตุฑ `range vector` ูุชุฌู `fetch` ุดููุฏ. ูุนูููุงูุ `float literal` ุงุฒ ุณูุชฺฉุณ ุจุง ฺฉ ุง ฺูุฏ `time units` ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุซูุงู `[5m]`. ูุญุฏูุฏู ฺฉ `interval` ุจุงุฒ ุงุฒ ฺูพ ู ุจุณุชู ุงุฒ ุฑุงุณุช ุงุณุชุ ุนู `samples` ุจุง `timestamps` ููุทุจู ุจุฑ ูุฑุฒ ฺูพ ูุญุฏูุฏู ุงุฒ ุงูุชุฎุงุจ ูุณุชุซู ูโุดููุฏุ ุฏุฑ ุญุงู ฺฉู `samples` ููุทุจู ุจุฑ ูุฑุฒ ุฑุงุณุช ูุญุฏูุฏู ุฏุฑ ุงูุชุฎุงุจ ฺฏูุฌุงูุฏู ูโุดููุฏ.

ุฏุฑ ุงู ูุซุงูุ ูุง ุชูุงู ููุงุฏุฑ ุซุจุช ุดุฏู ฺฉูุชุฑ ุงุฒ 5 ุฏููู ูพุด ุฑุง ุจุฑุง ุชูุงู `time series`ูุง ฺฉู `metric name` `http_requests_total` ู `label` `job` ุขููุง ุฑู `prometheus` ุชูุธู ุดุฏู ุงุณุชุ ุงูุชุฎุงุจ ูโฺฉูู:

```promql
http_requests_total{job="prometheus"}[5m]
```

**`Offset modifier`**
โ`offset modifier` ุงูฺฉุงู ุชุบุฑ `offset` ุฒูุงู ุจุฑุง `instant` ู `range vectors` ูุฌุฒุง ุฏุฑ ฺฉ `query` ุฑุง ูุฑุงูู ูโฺฉูุฏ.

ุจู ุนููุงู ูุซุงูุ `expression` ุฒุฑ ููุฏุงุฑ `http_requests_total` ุฑุง 5 ุฏููู ูุจู ูุณุจุช ุจู ุฒูุงู ุงุฑุฒุงุจ `query` ูุนู ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```promql
http_requests_total offset 5m
```

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `offset modifier` ููุดู ุจุงุฏ ุจูุงูุงุตูู ุจุนุฏ ุงุฒ `selector` ุจุงุฏุ ุนู ุนุจุงุฑุช ุฒุฑ ุตุญุญ ุฎูุงูุฏ ุจูุฏ:

```promql
sum(http_requests_total{method="GET"} offset 5m) // GOOD.
```

ุฏุฑ ุญุงู ฺฉู ุนุจุงุฑุช ุฒุฑ ูุงุฏุฑุณุช ุฎูุงูุฏ ุจูุฏ:

```promql
sum(http_requests_total{method="GET"}) offset 5m // INVALID.
```

ููู ุงูุฑ ุจุฑุง `range vectors` ูุฒ ุตุงุฏู ุงุณุช. ุงู `rate` 5 ุฏูููโุง `http_requests_total` ุฑุง ฺฉ ููุชู ูพุด ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```promql
rate(http_requests_total[5m] offset 1w)
```

ููฺฏุงู `query` ุจุฑุง `samples` ุฏุฑ ฺฏุฐุดุชูุ ฺฉ `offset` ููู ุงูฺฉุงู ููุงุณูโูุง ุฒูุงู ุจู ุฌูู ุฏุฑ ุฒูุงู ุฑุง ูุฑุงูู ูโฺฉูุฏ:

```promql
rate(http_requests_total[5m] offset -1w)
```

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงู ุจู `query` ุงุฌุงุฒู ูโุฏูุฏ ุฌููุชุฑ ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ุฎูุฏ ุฑุง ูฺฏุงู ฺฉูุฏ.

**`@ modifier`**
โ`@ modifier` ุงูฺฉุงู ุชุบุฑ ุฒูุงู ุงุฑุฒุงุจ ุจุฑุง `instant` ู `range vectors` ูุฌุฒุง ุฏุฑ ฺฉ `query` ุฑุง ูุฑุงูู ูโฺฉูุฏ. ุฒูุงู ุงุฑุงุฆู ุดุฏู ุจู `@ modifier` ฺฉ `unix timestamp` ุงุณุช ู ุจุง ฺฉ `float literal` ุชูุตู ูโุดูุฏ.

ุจู ุนููุงู ูุซุงูุ `expression` ุฒุฑ ููุฏุงุฑ `http_requests_total` ุฑุง ุฏุฑ `2021-01-04T07:40:00+00:00` ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```promql
http_requests_total @ 1609746000
```

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `@ modifier` ููุดู ุจุงุฏ ุจูุงูุงุตูู ุจุนุฏ ุงุฒ `selector` ุจุงุฏุ ุนู ุนุจุงุฑุช ุฒุฑ ุตุญุญ ุฎูุงูุฏ ุจูุฏ:

```promql
sum(http_requests_total{method="GET"} @ 1609746000) // GOOD.
```

ุฏุฑ ุญุงู ฺฉู ุนุจุงุฑุช ุฒุฑ ูุงุฏุฑุณุช ุฎูุงูุฏ ุจูุฏ:

```promql
sum(http_requests_total{method="GET"}) @ 1609746000 // INVALID.
```

ููู ุงูุฑ ุจุฑุง `range vectors` ูุฒ ุตุงุฏู ุงุณุช. ุงู `rate` 5 ุฏูููโุง `http_requests_total` ุฑุง ุฏุฑ `2021-01-04T07:40:00+00:00` ุจุงุฒูโฺฏุฑุฏุงูุฏ:

```promql
rate(http_requests_total[5m] @ 1609746000)
```

โ`@ modifier` ุงุฒ ุชูุงู ููุงุดโูุง `numeric literals` ุชูุตู ุดุฏู ุฏุฑ ุจุงูุง ูพุดุชุจุงู ูโฺฉูุฏ. ุงู ุจุง `offset modifier` ฺฉุงุฑ ูโฺฉูุฏ ฺฉู ุฏุฑ ุขู `offset` ูุณุจุช ุจู ุฒูุงู `@ modifier` ุงุนูุงู ูโุดูุฏ. ูุชุงุฌ ุจุฏูู ุชูุฌู ุจู ุชุฑุชุจ `modifier`ูุง ฺฉุณุงู ูุณุชูุฏ.

ุจู ุนููุงู ูุซุงูุ ุงู ุฏู `query` ูุชุฌู ฺฉุณุงู ุชููุฏ ุฎูุงููุฏ ฺฉุฑุฏ:

```promql
# offset after @
http_requests_total @ 1609746000 offset 5m
# offset before @
http_requests_total offset 5m @ 1609746000
```

ุนูุงูู ุจุฑ ุงูุ `start()` ู `end()` ูุฒ ูโุชูุงููุฏ ุจู ุนููุงู ููุงุฏุฑ ูฺู ุจุฑุง `@ modifier` ุงุณุชูุงุฏู ุดููุฏ.

ุจุฑุง ฺฉ `range query`ุ ุขููุง ุจู ุชุฑุชุจ ุจู ุดุฑูุน ู ูพุงุงู `range query` ุชุจุฏู ูโุดููุฏ ู ุจุฑุง ููู ฺฏุงูโูุง ฺฉุณุงู ุจุงู ูโูุงููุฏ.

ุจุฑุง ฺฉ `instant query`ุ `start()` ู `end()` ูุฑ ุฏู ุจู ุฒูุงู ุงุฑุฒุงุจ ุชุจุฏู ูโุดููุฏ.

```promql
http_requests_total @ start()
rate(http_requests_total[5m] @ end())
```

ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู `@ modifier` ุจู `query` ุงุฌุงุฒู ูโุฏูุฏ ุฌููุชุฑ ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ุฎูุฏ ุฑุง ูฺฏุงู ฺฉูุฏ.

**`Subquery`**
โ`Subquery` ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ฺฉ `instant query` ุฑุง ุจุฑุง ฺฉ `range` ู `resolution` ูุนู ุงุฌุฑุง ฺฉูุฏ. ูุชุฌู ฺฉ `subquery` ฺฉ `range vector` ุงุณุช.

ุณูุชฺฉุณ: `<instant_query> '[' <range> ':' [<resolution>] ']' [ @ <float_literal> ] [ offset <float_literal> ]`

โ`<resolution>` ุงุฎุชุงุฑ ุงุณุช. ูพุดโูุฑุถ ูุงุตูู ุงุฑุฒุงุจ ุณุฑุงุณุฑ ุงุณุช.

**`Operators`**
โ`Prometheus` ุงุฒ ุจุณุงุฑ ุงุฒ `binary` ู `aggregation operators` ูพุดุชุจุงู ูโฺฉูุฏ. ุงููุง ุจู ุชูุตู ุฏุฑ ุตูุญู `expression language operators` ุดุฑุญ ุฏุงุฏู ุดุฏูโุงูุฏ.

**`Functions`**
โ`Prometheus` ุงุฒ ฺูุฏู `function` ุจุฑุง ุนููุงุช ุฑู ุฏุงุฏูโูุง ูพุดุชุจุงู ูโฺฉูุฏ. ุงููุง ุจู ุชูุตู ุฏุฑ ุตูุญู `expression language functions` ุดุฑุญ ุฏุงุฏู ุดุฏูโุงูุฏ.

**`Comments`**
โ`PromQL` ุงุฒ `line comments` ฺฉู ุจุง `#` ุดุฑูุน ูโุดููุฏ ูพุดุชุจุงู ูโฺฉูุฏ. ูุซุงู:

```promql
    # This is a comment
```

**`Regular expressions`**
ุชูุงู `regular expressions` ุฏุฑ `Prometheus` ุงุฒ ุณูุชฺฉุณ `RE2` ุงุณุชูุงุฏู ูโฺฉููุฏ.

ุชุทุงุจูโูุง `Regex` ููุดู ฺฉุงููุงู `anchored` ูุณุชูุฏ.

**`Gotchas`**

**`Staleness`**
โ`timestamps` ฺฉู ุฏุฑ ุขููุง ุฏุงุฏูโูุง ุฏุฑ ุทูู ฺฉ `query` ูููููโุจุฑุฏุงุฑ ูโุดููุฏุ ูุณุชูู ุงุฒ ุฏุงุฏูโูุง `time series` ูุงูุน ููุฌูุฏ ุงูุชุฎุงุจ ูโุดููุฏ. ุงู ุนูุฏุชุงู ุจุฑุง ูพุดุชุจุงู ุงุฒ ููุงุฑุฏ ูุงููุฏ `aggregation` (`sum`, `avg` ู ุบุฑู) ุงุณุชุ ุฌุง ฺฉู ฺูุฏู `time series` `aggregate` ุดุฏู ุฏููุงู ุฏุฑ ุฒูุงู ุชุฑุงุฒ ูุณุชูุฏ. ุจู ุฏูู ุงุณุชููุงู ุขููุงุ `Prometheus` ูุงุฒ ุฏุงุฑุฏ ุฏุฑ ุขู `timestamps` ุจุฑุง ูุฑ `time series` ูุฑุจูุทู ููุฏุงุฑ ุฑุง ุชุฎุตุต ุฏูุฏ. ุงู ฺฉุงุฑ ุฑุง ุจุง ฺฏุฑูุชู ุฌุฏุฏุชุฑู `sample` ฺฉู ฺฉูุชุฑ ุงุฒ ุฏูุฑู `lookback period` ูพุด ุงุณุชุ ุงูุฌุงู ูโุฏูุฏ. `lookback period` ุจู ุทูุฑ ูพุดโูุฑุถ 5 ุฏููู ุงุณุชุ ุงูุง ูโุชูุงู ุขู ุฑุง ุจุง ูพุฑฺู `--query.lookback-delta` ุชูุธู ฺฉุฑุฏ.

ุงฺฏุฑ ฺฉ `target scrape` ุง `rule evaluation` ุฏฺฏุฑ `sample` ุฑุง ุจุฑุง ฺฉ `time series` ฺฉู ูุจูุงู ูุฌูุฏ ุฏุงุดุช ุจุฑูฺฏุฑุฏุงูุฏุ ุงู `time series` ุจู ุนููุงู `stale` ุนูุงูุชโฺฏุฐุงุฑ ูโุดูุฏ. ุงฺฏุฑ ฺฉ `target` ุญุฐู ุดูุฏุ `time series`ูุง ูุจูุงู ุจุงุฒุงุจ ุดุฏู ุจู ุฒูุฏ ูพุณ ุงุฒ ุญุฐู ุจู ุนููุงู `stale` ุนูุงูุชโฺฏุฐุงุฑ ูโุดููุฏ.

ุงฺฏุฑ ฺฉ `query` ุฏุฑ ฺฉ `sampling timestamp` ูพุณ ุงุฒ ุงูฺฉู ฺฉ `time series` ุจู ุนููุงู `stale` ุนูุงูุชโฺฏุฐุงุฑ ุดุฏ ุงุฑุฒุงุจ ุดูุฏุ ูฺ ููุฏุงุฑ ุจุฑุง ุขู `time series` ุจุงุฒฺฏุฑุฏุงูุฏู ููโุดูุฏ. ุงฺฏุฑ `sample`ูุง ุฌุฏุฏ ูุชุนุงูุจุงู ุจุฑุง ุขู `time series` `ingest` ุดููุฏุ ุทุจู ุงูุชุธุงุฑ ุจุงุฒฺฏุฑุฏุงูุฏู ุฎูุงููุฏ ุดุฏ.

ฺฉ `time series` ุฒูุงู `stale` ูโุดูุฏ ฺฉู ุฏฺฏุฑ `export` ูุดูุฏุ ุง `target` ุฏฺฏุฑ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ. ฺูู `time series`ูุง ุฏุฑ ุฒูุงู ุขุฎุฑู `sample` ุฌูุนโุขูุฑ ุดุฏู ุฎูุฏ ุงุฒ `graphs` ูุงูพุฏุฏ ูโุดููุฏ ู ูพุณ ุงุฒ ุนูุงูุชโฺฏุฐุงุฑ ุจู ุนููุงู `stale` ุฏุฑ `queries` ุจุงุฒฺฏุฑุฏุงูุฏู ูุฎูุงููุฏ ุดุฏ.

ุจุฑุฎ `exporters` ฺฉู `timestamp`ูุง ุฎูุฏ ุฑุง ุฑู `sample`ูุง ูุฑุงุฑ ูโุฏููุฏุ ุฑูุชุงุฑ ูุชูุงูุช ุฏุงุฑูุฏ: `series`ูุง ฺฉู `export` ุดุฏู ุขููุง ูุชููู ูโุดูุฏุ ุขุฎุฑู ููุฏุงุฑ ุฑุง ุจุฑุง (ุจู ุทูุฑ ูพุดโูุฑุถ) 5 ุฏููู ูุจู ุงุฒ ูุงูพุฏุฏ ุดุฏู ุญูุธ ูโฺฉููุฏ. ุชูุธู `track_timestamps_staleness` ูโุชูุงูุฏ ุงู ุฑุง ุชุบุฑ ุฏูุฏ.

**ุงุฌุชูุงุจ ุงุฒ `queries` ฺฉูุฏ ู `overloads`**
ุงฺฏุฑ ฺฉ `query` ูุงุฒ ุจู ุนููุงุช ุจุฑ ุฑู ููุฏุงุฑ ูุงุจู ุชูุฌู ุงุฒ ุฏุงุฏู ุฏุงุดุชู ุจุงุดุฏุ ุชุฑุณู `graph` ุขู ููฺฉู ุงุณุช ุจุง `timeout` ููุงุฌู ุดูุฏ ุง `server` ุง `browser` ุฑุง `overload` ฺฉูุฏ. ุจูุงุจุฑุงูุ ููฺฏุงู ุณุงุฎุช `queries` ุจุฑ ุฑู ุฏุงุฏูโูุง ูุงุดูุงุฎุชูุ ููุดู ุณุงุฎุช `query` ุฑุง ุฏุฑ ููุง `tabular view` `expression browser` `Prometheus` ุดุฑูุน ฺฉูุฏ ุชุง ุฒูุงู ฺฉู ูุฌููุนู ูุชุงุฌ ูุนููู ุจู ูุธุฑ ุจุฑุณุฏ (ุญุฏุงฺฉุซุฑ ุตุฏูุงุ ูู ูุฒุงุฑุงูุ `time series`). ููุท ุฒูุงู ฺฉู ุฏุงุฏูโูุง ุฎูุฏ ุฑุง ุจู ุงูุฏุงุฒู ฺฉุงู ููุชุฑ ุง `aggregate` ฺฉุฑุฏุฏุ ุจู ุญุงูุช `graph mode` ุจุฑูุฏ. ุงฺฏุฑ `expression` ูููุฒ ุจุฑุง ุชุฑุณู `graph` ุจู ุตูุฑุช `ad-hoc` ุจุด ุงุฒ ุญุฏ ุทูู ูโฺฉุดุฏุ ุขู ุฑุง ุงุฒ ุทุฑู ฺฉ `recording rule` ูพุดโุถุจุท ฺฉูุฏ.

ุงู ุจู ูฺู ุจุฑุง ุฒุจุงู `query` `Prometheus` ูุฑุชุจุท ุงุณุชุ ุฌุง ฺฉู ฺฉ `metric name selector` ุฎุงู ูุงููุฏ `api_http_requests_total` ูโุชูุงูุฏ ุจู ูุฒุงุฑุงู `time series` ุจุง `labels` ูุฎุชูู ฺฏุณุชุฑุด ุงุจุฏ. ููฺููุ ุจู ุฎุงุทุฑ ุฏุงุดุชู ุจุงุดุฏ ฺฉู `expressions` ฺฉู ุจุฑ ุฑู ุจุณุงุฑ ุงุฒ `time series`ูุง `aggregate` ูโุดููุฏุ ุญุช ุงฺฏุฑ ุฎุฑูุฌ ููุท ุชุนุฏุงุฏ ฺฉู `time series` ุจุงุดุฏุ ุฑู `server` ุจุงุฑ ุงุฌุงุฏ ูโฺฉููุฏ. ุงู ุดุจู ุจู ุงู ุงุณุช ฺฉู ฺฺฏููู ุฌูุน ฺฉุฑุฏู ุชูุงู ููุงุฏุฑ ฺฉ ุณุชูู ุฏุฑ ฺฉ `relational database` ฺฉูุฏ ุฎูุงูุฏ ุจูุฏุ ุญุช ุงฺฏุฑ ููุฏุงุฑ ุฎุฑูุฌ ููุท ฺฉ ุนุฏุฏ ุจุงุดุฏ.





โ

### ูุจุงู Aggregation

ุจุงุฏ ุจุง ฺูุฏ ฺฉูุฆุฑ `aggregation` ุณุงุฏู ุดุฑูุน ฺฉูู. ุงู ฺฉูุฆุฑโูุง ุงุญุชูุงูุงู ุจุดุชุฑ ฺฉุงุฑุจุฑุฏูุง ุจุงูููู ุดูุง ุงุฒ `PromQL` ุฑุง ูพูุดุด ูโุฏููุฏ. ุงฺฏุฑฺู `PromQL` ุชุง ุญุฏ ุงูฺฉุงู ูุฏุฑุชููุฏ ุงุณุชุ ุฏุฑ ุจุดุชุฑ ููุงูุน ูุงุฒูุง ุดูุง ูุณุจุชุงู ุณุงุฏู ุฎูุงููุฏ ุจูุฏ.

## Gauge
โ`Gauges` ุชุตูุฑ ูุญุธูโุง (`snapshot`) ุงุฒ ูุถุนุช (`state`) ูุณุชูุฏ ู ูุนูููุงู ููฺฏุงู ุชุฌูุน (`aggregating`) ุขูโูุงุ ูโุฎูุงูุฏ `sum` (ูุฌููุน)ุ `average` (ูุงูฺฏู)ุ `minimum` (ฺฉููู) ุง `maximum` (ุจุดูู) ุขูโูุง ุฑุง ุจฺฏุฑุฏ.

โ`metric` ุจุง ูุงู `node_filesystem_size_bytes` ุงุฒ `Node Exporter` ุฎูุฏ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู ุงูุฏุงุฒู ูุฑ ฺฉ ุงุฒ ูุงูโุณุณุชูโูุง `mount` ุดุฏู ุดูุง ุฑุง ฺฏุฒุงุฑุด ูโุฏูุฏ ู ุฏุงุฑุง `labels` ุจุง ูุงูโูุง `device`ุ `fstype` ู `mountpoint` ุงุณุช. ุดูุง ูโุชูุงูุฏ ุงูุฏุงุฒู ฺฉู ูุงูโุณุณุชู ุฑุง ุฑู ูุฑ ูุงุดู ุจุง ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑ ุฒุฑ ูุญุงุณุจู ฺฉูุฏ:

`sum without(device, fstype, mountpoint)(node_filesystem_size_bytes)`

ุงู ููุฑุฏ ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ ุฒุฑุง `without` ุจู `aggregator` ุชุงุจุน `sum` ูโฺฏูุฏ ฺฉู ููู ฺุฒ ุฑุง ุจุง `labels` ฺฉุณุงู ุฌูุน ฺฉูุฏ ู ุขู ุณู `label` ูุดุฎุต ุดุฏู ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏ. ุจูุงุจุฑุงู ุงฺฏุฑ `time series` ุฒุฑ ุฑุง ุฏุงุดุชุฏ:
```
node_filesystem_free_bytes{device="/dev/sda1",fstype="vfat",
instance="localhost:9100",job="node",mountpoint="/boot/efi"} 70300672
node_filesystem_free_bytes{device="/dev/sda5",fstype="ext4",
instance="localhost:9100",job="node",mountpoint="/"} 30791843840
node_filesystem_free_bytes{device="tmpfs",fstype="tmpfs",
instance="localhost:9100",job="node",mountpoint="/run"} 817094656
node_filesystem_free_bytes{device="tmpfs",fstype="tmpfs",
instance="localhost:9100",job="node",mountpoint="/run/lock"} 5238784
node_filesystem_free_bytes{device="tmpfs",fstype="tmpfs",
instance="localhost:9100",job="node",mountpoint="/run/user/1000"} 826912768
```

ูุชุฌู ุจู ุงู ุตูุฑุช ุฎูุงูุฏ ุจูุฏ:

`{instance="localhost:9100",job="node"} 32511390720`

ูุชูุฌู ุฎูุงูุฏ ุดุฏ ฺฉู `labels` ุจุง ูุงูโูุง `device`ุ `fstype` ู `mountpoint` ุงฺฉููู ุญุฐู ุดุฏูโุงูุฏ. ูุงู `metric` ูุฒ ุฏฺฏุฑ ูุฌูุฏ ูุฏุงุฑุฏุ ุฒุฑุง ุงู ุฏฺฏุฑ `node_filesystem_free_bytes` ูุณุช ฺูู ุนููุงุช ุฑุงุถ ุฑู ุขู ุงูุฌุงู ุดุฏู ุงุณุช. ุงุฒ ุขูุฌุง ฺฉู ุชููุง ฺฉ `Node Exporter` ุชูุณุท `Prometheus` ุฏุฑ ุญุงู `scrape` ุดุฏู ุงุณุชุ ุชููุง ฺฉ ูุชุฌู ูุฌูุฏ ุฏุงุฑุฏุ ุงูุง ุงฺฏุฑ ุชุนุฏุงุฏ ุจุดุชุฑ ุฑุง `scrape` ูโฺฉุฑุฏุฏุ ุจุฑุง ูุฑ ฺฉ ุงุฒ `Node Exporter`ูุง ฺฉ ูุชุฌู ุฏุงุดุชุฏ.

ูโุชูุงูุฏ ฺฉ ูุฏู ูุฑุงุชุฑ ุฑูุชู ู `label` ุจุง ูุงู `instance` ุฑุง ูุฒ ุญุฐู ฺฉูุฏ:

`sum without(device, fstype, mountpoint, instance)(node_filesystem_size_bytes)`

ุงู ููุงูุทูุฑ ฺฉู ุงูุชุธุงุฑ ูโุฑูุฏ `label` ุจุง ูุงู `instance` ุฑุง ุญุฐู ูโฺฉูุฏุ ุงูุง ููุฏุงุฑ ูุงููุฏ ุนุจุงุฑุช ูุจู ุจุงู ูโูุงูุฏ ุฒุฑุง ุชููุง ฺฉ `Node Exporter` ุจุฑุง ุชุฌูุน `metrics` ูุฌูุฏ ุฏุงุฑุฏ:

`{job="node"} 32511390720`

ูโุชูุงูุฏ ุงุฒ ููู ุฑูฺฉุฑุฏ ุจุง ุณุงุฑ `aggregations` ุงุณุชูุงุฏู ฺฉูุฏ. `max` ุจู ุดูุง ุงูุฏุงุฒู ุจุฒุฑฺฏุชุฑู ูุงูโุณุณุชู `mount` ุดุฏู ุฑู ูุฑ ูุงุดู ุฑุง ูโฺฏูุฏ:

`max without(device, fstype, mountpoint)(node_filesystem_size_bytes)`

โ`labels` ุฎุฑูุฌ ุฏููุงู ูุดุงุจู ุฒูุงู ุงุณุช ฺฉู ุจุง ุงุณุชูุงุฏู ุงุฒ `sum` ุชุฌูุน ฺฉุฑุฏุฏ:

`{instance="localhost:9100",job="node"} 30792601600`

ุงู ูุงุจู ูพุดโุจู ุจูุฏู ุฏุฑ ููุฑุฏ ุงูฺฉู ฺฉุฏุงู `labels` ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดููุฏุ ุจุฑุง ุชุทุจู `vector` (`vector matching`) ุจุง `operators` ููู ุงุณุชุ ููุงูุทูุฑ ฺฉู ุฏุฑ ฺฏุฐุดุชู ุจุญุซ ุฎูุงูุฏ ุดุฏ.

ุดูุง ูุญุฏูุฏ ุจู ุชุฌูุน `metrics` ุฏุฑุจุงุฑู ฺฉ ููุน `job` ูุณุชุฏ. ุจู ุนููุงู ูุซุงูุ ุจุฑุง ุงูุชู ูุงูฺฏู ุชุนุฏุงุฏ `file descriptors` ุจุงุฒ ุฏุฑ ุชูุงู `job`ูุง ุฎูุฏุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

`avg without(instance, job)(process_open_fds)`

## Counter
โ`Counters` ุชุนุฏุงุฏ ุง ุงูุฏุงุฒู ุฑูุฏุงุฏูุง ุฑุง ุฑุฏุงุจ ูโฺฉููุฏ ู ููุฏุงุฑ ฺฉู ุจุฑูุงููโูุง ุดูุง ุฏุฑ `/metrics` ุฎูุฏ ููุงุด ูโุฏููุฏุ ููุฏุงุฑ ฺฉู ุงุฒ ุฒูุงู ุดุฑูุน ุขู ุงุณุช. ุงูุง ุงู ููุฏุงุฑ ฺฉู ุจู ุชููุง ฺฉุงุฑุจุฑุฏ ฺูุฏุงู ุจุฑุง ุดูุง ูุฏุงุฑุฏุ ุขูฺู ูุงูุนุงู ูโุฎูุงูุฏ ุจุฏุงูุฏ ุงู ุงุณุช ฺฉู `counter` ุจุง ฺู ุณุฑุนุช ุฏุฑ ุทูู ุฒูุงู ุงูุฒุงุด ูโุงุจุฏ. ุงู ฺฉุงุฑ ูุนูููุงู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชุงุจุน `rate` ุงูุฌุงู ูโุดูุฏุ ุงฺฏุฑฺู ุชูุงุจุน `increase` ู `irate` ูุฒ ุฑู ููุงุฏุฑ `counter` ุนูู ูโฺฉููุฏ.

ุจู ุนููุงู ูุซุงูุ ุจุฑุง ูุญุงุณุจู ููุฏุงุฑ ุชุฑุงูฺฉ ุดุจฺฉู ุฏุฑุงูุช ุดุฏู ุฏุฑ ูุฑ ุซุงููุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

`rate(node_network_receive_bytes_total[5m])`

โ`[5m]` ุจู `rate` ูโฺฏูุฏ ฺฉู ุฏุงุฏูโูุง ต ุฏููู ุฑุง ุงุฑุงุฆู ุฏูุฏุ ุจูุงุจุฑุงู ููุฏุงุฑ ุจุงุฒฺฏุดุช ูุงูฺฏู ุฏุฑ ุทูู ต ุฏููู ฺฏุฐุดุชู ุฎูุงูุฏ ุจูุฏ:

```
{device="lo",instance="localhost:9100",job="node"} 1859.389655172414
{device="wlan0",instance="localhost:9100",job="node"} 1314.5034482758622
```

ููุงุฏุฑ ุฏุฑ ุงูุฌุง ุงุนุฏุงุฏ ุตุญุญ ูุณุชูุฏุ ุฒุฑุง ูพูุฌุฑู ต ุฏูููโุง ฺฉู `rate` ุจู ุขู ูฺฏุงู ูโฺฉูุฏุ ฺฉุงููุงู ุจุง `samples` (ูููููโูุง) ฺฉู `Prometheus` ุฌูุนโุขูุฑ (`scrape`) ฺฉุฑุฏู ุงุณุชุ ููุงููฺฏ ูุณุช. ููุฏุงุฑ ุชุฎูู (`estimation`) ุจุฑุง ูพุฑ ฺฉุฑุฏู ุดฺฉุงูโูุง ุจู ููุงุท ุฏุงุฏูโุง ฺฉู ุฏุงุฑุฏ ู ูุฑุฒูุง ุจุงุฒู ุงุณุชูุงุฏู ูโุดูุฏ.

ุฎุฑูุฌ `rate` ฺฉ `gauge` ุงุณุชุ ุจูุงุจุฑุงู ููุงู `aggregations` ฺฉู ุจุฑุง `gauges` ุงุนูุงู ูโุดููุฏุ ุฏุฑ ุงูุฌุง ูุฒ ฺฉุงุฑุจุฑุฏ ุฏุงุฑูุฏ. `metric` ุจุง ูุงู `node_network_receive_bytes_total` ุฏุงุฑุง `label` ุจุง ูุงู `device` ุงุณุชุ ุจูุงุจุฑุงู ุงฺฏุฑ ุขู ุฑุง ุชุฌูุน ฺฉูุฏ (`aggregate it away`)ุ ฺฉู ุจุงุชโูุง ุฏุฑุงูุช ุดุฏู ุฏุฑ ูุฑ ูุงุดู ุฏุฑ ูุฑ ุซุงูู ุฑุง ุจู ุฏุณุช ุฎูุงูุฏ ุขูุฑุฏ:

`sum without(device)(rate(node_network_receive_bytes_total[5m]))`

ุงุฌุฑุง ุงู ฺฉูุฆุฑ ูุชุฌูโุง ูุงููุฏ ุงู ุจู ุดูุง ูโุฏูุฏ:

`{instance="localhost:9100",job="node"} 3173.8931034482762`

ูโุชูุงูุฏ `time series` ููุฑุฏ ุฏุฑุฎูุงุณุช ุฑุง ููุชุฑ ฺฉูุฏุ ุจูุงุจุฑุงู ูโุชูุงูุฏ ููุท ุจู `eth0` ูฺฏุงู ฺฉูุฏ ู ุณูพุณ ุขู ุฑุง ุฏุฑ ุชูุงู ูุงุดูโูุง ุจุง ุญุฐู `label` ุจุง ูุงู `instance` ุชุฌูุน ฺฉูุฏ:

`sum without(instance)(rate(node_network_receive_bytes_total{device="eth0"}[5m]))`

ููฺฏุงู ฺฉู ุงู ฺฉูุฆุฑ ุฑุง ุงุฌุฑุง ูโฺฉูุฏุ `label` ุจุง ูุงู `instance` ุญุฐู ูโุดูุฏุ ุงูุง `label` ุจุง ูุงู `device` ุจุงู ูโูุงูุฏ ุฒุฑุง ุดูุง ูุฎูุงุณุชุฏ ุญุฐู ุดูุฏ:

`{device="eth0",job="node"} 3173.8931034482762`

ูฺ ุชุฑุชุจ ุง ุณูุณูู ูุฑุงุชุจ (`hierarchy`) ุฏุฑ `labels` ูุฌูุฏ ูุฏุงุฑุฏุ ฺฉู ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุจุง ูุฑ ุชุนุฏุงุฏ `label` ฺฉู ุฏูุณุช ุฏุงุฑุฏ ุชุฌูุน ฺฉูุฏ.


ุฏุฑ Prometheusุ ุชูุงุจุน `rate`ุ `irate` ู `increase` ููฺฏ ุจุฑุง ฺฉุงุฑ ุจุง **counter**ูุง (ููุงุฏุฑ ุชุฌูุน) ุจู ฺฉุงุฑ ูโุฑููุฏุ ูู ุชูุงูุชโูุง ุฏุฑ ูุญูู ูุญุงุณุจู ู ฺฉุงุฑุจุฑุฏ ุขูโูุง ูุฌูุฏ ุฏุงุฑุฏ. ุฏุฑ ุงุฏุงูู ุชูุงูุช ุงู ุชูุงุจุน ุฑุง ุจู ุตูุฑุช ุฎูุงุตู ู ุฏูู ุจุฑุฑุณ ูโฺฉูู:

---

## ๐ 1. `rate()`

* **ุชุนุฑู**: ูุฑุฎ ูุชูุณุท ุชุบุฑ ููุฏุงุฑ ฺฉ counter ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ูุดุฎุต.
* **ูุฑููู**: ```$(ุขุฎุฑ - ุงูู) รท ูุฏุช ุฒูุงู ุจุงุฒู$```
```
rate(http_server_requests_seconds_count{uri!~".*actuator.*"}[40s])  
..  
(valT4-valT1)/(t4-t1)  
..  
//Rate  
(28-12)/(40-10) = 0.533  
..  
// Number of request  
(28-12)/(40-10)/(1/40) = 21,32


```
* **ูฺฺฏโูุง**:

  * ุจุฑุง ุฏุงุฏูโูุง **ูุณุชูุฑ ู ุตุงู** ุงุณุชูุงุฏู ูโุดูุฏ.
  * ูุงูฺฏู ูุฑุฎ ุชุบุฑ ุฏุฑ ฺฉู ุจุงุฒู ุฒูุงู ุฑุง ุญุณุงุจ ูโฺฉูุฏ.
  * **ูพุดููุงุฏ Prometheus** ุจุฑุง ุจุดุชุฑ ููุงุฑุฏ.

**ูุซุงู**:

```promql
rate(http_requests_total[5m])
```

ุนู: ูุฑุฎ ูุงูฺฏู ุฏุฑุฎูุงุณุชโูุง HTTP ุฏุฑ ต ุฏููู ฺฏุฐุดุชู.

![[rate.png]]



![[rate2.png]]


---

## โก 2. `irate()`

* **ุชุนุฑู**: ูุฑุฎ ูุญุธูโุง (ุชูุฑุจุงู ุขุฎุฑู ูุฑุฎ ุชุบุฑ) ุจุฑ ุงุณุงุณ ุฏู ุขุฎุฑู ููููู ุฏุฑ ุจุงุฒู ุฒูุงู.
* **ูฺฺฏโูุง**:

  * **ุณุฑุนโุชุฑู ุชุบุฑุงุช** ุฑุง ูุดุงู ูโุฏูุฏ.
  * ุจุณุงุฑ **ุญุณุงุณ ุจู ููุฒ** ุงุณุช.
  * ุจุฑุง **ูููุฏุงุฑูุง ุฒูุฏู / real-time** ููุงุณุจ ุงุณุช.
  * ุงฺฏุฑ ุฏุงุฏูโูุง sparse ุง ูุงููุธู ุจุงุดูุฏุ ููฺฉู ุงุณุช unreliable ุดูุฏ.

**ูุซุงู**:

```promql
irate(cpu_usage_seconds_total[1m])
```

![[irate.png]]


Applying the formula to all the serie this is the result:

![[irate2.png]]


Joining the points, I get a line with a considerable variation between the points.

![[irate3.png]]


ุนู: ูุฑุฎ ูุญุธูโุง ุงุณุชูุงุฏู ุงุฒ CPU ุจุฑ ุงุณุงุณ ุขุฎุฑู ุฏู ููููู ุฏุฑ ฑ ุฏููู ุงุฎุฑ.

ููุงุณู irate , rate

![[rateVsIrate.png]]

---

## ๐ 3. `increase()`

* **ุชุนุฑู**: ูุฌููุน ุงูุฒุงุด ููุฏุงุฑ ฺฉ counter ุฏุฑ ุทูู ุจุงุฒู ุฒูุงู.
* **ูุฑููู**:` ููุท $ุขุฎุฑ - ุงูู$ (ูู ุชูุณู ุจุฑ ุฒูุงู).`
* **ูฺฺฏโูุง**:

  * ุจุฑุง ูุญุงุณุจู **ุชุนุฏุงุฏ ุงุชูุงูุงุช** ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู ุงุณุชูุงุฏู ูโุดูุฏ.
  * ููุงุณุจ ุจุฑุง ูุญุงุณุจู ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุงุ ุฎุทุงูุงุ bytes ู ุบุฑู.

**ูุซุงู**:

```promql
increase(http_requests_total[1h])
```

ุนู: ุชุนุฏุงุฏ ฺฉู ุฏุฑุฎูุงุณุชโูุง HTTP ฺฉู ุฏุฑ ฺฉ ุณุงุนุช ุงุฎุฑ ุซุจุช ุดุฏูโุงูุฏ.

---

## ๐ ุฌุฏูู ููุงุณู

| ูฺฺฏ                  | `rate()`       | `irate()`              | `increase()`   |
| ---------------------- | -------------- | ---------------------- | -------------- |
| ููุน ุฎุฑูุฌ              | ูุฑุฎ (ุฏุฑ ุซุงูู) | ูุฑุฎ ูุญุธูโุง (ุฏุฑ ุซุงูู) | ูุฌููุน ุงูุฒุงุด   |
| ุญุณุงุณุช ุจู ููุฒ         | ฺฉู             | ุฒุงุฏ                   | ฺฉู             |
| ููุงุณุจ ุจุฑุง ูููุฏุงุฑ ุฒูุฏู | ูู ุฎู        | ุจูู                    | ูู             |
| ููุงุณุจ ุจุฑุง ุดูุงุฑุด ุชุฌูุน | ูู             | ูู                     | ุจูู            |
| ุงุณุชูุงุฏู ุฑุงุฌ           | ุจูู            | ุจูู (ุจุฑุง ูุญุธูโุง)     | ุจูู (ุจุฑุง ุฌูุน) |

---

### โ ฺู ุฒูุงู ุงุฒ ฺฉุฏุงู ุงุณุชูุงุฏู ฺฉููุ

* ๐ธ `rate`: ุจุฑุง ูุดุงูุฏู ูุฑุฎ ุชุบุฑ ฺฉููุงุฎุช ุฏุฑ ุทูู ุฒูุงู (ุงุบูุจ ุจูุชุฑู ุงูุชุฎุงุจ ูพุดโูุฑุถ).
* ๐ธ `irate`: ุจุฑุง ูุดุงูุฏู ููุณุงูุงุช ุณุฑุน ู ูุฑุฎ ูุญุธูโุง (ูููุฏุงุฑ ุฒูุฏู).
* ๐ธ `increase`: ุจุฑุง ูุญุงุณุจู ุชุนุฏุงุฏ ุง ููุฏุงุฑ ุชุฌูุน ุฑุฎุฏุงุฏูุง ุฏุฑ ฺฉ ุจุงุฒู ุฒูุงู.



## Summary

ฺฉ `metric` ุงุฒ ููุน `summary` ูุนูููุงู ุดุงูู `_sum` ู `_count` ู ฺฏุงู ุงููุงุช ฺฉ `time series` ุจุฏูู ูพุณููุฏ ุจุง ฺฉ `label` ุจู ูุงู `quantile` ุงุณุช. `_sum` ู `_count` ูุฑ ุฏู `counter` ูุณุชูุฏ.
โ`Prometheus` ุดูุง ฺฉ `summary` ุจู ูุงู `http_response_size_bytes` ุจุฑุง ููุฏุงุฑ ุฏุงุฏูโุง ฺฉู ุจุฑุฎ ุงุฒ `HTTP APIs` ุขู ุจุงุฒูโฺฏุฑุฏุงููุฏุ ุงุฑุงุฆู ูโุฏูุฏ. `http_response_size_bytes_count` ุชุนุฏุงุฏ ุฏุฑุฎูุงุณุชโูุง ุฑุง ุฑุฏุงุจ ูโฺฉูุฏ ู ุงุฒ ุขูุฌุง ฺฉู ฺฉ `counter` ุงุณุชุ ุจุงุฏ ูุจู ุงุฒ ุชุฌูุน `label` ุจุง ูุงู `handler` ุขูุ ุงุฒ `rate` ุงุณุชูุงุฏู ฺฉูุฏ:

`sum without(handler)(rate(http_response_size_bytes_count[5m]))`

ุงู ุจู ุดูุง ูุฑุฎ ฺฉู ุฏุฑุฎูุงุณุช HTTP ุฏุฑ ุซุงูู ุฑุง ูโุฏูุฏ ู ุงุฒ ุขูุฌุง ฺฉู `Node Exporter` ูุฒ ุงู `metric` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏุ ูุฑ ุฏู `job` ุฑุง ุฏุฑ ูุชุฌู ุฎูุงูุฏ ุฏุฏ:

```
{instance="localhost:9090",job="prometheus"} 0.26868836781609196
{instance="localhost:9100",job="node"} 0.1
```

ุจู ุทูุฑ ูุดุงุจูุ `http_response_size_bytes_sum` ฺฉ `counter` ุจุง ุชุนุฏุงุฏ ุจุงุชโูุง ุงุณุช ฺฉู ูุฑ `handler` ุจุงุฒฺฏุฑุฏุงูุฏู ุงุณุชุ ุจูุงุจุฑุงู ููุงู ุงูฺฏู ุงุนูุงู ูโุดูุฏ:

`sum without(handler)(rate(http_response_size_bytes_sum[5m]))`

ุงู ูุชุงุฌ ุจุง ููุงู `labels` ฺฉูุฆุฑ ูุจู ุจุฑูโฺฏุฑุฏุงูุฏุ ุงูุง ููุงุฏุฑ ุจุฒุฑฺฏุชุฑ ูุณุชูุฏ ุฒุฑุง ูพุงุณุฎโูุง ูุนูููุงู ุจุงุชโูุง ุฒุงุฏ ุฑุง ุจุฑูโฺฏุฑุฏุงููุฏ:

```
{instance="localhost:9090",job="prometheus"} 796.0015958275862
{instance="localhost:9100",job="node"} 1581.6103448275862
```

ูุฏุฑุช ฺฉ `summary` ุฏุฑ ุงู ุงุณุช ฺฉู ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุงูุฏุงุฒู ูุชูุณุท ฺฉ ุฑูุฏุงุฏ ุฑุง ูุญุงุณุจู ฺฉูุฏุ ุฏุฑ ุงู ููุฑุฏุ ูุงูฺฏู ููุฏุงุฑ ุจุงุชโูุง ฺฉู ุฏุฑ ูุฑ ูพุงุณุฎ ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ. ุงฺฏุฑ ุณู ูพุงุณุฎ ุจุง ุงูุฏุงุฒูโูุง ฑุ ด ู ท ุฏุงุดุชุฏุ ูุงูฺฏู ุขูโูุง ูุฌููุน ุชูุณู ุจุฑ ุชุนุฏุงุฏุดุงู ุฎูุงูุฏ ุจูุฏุ ุนู ฑฒ ุชูุณู ุจุฑ ณ. ููู ุงูุฑ ุฏุฑ ููุฑุฏ `summary` ูุฒ ุตุฏู ูโฺฉูุฏ. ุดูุง `_sum` ุฑุง ุจุฑ `_count` (ูพุณ ุงุฒ ุงุนูุงู `rate`) ุชูุณู ูโฺฉูุฏ ุชุง ูุงูฺฏู ุฑุง ุฏุฑ ฺฉ ุฏูุฑู ุฒูุงู ุจู ุฏุณุช ุขูุฑุฏ:

```
sum without(handler)(rate(http_response_size_bytes_sum[5m]))
/
sum without(handler)(rate(http_response_size_bytes_count[5m]))
```

โ`operator` ุชูุณู (`division operator`) `time series` ุจุง `labels` ฺฉุณุงู ุฑุง `matches` (ุชุทุจู ูโุฏูุฏ) ู ุชูุณู ูโฺฉูุฏุ ู ููุงู ุฏู `time series` ุฑุง ุจู ุดูุง ูโุฏูุฏ ุงูุง ุจุง ููุฏุงุฑ ูุงูฺฏู ุงูุฏุงุฒู ูพุงุณุฎ ุฏุฑ ต ุฏููู ฺฏุฐุดุชู:

```
{instance="localhost:9090",job="prometheus"} 2962.54580091246150133317
{instance="localhost:9100",job="node"} 15816.10344827586200000000
```

ููฺฏุงู ูุญุงุณุจู ูุงูฺฏูุ ููู ุงุณุช ฺฉู ุงุจุชุฏุง `sum` ู `count` ุฑุง ุชุฌูุน ฺฉูุฏ ู ุชููุง ุจู ุนููุงู ุขุฎุฑู ูุฑุญููุ ุชูุณู ุฑุง ุงูุฌุงู ุฏูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ููฺฉู ุงุณุช ุจู ูุงูฺฏูโฺฏุฑ ุงุฒ ูุงูฺฏูโูุง ุฎุชู ุดูุฏ ฺฉู ุงุฒ ูุธุฑ ุขูุงุฑ ูุนุชุจุฑ ูุณุช.

ุจู ุนููุงู ูุซุงูุ ุงฺฏุฑ ูโุฎูุงุณุชุฏ ูุงูฺฏู ุงูุฏุงุฒู ูพุงุณุฎ ุฑุง ุฏุฑ ุชูุงู `instances` ฺฉ `job` ุจู ุฏุณุช ุขูุฑุฏุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```
sum without(instance)(
  sum without(handler)(rate(http_response_size_bytes_sum[5m]))
)
/
sum without(instance)(
  sum without(handler)(rate(http_response_size_bytes_count[5m]))
)
```

ุจุง ุงู ุญุงูุ ุงูุฌุงู ุงู ฺฉุงุฑ ูุงุฏุฑุณุช ุฎูุงูุฏ ุจูุฏ:

```
avg without(instance)(
  sum without(handler)(rate(http_response_size_bytes_sum[5m]))
  /
  sum without(handler)(rate(http_response_size_bytes_count[5m]))
)
```

ูุงูฺฏู ฺฏุฑูุชู ุงุฒ ฺฉ ูุงูฺฏู ูุงุฏุฑุณุช ุงุณุช ู ูู ุชูุณู ู ูู `avg` ุฏุฑ ุญุงู ูุญุงุณุจู ูุงูฺฏู ุฎูุงููุฏ ุจูุฏ.

ุงุฒ ุฏุฏฺฏุงู ุขูุงุฑุ ุงูฺฉุงู ุชุฌูุน `quantiles` ฺฉ `summary` (ุนู `time series` ุจุง `label` ุจู ูุงู `quantile`) ูุฌูุฏ ูุฏุงุฑุฏ.

### Histogram

โ`Metrics` ุงุฒ ููุน `Histogram` ุจู ุดูุง ุงูฺฉุงู ูโุฏููุฏ ุชูุฒุน (`distribution`) ุงูุฏุงุฒู ุฑูุฏุงุฏูุง ุฑุง ุฑุฏุงุจ ฺฉูุฏ ู ุจู ุดูุง ุงูฺฉุงู ูุญุงุณุจู `quantiles` ุงุฒ ุขูโูุง ุฑุง ูโุฏููุฏ. ุจู ุนููุงู ูุซุงูุ ูโุชูุงูุฏ ุงุฒ `histograms` ุจุฑุง ูุญุงุณุจู `quantile` ฐ.น (ฺฉู ุจู ุนููุงู `percentile` ููุฏู ูุฒ ุดูุงุฎุชู ูโุดูุฏ) `latency` ุงุณุชูุงุฏู ฺฉูุฏ. Prometheus 2.37.1 ฺฉ `metric` ุงุฒ ููุน `histogram` ุจู ูุงู `prometheus_tsdb_compaction_duration_seconds` ุฑุง ุงุฑุงุฆู ูโุฏูุฏ ฺฉู ูุฏุช ุฒูุงู `compaction` (ูุดุฑุฏูโุณุงุฒ) ูพุงฺฏุงู ุฏุงุฏู `time series` ุฑุง ุจุฑ ุญุณุจ ุซุงูู ุฑุฏุงุจ ูโฺฉูุฏ. ุงู `metric` ุงุฒ ููุน `histogram` ุฏุงุฑุง `time series` ุจุง ูพุณููุฏ `_bucket` ุจู ูุงู `prometheus_tsdb_compaction_duration_seconds_bucket` ุงุณุช. ูุฑ `bucket` ุฏุงุฑุง ฺฉ `label` ุจู ูุงู `le` ุงุณุช ฺฉู ฺฉ `counter` ุงุฒ ุชุนุฏุงุฏ ุฑูุฏุงุฏูุง ุงุณุช ฺฉู ุงูุฏุงุฒูโุง ฺฉูุชุฑ ุง ูุณุงู ูุฑุฒ `bucket` (`bucket boundary`) ุฏุงุฑูุฏ. ุงู ฺฉ ุฌุฒุฆุงุช ูพุงุฏูโุณุงุฒ ุงุณุช ฺฉู ุนูุฏุชุงู ูุงุฒ ุจู ูฺฏุฑุงู ุฏุฑ ููุฑุฏ ุขู ูุฏุงุฑุฏ ุฒุฑุง ุชุงุจุน `histogram_quantile` ููฺฏุงู ูุญุงุณุจู `quantiles` ุงู ููุถูุน ุฑุง ูุฏุฑุช ูโฺฉูุฏ. ุจู ุนููุงู ูุซุงูุ `quantile` ฐ.นฐ ุจู ุตูุฑุช ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```
histogram_quantile(
  0.90,
  rate(prometheus_tsdb_compaction_duration_seconds_bucket[1d])
)
```

ุงุฒ ุขูุฌุง ฺฉู `prometheus_tsdb_compaction_duration_seconds_bucket` ฺฉ `counter` ุงุณุชุ ุงุจุชุฏุง ุจุงุฏ ุงุฒ `rate` ุงุณุชูุงุฏู ฺฉูุฏ. `Compaction` ูุนูููุงู ูุฑ ุฏู ุณุงุนุช ฺฉุจุงุฑ ุงุชูุงู ูโุงูุชุฏุ ุจูุงุจุฑุงู ุงุฒ ฺฉ ุจุงุฒู ุฒูุงู ฺฉ ุฑูุฒู (`[1d]`) ุฏุฑ ุงูุฌุง ุงุณุชูุงุฏู ูโุดูุฏ ู ูุชุฌูโุง ูุงููุฏ ุงู ุฑุง ุฏุฑ ูุฑูุฑฺฏุฑ `expression` (`expression browser`) ุฎูุงูุฏ ุฏุฏ:

`{instance="localhost:9090",job="prometheus"} 7.720000000000001`

ุงู ูุดุงู ูโุฏูุฏ ฺฉู `percentile` ููุฏู `latency` ูุฑุจูุท ุจู `compaction` ุญุฏูุฏ ท.ทฒ ุซุงูู ุงุณุช. ุงุฒ ุขูุฌุง ฺฉู ูุนูููุงู ููุท ฑฒ `compaction` ุฏุฑ ฺฉ ุฑูุฒ ูุฌูุฏ ุฎูุงูุฏ ุฏุงุดุชุ `percentile` ููุฏู ูโฺฏูุฏ ฺฉู ฑฐูช ุงุฒ `compaction`ูุง ุจุดุชุฑ ุงุฒ ุงู ุทูู ูโฺฉุดูุฏุ ุนู ฺฉ ุง ุฏู `compaction`. ุงู ูฺฉุชูโุง ุงุณุช ฺฉู ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ `quantiles` ุจุงุฏ ุจู ุขู ุชูุฌู ุฏุงุดุช. ุจู ุนููุงู ูุซุงูุ ุงฺฏุฑ ูโุฎูุงูุฏ `quantile` ฐ.นนน ุฑุง ูุญุงุณุจู ฺฉูุฏุ ุจุงุฏ ฺูุฏู ูุฒุงุฑ ููุทู ุฏุงุฏู ุจุฑุง ฺฉุงุฑ ุฏุงุดุชู ุจุงุดุฏ ุชุง ูพุงุณุฎ ูุณุจุชุงู ุฏูู ุชููุฏ ุดูุฏ. ุงฺฏุฑ ฺฉูุชุฑ ุงุฒ ุขู ุฏุงุฑุฏุ ุชฺฉ ุฏุงุฏูโูุง ูพุฑุช (`outliers`) ูโุชูุงููุฏ ุจู ุดุฏุช ุจุฑ ูุชุฌู ุชุฃุซุฑ ุจฺฏุฐุงุฑูุฏ ู ุจุงุฏ ุจู ุงุณุชูุงุฏู ุงุฒ `quantiles` ูพุงูโุชุฑ ูฺฉุฑ ฺฉูุฏ ุชุง ุงุฒ ุจุงู ุงุธูุงุฑุงุช ุฏุฑ ููุฑุฏ ุณุณุชู ุฎูุฏ ฺฉู ุฏุงุฏูโูุง ฺฉุงู ุจุฑุง ูพุดุชุจุงู ุงุฒ ุขูโูุง ูุฏุงุฑุฏุ ุงุฌุชูุงุจ ฺฉูุฏ.
ูุนูููุงู ุจุง `histograms` ุงุฒ `rate` ต ุง ฑฐ ุฏูููโุง ุงุณุชูุงุฏู ูโฺฉูุฏ. ุชูุงู `time series` ูุฑุจูุท ุจู `bucket`ูุง ููุฑุงู ุจุง ูุฑ `label` ู ฺฉ ุจุงุฒู ุทููุงู ุฏุฑ `rate`ุ ูโุชูุงูุฏ ููุฌุฑ ุจู ุชุนุฏุงุฏ ุฒุงุฏ `sample` ุดูุฏ ฺฉู ูุงุฒ ุจู ูพุฑุฏุงุฒุด ุฏุงุฑูุฏ. ูุฑุงูุจ ุนุจุงุฑุงุช (`expressions`) `PromQL` ุจุงุดุฏ ฺฉู ุงุฒ ุจุงุฒูโูุง ุจู ุทูู ุณุงุนุชโูุง ุง ุฑูุฒูุง ุงุณุชูุงุฏู ูโฺฉููุฏุ ุฒุฑุง ูุญุงุณุจู ุขูโูุง ูโุชูุงูุฏ ูุณุจุชุงู ูพุฑูุฒูู ุจุงุดุฏ.

ูุดุงุจู ุฒูุงู ฺฉู ูุงูฺฏู ูโฺฏุฑุฏุ ุงุณุชูุงุฏู ุงุฒ `histogram_quantile` ุจุงุฏ ุขุฎุฑู ูุฑุญูู ุฏุฑ ฺฉ ุนุจุงุฑุช ฺฉูุฆุฑ ุจุงุดุฏ. `Quantiles` ุงุฒ ุฏุฏฺฏุงู ุขูุงุฑ ูุงุจู ุชุฌูุน ูุณุชูุฏ ุง ููโุชูุงู ุฑู ุขูโูุง ุนููุงุช ุญุณุงุจ ุงูุฌุงู ุฏุงุฏ. ุจุฑ ุงู ุงุณุงุณุ ููฺฏุงู ฺฉู ูโุฎูุงูุฏ `histogram` ฺฉ ุชุฌูุน ุฑุง ุจฺฏุฑุฏุ ุงุจุชุฏุง ุจุง `sum` ุชุฌูุน ฺฉูุฏ ู ุณูพุณ ุงุฒ `histogram_quantile` ุงุณุชูุงุฏู ฺฉูุฏ:

```
histogram_quantile(
  0.90,
  sum without(instance)(rate(prometheus_tsdb_compaction_duration_bucket[1d]))
)
```

ุงู `quantile` ฐ.น ูุฏุช ุฒูุงู `compaction` ุฑุง ุฏุฑ ุชูุงู ุณุฑูุฑูุง `Prometheus` ุดูุง ูุญุงุณุจู ูโฺฉูุฏ ู ูุชุฌูโุง ุจุฏูู `label` ุจุง ูุงู `instance` ุชููุฏ ูโฺฉูุฏ:

`{job="prometheus"} 7.720000000000001`

โ`Metrics` ุงุฒ ููุน `Histogram` ููฺูู ุดุงูู `metrics` ุจุง ูุงู `_sum` ู `_count` ูุณุชูุฏ ฺฉู ุฏููุงู ูุงููุฏ `metric` ุงุฒ ููุน `summary` ฺฉุงุฑ ูโฺฉููุฏ. ูโุชูุงูุฏ ุงุฒ ุงูโูุง ุจุฑุง ูุญุงุณุจู ูุงูฺฏู ุงูุฏุงุฒู ุฑูุฏุงุฏูุงุ ูุงููุฏ ูุงูฺฏู ูุฏุช ุฒูุงู `compaction` ุงุณุชูุงุฏู ฺฉูุฏ:

```
sum without(instance)(rate(prometheus_tsdb_compaction_duration_sum[1d]))
/
sum without(instance)(rate(prometheus_tsdb_compaction_duration_count[1d]))
```

ุงู ูุชุฌูโุง ูุงููุฏ ุงู ุชููุฏ ูโฺฉูุฏ:

`{job="prometheus"} 3.1766430400714287`

### Selectors

ฺฉุงุฑ ุจุง ุชูุงู `time series`ูุง ูุฎุชูู ุจุง ููุงุฏุฑ `label` ูุชูุงูุช ุจุฑุง ฺฉ `metric` ูโุชูุงูุฏ ฺฉู ุทุงูุชโูุฑุณุง ู ุจุงูููู ฺฏุฌโฺฉููุฏู ุจุงุดุฏ ุงฺฏุฑ `metric` ุงุฒ ุงููุงุน ูุฎุชูู ุณุฑูุฑูุง  ูโุขุฏ. ูุนูููุงู ูโุฎูุงูุฏ `time series`ูุง ุฑุง ฺฉู ุฑู ุขูโูุง ฺฉุงุฑ ูโฺฉูุฏ ูุญุฏูุฏ ฺฉูุฏ. ุชูุฑุจุงู ููุดู ูโุฎูุงูุฏ ุจุฑ ุงุณุงุณ `label` ุจุง ูุงู `job` ูุญุฏูุฏ ฺฉูุฏ ู ุจุณุชู ุจู ฺฉุงุฑ ฺฉู ุงูุฌุงู ูโุฏูุฏุ ููฺฉู ุงุณุช ุจุฎูุงูุฏ ููุท ุจู ฺฉ `instance` ุง ฺฉ `handler` ูฺฏุงู ฺฉูุฏุ ุจู ุนููุงู ูุซุงู.

ุงู ูุญุฏูุฏ ฺฉุฑุฏู ุจุฑ ุงุณุงุณ `labels` ุจุง ุงุณุชูุงุฏู ุงุฒ `selectors` (ุงูุชุฎุงุจฺฏุฑูุง) ุงูุฌุงู ูโุดูุฏ. ุดูุง ุฏุฑ ูุฑ ูุซุงู ุชุงฺฉููู `selectors` ุฑุง ุฏุฏูโุงุฏ ู ุงฺฉููู ูโุฎูุงูู ุขูโูุง ุฑุง ุจู ุชูุตู ุจุฑุง ุดูุง ุชูุถุญ ุฏูู. ุจู ุนููุงู ูุซุงู:

`process_resident_memory_bytes{job="node"}`

ฺฉ `selector` ุงุณุช ฺฉู ุชูุงู `time series` ุจุง ูุงู `process_resident_memory_bytes` ู `label` ุจุง ูุงู `job` ู ููุฏุงุฑ `node` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุงู `selector` ุฎุงุต ุจู ุฏุฑุณุช `instant vector selector` ูุงูุฏู ูโุดูุฏุ ุฒุฑุง ููุงุฏุฑ `time series` ุฏุงุฏู ุดุฏู ุฑุง ุฏุฑ ฺฉ ูุญุธู ูุนู ุจุฑูโฺฏุฑุฏุงูุฏ. `Vector` ุฏุฑ ุงูุฌุง ุงุณุงุณุงู ุจู ูุนูุง ฺฉ ูุณุช ฺฉ ุจุนุฏ ุงุณุชุ ุฒุฑุง ฺฉ `selector` ูโุชูุงูุฏ ุตูุฑ ุง ฺูุฏ `time series` ุฑุง ุจุฑฺฏุฑุฏุงูุฏ ู ูุฑ `time series` ฺฉ `sample` ุฎูุงูุฏ ุฏุงุดุช.

โ`job="node"` ฺฉ `matcher` (ุชุทุจูโุฏููุฏู) ูุงูุฏู ูโุดูุฏ ู ุดูุง ูโุชูุงูุฏ ฺูุฏู `matcher` ุฏุฑ ฺฉ `selector` ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุจุง ูู `AND` ูโุดููุฏ.

## Matchers

ฺูุงุฑ `matcher` ูุฌูุฏ ุฏุงุฑุฏ (ุดูุง ูุจูุงู `equality matcher` ุฑุง ุฏุฏูโุงุฏ ฺฉู ุฑุงุฌโุชุฑู ูุฒ ูุณุช):

=
ุงู `equality matcher` ุงุณุชุ ุจู ุนููุงู ูุซุงูุ `job="node"`. ุจุง ุงู ฺฉุงุฑ ูโุชูุงูุฏ ูุดุฎุต ฺฉูุฏ ฺฉู `time series` ุจุงุฒฺฏุดุช ุฏุงุฑุง ูุงู `label` ุจุง ููุฏุงุฑ ุฏูู `label` ุฏุงุฏู ุดุฏู ุจุงุดุฏ. ุงุฒ ุขูุฌุง ฺฉู ฺฉ ููุฏุงุฑ `label` ุฎุงู ููุงููุฏ ูุฏุงุดุชู ุขู `label` ุงุณุชุ ูโุชูุงูุฏ ุงุฒ `foo=""` ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ุนุฏู ูุฌูุฏ `label` ุจุง ูุงู `foo` ุงุณุชูุงุฏู ฺฉูุฏ.

!=
ุงู `negative equality matcher` ุงุณุชุ ุจู ุนููุงู ูุซุงูุ `job!="node"`. ุจุง ุงู ฺฉุงุฑ ูโุชูุงูุฏ ูุดุฎุต ฺฉูุฏ ฺฉู `time series` ุจุงุฒฺฏุดุช ูุงู `label` ุจุง ููุฏุงุฑ ุฏูู `label` ุฏุงุฏู ุดุฏู ุฑุง ูุฏุงุดุชู ุจุงุดูุฏ.

=~
ุงู `regular expression matcher` ุงุณุชุ ุจู ุนููุงู ูุซุงูุ `job=~"n.*"`. ุจุง ุงู ฺฉุงุฑ ูุดุฎุต ูโฺฉูุฏ ฺฉู ุจุฑุง `time series` ุจุงุฒฺฏุดุชุ ููุฏุงุฑ `label` ุฏุงุฏู ุดุฏู ุจุง `regular expression` (ุนุจุงุฑุช ููุธู) ูุทุงุจูุช ุฏุงุดุชู ุจุงุดุฏ. `regular expression` ฺฉุงููุงู `anchored` (ููุงุฑ ุดุฏู) ุงุณุชุ ุจู ุงู ูุนู ฺฉู `regular expression` `a` ููุท ุจุง ุฑุดุชู `a` ูุทุงุจูุช ุฏุงุฑุฏ ู ูู `xa` ุง `ax`. ุงฺฏุฑ ุงู ุฑูุชุงุฑ ุฑุง ููโุฎูุงูุฏุ ูโุชูุงูุฏ ูพุดููุฏ ุง ูพุณููุฏ `.*` ุฑุง ุจู `regular expression` ุฎูุฏ ุงุถุงูู ฺฉูุฏ.โถ ููุงููุฏ `relabeling`ุ ุงุฒ ููุชูุฑ `regular expression` `RE2` ุงุณุชูุงุฏู ูโุดูุฏุ ููุงูุทูุฑ ฺฉู ุฏุฑ "Regular Expressions" ูุจูุง ูพูุดุด ุฏุงุฏู ุดุฏู ุงุณุช.

!~
ุงู `negative regular expression matcher` ุงุณุช. `RE2` ุงุฒ ุนุจุงุฑุงุช `negative lookahead` ูพุดุชุจุงู ููโฺฉูุฏุ ุจูุงุจุฑุงู ุงู ุฑูุด ุฌุงฺฏุฒู ุจุฑุง ุญุฐู ููุงุฏุฑ `label` ุจุฑ ุงุณุงุณ ฺฉ `regular expression` ุจู ุดูุง ุงุฑุงุฆู ูโุฏูุฏ. ูโุชูุงูุฏ ฺูุฏู `matcher` ุจุง ูุงู `label` ฺฉุณุงู ุฏุฑ ฺฉ `selector` ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูโุชูุงูุฏ ุฌุงฺฏุฒู ุจุฑุง ุนุจุงุฑุงุช `negative lookahead` ุจุงุดุฏ. ุจู ุนููุงู ูุซุงูุ ุจุฑุง ุงูุชู ุงูุฏุงุฒู ุชูุงู ูุงูโุณุณุชูโูุง `mount` ุดุฏู ุฒุฑ `/run` ุงูุง ูู `/run/user`ุ ูโุชูุงูุฏ ุงุฒ ุฏุณุชูุฑ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:
`node_filesystem_size_bytes{job="node",mountpoint=~"/run/.*",mountpoint!~"/run/user/.*"}`

ุฏุฑ ุฏุงุฎูุ ูุงู `metric` ุฏุฑ ฺฉ `label` ุจู ูุงู `__name__` ุฐุฎุฑู ูโุดูุฏ (ููุงูุทูุฑ ฺฉู ุฏุฑ "Reserved Labels and __name__" ุฏุฑ ฺฏุฐุดุชู ุจุญุซ ุดุฏ)ุ ุจูุงุจุฑุงู `process_resident_memory_bytes{job="node"}` ฺฉ `syntactic sugar` ุจุฑุง `{name="process_resident_memory_bytes",job="node"}` ุงุณุช. ุญุช ูโุชูุงูุฏ ุฑู ูุงู `metric` ุงุฒ `regular expressions` ุงุณุชูุงุฏู ฺฉูุฏุ ุงูุง ุงู ฺฉุงุฑ ุฎุงุฑุฌ ุงุฒ ุฒูุงู ฺฉู ุฏุฑ ุญุงู `debugging` (ุงุดฺฉุงูโุฒุฏุง) `performance` (ุนููฺฉุฑุฏ) ุณุฑูุฑ `Prometheus` ูุณุชุฏุ ููุดููุฏุงูู ูุณุช.

ูุงุฒ ุจู ุงุณุชูุงุฏู ุงุฒ `regular expression matchers` ฺฉู ูุดุงูู ุฎูุจ ูุณุช. ุงฺฏุฑ ูุชูุฌู ุดุฏุฏ ฺฉู ุฒุงุฏ ุงุฒ ุขูโูุง ุฑู ฺฉ `label` ุฎุงุต ุงุณุชูุงุฏู ูโฺฉูุฏุ ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู ุขุง ุจุงุฏ ููุงุฏุฑ `label` ุชุทุจู ุฏุงุฏู ุดุฏู ุฑุง ุฏุฑ ฺฉ ููุฏุงุฑ ุชุฑฺฉุจ ฺฉูุฏ. ุจู ุนููุงู ูุซุงูุ ุจุฑุง ฺฉุฏูุง ูุถุนุช `HTTP` ุจู ุฌุง ุงูุฌุงู `code~="4.."` ุจุฑุง ฺฏุฑูุชู 401ูุงุ 404ูุงุ 405ูุง ู ุบุฑูุ ููฺฉู ุงุณุช ุขูโูุง ุฑุง ุฏุฑ ฺฉ ููุฏุงุฑ `label` `4xx` ุชุฑฺฉุจ ฺฉูุฏ ู ุงุฒ `equality matcher` `code="4xx"` ุงุณุชูุงุฏู ฺฉูุฏ.

โ`selector` `{}` ฺฉ `error` ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉู ฺฉ ุงูุฏุงู ุงูู (`safety measure`) ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจุงุฒฺฏุฑุฏุงูุฏู ุชุตุงุฏู ุชูุงู `time series`ูุง ุฏุงุฎู ุณุฑูุฑ `Prometheus` ุงุณุช ุฒุฑุง ุงู ฺฉุงุฑ ูโุชูุงูุฏ ูพุฑูุฒูู ุจุงุดุฏ. ุจู ุทูุฑ ุฏููโุชุฑุ ุญุฏุงูู ฺฉ ุงุฒ `matchers` ุฏุฑ ฺฉ `selector` ูุจุงุฏ ุจุง ุฑุดุชู ุฎุงู ูุทุงุจูุช ุฏุงุดุชู ุจุงุดุฏ. ุจูุงุจุฑุงู `{foo=""}` ู `{foo=~".*"}` ฺฉ `error` ุจุฑูโฺฏุฑุฏุงููุฏุ ุฏุฑ ุญุงู ฺฉู `{foo="",bar="x"}`, `{foo!=""}` ุง `{foo=~".+"}` ูุฌุงุฒ ูุณุชูุฏ.



## Durations
โ`Durations` (ูุฏุช ุฒูุงูโูุง) ุฏุฑ `Prometheus` ููุงูุทูุฑ ฺฉู ุฏุฑ `PromQL` ู ูุงู ูพฺฉุฑุจูุฏ ุงุณุชูุงุฏู ูโุดููุฏุ ุงุฒ ฺูุฏู ูุงุญุฏ ูพุดุชุจุงู ูโฺฉููุฏ. ุดูุง ูุจูุงู `m` ุจุฑุง ุฏููู ุฑุง ุฏุฏูโุงุฏ.

![[pic14.png]]

### Subqueries

ุฏุฑ ุญุงู ฺฉู `range vectors` ุฑู `time series` ุนูู ูโฺฉููุฏุ ููโุชูุงู ุขูโูุง ุฑุง ุฏุฑ ุชุฑฺฉุจ ุจุง ุชูุงุจุน ุงุณุชูุงุฏู ฺฉุฑุฏ. ุงฺฏุฑ ูโุฎูุงูุฏ `max_over_time` ุฑุง ุจุง `rate` ุชุฑฺฉุจ ฺฉูุฏุ ูโุชูุงูุฏ ุง ุงุฒ `recording rules` ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ูุชุฌู ุชุงุจุน `rate` ุฑุง ุถุจุท ฺฉุฑุฏู ู ุขู ุฑุง ุจู ุชุงุจุน `vector` ููุชูู ูโฺฉูุฏุ ุง ูโุชูุงูุฏ ุงุฒ `subquery` ุงุณุชูุงุฏู ฺฉูุฏ. `subquery` ุจุฎุด ุงุฒ ฺฉ ฺฉูุฆุฑ ุงุณุช ฺฉู ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ฺฉ `range query` ุฑุง ุฏุฑ ุฏุงุฎู ฺฉ ฺฉูุฆุฑ ุงูุฌุงู ุฏูุฏ. ุณูุชฺฉุณ (`syntax`) ุจุฑุง `subquery` ุงุฒ ุจุฑุงฺฉุชโูุง ูุฑุจุนุ ูุงููุฏ `range selectors` ุงุณุชูุงุฏู ูโฺฉูุฏ. ุงูุง ุฏู `duration` ูุฎุชูู ูโฺฏุฑุฏ: `range` ู `resolution`. `range` ุจุงุฒูโุง ุงุณุช ฺฉู ุชูุณุท `subquery` ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ ู `resolution` ุจู ุนููุงู `step` (ฺฏุงู) ุนูู ูโฺฉูุฏ:

`max_over_time( rate(http_requests_total[5m])[30m:1m] )`

ฺฉูุฆุฑ ููู `rate(http_requests_total[5m])` ุฑุง ูุฑ ุฏููู (`1m`) ุจุฑุง ณฐ ุฏููู ฺฏุฐุดุชู (`30m`) ุงุฌุฑุง ูโฺฉูุฏุ ุณูพุณ ูุชุฌู ุฑุง ุจู ุชุงุจุน `max_over_time()` ูโุฏูุฏ. `resolution` ูโุชูุงูุฏ ุญุฐู ุดูุฏุ ูุงููุฏ `[30m:]`. ุฏุฑ ุงู ุญุงูุชุ ูุงุตูู ุงุฑุฒุงุจ ุณุฑุงุณุฑ (`global evaluation interval`) ุจู ุนููุงู `resolution` ุงุณุชูุงุฏู ูโุดูุฏ.

### Offset

ฺฉ ุงุตูุงุญโฺฉููุฏู (`modifier`) ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจุง ูุฑ ุฏู ููุน `vector selector` ุจู ูุงู `offset` ุงุณุชูุงุฏู ฺฉูุฏ. `offset` ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุฒูุงู ุงุฑุฒุงุจ ฺฉ ฺฉูุฆุฑ ุฑุง ุจฺฏุฑุฏ ู ุจุฑ ุงุณุงุณ ูุฑ `selector`ุ ุขู ุฑุง ุฏุฑ ุฒูุงู ุจู ุนูุจ ุจุจุฑุฏ. ุจู ุนููุงู ูุซุงู:

`process_resident_memory_bytes{job="node"} offset 1h`
ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู ุฑุง ฺฉ ุณุงุนุช ูุจู ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุฏุฑุงูุช ูโฺฉูุฏ. `offset` ุฏุฑ ฺฉูุฆุฑโูุง ุณุงุฏู ูุงููุฏ ุงู ุฒุงุฏ ุงุณุชูุงุฏู ููโุดูุฏุ ุฒุฑุง ุชุบุฑ ุฒูุงู ุงุฑุฒุงุจ ุจุฑุง ฺฉู ฺฉูุฆุฑ ุขุณุงูโุชุฑ ุฎูุงูุฏ ุจูุฏ. ุฌุง ฺฉู ุงู ูโุชูุงูุฏ ููุฏ ุจุงุดุฏ ุฒูุงู ุงุณุช ฺฉู ููุท ูโุฎูุงูุฏ ฺฉ `selector` ุฑุง ุฏุฑ ฺฉ ุนุจุงุฑุช ฺฉูุฆุฑ ุชูุธู ฺฉูุฏ. ุจู ุนููุงู ูุซุงู:

`process_resident_memory_bytes{job="node"}`
`-`
`process_resident_memory_bytes{job="node"} offset 1h`
ุชุบุฑ ุฏุฑ ุงุณุชูุงุฏู ุงุฒ ุญุงูุธู ุฏุฑ `Node Exporter` ุท ุณุงุนุช ฺฏุฐุดุชูยนยณ ุฑุง ูุดุงู ูโุฏูุฏ. ููู ุฑูฺฉุฑุฏ ุจุง `range vectors` ูุฒ ฺฉุงุฑ ูโฺฉูุฏ:
`rate(process_cpu_seconds_total{job="node"}[5m])`
`-`
`rate(process_cpu_seconds_total{job="node"}[5m] offset 1h)`
โ`offset` ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุจู ฺฏุฐุดุชู ุฏูุฑุชุฑ ูฺฏุงู ฺฉูุฏุ ุงูุง ููฺูู ุจู ุขูุฏูุ ุจุง ุงุณุชูุงุฏู ุงุฒ `offset` ููู. ุงู ูโุชูุงูุฏ ููฺฏุงู ุงูุฌุงู `prediction` ุง ุฒูุงู ฺฉู `sample` `metrics` ุจุง ูุงูุนุช ููโุชุฑุงุฒ ูุณุชุ ุงุณุชูุงุฏู ุดูุฏ:
`rate(process_cpu_seconds_total{job="node"}[5m]) offset -1h`
`-`
`rate(process_cpu_seconds_total{job="node"}[5m])`
ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงู ฺฉูุฆุฑ ุงุญุชูุงูุงู ุจุฑุง ุณุงุนุช ฺฏุฐุดุชู ฺุฒ ุจุฑููโฺฏุฑุฏุงูุฏ. `Grafana` ูฺฺฏโุง ุฏุงุฑุฏ ฺฉู ฺฉ `panel` ุฑุง ุฏุฑ ุฒูุงู ุจู ุจุงุฒู ุฒูุงู ูุชูุงูุช ูุณุจุช ุจู ุจูู `dashboard` ฺฉู ุจุฎุด ุงุฒ ุขู ุงุณุชุ ููุชูู ฺฉูุฏ. ุฏุฑ Grafana 5.0.0 ูโุชูุงูุฏ ุงู ุฑุง ุฏุฑ ุชุจ `Time range` ูุฑุงุดฺฏุฑ `panel` (`panel editor`) ูพุฏุง ฺฉูุฏ.

### @ Modifier

ูุดุงุจู `offset modifier`ุ `PromQL` ุงุฒ ฺฉ `@ modifier` ูพุดุชุจุงู ูโฺฉูุฏ ฺฉู ุจู ุดูุง ุงูฺฉุงู ูโุฏูุฏ ุงุฑุฒุงุจ `vector selectors`ุ `range selectors` ู `subqueries` ุฑุง ุจู ฺฉ ุฒูุงู ุงุฑุฒุงุจ ูุฌุฏุฏ ุซุงุจุช ุชุบุฑ ุฏูุฏ. `@ modifier` ูโุชูุงูุฏ ุจุง ฺฉ `Unix timestamp` ุงุณุชูุงุฏู ุดูุฏ. ฺฉูุฆุฑ `http_requests_total @ 1667491200` ููุฏุงุฑ `http_requests_total` ุฑุง ุฏุฑ 2022-11-03T16:00:00+00:00 ุจุฑูโฺฏุฑุฏุงูุฏ. ฺฉูุฆุฑ `rate(http_requests_total[5m] @1667491200)` ูุฑุฎ ต ุฏูููโุง `http_requests_total` ุฑุง ุฏุฑ ููุงู ุฒูุงู ุจุฑูโฺฏุฑุฏุงูุฏ. ุนูุงูู ุจุฑ ุงูุ `start()` ู `end()` ูโุชูุงููุฏ ุจู ุนููุงู ููุงุฏุฑ ุจุฑุง `@ modifier` ุงุณุชูุงุฏู ุดููุฏ. ุจุฑุง ฺฉ `range query`ุ ุขููุง ุจู ุชุฑุชุจ ุจุง ุดุฑูุน ู ูพุงุงู `range query` ุชุทุจู ูโุงุจูุฏ. ุจุฑุง ฺฉ ฺฉูุฆุฑ ูุญุธูโุง (`instant query`)ุ ูุฑ ุฏู ุจู ุฒูุงู ุงุฑุฒุงุจ ุชุทุจู ูโุงุจูุฏ. ุฏุฑ ุนููุ ูโุชูุงู ุงุฒ `@ modifier` ุจุฑุง ุฑุณู ูููุฏุงุฑ ุชฺฉุงูู `http_request_total` ฺฉู ุฏุงุฑุง `rate` ุจุงูุง ุฏุฑ ุงูุชูุง ุจุงุฒู ุงุฑุฒุงุจ ุงุณุชุ ุงุณุชูุงุฏู ฺฉุฑุฏ:

```
rate(http_requests_total[1m])
and
topk(5, rate(http_requests_total[1h] @ end()))
```

ุก`topk(5, rate(http_requests_total[1h] @ end()))` ุจู ุนููุงู ฺฉ ุชุงุจุน ุฑุชุจูโุจูุฏ (`ranking function`) ุนูู ูโฺฉูุฏ ู ููุท ููุงุฏุฑ ุจุงูุงุชุฑ ุฑุง ุฏุฑ ุงูุชูุง ุจุงุฒู ุงุฑุฒุงุจ ููุชุฑ ูโฺฉูุฏ.

### HTTP API

โ`Prometheus` ุชุนุฏุงุฏ `HTTP API` ุงุฑุงุฆู ูโุฏูุฏ. ุขููุง ฺฉู ุจุดุชุฑ ุจุง ุขููุง ุชุนุงูู ุฎูุงูุฏ ุฏุงุดุช `query` ู `query_range` ูุณุชูุฏ ฺฉู ุจู ุดูุง ุงูฺฉุงู ุฏุณุชุฑุณ ุจู `PromQL` ุฑุง ูโุฏููุฏ ู ูโุชูุงููุฏ ุชูุณุท ุงุจุฒุงุฑูุง `dashboarding` ุง ุงุณฺฉุฑูพุชโูุง ฺฏุฒุงุฑุดโฺฏุฑ ุณูุงุฑุด ุงุณุชูุงุฏู ุดููุฏ. ุชูุงู `endpoints` ููุฑุฏ ุนูุงูู ุฒุฑ `/api/v1/` ูุฑุงุฑ ุฏุงุฑูุฏ ู ูุฑุงุชุฑ ุงุฒ ุงุฌุฑุง `PromQL`ุ ูโุชูุงูุฏ `metadata` (ูุฑุงุฏุงุฏู) `time series` ุฑุง ุฌุณุชุฌู ฺฉุฑุฏู ู ุงูุฏุงูุงุช ูุฏุฑุช (`administrative actions`) ูุงููุฏ ฺฏุฑูุชู `snapshots` ู ุญุฐู (`deleting`) `time series` ุฑุง ุงูุฌุงู ุฏูุฏ. ุงู `API`ูุง ุฏฺฏุฑ ุนูุฏุชุงู ุจุฑุง ุงุจุฒุงุฑูุง `dashboarding` ูุงููุฏ `Grafana` ฺฉู ูโุชูุงููุฏ ุงุฒ `metadata` ุจุฑุง ุจูุจูุฏ `UI` ุฎูุฏ ุงุณุชูุงุฏู ฺฉููุฏ ู ุจุฑุง ฺฉุณุงู ฺฉู `Prometheus` ุฑุง ูุฏุฑุช ูโฺฉููุฏุ ููุฑุฏ ุนูุงูู ูุณุชูุฏุ ุงูุง ุจู ุงุฌุฑุง `PromQL` ูุฑุจูุท ููโุดููุฏ.

### query

โ`endpoint` ุจุง ูุงู `query`ุ ุง ุจู ุทูุฑ ุฑุณู `/api/v1/query`ุ ฺฉ ุนุจุงุฑุช `PromQL` ุฑุง ุฏุฑ ฺฉ ุฒูุงู ูุนู ุงุฌุฑุง ูโฺฉูุฏ ู ูุชุฌู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุจู ุนููุงู ูุซุงูุ `http://localhost:9090/api/v1/query?query=process_resident_memory_bytes` ูุชุงุฌ ูุงููุฏ ุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:

```json
{
  "status": "success",
  "data": {
    "resultType": "vector",
    "result": [
      {
        "metric": {
          "__name__": "process_resident_memory_bytes",
          "instance": "localhost:9090",
          "job": "prometheus"
        },
        "value": [1517929228.782, "91656192"]
      },
      {
        "metric": {
          "__name__": "process_resident_memory_bytes",
          "instance": "localhost:9100",
          "job": "node"
        },
        "value": [1517929228.782, "15507456"]
      }
    ]
  }
}
```

โ`status` ุจุฑุงุจุฑ `success` ุงุณุชุ ุจู ุงู ูุนู ฺฉู ฺฉูุฆุฑ ฺฉุงุฑ ฺฉุฑุฏู ุงุณุช. ุงฺฏุฑ ูุงูููู ุจูุฏุ `status` ุจุฑุงุจุฑ `error` ุจูุฏ ู ููุฏ `error` ุฌุฒุฆุงุช ุจุดุชุฑ ุฑุง ุงุฑุงุฆู ูโุฏุงุฏ. ุงู ูุชุฌู ุฎุงุต ฺฉ `instant vector` ุงุณุช ฺฉู ูโุชูุงูุฏ ุงุฒ `"resultType": "vector"` ูุชูุฌู ุดูุฏ. ุจุฑุง ูุฑ ฺฉ ุงุฒ `samples` ุฏุฑ ูุชุฌูุ `labels` ุฏุฑ `map` ุจู ูุงู `metric` ูุฑุงุฑ ุฏุงุฑูุฏ ู ููุฏุงุฑ `sample` ุฏุฑ `list` ุจู ูุงู `value` ุงุณุช. ุนุฏุฏ ุงูู ุฏุฑ `list` `value`ุ `timestamp` ูุฑุจูุท ุจู `sample` ุจุฑ ุญุณุจ ุซุงูู ุงุณุช ู ุฏูู ููุฏุงุฑ ูุงูุน `sample` ุงุณุช. ููุฏุงุฑ ุฏุงุฎู ฺฉ `string` ุงุณุชุ ุฒุฑุง `JSON` ููโุชูุงูุฏ ููุงุฏุฑ ุบุฑูุงูุน ูุงููุฏ `NaN` ู `+Inf` ุฑุง ูุดุงู ุฏูุฏ. ุฒูุงู ุชูุงู `samples` ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุฎูุงูุฏ ุจูุฏุ ุญุช ุงฺฏุฑ ุนุจุงุฑุช ููุท ุงุฒ ฺฉ `instant vector selector` ุชุดฺฉู ุดุฏู ุจุงุดุฏ. ุฏุฑ ุงูุฌุง ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุจู ุทูุฑ ูพุดโูุฑุถ ุฒูุงู ูุนู ุงุณุชุ ุงูุง ูโุชูุงูุฏ ุจุง ูพุงุฑุงูุชุฑ `URL` ุจู ูุงู `time`ุ ุฒูุงู ุฑุง ูุดุฎุต ฺฉูุฏ ฺฉู ูโุชูุงูุฏ `Unix time`ุ ุจุฑ ุญุณุจ ุซุงููุ ุง ุฒูุงู `RFC 3339` ุจุงุดุฏ. ุจู ุนููุงู ูุซุงูุ `http://localhost:9090/api/v1/query?query=process_resident_memory_bytes&time=1514764800` ฺฉูุฆุฑ ุฑุง ุฏุฑ ููู ุดุจ ุงูู ฺุงููู ฒฐฑธ ุงุฑุฒุงุจ ูโฺฉูุฏ.
ุดูุง ููฺูู ูโุชูุงูุฏ ุงุฒ `range vectors` ุจุง `endpoint` `query` ุงุณุชูุงุฏู ฺฉูุฏ. ุจู ุนููุงู ูุซุงูุ 
`http://localhost:9090/api/v1/query=prometheus_tsdb_head_samples_appended_total[1m]` ูุชุงุฌ ูุงููุฏ ุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ:

```json
{
  "status": "success",
  "data": {
    "resultType": "matrix",
    "result": [
      {
        "metric": {
          "__name__": "process_resident_memory_bytes",
          "instance": "localhost:9090",
          "job": "prometheus"
        },
        "values": [
          [1518008453.662, "87318528"],
          [1518008463.662, "87318528"],
          [1518008473.662, "87318528"]
        ]
      },
      {
        "metric": {
          "__name__": "process_resident_memory_bytes",
          "instance": "localhost:9100",
          "job": "node"
        },
        "values": [
          [1518008444.819, "17043456"],
          [1518008454.819, "17043456"],
          [1518008464.819, "17043456"]
        ]
      }
    ]
  }
}
```

ุงู ุจุง ูุชุฌู `instant vector` ูุจู ูุชูุงูุช ุงุณุชุ ุฒุฑุง `resultType` ุงฺฉููู `matrix` ุงุณุช ู ูุฑ `time series` ฺูุฏู ููุฏุงุฑ ุฏุงุฑุฏ. ููฺฏุงู ฺฉู ุจุง `range vector` ุงุณุชูุงุฏู ูโุดูุฏุ `endpoint` `query` `samples` ุฎุงู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏุ ุงูุง ูุฑุงูุจ ุจุงุดุฏ ฺฉู ุฏุงุฏูโูุง ุฒุงุฏ ุฑุง ุจู ฺฉุจุงุฑู ุฏุฑุฎูุงุณุช ูฺฉูุฏ ุฒุฑุง ููฺฉู ุงุณุช ุญุงูุธู ฺฉ ุทุฑู ุง ุทุฑู ุฏฺฏุฑ ุชูุงู ุดูุฏ.
ฺฉ ููุน ูุชุฌู ุฏฺฏุฑ ุจู ูุงู `scalar` ูุฌูุฏ ุฏุงุฑุฏ. `Scalars` `labels` ูุฏุงุฑูุฏุ ุขููุง ููุท ุงุนุฏุงุฏ ูุณุชูุฏ.ยนโท `http://localhost:9090/api/v1/query?query=42` ูุชุฌู ุฒุฑ ุฑุง ุชููุฏ ูโฺฉูุฏ:

```json
{
  "status": "success",
  "data": {
    "resultType": "scalar",
    "result": [1518008879.023, "42"]
  }
}
```

### query_range

โ`endpoint` ุจุง ูุงู `query range` ุฏุฑ `/api/v1/query_range` `endpoint` ุงุตู `HTTP` `Prometheus` ุงุณุช ฺฉู ุงุฒ ุขู ุงุณุชูุงุฏู ุฎูุงูุฏ ฺฉุฑุฏุ ุฒุฑุง ุงู `endpoint` ุจุฑุง `graphing` (ุฑุณู ูููุฏุงุฑ) ุงุณุช. ุฏุฑ ูพุดุช ุตุญููุ `query_range` ฺฉ `syntactic sugar` (ุจู ุนูุงูู ุจุฑุฎ ุจูููโุณุงุฒโูุง ุนููฺฉุฑุฏ) ุจุฑุง ฺูุฏู ูุฑุงุฎูุงู ุจู `endpoint` `query` ุงุณุช. ุนูุงูู ุจุฑ ูพุงุฑุงูุชุฑ `URL` `query`ุ ุดูุง ุจู `query_range` ฺฉ `start time` (ุฒูุงู ุดุฑูุน)ุ ฺฉ `end time` (ุฒูุงู ูพุงุงู) ู ฺฉ `step` (ฺฏุงู) ุงุฑุงุฆู ูโุฏูุฏ. ฺฉูุฆุฑ ุงุจุชุฏุง ุฏุฑ `start time` ุงุฌุฑุง ูโุดูุฏ. ุณูพุณ `step` ุซุงูู ูพุณ ุงุฒ `start time` ุงุฌุฑุง ูโุดูุฏ. ุณูพุณ ุฏู ุจุฑุงุจุฑ `step` ุซุงูู ูพุณ ุงุฒ `start time` ุงุฌุฑุง ูโุดูุฏ ู ุจู ููู ุชุฑุชุจุ ุชุง ุฒูุงู ฺฉู ุฒูุงู ุงุฑุฒุงุจ ฺฉูุฆุฑ ุงุฒ `end time` ุชุฌุงูุฒ ฺฉูุฏุ ูุชููู ูโุดูุฏ. ุชูุงู ูุชุงุฌ `instant vector`   ุงุฒ ุงุฌุฑุงูุง ูุฎุชูู ุฏุฑ ฺฉ `range vector` ุชุฑฺฉุจ ุดุฏู ู ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดููุฏ.
ุจู ุนููุงู ูุซุงูุ ุงฺฏุฑ ูโุฎูุงุณุชุฏ ุชุนุฏุงุฏ `samples` ฺฉู `Prometheus` ุฏุฑ ฑต ุฏููู ุงูู ุณุงู ฒฐฑธ ุฏุฑุงูุช ฺฉุฑุฏู ุงุณุช ุฑุง ฺฉูุฆุฑ ฺฉูุฏุ ูโุชูุงูุฏ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ: `http://localhost:9090/api/v1/query_range?query=rate(prometheus_tsdb_head_samples_appended_total[5m])&start=1514764800&end=1514765700&step=60`ุ ฺฉู ูุชุฌูโุง ูุงููุฏ ุงู ุชููุฏ ูโฺฉูุฏ:

```json
{
  "status": "success",
  "data": {
    "resultType": "matrix",
    "result": [
      {
        "metric": {
          "instance": "localhost:9090",
          "job": "prometheus"
        },
        "values": [
          [1514764800, "85.07241379310345"],
          [1514764860, "102.6793103448276"],
          [1514764920, "120.30344827586208"],
          [1514764980, "137.93103448275863"],
          [1514765040, "146.7586206896552"],
          [1514765100, "146.7793103448276"],
          [1514765160, "146.8"],
          [1514765220, "146.8"],
          [1514765280, "146.8"],
          [1514765340, "146.8"],
          [1514765400, "146.8"],
          [1514765460, "146.8"],
          [1514765520, "146.8"],
          [1514765580, "146.8"],
          [1514765640, "146.8"],
          [1514765700, "146.8"]
        ]
      }
    ]
  }
}
```

ฺูุฏ ุฌูุจู ุงุฒ ุงู ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุจุงุฏ ุจู ุขููุง ุชูุฌู ฺฉูุฏ. ุงูู ุงูฺฉู `timestamps` `sample`ูุง ุจุง `start time` ู `step` ููโุชุฑุงุฒ ูุณุชูุฏุ ุฒุฑุง ูุฑ ูุชุฌู ุงุฒ ฺฉ ุงุฑุฒุงุจ ฺฉูุฆุฑ ูุญุธูโุง ูุชูุงูุช ูโุขุฏ ู ูุชุงุฌ ฺฉูุฆุฑ ูุญุธูโุง ููุดู ุงุฒ ุฒูุงู ุงุฑุฒุงุจ ุฎูุฏ ุจู ุนููุงู `timestamp` ูุชุงุฌ ุงุณุชูุงุฏู ูโฺฉููุฏ. ุฏูู ุงูฺฉู ุขุฎุฑู `sample` ุฏุฑ ุงูุฌุง ุฏุฑ `end time` ุงุณุชุ ุจู ุงู ูุนู ฺฉู ุจุงุฒู `inclusive` (ุดุงูู) ุงุณุช ู ุขุฎุฑู ููุทู `end time` ุฎูุงูุฏ ุจูุฏ ุงฺฏุฑ ุงุชูุงูุงู ุจุง `step` ููโุชุฑุงุฒ ุดูุฏ. ุณูู ุงูฺฉู ูุง ฺฉ ุจุงุฒู ต ุฏูููโุง ุจุฑุง ุชุงุจุน `rate` ุงูุชุฎุงุจ ฺฉุฑุฏู ฺฉู ุจุฒุฑฺฏุชุฑ ุงุฒ `step` ุงุณุช. ุงุฒ ุขูุฌุง ฺฉู `query_range` ุงุฑุฒุงุจโูุง ฺฉูุฆุฑ ูุญุธูโุง ุชฺฉุฑุงุฑ ุฑุง ุงูุฌุงู ูโุฏูุฏุ ูฺ ูุถุนุช ุจู ุงุฑุฒุงุจโูุง ููุชูู ููโุดูุฏ. ุงฺฏุฑ ุจุงุฒู ฺฉูฺฺฉุชุฑ ุงุฒ `step` ุจูุฏุ ูุง ุงุฒ ุฑู ุฏุงุฏูโูุง ูโูพุฑุฏู. ุจู ุนููุงู ูุซุงูุ ฺฉ ุจุงุฒู ฑ ุฏูููโุง ุจุง ฺฉ`step`  ุงุฒ ููุน ต ุฏูููโุงุ ธฐูช ุงุฒ `samples` ุฑุง ูุงุฏุฏู ูโฺฏุฑูุช. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงูุ ุจุงุฏ ุงุฒ ุจุงุฒูโูุง ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ุญุฏุงูู ฺฉ ุง ุฏู ูุงุตูู `scrape` (`scrape intervals`) ุจุฒุฑฺฏุชุฑ ุงุฒ `step` ุจุงุดูุฏ ฺฉู ุงุณุชูุงุฏู ูโฺฉูุฏ.

ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ `range vectors` ุจุง `query_range`ุ ูุนูููุงู ุจุงุฏ ุงุฒ ุจุงุฒูโุง ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ุทููุงูโุชุฑ ุงุฒ `step` ุดูุง ุจุงุดุฏ ุชุง ุฏุงุฏูโุง ุฑุง ุงุฒ ุฏุณุช ูุฏูุฏ.

ฺูุงุฑู ุงูฺฉู ุจุฑุฎ ุงุฒ `samples` ุจู ุทูุฑ ุฎุงุต ฺฏุฑุฏ ูุณุชูุฏุ ู ุงูฺฉู ูุฑ ุนุฏุฏ ุงุตูุงู ฺฏุฑุฏ ุจุงุดุฏ ุจู ุงู ุฏูู ุงุณุช ฺฉู ุงู ฺฉ ุชูุธู ุณุงุฏู ุงุฒ ููุงุฏุฑ `sample` ุงุณุช. ููฺฏุงู ฺฉุงุฑ ุจุง `metrics`ุ ุฏุงุฏูโูุง ุดูุง ุจู ูุฏุฑุช ฺฉุงููุงู ุชูุฒ ูุณุชูุฏุ `targets` ูุฎุชูู ุฏุฑ ุฒูุงูโูุง ูุฎุชูู `scrape` ูโุดููุฏ ู `scrapes` ูโุชูุงููุฏ ุจู ุชุฃุฎุฑ ุจูุชูุฏ. ููฺฏุงู ุงูุฌุงู ฺฉูุฆุฑโูุง ฺฉู ฺฉุงููุงู ุจุง ุฏุงุฏูโูุง ุฒุฑุจูุง ููโุชุฑุงุฒ ูุณุชูุฏ ุง ููฺฏุงู ุชุฌูุน ุฏุฑ ฺูุฏู ูุฒุจุงูุ ุจู ูุฏุฑุช ูุชุงุฌ ฺฏุฑุฏ ุฏุฑุงูุช ุฎูุงูุฏ ฺฉุฑุฏ. ุนูุงูู ุจุฑ ุงูุ ูุงูุช ูุญุงุณุจุงุช `floating-point` ูโุชูุงูุฏ ููุฌุฑ ุจู ุงุนุฏุงุฏ ุดูุฏ ฺฉู ุชูุฑุจุงู ฺฏุฑุฏ ูุณุชูุฏ.

ุฏุฑ ุงูุฌุงุ ุจุฑุง ูุฑ `step` ฺฉ `sample` ูุฌูุฏ ุฏุงุฑุฏ. ุงฺฏุฑ ุงุชูุงู ูโุงูุชุงุฏ ฺฉู ุจุฑุง ฺฉ `time series` ูุนู ุจุฑุง ฺฉ `step` ูุชุฌูโุง ูุฌูุฏ ูุฏุงุดุชุ ุขู `sample` ุจู ุณุงุฏฺฏ ุฏุฑ ูุชุฌู ููุง ูุฌูุฏ ูุฏุงุดุช. ุงฺฏุฑ ุจุด ุงุฒ ฑฑฐฐฐ `step` ุจุฑุง ฺฉ `query_range` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ `Prometheus` ฺฉูุฆุฑ ุฑุง ุจุง ฺฉ `error` ุฑุฏ ูโฺฉูุฏ. ุงู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงุฑุณุงู ุชุตุงุฏู ฺฉูุฆุฑโูุง ุจุณุงุฑ ุจุฒุฑฺฏ ุจู `Prometheus` ุงุณุชุ ูุงููุฏ `step` ฑ ุซุงููโุง ุจุฑุง ฺฉ ููุชู. ุงุฒ ุขูุฌุง ฺฉู ูุงูุชูุฑูุง ุจุง ูุถูุญ ุงูู ุจุด ุงุฒ ฑฑฐฐฐ ูพฺฉุณู (`pixels`) ูุงุฏุฑ ูุณุชูุฏุ ุจุนุฏ ุงุณุช ููฺฏุงู `graphing` ุจุง ุงู ูุดฺฉู ููุงุฌู ุดูุฏ. ุงฺฏุฑ ุฏุฑ ุญุงู ููุดุชู ุงุณฺฉุฑูพุชโูุง ฺฏุฒุงุฑุดโฺฏุฑ ูุณุชุฏุ ูโุชูุงูุฏ ุฏุฑุฎูุงุณุชโูุง `query_range` ุฑุง ฺฉู ุจู ุงู ุญุฏ ูโุฑุณูุฏุ ุชูุณู ฺฉูุฏ. ุงู ุญุฏ ุงูฺฉุงู ูุถูุญ ฺฉ ุฏูููโุง ุจุฑุง ฺฉ ููุชูุ ุง ูุถูุญ ฺฉ ุณุงุนุชู ุจุฑุง ฺฉ ุณุงู ุฑุง ูุฑุงูู ูโฺฉูุฏุ ุจูุงุจุฑุงู ุฏุฑ ุจุดุชุฑ ููุงูุน ูุจุงุฏ ุงุนูุงู ุดูุฏ.
**ุฏุงุฏูโูุง ุชุฑุงุฒ ุดุฏู (Aligned data)**
ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง ูุงููุฏ `Grafana`ุ ูุนููู ุงุณุช ฺฉู `alignment` (ุชุฑุงุฒุจูุฏ) `query_range` ุจุฑ ุงุณุงุณ ุฒูุงู ูุนู ุจุงุดุฏุ ู ุจูุงุจุฑุงู ูุชุงุฌ ุดูุง ฺฉุงููุงู ุจุง ุฏูููโูุงุ ุณุงุนุชโูุง ุง ุฑูุฒูุง ููโุชุฑุงุฒ ูุฎูุงููุฏ ุจูุฏ. ุฏุฑ ุญุงู ฺฉู ุงู ููฺฏุงู ูฺฏุงู ฺฉุฑุฏู ุจู `dashboards` ุฎูุจ ุงุณุชุ ุจู ูุฏุฑุช ฺุฒ ุงุณุช ฺฉู ุจุง ุงุณฺฉุฑูพุชโูุง ฺฏุฒุงุฑุดโฺฏุฑ ูโุฎูุงูุฏ. `query_range` ฺฏุฒููโุง ุจุฑุง ูุดุฎุต ฺฉุฑุฏู `alignment` ูุฏุงุฑุฏุ ุฏุฑ ุนูุถ ุงู ุจู ุดูุง ุจุณุชฺฏ ุฏุงุฑุฏ ฺฉู ูพุงุฑุงูุชุฑ `start` ุฑุง ุจุง `alignment` ุตุญุญ ูุดุฎุต ฺฉูุฏ. ุจู ุนููุงู ูุซุงูุ ุงฺฏุฑ ูโุฎูุงุณุชุฏ ุฏุฑ `Python` `samples` ุฑุง ูุฑ ุณุงุนุช ุณุฑ ุณุงุนุช ุฏุงุดุชู ุจุงุดุฏุ ุนุจุงุฑุช `(time.time() // 3600) * 3600` ุดุฑูุน ุณุงุนุช ูุนู  ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏุ ฺฉู ูโุชูุงูุฏ ุขู ุฑุง ุฏุฑ ฺฏุงูโูุง ณถฐฐ ุชูุธู ฺฉุฑุฏู ู ุจู ุนููุงู ูพุงุฑุงูุชุฑูุง `URL` `start` ู `end` ุงุณุชูุงุฏู ฺฉูุฏ ู ุณูพุณ ุงุฒ ูพุงุฑุงูุชุฑ `step` ุจุง ููุฏุงุฑ 3600 ุงุณุชูุงุฏู ฺฉูุฏ.
ุงฺฉููู ฺฉู ุงุตูู ุงููู ูุญูู ุงุณุชูุงุฏู ุงุฒ `PromQL` ู ุงุฌุฑุง ฺฉูุฆุฑโูุง ุงุฒ ุทุฑู `HTTP APIs` ุฑุง ูโุฏุงูุฏุ ุจุง ุฌุฒุฆุงุช ุจุดุชุฑ ุจู `aggregation` ุฎูุงูู ูพุฑุฏุงุฎุช.